/*! 
* 20231220182517
* Dynamsoft JavaScript Library
* Product: Dynamsoft Document Viewer
* Web Site: https://www.dynamsoft.com
*
* Copyright 2023, Dynamsoft Corporation
* Author: Dynamsoft Support Team
* Version: 1.0.0
*/

(function (exports) {
	'use strict';

	function e(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===t?String:Number)(e)}(e,"string");return "symbol"==typeof t?t:String(t)}function t(t,i,s){return (i=e(i))in t?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t}function i(e,t){return l(e,o(e,t,"get"))}function s(e,t,i){return h(e,o(e,t,"set"),i),i}function o(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function r(e,t,i){return c(e,t),d(i,"get"),l(e,i)}function n(e,t,i,s){return c(e,t),d(i,"set"),h(e,i,s),s}function a(e,t,i){return c(e,t),i}function l(e,t){return t.get?t.get.call(e):t.value}function h(e,t,i){if(t.set)t.set.call(e,i);else {if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i;}}function c(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function d(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function u(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}function g(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(e,t,i){g(e,t),t.set(e,i);}function p(e,t){g(e,t),t.add(e);}const m="\\s*([+-]?\\d+)\\s*",v="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",y="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",w=/^#([0-9a-f]{3,8})$/,b=new RegExp(`^rgb\\(${m},${m},${m}\\)$`),x=new RegExp(`^rgb\\(${y},${y},${y}\\)$`),C=new RegExp(`^rgba\\(${m},${m},${m},${v}\\)$`),S=new RegExp(`^rgba\\(${y},${y},${y},${v}\\)$`),P=new RegExp(`^hsl\\(${v},${y},${y}\\)$`),T=new RegExp(`^hsla\\(${v},${y},${y},${v}\\)$`),k={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};let D=class{constructor(e,i,s,o){t(this,"r",void 0),t(this,"g",void 0),t(this,"b",void 0),t(this,"opacity",void 0),this.r=e,this.g=i,this.b=s,this.opacity=o;}};function E(e){return new D(e>>16&255,e>>8&255,255&e,1)}function A(e,t,i,s){return s<=0&&(e=NaN,t=NaN,i=NaN),new D(e,t,i,s)}function I(e,t,i,s){return s<=0?(e=NaN,t=NaN,i=NaN):i<=0||i>=1?(e=NaN,t=NaN):t<=0&&(e=NaN),{h:e,s:t,l:i,opacity:s}}function M(e,t,i){return e<60?(t+(i-t)*e)/60*255:e<180?255*i:e<240?(t+(i-t)*(240-e))/60*255:255*t}function R(e){const t=e.h<0?e.h%360+360:e.h%360,i=Number.isNaN(t)||Number.isNaN(e.s)?0:e.s,{l:s}=e,o=s+(s<.5?s:1-s)*i,r=2*s-o;return new D(M(t>=240?t-240:t+120,r,o),M(t,r,o),M(t<120?t+240:t-120,r,o),e.opacity)}const O=e=>{let t,i;if(e=`${e}`.trim().toLowerCase(),w.exec(e))switch(t=w.exec(e),i=t[1].length,t=parseInt(t[1],16),i){case 6:return E(t);case 3:return new D(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1);case 8:return A(t>>24&255,t>>16&255,t>>8&255,(255&t)/255);case 4:return A(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255);default:return null}return b.exec(e)?(t=b.exec(e),new D(t[1],t[2],t[3],1)):x.exec(e)?(t=x.exec(e),new D(255*t[1]/100,255*t[2]/100,255*t[3]/100,1)):C.exec(e)?(t=C.exec(e),A(t[1],t[2],t[3],t[4])):S.exec(e)?(t=S.exec(e),A(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4])):P.exec(e)?(t=P.exec(e),R(I(t[1],t[2]/100,t[3]/100,1))):T.exec(e)?(t=T.exec(e),R(I(t[1],t[2]/100,t[3]/100,t[4]))):k.hasOwnProperty(e)?E(k[e]):"transparent"===e?new D(NaN,NaN,NaN,0):null},_=e=>e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`)),N=e=>Object.prototype.toString.call(e),L=e=>Array.isArray?Array.isArray(e):"[object Array]"===N(e),B=e=>null!==e&&"[object Object]"===N(e),U=e=>{let t=null;return L(e)&&(t||(t=[]),e.forEach((e=>{t.push(U(e));}))),B(e)&&(t||(t={}),Object.keys(e).forEach((i=>{t[i]=U(e[i]);}))),t||e},W=e=>void 0===e,V=e=>"[object ArrayBuffer]"===N(e),F=e=>"[object Blob]"===N(e),z=e=>"[object Boolean]"===N(e),H=e=>"function"==typeof e,j=()=>"ontouchstart"in document.documentElement,G=e=>"number"==typeof e&&!Number.isNaN(e),$=e=>"string"==typeof e,X=(e,t,i)=>Math.min(Math.max(e,t),i);let Y=0;const q=()=>(Y+=1,`${(new Date).getTime().toString(36)}${Y.toString(36)}`),Q=e=>{const t=window.URL||window.webkitURL;let i="string";return $(e)?i="string":F(e)?(i="blob",e=t.createObjectURL(e)):(V(e)||L(e))&&(i="blob",e=t.createObjectURL(new Blob([e]))),{type:i,data:e}};function Z(e){return "object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName}let J=class e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t(this,"prefix",void 0),t(this,"postfix",void 0),t(this,"isDestroyed",!1),t(this,"uid",q()),t(this,"cacheEvents",void 0),t(this,"events",void 0),t(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=e,this.postfix=i;}static create(t,i){return new e(t,i)}save(){this.isCached=!0;}restore(){this.isCached=!1,this.cacheEvents.forEach((e=>{let{eventName:t,param:i}=e;this.emit(t,...i);})),this.cacheEvents.length=0;}destroy(){if(!this.isDestroyed){for(const e in this.events)if(Object.prototype.hasOwnProperty.call(this.events,e)){const t=this.events[e];t&&t.slice().forEach((e=>{let{name:t,fn:i,context:s,once:o}=e;this.off(t,i,s,o);}));}this.events={},this.isDestroyed=!0;}}on(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{events:o}=this,r={name:e=this.format(e),uid:q(),context:i,once:s,fn:t};return o[e]||(o[e]=[]),o[e].indexOf(r)<0&&o[e].push(r),r}once(e,t,i){return this.on(e,t,i,!0)}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(this.isCached)return this.cacheEvents.push({eventName:e,param:i}),!0;const{events:o}=this,r=o[e=this.format(e)];return !(!r||!r.length||(r.slice().forEach((e=>{let{fn:t,context:s}=e;t.call(s||null,...i);})),r.slice().forEach((t=>{let{fn:i,context:s,once:o}=t;o&&this.off(e,i,s,o);})),0))}off(e,t,i,s){const{events:o}=this,r=o[e=this.format(e)];if(!r)return !1;if(!arguments.length)return r.length=0,!0;for(let e=r.length-1;e>=0;e--){const o=r[e];t&&o.fn!==t||i&&o.context!==i||s&&o.once!==s||r.splice(e,1);}return !0}removeAllEventListeners(e){if(e){e=this.format(e);const t=this.cacheEvents.findIndex((t=>t.eventName===e));t>-1&&this.cacheEvents.splice(t,1),this.events[e]&&delete this.events[e];}else this.cacheEvents=[],this.events={};}getAllEvents(){return this.events}format(e){return `${this.prefix||""}${e}${this.postfix||""}`}};const K="default";let ee=class e{constructor(){t(this,"emitter",new J);}static create(){return new e}on(e){this.emitter.on(K,e);}emit(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.emitter.emit(K,...t);}off(e){this.emitter.off(K,e);}};function te(){return new ee}const ie=e=>e/180*Math.PI;let se=class e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,"x",void 0),t(this,"y",void 0),t(this,"z",void 0),this.x=e,this.y=i,this.z=s;}static fromPoint(t){return new e(t.x,t.y,t.z)}static fromTwoPoint(t,i){var s,o,r,n,a,l;return new e((null!==(s=i.x)&&void 0!==s?s:0)-(null!==(o=t.x)&&void 0!==o?o:0),(null!==(r=i.y)&&void 0!==r?r:0)-(null!==(n=t.y)&&void 0!==n?n:0),(null!==(a=i.z)&&void 0!==a?a:0)-(null!==(l=t.z)&&void 0!==l?l:0))}static fromValue(t,i,s){return new e(t,i,s)}setFromVector(e){var t;this.x=e.x,this.y=e.y,this.z=null!==(t=e.z)&&void 0!==t?t:0;}clone(){return new e(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(e){var t;return this.x*e.x+this.y*e.y+this.z*(null!==(t=e.z)&&void 0!==t?t:0)}projectionTo(e){const t=Math.hypot(e.x,e.y,e.z);return this.dot(e)/t}angle(e){const t=this.norm()*Math.hypot(e.x,e.y,e.z),i=t&&this.dot(e)/t;return Math.acos(X(i,-1,1))}equals(e){var t;return this.x===e.x&&this.y===e.y&&this.z===(null!==(t=e.z)&&void 0!==t?t:0)}distance(e){var t;return Math.hypot(this.x-e.x,this.y-e.y,this.z-(null!==(t=e.z)&&void 0!==t?t:0))}lerp(t){var i;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:o,y:r,z:n}=this;return new e(o+s*(t.x-o),r+s*(t.y-r),n+s*((null!==(i=t.z)&&void 0!==i?i:0)-n))}normalize(){const e=this,t=e.norm();return e.x/=t,e.y/=t,e.z/=t,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(e){const t=this;return {x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}};function oe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return G(e)?se.fromValue(e,t,i):se.fromPoint(e)}function re(e,t){return se.fromTwoPoint(e,t)}let ne=class e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,"x",void 0),t(this,"y",void 0),t(this,"z",void 0),this.x=e,this.y=i,this.z=s;}static fromPoint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e(t.x,t.y,t.z)}matrixTransform(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:t,y:i,z:s}=this,{m11:o,m21:r,m31:n,m41:a,m12:l,m22:h,m32:c,m42:d,m13:u,m23:g,m33:f,m43:p,m14:m,m24:v,m34:y,m44:w}=e,b=m*t+v*i+y*s+w;return ae({x:(o*t+r*i+n*s+a)/b,y:(l*t+h*i+c*s+d)/b,z:(u*t+g*i+f*s+p)/b})}setFromPoint(e){return this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this}clone(){return ae(this)}equals(e){const{x:t=0,y:i=0,z:s=0}=e,o=this;return o.x===t&&o.y===i&&o.z===s}distanceTo(e){const{x:t=0,y:i=0,z:s=0}=e,o=this;return Math.hypot(o.x-t,o.y-i,o.z-s)}lerpTo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:i=0,y:s=0,z:o=0}=e,r=this;return ae({x:r.x+t*(i-r.x),y:r.y+t*(s-r.y),z:r.z+t*(o-r.z)})}footPointInSegment(e,t){const i=re(e,this),s=re(e,t),o=s.norm(),r=ae(e);if(0===o)return r;const n=i.projectionTo(s)/o;return r.lerpTo(t,n)}perpendicularToSegment(e,t){const i=this.footPointInSegment(e,t);return this.distanceTo(i)}};function ae(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return G(e)?new ne(e,t,i):new ne(e.x,e.y,e.z)}const le=e=>e/Math.PI*180;let he=class e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t(this,"x",void 0),t(this,"y",void 0),t(this,"z",void 0),t(this,"w",void 0),this.x=e,this.y=i,this.z=s,this.w=o;}static fromQuat(t){return (new e).setFromQuat(t)}static fromEuler(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=ie(t)/2,i=ie(i)/2,s=ie(s)/2;const o=Math.sin(t),r=Math.cos(t),n=Math.sin(i),a=Math.cos(i),l=Math.sin(s),h=Math.cos(s),c=new e;return c.setFromQuat({x:o*a*h-r*n*l,y:r*n*h+o*a*l,z:r*a*l-o*n*h,w:r*a*h+o*n*l}),c}clone(){const t=new e;return t.setFromQuat(this),t}setFromQuat(e){var t,i,s,o;const r=this;return r.x=null!==(t=e.x)&&void 0!==t?t:0,r.y=null!==(i=e.y)&&void 0!==i?i:0,r.z=null!==(s=e.z)&&void 0!==s?s:0,r.w=null!==(o=e.w)&&void 0!==o?o:1,this}toEuler(){const{x:e,y:t,z:i,w:s}=this,o=.4990234375,r=this.w*this.y-this.x*this.z;if(r<-o||r>o){const e=Math.sign(r);return {z:-2*e*Math.atan2(this.x,this.w),y:e*(Math.PI/2),x:0}}return {x:le(Math.atan2(2*(t*i+s*e),s*s-e*e-t*t+i*i)),y:le(Math.asin(-2*(e*i-s*t))),z:le(Math.atan2(2*(e*t+s*i),s*s+e*e-t*t-i*i))}}invert(){const{x:e,y:t,z:i,w:s}=this,o=e*e+t*t+i*i+s*s,r=o?1/o:0;return this.x=-e*r,this.y=-t*r,this.z=-i*r,this.w=s*r,this}multiply(e){const{x:t,y:i,z:s,w:o}=this,{x:r,y:n,z:a,w:l}=e;return this.x=t*l+o*r+i*a-s*n,this.y=i*l+o*n+s*r-t*a,this.z=s*l+o*a+t*n-i*r,this.w=o*l-t*r-i*n-s*a,this}normalize(){const{x:e,y:t,z:i,w:s}=this,o=e*e+t*t+i*i+s*s;return this.x/=o,this.y/=o,this.z/=o,this.w/=o,this}};function ce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return G(e)?new he(e,t,i,s):he.fromQuat(e)}function de(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return he.fromEuler(e,t,i)}let ue=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t(this,"x",void 0),t(this,"y",void 0),t(this,"z",void 0),t(this,"w",void 0),this.x=e,this.y=i,this.z=s,this.w=o;}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1;}normalize(){const e=this.norm();this.x/=e,this.y/=e,this.z/=e,this.w/=e;}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}};function ge(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return G(e)?new ue(e,t,i,s):new ue(e.x,e.y,e.z,e.w)}const fe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];let pe=class e{constructor(e){if(t(this,"a",1),t(this,"b",0),t(this,"c",0),t(this,"d",1),t(this,"e",0),t(this,"f",0),t(this,"m11",1),t(this,"m12",0),t(this,"m13",0),t(this,"m14",0),t(this,"m21",0),t(this,"m22",1),t(this,"m23",0),t(this,"m24",0),t(this,"m31",0),t(this,"m32",0),t(this,"m33",1),t(this,"m34",0),t(this,"m41",0),t(this,"m42",0),t(this,"m43",0),t(this,"m44",1),t(this,"is2D",void 0),e||(e=fe),$(e));else {if(!L(e))throw new Error("DefaultMatrix error.");we(e,this);}}static fromQuat(t){const{x:i,y:s,z:o,w:r}=t,n=new e;return n.m11=1-2*(s*s+o*o),n.m12=2*(i*s+o*r),n.m13=2*(i*o-s*r),n.m21=2*(i*s-o*r),n.m22=1-2*(i*i+o*o),n.m23=2*(s*o+i*r),n.m31=2*(i*o+s*r),n.m32=2*(s*o-i*r),n.m33=1-2*(i*i+s*s),n.setFromMatrix(n),n}static fromMatrix(t){const i=new e;return i.setFromMatrix(t),i.is2D=!!t.is2D,i}static fromFloat32Array(t){const i=new e;return we(t,i),i}static fromFloat64Array(t){const i=new e;return we(t,i),i}get isIdentity(){const e=this.toArray();for(let t=0;t<16;t++)if(e[t]!==fe[t])return !1;return !0}translate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.clone().translateSelf(e,t,i)}scale(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return W(t)&&(t=e),this.clone().scaleSelf(e,t,i,s,o,r)}scale3d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().scale3dSelf(e,t,i,s)}rotate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return this.clone().rotateSelf(e,t,i)}rotateFromVector(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().rotateFromVectorSelf(e,t)}rotateAxisAngle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().rotateAxisAngleSelf(e,t,i,s)}skewX(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewXSelf(e)}skewY(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewYSelf(e)}multiply(e){return this.clone().multiplySelf(e)}flipX(){return this.clone().multiplySelf(new e([-1,0,0,1,0,0]))}flipY(){return this.clone().multiplySelf(new e([1,0,0,-1,0,0]))}inverse(){return this.clone().invertSelf()}transformPoint(){return ae(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).matrixTransform(this)}toFloat32Array(){const e=this.toArray();return new Float32Array(e)}toFloat64Array(){const e=this.toArray();return new Float64Array(e)}toJSON(){}multiplySelf(){const e=be(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(e),this}preMultiplySelf(){const e=be(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(e),this}translateSelf(){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const t=function(){return {m11:1,m21:0,m31:0,m41:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m12:0,m22:1,m32:0,m42:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m13:0,m23:0,m33:1,m43:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,m14:0,m24:0,m34:0,m44:1}}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e);return this.multiplySelf(t),e&&(this.is2D=!1),this}scaleSelf(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.translateSelf(s,o,r),W(t)&&(t=e);const n=function(){return {m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1}}(e,t,i);return this.multiplySelf(n),this.translateSelf(-s,-o,-r),1!==i&&(this.is2D=!1),this}scale3dSelf(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.scaleSelf(e,e,e,t,i,s)}rotateSelf(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;W(t)&&W(i)&&(i=e,e=0,t=0),W(t)&&(t=0),W(i)&&(i=0),0===e&&0===t||(this.is2D=!1);const s=xe(i,[0,0,1]),o=xe(t,[0,1,0]),r=xe(e,[1,0,0]);return this.multiplySelf(s),this.multiplySelf(o),this.multiplySelf(r),this}rotateFromVectorSelf(){const e=oe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),t=oe(1,0),i=xe(e.angle(t),[0,0,1]);return this.multiplySelf(i),this}rotateAxisAngleSelf(){const e=xe(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0]);return this.multiplySelf(e),this}skewXSelf(){const e=Ce(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return this.multiplySelf(e),this}skewYSelf(){const e=Ce(0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0);return this.multiplySelf(e),this}invertSelf(){const e=function(e){if(e[0].length!==e.length)throw new Error;const t=ve(e),i=function(e){if(e[0].length!==e.length)throw new Error("Not square matrix.");const t=e.length,i=new Array(t).fill(0).map((e=>new Array(t).fill(0)));for(let s=0;s<t;s++)for(let o=0;o<t;o++)i[s][o]=ye(e,s,o);return function(e){const t=new Array(e.length).fill(0).map((t=>new Array(e[0].length).fill(0)));for(let i=0;i<t.length;i++)for(let s=0;s<t[0].length;s++)t[i][s]=e[s][i];return t}(i)}(e);for(let e=0;e<i.length;e++)for(let s=0;s<i.length;s++)i[e][s]/=t;return i}(this.toTwoDimensionalArray());return this.setFromTwoDimensionalArray(e),this}setMatrixValue(e){}setFromMatrix(e){const t=this;t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m21=e.m21,t.m22=e.m22,t.m23=e.m23,t.m24=e.m24,t.m31=e.m31,t.m32=e.m32,t.m33=e.m33,t.m34=e.m34,t.m41=e.m41,t.m42=e.m42,t.m43=e.m43,t.m44=e.m44,t.a=e.m11,t.b=e.m12,t.c=e.m21,t.d=e.m22,t.e=e.m41,t.f=e.m42,!1===e.is2D&&(t.is2D=!1);}setFromTwoDimensionalArray(e){const[[t,i,s,o],[r,n,a,l],[h,c,d,u],[g,f,p,m]]=e;this.setFromMatrix({m11:t,m21:i,m31:s,m41:o,m12:r,m22:n,m32:a,m42:l,m13:h,m23:c,m33:d,m43:u,m14:g,m24:f,m34:p,m44:m});}clone(){return e.fromMatrix(this)}determinant(){return ve(this.toTwoDimensionalArray())}toTwoDimensionalArray(){const e=this;return [[e.m11,e.m21,e.m31,e.m41],[e.m12,e.m22,e.m32,e.m42],[e.m13,e.m23,e.m33,e.m43],[e.m14,e.m24,e.m34,e.m44]]}toArray(){const e=this;return [e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44]}decompose(){if(0===this.m44)return {};let e=ge(0,0,0,1);const t=ce(0,0,0,1),i=oe(0,0,0),s=oe(0,0,0),o=oe(0,0,0),r=this;r.normalize();const n=r.clone();if(n.m14=0,n.m24=0,n.m34=0,n.m44=1,0===n.determinant())return !1;if(0!==r.m14||0!==r.m24||0!==r.m34){const t={x:r.m14,y:r.m24,z:r.m34,w:r.m44};e=n.invertSelf().transposeSelf().multiplyVector(t);}else e.x=0,e.y=0,e.z=0,e.w=1;o.x=r.m41,o.y=r.m42,o.z=r.m43;const a=[oe(r.m11,r.m12,r.m13),oe(r.m21,r.m22,r.m23),oe(r.m31,r.m32,r.m33)];i.x=a[0].norm(),a[0].normalize(),s.x=a[0].dot(a[1]),a[1]=oe(me(a[1],a[0],1,-s.x)),i.y=a[1].norm(),a[1].normalize(),s.x/=i.y,s.y=a[0].dot(a[2]),a[2]=oe(me(a[2],a[0],1,-s.y)),s.z=a[1].dot(a[2]),a[2]=oe(me(a[2],a[1],1,-s.z)),i.z=a[2].norm(),a[2].normalize(),s.y/=i.z,s.z/=i.z;const l=a[1].cross(a[2]);let h;if(a[0].dot(l)<0&&(i.negate(),a[0].negate(),a[1].negate(),a[2].negate()),t.x=.5*Math.max(1+a[0].x-a[1].y-a[2].z,0)**.5,t.y=.5*Math.max(1-a[0].x+a[1].y-a[2].z,0)**.5,t.z=.5*Math.max(1-a[0].x-a[1].y+a[2].z,0)**.5,t.w=.5*Math.max(1+a[0].x+a[1].y+a[2].z,0)**.5,a[2].y>a[1].z&&(t.x*=-1),a[0].z>a[2].x&&(t.y*=-1),a[1].x>a[0].y&&(t.z*=-1),t.x<.001&&t.x>=0&&t.y<.001&&t.y>=0){const e=Math.atan2(a[0].y,a[0].x);h={x:0,y:0,z:Number(le(e).toFixed(3))};}else h=t.toEuler();return {rotation:h,scale:i,translation:o,skew:s,quaternion:t,perspective:e}}multiplyVector(e){const t=this,{x:i,y:s,z:o,w:r}=e;return {x:t.m11*i+t.m21*s+t.m31*o+t.m41*r,y:t.m12*i+t.m22*s+t.m32*o+t.m42*r,z:t.m13*i+t.m23*s+t.m33*o+t.m43*r,w:t.m14*i+t.m24*s+t.m34*o+t.m44*r}}transpose(){const e=this.clone();return e.transposeSelf(),e}transposeSelf(){const{m11:e,m21:t,m31:i,m41:s,m12:o,m22:r,m32:n,m42:a,m13:l,m23:h,m33:c,m43:d,m14:u,m24:g,m34:f,m44:p}=this;return this.setFromMatrix({m11:e,m21:o,m31:l,m41:u,m12:t,m22:r,m32:h,m42:g,m13:i,m23:n,m33:c,m43:f,m14:s,m24:a,m34:d,m44:p}),this}normalize(){const e=this,t=e.m44;e.m11/=t,e.m12/=t,e.m13/=t,e.m14/=t,e.m21/=t,e.m22/=t,e.m23/=t,e.m24/=t,e.m31/=t,e.m32/=t,e.m33/=t,e.m34/=t,e.m41/=t,e.m42/=t,e.m43/=t,e.m44/=t;}getTranslation(){return oe(this.m41,this.m42,this.m43)}getRotation(){const e=this,t=.5*(e.m11+e.m22+e.m33+1)**.5;return ce(.25*(e.m23-e.m32)/t,.25*(e.m31-e.m13)/t,.25*(e.m12-e.m21)/t,t)}getScaling(){const e=this;return oe(Math.hypot(e.m11,e.m12,e.m13),Math.hypot(e.m21,e.m22,e.m23),Math.hypot(e.m31,e.m32,e.m33))}toEuler(){const e=this.getRotation().toEuler();return oe(e.x,e.y,e.z)}};function me(e,t,i,s){return {x:i*e.x+s*t.x,y:i*e.y+s*t.y,z:i*e.z+s*t.z}}function ve(e){if(e.length!==e[0].length)throw new Error;const t=e.length;let i=0;if(t>3)for(let s=0;s<t;s++)i+=e[0][s]*ye(e,0,s);else 3===t?i=e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][2]*e[1][1]*e[2][0]-e[0][1]*e[1][0]*e[2][2]-e[0][0]*e[1][2]*e[2][1]:2===t?i=e[0][0]*e[1][1]-e[0][1]*e[1][0]:1===t&&([[i]]=e);return i}function ye(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=e.length,o=new Array(s-1).fill(0).map((e=>new Array(s-1).fill(0)));for(let r=0;r<s-1;r++)for(let n=0;n<s-1;n++){const s=r<t?r:r+1,a=n<i?n:n+1;o[r][n]=e[s][a];}return (-1)**(t+i)*ve(o)}function we(e,t){const[i,s,o,r,n,a,l,h,c,d,u,g,f,p,m,v]=e;if(6===e.length)t.m11=i,t.m12=s,t.m21=o,t.m22=r,t.m41=n,t.m42=a,t.m13=0,t.m14=0,t.m23=0,t.m24=0,t.m31=0,t.m32=0,t.m34=0,t.m33=1,t.m44=1,t.is2D=!0;else {if(16!==e.length)throw new Error;t.m11=i,t.m12=s,t.m13=o,t.m14=r,t.m21=n,t.m22=a,t.m23=l,t.m24=h,t.m31=c,t.m32=d,t.m33=u,t.m34=g,t.m41=f,t.m42=p,t.m43=m,t.m44=v,t.is2D=!1;}}function be(e,t){const i={},{m11:s,m21:o,m31:r,m41:n,m12:a,m22:l,m32:h,m42:c,m13:d,m23:u,m33:g,m43:f,m14:p,m24:m,m34:v,m44:y}=e,{m11:w,m21:b,m31:x,m41:C,m12:S,m22:P,m32:T,m42:k,m13:D,m23:E,m33:A,m43:I,m14:M,m24:R,m34:O,m44:_}=t;return i.m11=s*w+o*S+r*D+n*M,i.m21=s*b+o*P+r*E+n*R,i.m31=s*x+o*T+r*A+n*O,i.m41=s*C+o*k+r*I+n*_,i.m12=a*w+l*S+h*D+c*M,i.m22=a*b+l*P+h*E+c*R,i.m32=a*x+l*T+h*A+c*O,i.m42=a*C+l*k+h*I+c*_,i.m13=d*w+u*S+g*D+f*M,i.m23=d*b+u*P+g*E+f*R,i.m33=d*x+u*T+g*A+f*O,i.m43=d*C+u*k+g*I+f*_,i.m14=p*w+m*S+v*D+y*M,i.m24=p*b+m*P+v*E+y*R,i.m34=p*x+m*T+v*A+y*O,i.m44=p*C+m*k+v*I+y*_,i}function xe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1];e=ie(e);const i=Math.sin(e/2)*Math.cos(e/2),s=Math.sin(e/2)**2,[o,r,n]=t;return {m11:1-2*(r**2+n**2)*s,m21:2*(o*r*s-n*i),m31:2*(o*n*s+r*i),m41:0,m12:2*(o*r*s+n*i),m22:1-2*(o**2+r**2)*s,m32:2*(r*n*s-o*i),m42:0,m13:2*(o*n*s-r*i),m23:2*(r*n*s+o*i),m33:1-2*(o**2+r**2)*s,m43:0,m14:0,m24:0,m34:0,m44:1}}function Ce(e,t){const i=new pe;return e&&(i.m21=Math.tan(ie(e))),t&&(i.m12=Math.tan(ie(t))),i}function Se(e,t,i){const s=e.x-t.x,o=e.y-t.y;let r=(i.x-e.x)*s+(i.y-e.y)*o;return r/=s*s+o*o,new ne(e.x+r*s,e.y+r*o)}function Pe(e,t){return ((e.x-t.x)**2+(e.y-t.y)**2)**.5}function Te(e,t,i){return (i.x-e.x)*(t.y-e.y)==(t.x-e.x)*(i.y-e.y)&&Math.min(e.x,t.x)<=i.x&&i.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=i.y&&i.y<=Math.max(e.y,t.y)}let ke=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t(this,"x",0),t(this,"y",0),t(this,"left",0),t(this,"top",0),t(this,"right",0),t(this,"bottom",0),t(this,"width",0),t(this,"height",0),this.update(e,i,s,o);}update(e,t,i,s){this.x=e,this.y=t,this.left=e,this.top=t,this.right=e+i,this.bottom=t+s,this.width=i,this.height=s;}toJSON(){}};function De(e,t,i,s,o){const{cos:r,sin:n}=Math;return {x:(e-i)*r(o)-(t-s)*n(o)+i,y:(e-i)*n(o)+(t-s)*r(o)+s}}const Ee=new class{constructor(){t(this,"tasks",[]);}createTimer(e,t){const i=q();return this.tasks.push({uid:i,callback:e,time:t}),this.executeTimer(i),i}executeTimer(e){const t=this.tasks.find((t=>t.uid===e));if(!t)return;const i=()=>{t.callback(),null!==t.timer&&(t.timer=setTimeout(i,t.time));};t.timer=setTimeout(i,t.time);}clearTimer(e){const t=this.tasks.findIndex((t=>t.uid===e));t>-1&&(clearTimeout(this.tasks[t].timer),this.tasks[t].timer=null,this.tasks.splice(t,1));}};function Ae(e,t){return ((e.x-t.x)**2+(e.y-t.y)**2)**.5}function Ie(e){const{type:t,value:i}=e;return "hex"===t?`#${i}`:"literal"===t?i:"rgb"===t?`rgb(${i.join(",")})`:`rgba(${i.join(",")})`}const Me=function(){const e={linearGradient:/^(linear\-gradient)/i,repeatingLinearGradient:/^(repeating\-linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,repeatingRadialGradient:/^(repeating\-radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/};let t="";function i(e){throw new Error(`${t}: ${e}`)}function s(){return o("linear-gradient",e.linearGradient,n)||o("repeating-linear-gradient",e.repeatingLinearGradient,n)||o("radial-gradient",e.radialGradient,a)||o("repeating-radial-gradient",e.repeatingRadialGradient,a)||o("conic-gradient",e.conicGradient,a)}function o(t,s,o){return r(s,(s=>{const r=o();return r&&(y(e.comma)||i("Missing comma before color stops")),{type:t,orientation:r,colorStops:u(g)}}))}function r(t,s){const o=y(t);if(o){y(e.startCall)||i("Missing (");const t=s(o);return y(e.endCall)||i("Missing )"),t}}function n(){return v("directional",e.sideOrCorner,1)||v("angular",e.angleValue,1)}function a(){let i,s,o=l();return o&&(i=[],i.push(o),s=t,y(e.comma)&&(o=l(),o?i.push(o):t=s)),i}function l(){let e=function(){const e=v("shape",/^(circle)/i,0);return e&&(e.style=m()||h()),e}()||function(){const e=v("shape",/^(ellipse)/i,0);return e&&(e.style=p()||h()),e}();if(e)e.at=c();else {const t=h();if(t){e=t;const i=c();i&&(e.at=i);}else {const t=d();t&&(e={type:"default-radial",at:t});}}return e}function h(){return v("extent-keyword",e.extentKeywords,1)}function c(){if(v("position",/^at/,0)){const e=d();return e||i("Missing positioning value"),e}}function d(){const e={x:p(),y:p()};if(e.x||e.y)return {type:"position",value:e}}function u(t){let s=t();const o=[];if(s)for(o.push(s);y(e.comma);)s=t(),s?o.push(s):i("One extra comma");return o}function g(){const t=v("hex",e.hexColor,1)||r(e.rgbaColor,(()=>({type:"rgba",value:u(f)})))||r(e.rgbColor,(()=>({type:"rgb",value:u(f)})))||v("literal",e.literalColor,0);return t||i("Expected color definition"),t.length=p(),t}function f(){return y(e.number)[1]}function p(){return v("%",e.percentageValue,1)||v("position-keyword",e.positionKeywords,1)||m()}function m(){return v("px",e.pixelValue,1)||v("em",e.emValue,1)}function v(e,t,i){const s=y(t);if(s)return {type:e,value:s[i]}}function y(e){const i=/^[\n\r\t\s]+/.exec(t);i&&w(i[0].length);const s=e.exec(t);return s&&w(s[0].length),s}function w(e){t=t.substring(e);}return function(e){return t=e,function(){const e=u(s);return t.length>0&&i("Invalid input not EOF"),e}()}}();function Re(e){let t="";return 0===(e=String(e)).length?"":(t=e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"'),t)}const Oe=(e,t,i)=>{void 0===t?i.appendChild(e):i.insertBefore(e,t);},_e=(e,t)=>{const i=t.parentNode;i.lastChild===t?i.appendChild(e):Oe(e,t.nextSibling,i);},Ne=()=>{const e=window;if(e){if(e.devicePixelRatio)return e.devicePixelRatio;if(e.screen.deviceXDPI&&e.screen.logicalXDPI)return e.screen.deviceXDPI/e.screen.logicalXDPI}return 1};function Le(e){let t="0px",i="",s="solid";if(!W(e)&&""!==e){const o=document.createElement("div");o.style.border=e;const{borderWidth:r,borderColor:n,borderStyle:a}=o.style;"initial"!==r&&""!==r&&(t=r),"initial"!==n&&""!==n&&(i=n),"initial"!==a&&""!==a&&(s=a);}return {borderWidth:t,borderColor:i,borderStyle:s}}const Be=function(e,t){const i=e.indexOf(t);return !(i<0||(e.splice(i,1),0))},Ue=function(e,t,i){if(G(i)){let s=[],o=[];if(t.includes(i)){const e=t.length;if(e>1){const r=t.indexOf(i);0===r?o=t.slice(1):r===e-1?s=t.slice(0,-1):(s=t.slice(0,r),o=t.slice(r+1));}}else s=t;const r=e[i],n=s.map((t=>e[t])),a=o.map((t=>e[t]));n.forEach((t=>{const i=e.indexOf(t);i>-1&&e.splice(i,1);})),a.forEach((t=>{const i=e.indexOf(t);i>-1&&e.splice(i,1);}));const l=e.indexOf(r);e.splice(l+1,0,...a),e.splice(l,0,...n);}else t.map((t=>e[t])).forEach((t=>{const i=e.indexOf(t);e.splice(i,1),e.push(t);}));return !0},We=function(e,t,i){if(t===i)return !0;const s=e[t];return e[t]=e[i],e[i]=s,!0},Ve=function(e,t){const i=t.length;return !(e.length!==i||!i||(t.every(((e,t)=>e===t))||t.map((t=>e[t])).forEach(((t,i)=>{e[i]=t;})),0))};function Fe(e){return null==e}const ze=(e,t)=>e in t,He=(e,t)=>{const i=[];for(;e;){const s=e.match(t);if(!s)break;i.push(s),e=e.substring(s.index+s[0].length);}return i};function je(e,t){return Object.keys(e).forEach((i=>{W(t[i])?t[i]=e[i]:B(e[i])?je(e[i],t[i]):t[i]=e[i];})),t}var Ge,$e,Xe,Ye,qe,Qe,Ze,Je,Ke,et,tt,it,st,ot,rt,nt,at,lt,ht,ct,dt,ut,gt,ft,pt,mt,vt,yt,wt,bt,xt,Ct,St,Pt,Tt,kt,Dt,Et,At,It,Mt,Rt,Ot,_t,Nt,Lt,Bt,Ut,Wt,Vt,Ft,zt,Ht,jt,Gt,$t,Xt,Yt,qt,Qt,Zt,Jt,Kt,ei,ti,ii,si,oi,ri,ni,ai,li,hi,ci,di,ui,gi,fi,pi,mi,vi,yi,wi,bi,xi,Ci,Si,Pi,Ti,ki,Di,Ei,Ai,Ii,Mi,Ri,Oi,_i,Ni,Li,Bi,Ui,Wi,Vi,Fi,zi,Hi,ji,Gi,$i,Xi,Yi,qi,Qi,Zi,Ji,Ki,es,ts,is,ss,os,rs,ns,as,ls,hs,cs,ds,us,gs,fs,ps,ms,vs,ys,ws,bs,xs,Cs,Ss,Ps,Ts,ks,Ds,Es,As,Is,Ms,Rs,Os,_s,Ns,Ls,Bs,Us,Ws,Vs,Fs,zs,Hs,js;async function Gs(e){let t;if(e instanceof ArrayBuffer)e.byteLength>12&&(t=new Uint8Array(e.slice(0,12)));else if(e instanceof Blob&&e.size>12){const i=e.slice(0,12),s=await i.arrayBuffer();t=new Uint8Array(s);}if(t){if(function(e){return 37===e[0]&&80===e[1]&&68===e[2]&&70===e[3]}(t))return Ge.APPLICATION_PDF;if(function(e){return 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]}(t))return Ge.IMAGE_PNG;if(function(e){return 255===e[0]&&216===e[1]}(t))return Ge.IMAGE_JPEG;if(function(e){return 66===e[0]&&77===e[1]}(t))return Ge.IMAGE_BMP;if(function(e){return 73===e[0]&&73===e[1]&&42===e[2]&&0===e[3]||77===e[0]&&77===e[1]&&0===e[2]&&42===e[3]}(t))return Ge.IMAGE_TIFF;if(function(e){return 0===e[0]&&0===e[1]&&0===e[2]&&12===e[3]&&106===e[4]&&80===e[5]&&32===e[6]&&32===e[7]||255===e[0]&&79===e[1]&&255===e[2]&&81===e[3]}(t))return Ge.IMAGE_JP2;if(e instanceof Blob&&(e.type===Ge.APPLICATION_PDF||e.type===Ge.IMAGE_BMP||e.type===Ge.IMAGE_JP2||e.type===Ge.IMAGE_JPEG||e.type===Ge.IMAGE_PNG||e.type===Ge.IMAGE_TIFF||e.type===Ge.IMAGE_WEBP||e.type===Ge.IMAGE_RGBA))return e.type}return ""}function $s(e){return !(!G(e)||G(e)&&!Number.isInteger(e))}function Xs(e,t,i,s){return new(i||(i=Promise))((function(o,r){function n(e){try{l(s.next(e));}catch(e){r(e);}}function a(e){try{l(s.throw(e));}catch(e){r(e);}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t);}))).then(n,a);}l((s=s.apply(e,t||[])).next());}))}function Ys(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)}function qs(e,t,i,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===s?o.call(e,i):o?o.value=i:t.set(e,i),i}!function(e){e.IMAGE_PNG="image/png",e.IMAGE_JPEG="image/jpeg",e.IMAGE_BMP="image/bmp",e.IMAGE_WEBP="image/webp",e.IMAGE_TIFF="image/tiff",e.IMAGE_JP2="image/jp2",e.APPLICATION_PDF="application/pdf",e.IMAGE_RGBA="image/rgba";}(Ge||(Ge={})),"function"==typeof SuppressedError&&SuppressedError,function(e){e.logInfo="logInfo",e.logDebug="logDebug",e.logAll="logAll",e.imgIO="imgIO",e.core="imgCore",e.imgProc="imgProc",e.pdfR="pdfReader",e.pdfW="pdfWriter",e.crypto="crypto",e.binaryBlobType="application/octet-stream",e.wasmExtension=".wasm";}($e||($e={})),function(e){e.core="ddv-core",e.reader="ddv-reader",e.detector="ddv-detector";}(Xe||(Xe={})),function(e){e.pending="pending",e.ready="ready",e.failed="failed",e.destroyed="destroyed",e.init="init";}(Ye||(Ye={})),function(e){e.PARAMETER_TYPE_ERROR="Parameter Type not Supported = ",e.TIMEOUT="Timeout no Response = ",e.FILE_STREAM_ERROR="File Stream Error = ",e.WASM_EXCEPTION_ERROR="An WASM exception occurred.";}(qe||(qe={})),function(e){e[e.LONG_KEY=0]="LONG_KEY",e[e.DLS_KEY=1]="DLS_KEY";}(Qe||(Qe={})),function(e){e[e.wasmSucceed=0]="wasmSucceed",e[e.wasmBase=-4e3]="wasmBase",e[e.wasmException=-4001]="wasmException",e[e.wasmNoModule=-4002]="wasmNoModule",e[e.wasmJsBase=-4100]="wasmJsBase",e[e.wasmJsObjectNotInit=-4101]="wasmJsObjectNotInit",e[e.wasmJsObjectTerminated=-4102]="wasmJsObjectTerminated",e[e.wasmJsObjectInitFailed=-4103]="wasmJsObjectInitFailed",e[e.wasmJsNotLoaded=-4104]="wasmJsNotLoaded",e[e.wasmJsInvalidJson=-4105]="wasmJsInvalidJson",e[e.wasmJsWorkerRunException=-4106]="wasmJsWorkerRunException",e[e.wasmJsWorkerRunFailed=-4107]="wasmJsWorkerRunFailed",e[e.wasmJsReadFileFailed=-4108]="wasmJsReadFileFailed",e[e.wasmJsCoreTaskException=-4109]="wasmJsCoreTaskException",e[e.wasmJsProcTaskException=-4110]="wasmJsProcTaskException",e[e.wasmJsSavePdfFailed=-4111]="wasmJsSavePdfFailed",e[e.wasmJsSaveTiffFailed=-4112]="wasmJsSaveTiffFailed";}(Ze||(Ze={})),function(e){e[e.IT_DIB=-1]="IT_DIB",e[e.IT_RGBA=-2]="IT_RGBA",e[e.IT_BGRA=-3]="IT_BGRA",e[e.IT_BMP=0]="IT_BMP",e[e.IT_JPG=1]="IT_JPG",e[e.IT_PNG=3]="IT_PNG",e[e.IT_ALL=5]="IT_ALL";}(Je||(Je={})),function(e){e[e.RT_AUTO=-1]="RT_AUTO",e[e.RT_BINARY=1]="RT_BINARY",e[e.RT_BASE64=2]="RT_BASE64";}(Ke||(Ke={})),function(e){e[e.SF_DEF=0]="SF_DEF",e[e.SF_ENABLE=1]="SF_ENABLE",e[e.SF_DISABLE=2]="SF_DISABLE";}(et||(et={})),function(e){e.imgIOVer="1.8.9",e.coreVer="1.8.9",e.imgProcVer="1.8.9",e.pdfRVer="1.8.9",e.pdfWVer="1.8.9",e.cryptoVer="1.8.9";}(At||(At={}));class Qs{static setLogFunc(e,t,i){qs(this,tt,e,"f",it),qs(this,tt,t,"f",st),qs(this,tt,i,"f",ot);}static get level(){return Ys(this,tt,"f",it)}static get func(){return Ys(this,tt,"f",st)}static get context(){return Ys(this,tt,"f",ot)}static logAll(e){this.log($e.logAll,e);}static logD(e){this.log($e.logDebug,e);}static log(e,t){Ys(this,tt,"f",st)&&Ys(this,tt,"f",it)===e&&Ys(this,tt,"f",st).call(this,t,Ys(this,tt,"f",ot));}}tt=Qs,it={value:""},st={value:void 0},ot={value:null};class Zs{static unload(){qs(this,rt,"","f",nt),qs(this,rt,"","f",lt),qs(this,rt,null,"f",ht),Qs.setLogFunc("",void 0,null);}static get UseSimd(){return Ys(this,rt,"f",dt)}static set UseSimd(e){qs(this,rt,e,"f",dt);}static get License(){return Ys(this,rt,"f",nt)}static set License(e){qs(this,rt,e,"f",nt);}static get LicMode(){return Ys(this,rt,"f",at)}static set LicMode(e){qs(this,rt,e,"f",at),Ys(this,rt,"m",gt).call(this);}static get UUID(){return Ys(this,rt,"f",lt)}static set UUID(e){qs(this,rt,e,"f",lt);}static get NavInfo(){return Ys(this,rt,"f",ht)}static set NavInfo(e){qs(this,rt,e,"f",ht);}static get Mobile(){return Ys(this,rt,"f",ct)}static set Mobile(e){qs(this,rt,e,"f",ct);}static get DefHeapSize(){return Ys(this,rt,"f",ft)}static set DefHeapSize(e){qs(this,rt,e,"f",ft);}static get MaxHeapSize(){return Ys(this,rt,"f",pt)}static get HeapConfig(){return Ys(this,rt,"m",vt).call(this),Object.assign({},Ys(this,rt,"f",mt))}static getWorkerHeap(e){return void 0!==Ys(this,rt,"f",mt)[e]?Ys(this,rt,"f",mt)[e]:{maxHeapSize:Ys(this,rt,"f",pt),initHeapSize:Ys(this,rt,"f",ft)}}static UpdateHeapConfig(e,t,i){Ys(this,rt,"m",vt).call(this),t&&void 0!==Ys(this,rt,"f",mt)[e]&&(Ys(this,rt,"f",mt)[e].maxHeapSize=t),i&&void 0!==Ys(this,rt,"f",mt)[e]&&(Ys(this,rt,"f",mt)[e].initHeapSize=i);}static get ImageIOWorkerJS(){return "ddv-imageio.worker.js?v="+At.imgIOVer}static get PdfReaderWorkerJS(){return "dynamsoft.pdfReader_wasm-"+At.pdfRVer+".js"}static get ImageIOPrefixName(){return "ddv-imageio"}static get ImagecorePrefixName(){return "ddv-imagecore"}static get ImageProcPrefixName(){return "ddv-imageproc"}static get PdfReaderPrefixName(){return "ddv-pdfreader"}static get CryptoPrefixName(){return "ddv-crypto"}static get ImageIOResource(){return Ys(this,rt,"f",bt)}static set ImageIOResource(e){qs(this,rt,Ys(this,rt,"m",yt).call(this,e),"f",bt),Ys(this,rt,"m",Ct).call(this,Ys(this,rt,"f",bt),Ys(this,rt,"f",St)),Ys(this,rt,"m",Ct).call(this,Ys(this,rt,"f",bt),Ys(this,rt,"f",Pt)),Ys(this,rt,"m",Ct).call(this,Ys(this,rt,"f",bt),Ys(this,rt,"f",kt)),Ys(this,rt,"m",Ct).call(this,Ys(this,rt,"f",bt),Ys(this,rt,"f",Dt));}static get PdfReaderResource(){return Ys(this,rt,"f",xt)}static set PdfReaderResource(e){e.useFastCompEdition=!1,qs(this,rt,Ys(this,rt,"m",yt).call(this,e),"f",xt),Ys(this,rt,"m",Ct).call(this,Ys(this,rt,"f",xt),Ys(this,rt,"f",Tt)),this.PdfReaderModule.singleInstance=!0;}static get ImageIOModule(){return Ys(this,rt,"f",St)}static get CryptoModule(){return Ys(this,rt,"f",Pt)}static get PdfReaderModule(){return Ys(this,rt,"f",Tt)}static get ImagecoreModule(){return Ys(this,rt,"f",kt)}static get ImageReadereModule(){const e=Object.assign({},Ys(this,rt,"f",kt));return e.workerName=Xe.reader,e}static get ImageProcModule(){return Ys(this,rt,"f",Dt)}static get DetectorModule(){return qs(this,rt,Object.assign({},Ys(this,rt,"f",Dt)),"f",Et),Ys(this,rt,"f",Et).workerName=Xe.detector,Ys(this,rt,"f",Et)}static get PdfWriterModule(){const e=Object.assign({},Ys(this,rt,"f",Tt));return e.workerName=Xe.core,e}static setLogFunc(e,t,i){Qs.setLogFunc(e,t,i);}}rt=Zs,ut=function(e){this.LicMode==Qe.DLS_KEY&&e.dependencyModules&&-1!=e.dependencyModules.indexOf($e.imgIO)&&-1==e.dependencyModules.indexOf($e.crypto)&&e.dependencyModules.push($e.crypto);},gt=function(){Ys(this,rt,"m",ut).call(this,Ys(this,rt,"f",kt)),Ys(this,rt,"m",ut).call(this,Ys(this,rt,"f",Dt)),Ys(this,rt,"m",ut).call(this,Ys(this,rt,"f",Tt));},vt=function(){0===Object.keys(Ys(this,rt,"f",mt)).length&&(Ys(this,rt,"f",mt)[Xe.core]={},Ys(this,rt,"f",mt)[Xe.core].maxHeapSize=Ys(this,rt,"f",pt),Ys(this,rt,"f",mt)[Xe.core].initHeapSize=Ys(this,rt,"f",ft),Ys(this,rt,"f",mt)[Xe.reader]={},Ys(this,rt,"f",mt)[Xe.reader].maxHeapSize=Ys(this,rt,"f",pt),Ys(this,rt,"f",mt)[Xe.reader].initHeapSize=Ys(this,rt,"f",ft),Ys(this,rt,"f",mt)[Xe.detector]={},Ys(this,rt,"f",mt)[Xe.detector].maxHeapSize=Ys(this,rt,"f",pt),Ys(this,rt,"f",mt)[Xe.detector].initHeapSize=Ys(this,rt,"f",ft));},yt=function(e){var t,i,s;let o={crossScript:!1,resourceDir:e.resourceDir,workerScript:e.workerScript,useFastCompEdition:null!==(t=e.useFastCompEdition)&&void 0!==t&&t,useSimd:null!==(i=e.useSimd)&&void 0!==i?i:Ys(this,rt,"f",dt),fetchOptions:null!==(s=e.fetchOptions)&&void 0!==s?s:Ys(this,rt,"f",wt)};return o.workerScript=e.resourceDir+e.workerScript,o.workerScript.startsWith("http://")||o.workerScript.startsWith("https://")?(o.resourceDir=e.resourceDir,o.workerScript.startsWith(location.origin)||(o.crossScript=!0)):e.resourceDir.startsWith("/")?null!=location.origin&&(o.resourceDir=location.origin+e.resourceDir):null!=location.href&&(o.resourceDir=location.href.substring(0,location.href.lastIndexOf("/")+1)+e.resourceDir),o.resourceDir.endsWith("/")||(o.resourceDir+="/"),e.useFastCompEdition&&(o.resourceDir+="fastcomp/",o.workerScript=o.resourceDir+e.workerScript),o},Ct=function(e,t){t.resourceDir=e.resourceDir,t.crossScript=e.crossScript,t.name===$e.imgProc?t.useSimd=e.useSimd:t.useSimd=!1,t.script=e.workerScript,t.fetchOptions=e.fetchOptions;},nt={value:""},at={value:Qe.LONG_KEY},lt={value:""},ht={value:null},ct={value:!1},dt={value:!1},ft={value:32},pt={value:200},mt={value:Object.create(null)},wt={value:{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}},bt={value:{resourceDir:"",workerScript:Zs.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:Ys(Zs,rt,"f",wt)}},xt={value:{resourceDir:"",workerScript:Zs.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:Ys(Zs,rt,"f",wt)}},St={value:{name:$e.imgIO,workerName:Xe.core,autoLoad:!1,ver:At.imgIOVer,prefixName:Zs.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:Ys(Zs,rt,"f",wt)}},Pt={value:{name:$e.crypto,workerName:Xe.core,autoLoad:!1,ver:At.cryptoVer,prefixName:Zs.CryptoPrefixName,dependencyModules:[$e.imgIO],fetchOptions:Ys(Zs,rt,"f",wt)}},Tt={value:{name:$e.pdfR,workerName:Xe.reader,autoLoad:!1,ver:At.pdfRVer,prefixName:Zs.PdfReaderPrefixName,dependencyModules:[$e.imgIO,$e.core],fetchOptions:Ys(Zs,rt,"f",wt)}},kt={value:{name:$e.core,workerName:Xe.core,autoLoad:!1,ver:At.coreVer,prefixName:Zs.ImagecorePrefixName,dependencyModules:[$e.imgIO],fetchOptions:Ys(Zs,rt,"f",wt)}},Dt={value:{name:$e.imgProc,workerName:Xe.core,autoLoad:!1,ver:At.imgProcVer,prefixName:Zs.ImageProcPrefixName,dependencyModules:[$e.imgIO,$e.core],useSimd:Zs.UseSimd}},Et={value:void 0};class Js{static read(e){return new Promise((function(t,i){let s=Object.prototype.toString.call(e);if("[object String]"===s){if(0===e.indexOf("blob:")||e.indexOf(".jpg")>0||e.indexOf(".jpeg")>0||e.indexOf(".png")>0||e.indexOf(".bmp")>0||e.indexOf(".dib")>0||e.indexOf(".pdf")>0||e.indexOf(".tiff")>0||e.indexOf(".tif")>0)return fetch(e,{mode:"cors"}).then((function(e){return e.arrayBuffer()})).then((function(e){return t(e)})).catch((function(e){return Promise.reject(e)}));i("Error url: Can not read the file URL");}else if("[object Blob]"===s||"[object FileList]"===s||"[object File]"===s){let o=e;"[object FileList]"!==s&&"[object File]"!==s||(o=e[0]?e[0]:e),Ys(Js,It,"m",Mt).call(Js,o,t,i);}else "[object ArrayBuffer]"===s||"[object Uint8ClampedArray]"===s?t(e):i("Not support source type: "+s);}))}}It=Js,Mt=function(e,t,i){let s,o,r=0;try{s=new ArrayBuffer(e.size),o=new Uint8Array(s);}catch(e){i(e);}!function n(){const a=new FileReader;a.onload=function(a){var l;if(null===(l=null==a?void 0:a.target)||void 0===l?void 0:l.result){const i=a.target.result;o.set(new Uint8Array(i),r),r+=i.byteLength,r<e.size?n():t(s);}else i(a);},a.onerror=function(e){i(e);},a.onabort=function(e){i(e);};const l=Math.min(r+1048576,e.size),h=e.slice(r,l);a.readAsArrayBuffer(h);}();};class Ks{static fetchRetry(e,t,i,s){let o=t.retries,r=t.retryDelay;return new Promise((function(n,a){const l=function(h){return fetch(e,t).then((function(e){n(e);})).catch((function(e){h<o?function(e,t,o){i&&i(t,s),setTimeout((function(){l(++e);}),r);}(h,e):a(e);}))};return l(0)}))}}class eo{constructor(e,t,i,s,o,r){Rt.add(this),Ot.set(this,void 0),_t.set(this,void 0),Nt.set(this,void 0),Lt.set(this,void 0),Bt.set(this,void 0),Ut.set(this,void 0),Wt.set(this,void 0),Vt.set(this,void 0),Ft.set(this,void 0),zt.set(this,void 0),Ht.set(this,void 0),jt.set(this,void 0),Gt.set(this,void 0),$t.set(this,0),Xt.set(this,{}),Yt.set(this,null),qs(this,Ot,e,"f"),qs(this,Ft,s,"f"),qs(this,Gt,i,"f"),qs(this,Nt,[],"f"),qs(this,Lt,!1,"f"),qs(this,Bt,!1,"f"),qs(this,$t,t,"f"),qs(this,Yt,Object.create(null),"f"),Ys(this,Xt,"f").modulesInfo=[],qs(this,Ht,Object.create(null),"f"),qs(this,Vt,null,"f"),qs(this,zt,0,"f"),qs(this,jt,0,"f"),qs(this,_t,Ys(this,Rt,"m",Qt).call(this,Ys(this,Ot,"f")),"f"),Ys(this,_t,"f").on("message",Ys(this,Rt,"m",Jt),this),Ys(this,_t,"f").on("error",Ys(this,Rt,"m",Zt),this),Ys(this,_t,"f").on("exit",(function(t,i,s){let o="Worker #terminated Unexpectedly\n";o+=" exitCode: `"+t+"`\n",o+=" signalCode: `"+i+"`\n",o+=" #script: `"+e+"`\n",Ys(s,Rt,"m",Zt).call(s,new Error(o),s);}),this);}get WorkerScript(){return Ys(this,Ft,"f")}get id(){return Ys(this,$t,"f")}get Module(){return Ys(this,Xt,"f")}get Instances(){return Ys(this,Yt,"f")}get WorkerName(){return Ys(this,Gt,"f")}execTask(e,t,i){i||((i={}).promise=new Promise((function(e,t){i.resolve=e,i.reject=t;})));let s=qs(this,jt,+Ys(this,jt,"f")+1,"f");Ys(this,Ht,"f")[s]={id:s,insId:t.insId,resolver:i,cost:t.cost},delete t.cost;let o={id:s,func:e,params:t};return Qs.logD("["+t.insId+"] "+e+" send"),Ys(this,Bt,"f")?i.reject(new Error("Worker is #terminated")):Ys(this,Lt,"f")?i.reject(new Error("Worker is #terminating")):Ys(this,_t,"f").wasmReady||Ys(this,_t,"f").ready&&"loadWasm"===e?Ys(this,_t,"f").send(o):Ys(this,Nt,"f").push(o),i.promise}get memSize(){return Ys(this,zt,"f")}get busy(){return this.howManyTasks>0}get howManyTasks(){return Object.keys(Ys(this,Ht,"f")).length}get alive(){return !Ys(this,Lt,"f")&&!Ys(this,Bt,"f")}terminate(e,t){if(Qs.logD("["+this.id+"] worker terminate "+e),e&&Ys(this,Rt,"m",ei).call(this,"Worker has been #terminated"),"function"==typeof t&&qs(this,Vt,t,"f"),this.busy)qs(this,Lt,!0,"f");else {if(Ys(this,_t,"f")){if("function"!=typeof Ys(this,_t,"f").terminate)throw new Error("Failed to terminate worker");Qs.logD("["+this.id+"] will be terminated"),Ys(this,_t,"f").terminate(),qs(this,_t,null,"f");}qs(this,Lt,!1,"f"),qs(this,Bt,!0,"f"),Ys(this,Vt,"f")&&Ys(this,Vt,"f").call(this,this);}}hasInstance(e){if(e){const t=Ys(this,Yt,"f")[e];if(t)return 0!=Object.keys(t).length}else {const e=Object.keys(Ys(this,Yt,"f"));for(const t of e)if(0!=Object.keys(Ys(this,Yt,"f")[t]).length)return !0}return !1}exceedMaxMemory(){const e=1024*Zs.getWorkerHeap(this.WorkerName).maxHeapSize*1024;return !!(Ys(this,zt,"f")&&Ys(this,zt,"f")>e&&0!=e)&&(Qs.logD("[w-"+this.id+"] current memSize="+Ys(this,zt,"f")+", max="+e),!0)}shouldBeFreed(){return !(!this.exceedMaxMemory()||this.hasInstance(void 0)||(Qs.logD("[w-"+this.id+"] try to terminate the worker"),this.terminate(),0))}}Ot=new WeakMap,_t=new WeakMap,Nt=new WeakMap,Lt=new WeakMap,Bt=new WeakMap,Ut=new WeakMap,Wt=new WeakMap,Vt=new WeakMap,Ft=new WeakMap,zt=new WeakMap,Ht=new WeakMap,jt=new WeakMap,Gt=new WeakMap,$t=new WeakMap,Xt=new WeakMap,Yt=new WeakMap,Rt=new WeakSet,qt=function(e){let t=new Error(""),i=Object.keys(e);for(let s=0;s<i.length;s++)t[i[s]]=e[i[s]];return t},Qt=function(e){if("function"!=typeof Worker&&"object"!=typeof Worker)throw new Error("Web Workers not supported");let t=new Worker(e,{name:this.WorkerName});return t.on=function(e,t,i){this.addEventListener(e,(function(s){"exit"===e?t(s.data,"",i):t(s.data,i);}));},t.send=function(e){if(null!=e&&null!=e.params&&null!=e.params.input){let t=Object.prototype.toString.call(e.params.input);if("[object Array]"===Object.prototype.toString.call(e.params.input)){if(t=Object.prototype.toString.call(e.params.input[0]),"[object ArrayBuffer]"===t||"[object Uint8ClampedArray]"===t||"[object Uint8Array]"===t)return void this.postMessage(e,[null!=e.params.input[0].buffer?e.params.input[0].buffer:e.params.input[0]])}else if("[object ArrayBuffer]"===t||"[object Uint8ClampedArray]"===t||"[object Uint8Array]"===t)return void this.postMessage(e,[null!=e.params.input.buffer?e.params.input.buffer:e.params.input])}this.postMessage(e);},t},Zt=function(e,t){qs(t,Bt,!0,"f"),Qs.logD("[js]["+t.id+"] worker error "+JSON.stringify(e)),Ys(t,Lt,"f")&&Ys(t,Vt,"f")&&Ys(t,Vt,"f").call(t,t),qs(t,Lt,!1,"f"),Ys(t,Rt,"m",ei).call(t);},Jt=function(e,t){let i=e.id,s=Ys(t,Ht,"f")[i];if(e&&e.cost&&s&&s.cost){const t=s.cost;t.exec=e.cost;const i=Date.now();t.total=i-t.ctime,t.msgQueue=e.ctime-t.time;const o=i-e.time;delete t.time,delete t.ctime,e.cost=t,e.cost.receive=o,delete e.ctime,delete e.time;}if(Qs.logD(e.log?e.log:e),"string"==typeof e&&"ready"===e)Ys(t,_t,"f").ready=!0,setTimeout((()=>{Ys(t,Rt,"m",Kt).call(t);}),0);else if(!e.log){if("object"==typeof e){let i=e.result;"object"==typeof i?(null!=i.errorCode&&(i.code=i.errorCode,delete i.errorCode),null!=i.errorMessage&&(i.message=i.errorMessage,delete i.errorMessage)):"string"==typeof i&&(i=i.replace('"errorCode"','"code"'),i=i.replace("'errorCode'","'code'"),i=i.replace('"errorMessage"','"message"'),i=i.replace("'errorMessage'","'message'"),e.result=i),null!=e.memSize&&qs(t,zt,e.memSize,"f");}if(void 0!==s){const o=s.insId;delete Ys(t,Ht,"f")[i],Qs.logD("["+o+"] "+e.func+" received"),!0===Ys(t,Lt,"f")&&t.terminate(),"loadWasm"===e.func&&null!=e.result&&(Ys(t,_t,"f").wasmReady=!0,setTimeout((()=>{Ys(t,Rt,"m",Kt).call(t);}),0)),e.error?s.resolver.reject(Ys(t,Rt,"m",qt).call(t,e.error)):e.result&&s.resolver.resolve(e.result);}}},Kt=function(){Ys(this,Nt,"f").forEach(Ys(this,_t,"f").send.bind(Ys(this,_t,"f"))),qs(this,Nt,[],"f");},ei=function(e){for(let t in Ys(this,Ht,"f"))void 0!==Ys(this,Ht,"f")[t]&&Ys(this,Ht,"f")[t].resolver.reject(new Error(e));qs(this,Ht,Object.create(null),"f");};class to{constructor(){ti.add(this),oi.set(this,[]),ri.set(this,4),ni.set(this,60),ai.set(this,!1),li.set(this,0),ci.set(this,!1);}static get Instance(){return Ys(this,ii,"f",si)||qs(this,ii,new to,"f",si),Ys(this,ii,"f",si)}get Terminated(){return Ys(this,ai,"f")}getModuleLoadedError(e){for(let t of Ys(to,ii,"f",hi))if(t.name==e)return t.error}getModuleStatus(e){for(let t of Ys(to,ii,"f",hi))if(t.name==e)return t.status;return ""}addModules(e,t){let i=!1;if(Ys(to,ii,"f",hi).forEach((function(t,s,o){t.name==e.name&&(t.ver==e.ver?i=!0:o.splice(s,1));})),!i){let i=e;i.status=t||"",i.wasmModule=null,Ys(to,ii,"f",hi).push(i);}}loadModule(e,t){return Xs(this,void 0,void 0,(function*(){null==t&&(t=0!=Ys(this,ti,"m",yi).call(this,e).length);for(let t of e.dependencyModules)t===$e.imgIO?(this.addModules(Zs.ImageIOModule,Ye.pending),Zs.LicMode===Qe.DLS_KEY&&e.name!=$e.crypto&&this.addModules(Zs.CryptoModule,Ye.pending)):t===$e.core&&this.addModules(Zs.ImagecoreModule,Ye.pending);let i;for(let s of Ys(to,ii,"f",hi))if(s.name===e.name){if(s.status===Ye.pending)return !1;if(s.wasmModule){if(t)return !0;i=s.wasmModule;break}break}let s=null;if(i)s=e,s.wasmModule=i,s.status=Ye.pending,Ys(to,ii,"f",hi).push(s);else if(s=e,""===s.status)s.status=Ye.pending,s.wasmModule=null;else {if(s.status===Ye.pending)return !1;t||(s.error={code:0,message:""},s.status=Ye.pending);}return Ys(this,ti,"m",di).call(this,s)}))}get busy(){Ys(this,ti,"m",Ci).call(this);let e=Ys(this,oi,"f");for(let t of e)if(t.busy)return !0;return !1}getWorker(e,t){return Xs(this,void 0,void 0,(function*(){if(Ys(this,ti,"m",wi).call(this,e.name))return Ys(this,ti,"m",xi).call(this),{worker:null,workers:0};let i=Ys(this,ti,"m",yi).call(this,e,!0);return 0!=i.length?{worker:Ys(this,ti,"m",Si).call(this,i,t,e),workers:i.length}:(yield this.loadModule(e,!1),{worker:null,workers:0})}))}removeInstanceInWorker(e,t,i,s){if(Ys(this,ti,"m",Pi).call(this,t,e.name,i),s&&t&&t.shouldBeFreed()){let e=Ys(this,oi,"f").indexOf(t);-1!==e&&Ys(this,oi,"f").splice(e,1);}}terminate(e){qs(to,ii,null,"f",si),Qs.logD("worker pool terminate "+e),qs(this,ai,!0,"f");let t=[],i=Ys(this,oi,"f").slice();return qs(this,oi,[],"f"),i.forEach((function(i){let s={};s.promise=new Promise((function(e,t){s.resolve=e,s.reject=t;})),t.push(s.promise),i.terminate(e,(function(e){s.resolve(e);}));})),Promise.all(t)}static unload(){qs(this,ii,new Array,"f",hi);}terminateWorker(e){const t=Ys(this,oi,"f").filter((t=>t.WorkerName!==e||(t.terminate(!0),!1)));qs(this,oi,t,"f");}getMemoryUsed(){let e=Ys(this,oi,"f"),t=[],i=0;for(let s of e)s&&null!=s.memSize&&(t[i]={},t[i].size=s.memSize,t[i].limit=1024*Zs.getWorkerHeap(s.WorkerName).maxHeapSize*1024,t[i].name=s.WorkerName,t[i].id=s.id,i+=1);return t}}ii=to,oi=new WeakMap,ri=new WeakMap,ni=new WeakMap,ai=new WeakMap,li=new WeakMap,ci=new WeakMap,ti=new WeakSet,di=function(e){return Xs(this,void 0,void 0,(function*(){let t=this,i=yield Ys(this,ti,"m",mi).call(this,e);if(i){let s={id:0,func:"loadWasm",params:{insId:0,priority:0,module:{modulesInfo:[]},fetchOptions:e.fetchOptions}};if(s.params.resourceDir=e.resourceDir,s.params.initMemory=Zs.getWorkerHeap(e.workerName).initHeapSize,s.params.module){for(let t of Ys(to,ii,"f",hi))for(let i of e.dependencyModules)i==t.name&&s.params.module.modulesInfo.push(t);s.params.module.modulesInfo.push(e);}return Ys(this,ti,"m",gi).call(this,i,s,(function(i){qs(t,ri,Ys(t,ti,"m",pi).call(t),"f"),e.status===Ye.pending&&(e.status="");}))}e.status="",e.wasmModule=null;}))},ui=function(e,t,i,s){for(let o of Ys(to,ii,"f",hi))if(o.name===e){o.status=t,o.wasmModule=i,o.error=s;break}},gi=function(e,t,i){return Xs(this,void 0,void 0,(function*(){let s=this;try{const i=yield e.execTask(t.func,t.params);let o=!1;return void 0===i.code||i.modules?o=Ys(s,ti,"m",fi).call(s,i,e):Qs.logD(i),o}catch(s){return Qs.logD(s),!1}finally{i&&i();}}))},fi=function(e,t){if(Qs.logD("handleWasmLoad:"),Qs.logD(e),Ys(this,ai,"f"))return t.terminate(),!1;if(("object"!=typeof e||null==e.modules)&&"object"==typeof e)return !1;let i=!1;for(const s of e.modules)e.code?(Ys(this,ti,"m",ui).call(this,s.name,Ye.failed,null,{code:e.code,message:e.message}),t.Module.modulesInfo[s.name]=!1):(Ys(this,ti,"m",ui).call(this,s.name,Ye.ready,s.wasmModule,void 0),t.Module.modulesInfo[s.name]=!0,i=!0);return i},pi=function(){let e=2;return "hardwareConcurrency"in self.navigator&&(e=self.navigator.hardwareConcurrency),Math.max(Math.min(Ys(this,ri,"f"),Math.max(Ys(this,ri,"f"),e/2)),1)},mi=function(e){return Xs(this,void 0,void 0,(function*(){Ys(this,ti,"m",Ci).call(this);let t=Ys(this,oi,"f");for(let i of t)if(i.WorkerName===e.workerName)return i.busy?null:i;return Ys(this,ti,"m",vi).call(this,e)}))},vi=function(e){var t;return Xs(this,void 0,void 0,(function*(){let i=this,s=Ys(i,oi,"f");if(s.length<Ys(i,ri,"f")&&!Ys(i,ci,"f")){qs(i,ci,!0,"f");let o=e.script;e.crossScript&&(o=yield Ks.fetchRetry(e.script,e.fetchOptions,Qs.func,i).then((e=>e.blob())).then((e=>URL.createObjectURL(e))).catch((e=>(Qs.logD("get new worker fetch failed: "),Qs.logD(e),qs(i,ci,!1,"f"),null))));let r=new eo(o,qs(t=i,li,+Ys(t,li,"f")+1,"f"),e.workerName,e.script,Qs.func,Qs.context);return s.push(r),qs(i,ci,!1,"f"),Qs.logAll(s),Qs.logD("[wl-"+Ys(i,oi,"f").length+"] got new worker w-"+r.id+" succeed!"),r}return null}))},yi=function(e,t){Ys(this,ti,"m",Ci).call(this);let i=Ys(this,oi,"f");Qs.logAll(i);let s=[];for(let o of i)if(o.Module.modulesInfo[e.name]){if(t&&o.WorkerName!==e.workerName)continue;s.push(o);}return Qs.logAll("[wl-"+i.length+"] got workers for module "+e.name),Qs.logAll(s),s},wi=function(e){for(let t of Ys(to,ii,"f",hi))if(t.name===e&&t.status===Ye.pending)return !0;return !1},bi=function(){return Xs(this,void 0,void 0,(function*(){this.terminate(!0);for(let e of Ys(to,ii,"f",hi))yield Ys(this,ti,"m",di).call(this,e);}))},xi=function(){Ys(this,ti,"m",Ci).call(this),0==Ys(this,oi,"f").length&&0!=Ys(to,ii,"f",hi).length&&(Qs.logD("no worker ready, reinit"),Ys(this,ti,"m",bi).call(this));},Ci=function(){qs(this,oi,Ys(this,oi,"f").filter((function(e){return e.alive})),"f");},Si=function(e,t,i){Qs.logAll("[wl-"+Ys(this,oi,"f").length+"] getWorkerByIntanceId"),Qs.logAll(e);let s,o=9007199254740991;for(let r of e){if(i.singleInstance&&r.hasInstance(i.name))continue;const e=r.Instances[i.name];if(!e||null!=e[t]){s=r;break}{let e=r.howManyTasks;e<o&&(s=r,o=e);}}if(s){if(s.shouldBeFreed())return null;const o=s.Instances[i.name];if(o)o[t]="";else {const e=Object.create(null);e[t]="",s.Instances[i.name]=e;}return Qs.logAll(e),Qs.logD("[wl-"+e.length+"]["+t+"] got worker w-"+s.id),s}return Qs.logAll("#getWorkerByIntanceId: no suitable worker"),null},Pi=function(e,t,i){let s=Ys(this,oi,"f");Qs.logAll("removeInstanceInWorkerInner"),Qs.logAll(s);for(let o of s)if(o===e){const r=o.Instances[t];if(r){null!=r[i]?(delete r[i],Qs.logAll(s),Qs.logD("[w-"+o.id+"] removeInstanceInWorkerInner "+i+" in "+e.id+" succeed!")):Qs.logD("[w-"+o.id+"] not found instance "+i);break}}},si={value:null},hi={value:new Array};class io{constructor(e,t){var i,s,o,r;Ti.add(this),Ei.set(this,void 0),this._outputType=Je.IT_JPG,this._inputType=Je.IT_ALL,this._jpegQuality=80,Ai.set(this,null!==(i=Zs.License)&&void 0!==i?i:""),Ii.set(this,[]),Mi.set(this,null),Ri.set(this,0),Oi.set(this,qs(r=io,ki,+Ys(r,ki,"f",Di)+1,"f",Di)),_i.set(this,null),Ni.set(this,JSON.parse(JSON.stringify(Zs.NavInfo))),Li.set(this,Zs.Mobile),Bi.set(this,location.origin),Ui.set(this,""),Wi.set(this,Ye.init),Vi.set(this,!1),Fi.set(this,null!==(s=Zs.LicMode)&&void 0!==s?s:Qe.LONG_KEY),zi.set(this,null!==(o=Zs.UUID)&&void 0!==o?o:""),Hi.set(this,0),ji.set(this,!1),Gi.set(this,!1),this._handleBooleanResult=function(e,t){return !0},qs(this,Ei,e,"f"),qs(this,Ai,null!=t?t:Zs.License,"f");}_prepareModule(e){}get workerId(){return Ys(this,Mi,"f")&&Ys(this,Mi,"f").alive?Ys(this,Mi,"f").id:0}get id(){return Ys(this,Oi,"f")}hasTask(){return Ys(this,Ii,"f").length>0}_canTerminateWork(){return !1}_makeSureWorkerMemoryNotExceed(){return !(Ys(this,Mi,"f")&&Ys(this,Mi,"f").alive&&this._canTerminateWork()&&Ys(this,Mi,"f").exceedMaxMemory()&&(Qs.logD(`[${this.id}] try to termiate worker [${Ys(this,Mi,"f").id}]`),Ys(this,Mi,"f").terminate(!0),qs(this,Mi,null,"f"),qs(this,Wi,Ye.init,"f"),1))}_workerChanged(e){}_handleBasicResult(e,t){return delete e.code,delete e.message,e}_handleImageData(e,t){var i,s,o;if("object"==typeof e.imageData)if(null!=e.imageCount&&e.imageCount>1)for(let s=0;s<e.imageCount;s++)e.imageData[s]=Ys(i=t.context,Ti,"m",Yi).call(i,e.imageData[s],e.blobType,t.params.returnBlob);else e.imageData=Ys(s=t.context,Ti,"m",Yi).call(s,e.imageData,e.blobType,t.params.returnBlob);return "object"==typeof e.pdfData&&(e.pdfData=Ys(o=t.context,Ti,"m",Yi).call(o,e.pdfData,e.blobType,t.params.returnBlob)),e}_handleResult(e,t){var i,s;let o=Ys(s=t.context,Ti,"m",qi).call(s,e);if(void 0===o.code||!o.code&&"Successful."===o.message)o=t.handleResult(o,t),setTimeout((()=>{var e;Ys(e=t.context,Ti,"m",Xi).call(e);}),0),(0, t.resolve)(o);else {let e={code:o.code,message:o.code===Ze.wasmException?qe.WASM_EXCEPTION_ERROR+"("+(null===(i=t.params)||void 0===i?void 0:i.moduleName)+":"+t.func+":"+o.message+")":o.message};t.context.terminated?t.resolve(e):t.reject(e);}}_execTask(e){let t=this,i=Ys(t,Mi,"f");if(Qs.logAll(e),i)try{if(e.params.cost){const t=e.params.cost.time;e.params.cost.time=Date.now(),e.params.cost.taskQueue=e.params.cost.time-t;}i.execTask(e.func,e.params).then((function(i){t._handleResult(Ys(t,Ti,"m",qi).call(t,i),e);})).catch((function(i){Qs.logD(i),setTimeout((()=>{Ys(t,Ti,"m",Xi).call(t);}),0);let s=i;"object"==typeof i&&null!=i.message&&(s=i.message);let o={code:Ze.wasmJsWorkerRunFailed,message:s};Ys(t,Vi,"f")?e.resolve(o):e.reject(o);}));}catch(i){setTimeout((()=>{Ys(t,Ti,"m",Xi).call(t);}),0),Qs.logD(i);let s={code:Ze.wasmJsWorkerRunException,message:i.message,stack:i.stack};Ys(t,Vi,"f")?e.resolve(s):e.reject(s);}}_cancelAllTasks(e,t){for(let i of Ys(this,Ii,"f"))if(void 0!==i){let s={code:e,message:t};Ys(this,Vi,"f")?i.resolve(s):i.reject(s);}qs(this,Ii,[],"f");}_createTask(e,t,i){let s={moduleName:Ys(this,Ei,"f").name,insId:Ys(this,Oi,"f")},o={id:qs(this,Ri,+Ys(this,Ri,"f")+1,"f"),func:e,params:s};return o.promise=new Promise((function(e,t){o.resolve=e,o.reject=t;})),o.func=e,o.context=this,o.handleResult=void 0!==i&&i?i:this._handleBasicResult,o.params.input=void 0!==t&&t?t:"",o.params.returnType=Ke.RT_AUTO,o.params.returnBlob=!0,o.params.logLevel=Qs.level,o.params.cost={},o.params.cost.ctime=Date.now(),o.params.cost.time=o.params.cost.ctime,o}_addTask(e,t){if(e.params.cost){const t=e.params.cost.time;e.params.cost.time=Date.now(),e.params.cost.create=e.params.cost.time-t;}return Ys(this,Wi,"f")===Ye.destroyed?e.reject({code:Ze.wasmJsObjectNotInit,message:Ys(this,Vi,"f")?"object has been disposed":"object not init"}):Ys(this,Wi,"f")===Ye.failed?e.reject({code:Ze.wasmJsObjectInitFailed,message:Ys(this,Ui,"f")}):(t?Ys(this,Ii,"f").unshift(e):Ys(this,Ii,"f").push(e),Ys(this,Ti,"m",Xi).call(this)),e.promise}terminate(e){let t=this;Ys(t,ji,"f")?qs(t,Vi,!0,"f"):(qs(this,Gi,!0,"f"),Ys(t,Ti,"m",Zi).call(t).then((function(e){Qs.logD("["+t.id+"] "+Ys(t,Ei,"f").name+" destroy return: "),Qs.logD(e);})).catch((function(e){Qs.logD(Ys(t,Ei,"f").name+" destroy failed"),Qs.logD(e);})).finally((()=>{let i=to.Instance;i&&i.removeInstanceInWorker(Ys(t,Ei,"f"),Ys(t,Mi,"f"),Ys(t,Oi,"f"),null==e||e),qs(t,Mi,null,"f"),qs(t,Vi,!0,"f"),qs(t,Gi,!1,"f");}))),qs(t,Wi,"","f");}_readFile(e,t){return Js.read(e).catch((function(e){let t=e;return "object"!=typeof t&&(t={},t.code=Ze.wasmJsReadFileFailed,t.message=e),Promise.reject(t)}))}}ki=io,Ei=new WeakMap,Ai=new WeakMap,Ii=new WeakMap,Mi=new WeakMap,Ri=new WeakMap,Oi=new WeakMap,_i=new WeakMap,Ni=new WeakMap,Li=new WeakMap,Bi=new WeakMap,Ui=new WeakMap,Wi=new WeakMap,Vi=new WeakMap,Fi=new WeakMap,zi=new WeakMap,Hi=new WeakMap,ji=new WeakMap,Gi=new WeakMap,Ti=new WeakSet,$i=function e(t){let i=null!=t?t:this;if(Ys(i,_i,"f")&&clearTimeout(Ys(i,_i,"f")),Ys(i,Vi,"f")&&Qs.logD(`[${i.id}"] has been termiated.(getWorker)`),Ys(i,Mi,"f")&&Ys(i,Mi,"f").alive)return Ys(i,Mi,"f");let s=to.Instance;s?s.getWorker(Ys(i,Ei,"f"),Ys(i,Oi,"f")).then((t=>{if(qs(i,Mi,t.worker,"f"),Ys(i,Mi,"f")&&Ys(i,Mi,"f").alive)Ys(i,Hi,"f")!=Ys(i,Mi,"f").id&&(0!==Ys(i,Hi,"f")&&i._workerChanged(Ys(i,Mi,"f").id),qs(i,Hi,Ys(i,Mi,"f").id,"f")),Ys(i,Ii,"f").length>0&&setTimeout((()=>{Ys(i,Ti,"m",Xi).call(i);}),0);else {let t=s.getModuleLoadedError(Ys(i,Ei,"f").name);if(null==t?void 0:t.code)return i._cancelAllTasks(Ze.wasmJsNotLoaded,t.message),Ys(i,Mi,"f");Ys(i,Ii,"f").length>0&&qs(i,_i,setTimeout(Ys(i,Ti,"m",e),50,i),"f");}return Ys(i,Mi,"f")})).catch((e=>Ys(i,Mi,"f"))):i._cancelAllTasks(Ze.wasmJsNotLoaded,"wasm env not loaded or unloaded");},Xi=function(){if(Qs.logAll(Ys(this,Ii,"f")),Ys(this,Wi,"f")!=Ye.init)if(Ys(this,Mi,"f")&&Ys(this,Mi,"f").alive){if(Ys(this,Ii,"f").length>0){let e=Ys(this,Ii,"f")[0];Ys(this,Wi,"f")!==Ye.ready&&"init"!==e.func||(delete Ys(this,Ii,"f")[0],Ys(this,Ii,"f").splice(0,1),this._execTask(e));}}else {if(Ys(this,Mi,"f")&&!Ys(this,Mi,"f").alive&&Ys(this,Ii,"f").length>0&&"init"!=Ys(this,Ii,"f")[0].func)return qs(this,Mi,null,"f"),void Ys(this,Ti,"m",Qi).call(this);Ys(this,Ii,"f").length>0&&Ys(this,Ti,"m",$i).call(this,this);}else Ys(this,Ti,"m",Qi).call(this);},Yi=function(e,t,i){if(i){let i;return i=null!=t?new Blob([e],{type:t}):new Blob([e]),i}return e},qi=function(e){try{return "string"==typeof e?JSON.parse(e):e}catch(t){return e}},Qi=function(){let e=this;e._prepareModule(Ys(this,Ei,"f"));let t=this._createTask("init");t.params.key=Ys(this,Ai,"f"),t.params.uuid=Ys(this,zi,"f"),t.params.licMode=Ys(this,Fi,"f"),t.params.val={nv:Ys(this,Ni,"f"),mb:Ys(this,Li,"f"),dm:Ys(this,Bi,"f")},t.handleResult=function(e,t){return qs(t.context,Wi,Ye.ready,"f"),e},qs(this,Wi,Ye.pending,"f"),this._addTask(t,!0),t.promise.then((function(t){Qs.logD("["+e.id+"] "+Ys(e,Ei,"f").name+" init return: "),Qs.logD(t),qs(e,ji,!1,"f");})).catch((function(t){qs(e,Wi,Ye.failed,"f"),qs(e,Ui,t.message,"f"),Qs.logD(Ys(e,Ei,"f").name+" init failed"),Qs.logD(t),e._cancelAllTasks(Ze.wasmJsObjectInitFailed,t.message);}));},Zi=function(){if(Ys(this,Wi,"f")==Ye.pending||Ys(this,Wi,"f")==Ye.ready){let e=this._createTask("destroy",null,this._handleBooleanResult);return this._addTask(e),e.promise}return Promise.resolve(!0)},Di={value:0};class so extends io{constructor(e,t){super(e,t);}_prepareModule(e){let t=to.Instance;t.addModules(Zs.ImageIOModule),Zs.LicMode===Qe.DLS_KEY&&t.addModules(Zs.CryptoModule),Ys(so,Ji,"m",Ki).call(so,Zs.ImageIOModule,e),t.addModules(e);}}Ji=so,Ki=function(e,t){t.resourceDir=e.resourceDir,t.crossScript=e.crossScript,t.script=e.script,t.useSimd=e.useSimd,t.name===$e.imgProc?t.useSimd=Zs.UseSimd:t.useSimd=!1,t.fetchOptions=e.fetchOptions;};class oo extends so{constructor(e){super(Zs.ImagecoreModule,e),es.add(this),ts.set(this,0);}getImageFormat(e){return Xs(this,void 0,void 0,(function*(){let t=this,i=t._createTask("GetImageFormat");const s=yield t._readFile(e,i);return i.params.input=s,t._addTask(i),i.promise}))}readImageInfo(e){return Xs(this,void 0,void 0,(function*(){let t=this,i=t._createTask("ReadImageInfo");const s=yield t._readFile(e,i);return i.params.input=s,t._addTask(i),i.promise}))}getMD5(e){return Xs(this,void 0,void 0,(function*(){let t=this,i=t._createTask("GetMD5");const s=yield t._readFile(e,i);return i.params.input=s,i.handleResult=function(e,t){return e.MD5},t._addTask(i),i.promise}))}getLicenseInfo(){return Xs(this,void 0,void 0,(function*(){return this._addTask(this._createTask("GetLicenseInfo"))}))}getAesResult(e){return Xs(this,void 0,void 0,(function*(){return e=null!=e?e:"",this._addTask(this._createTask("GetAesResult",[e]))}))}saveImage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){return (o=null!=o&&o)?Ys(this,es,"m",is).call(this,e,void 0,void 0,void 0,1,void 0,void 0,t,i,s):Ys(this,es,"m",is).call(this,e,void 0,void 0,void 0,void 0,void 0,void 0,t,i,s)}))}readImage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){t=null!=t?t:this._outputType,i=null!=i?i:this._jpegQuality,s=null!=s&&s,o=null!=o&&o;let r=this,n=r._createTask("ReadImage");const a=yield r._readFile(e,n);n.params.input=[a,t,i,o],n.params.returnType=s?Ke.RT_BASE64:Ke.RT_AUTO,n.params.returnBlob=!s,n.handleResult=r._handleImageData,r._addTask(n);const l=yield n.promise;if(l.srcBuffer){let t=Object.prototype.toString.call(e);"[object ArrayBuffer]"!=t&&"[object Uint8ClampedArray]"!=t&&delete l.srcBuffer;}return l}))}openTiff(e,t){return Xs(this,void 0,void 0,(function*(){let i=this,s=i._createTask("LoadTiff");t=null!=t&&t;const o=yield i._readFile(e,s);s.params.input=[o,t],i._addTask(s);const r=yield s.promise;if(r.srcBuffer){let t=Object.prototype.toString.call(e);"[object ArrayBuffer]"!=t&&"[object Uint8ClampedArray]"!=t&&delete r.srcBuffer;}return r}))}readTiff(e,t,i,s){e=null!=e?e:0,t=null!=t?t:this._outputType,i=null!=i&&i,s=null!=s&&s;let o=this._createTask("ReadTiffPage");return o.params.input=[e,t,s],o.params.returnType=i?Ke.RT_BASE64:Ke.RT_AUTO,o.params.returnBlob=!i,o.handleResult=this._handleImageData,this._addTask(o)}readTiffInfos(e){let t=this._createTask("GetTiffPageInfos");return t.params.input=[e],this._addTask(t)}closeTiff(){return this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))}createTiff(){return this._addTask(this._createTask("NewTiff",null,this._handleBooleanResult))}appendImage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){t=null!=t?t:this._inputType,i=null!=i?i:Ys(this,ts,"f"),s=null!=s?s:this._jpegQuality,o=null!=o&&o;let r=this,n=r._createTask("AppendImageToTiff");const a=yield r._readFile(e,n);return n.params.input=[a,t,i,s,o],n.handleResult=r._handleBooleanResult,r._addTask(n),n.promise}))}addTag(e,t,i){return i=null!=i&&i,this._addTask(this._createTask("AddTagToNextPage",[e,t,i],this._handleBooleanResult))}getTiff(e){let t=this._createTask("GetTiffStream");return t.handleResult=this._handleImageData,t.params.returnType=null!=e?e:Ke.RT_AUTO,t.params.returnBlob=e!=Ke.RT_AUTO,this._addTask(t)}getMemoryUsed(){return this._addTask(this._createTask("getMemoryUsed",null,(function(e,t){return e.memoryUsed})))}getMultiPartFile(e,t){return this._addTask(this._createTask("ds_get_file",[e,t],(function(e,t){return e})))}}ts=new WeakMap,es=new WeakSet,is=function(e,t,i,s,o,r,n,a,l,h){return Xs(this,void 0,void 0,(function*(){let c=this;t=null!=t?t:this._inputType,i=null!=i?i:0,s=null!=s?s:0,o=null!=o?o:24,r=null!=r?r:96,n=null!=n?n:96,a=null!=a?a:this._outputType,l=null!=l?l:this._jpegQuality,h=null!=h?h:Ke.RT_AUTO;let d=c._createTask("SaveImage");const u=yield c._readFile(e,d);return d.params.input=[u,t,i,s,o,r,n,a,l],d.params.returnType=h,d.params.returnBlob=h!=Ke.RT_BASE64,d.handleResult=c._handleImageData,c._addTask(d),d.promise}))};class ro extends so{constructor(e){super(Zs.ImageReadereModule,e),ss.add(this),os.set(this,0),rs.set(this,!1),ns.set(this,null),as.set(this,void 0),ls.set(this,0),hs.set(this,void 0),cs.set(this,void 0);}workerChanged(e){qs(this,rs,!1,"f"),e&&(Qs.logD("["+this.id+"] worker changed to "+e),qs(this,ls,e,"f"));}setExternalWorkerChanged(e,t){qs(this,hs,e,"f"),qs(this,cs,t,"f");}_workerChanged(e){this.workerChanged(e),Ys(this,hs,"f")&&Ys(this,hs,"f").call(this,Ys(this,cs,"f"),this,e);}_canTerminateWork(){return !0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(qs(this,rs,!1,"f"),Ys(this,hs,"f")&&Ys(this,hs,"f").call(this,Ys(this,cs,"f"),this));}getImageFormat(e){return Xs(this,void 0,void 0,(function*(){let t=this,i=t._createTask("GetImageFormat");const s=yield t._readFile(e.fileSource,i);return i.params.input=s,t._addTask(i),i.promise}))}readImageInfo(e){return Xs(this,void 0,void 0,(function*(){let t=this,i=t._createTask("ReadImageInfo");const s=yield t._readFile(e.fileSource,i);return i.params.input=s,t._addTask(i),i.promise}))}readImage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){t=null!=t?t:this._outputType,i=null!=i?i:this._jpegQuality,s=null!=s&&s,o=null!=o&&o;let r=this,n=r._createTask("ReadImage");const a=yield r._readFile(e.fileSource,n);n.params.input=[a,t,i,o],n.params.returnType=s?Ke.RT_BASE64:Ke.RT_AUTO,n.params.returnBlob=!s,n.handleResult=r._handleImageData,r._addTask(n);const l=yield n.promise;if(l.srcBuffer){let t=Object.prototype.toString.call(e.fileSource);"[object ArrayBuffer]"!=t&&"[object Uint8ClampedArray]"!=t&&delete l.srcBuffer;}return l}))}openTiff(e,t){return Xs(this,void 0,void 0,(function*(){t=null!=t&&t;let i,s=this,o=s._createTask("LoadTiff");if(e!=Ys(this,ns,"f")){const t=yield s._readFile(e,o);e instanceof Blob?qs(s,ns,e,"f"):qs(s,ns,new Blob([t]),"f");}i||(i=yield Ys(s,ns,"f").arrayBuffer()),o.params.input=[i,t],s._addTask(o);const r=yield o.promise;if(qs(s,rs,!0,"f"),r.srcBuffer){let t=Object.prototype.toString.call(e);"[object ArrayBuffer]"!=t&&"[object Uint8ClampedArray]"!=t&&delete r.srcBuffer;}return qs(s,as,{pageCount:r.pageCount},"f"),r}))}readTiffPage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){yield Ys(this,ss,"m",ds).call(this,e.fileSource),t=null!=t?t:0,i=null!=i?i:this._outputType,s=null!=s&&s,o=null!=o&&o;let r=this._createTask("ReadTiffPage");return r.params.input=[t,i,o],r.params.returnType=s?Ke.RT_BASE64:Ke.RT_AUTO,r.params.returnBlob=!s,r.handleResult=this._handleImageData,this._addTask(r)}))}getTiffInfo(e,t){return Xs(this,void 0,void 0,(function*(){return yield Ys(this,ss,"m",ds).call(this,e.fileSource),Ys(this,as,"f")}))}getTiffPageInfos(e,t){return Xs(this,void 0,void 0,(function*(){yield Ys(this,ss,"m",ds).call(this,e.fileSource);let i=this._createTask("GetTiffPageInfos");return i.params.input=[t],this._addTask(i)}))}}os=new WeakMap,rs=new WeakMap,ns=new WeakMap,as=new WeakMap,ls=new WeakMap,hs=new WeakMap,cs=new WeakMap,ss=new WeakSet,ds=function(e){return Xs(this,void 0,void 0,(function*(){if(this.makeSureWorkerMemoryNotExceed(),Ys(this,rs,"f")){if(Ys(this,ns,"f")===e)return void Qs.logD("["+this.id+"] already opened in "+this.workerId);yield Ys(this,ss,"m",us).call(this);}Qs.logD("["+this.id+"] reopen in worker "+this.workerId),yield this.openTiff(e,!1);}))},us=function(){if(qs(this,ns,null,"f"),Ys(this,rs,"f"))return qs(this,rs,!1,"f"),this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))};class no{static decode(e){const t={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]};function i(e){let t,i,s,o,r,n,a,l=[],h=e.length;for(t=0;t<h;t++)o=e.charCodeAt(t),0==(o>>7&255)?l.push(e.charAt(t)):6==(o>>5&255)?(r=e.charCodeAt(++t),i=(31&o)<<6,s=63&r,a=i|s,l.push(String.fromCharCode(a))):14==(o>>4&255)&&(r=e.charCodeAt(++t),n=e.charCodeAt(++t),i=o<<4|r>>2&15,s=(3&r)<<6|63&n,a=(255&i)<<8|s,l.push(String.fromCharCode(a)));return l.join("")}return function(e){let s,o,r,n,a=[],l=0,h=e.length;for(;l<h;){do{s=t.decodeChars[255&e.charCodeAt(l++)];}while(l<h&&-1==s);if(-1==s)break;do{o=t.decodeChars[255&e.charCodeAt(l++)];}while(l<h&&-1==o);if(-1==o)break;a.push(String.fromCharCode(s<<2|(48&o)>>4));do{if(r=255&e.charCodeAt(l++),61==r)return i(a.join(""));r=t.decodeChars[r];}while(l<h&&-1==r);if(-1==r)break;a.push(String.fromCharCode((15&o)<<4|(60&r)>>2));do{if(n=255&e.charCodeAt(l++),61==n)return i(a.join(""));n=t.decodeChars[n];}while(l<h&&-1==n);if(-1==n)break;a.push(String.fromCharCode((3&r)<<6|n));}return i(a.join(""))}(e)}}!function(e){e[e.render=1]="render",e[e.extractImageOnly=2]="extractImageOnly",e[e.auto=3]="auto",e[e.renderWithAnnot=4]="renderWithAnnot";}(Rs||(Rs={}));class ao extends io{constructor(e){super(Zs.PdfReaderModule,e),gs.add(this),ms.set(this,void 0),vs.set(this,void 0),bs.set(this,0),xs.set(this,200),Cs.set(this,3),Ss.set(this,!1),Ps.set(this,void 0),Ts.set(this,null),ks.set(this,""),this._outputType=Je.IT_ALL;}static addPdfFont(e,t){return Xs(this,void 0,void 0,(function*(){return Ys(this,fs,"m",ys).call(this,e,t)}))}static removeFont(){qs(this,fs,Object.create(null),"f",ps);}workerChanged(e){qs(this,Ss,!1,"f"),e&&(Qs.logD("["+this.id+"] worker changed to "+e),qs(this,bs,e,"f"));}setExternalWorkerChanged(e,t){qs(this,ms,e,"f"),qs(this,vs,t,"f");}_workerChanged(e){this.workerChanged(e),Ys(this,ms,"f")&&Ys(this,ms,"f").call(this,Ys(this,vs,"f"),this,e);}_canTerminateWork(){return !0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(qs(this,Ss,!1,"f"),Ys(this,ms,"f")&&Ys(this,ms,"f").call(this,Ys(this,vs,"f"),this));}getPdfInfo(e){return Xs(this,void 0,void 0,(function*(){return yield Ys(this,gs,"m",Ds).call(this,e),Ys(this,Ps,"f")}))}readPage(e,t,i,s,o,r,n,a){return Xs(this,void 0,void 0,(function*(){return this.readPageEx(e,t,{convertMode:s,renderOptions:{resolution:i}},o,r,n,a)}))}readPageEx(e,t,i,s,o,r,n){return Xs(this,void 0,void 0,(function*(){yield Ys(this,gs,"m",Ds).call(this,e),t=null!=t?t:0,s=null!=s?s:this._outputType,r=null!=r&&r,o=null!=o&&o,n=null!=n&&n;let a=i?JSON.stringify(i):"{}",l=this._createTask("ReadPdfPageEx");return l.params.input=[t,a,s,o,n],l.params.returnType=r?Ke.RT_BASE64:Ke.RT_AUTO,l.params.returnBlob=!r,l.handleResult=this._handleImageData,this._addTask(l)}))}readPageImageInfos(e,t,i,s){return Xs(this,void 0,void 0,(function*(){yield Ys(this,gs,"m",Ds).call(this,e),s=null!=s?s:this._outputType;let o=i?JSON.stringify(i):"{}",r=this._createTask("ReadPageImageInfos");return r.params.input=[t,o,s],this._addTask(r)}))}readPageAnnot(e,t){return Xs(this,void 0,void 0,(function*(){yield Ys(this,gs,"m",Ds).call(this,e),t=null!=t?t:0;let i=this._createTask("GetPageAnnot",[t]);return this._addTask(i)}))}findText(e,t,i,s){return Xs(this,void 0,void 0,(function*(){return yield Ys(this,gs,"m",Ds).call(this,e),s=null!=s?s:0,this._addTask(this._createTask("SearchText",[t,i,s]))}))}getPageInfos(e,t){return Xs(this,void 0,void 0,(function*(){return yield Ys(this,gs,"m",Ds).call(this,e),this._addTask(this._createTask("GetPdfPageInfos",[t]))}))}}fs=ao,ms=new WeakMap,vs=new WeakMap,bs=new WeakMap,xs=new WeakMap,Cs=new WeakMap,Ss=new WeakMap,Ps=new WeakMap,Ts=new WeakMap,ks=new WeakMap,gs=new WeakSet,ys=function(e,t){return Xs(this,void 0,void 0,(function*(){if("string"==typeof e&&0!==e.length||Promise.reject("The 'name' should be a valid string"),void 0===Ys(this,fs,"f",ps)[e])if(t instanceof Blob)Ys(this,fs,"f",ps)[e]=t;else {const i=yield Js.read(t);Ys(this,fs,"f",ps)[e]=new Blob([i]);}}))},ws=function(){return Ys(this,fs,"f",ps)},Ds=function(e){var t,i;return Xs(this,void 0,void 0,(function*(){if(this.makeSureWorkerMemoryNotExceed(),Ys(this,Ss,"f")){if(Ys(this,Ts,"f")===e.fileSource)return void Qs.logD("["+this.id+"] already opened in "+this.workerId);yield Ys(this,gs,"m",Ms).call(this);}Qs.logD("["+this.id+"] reopen in worker "+this.workerId),yield Ys(this,gs,"m",Is).call(this,null!==(t=e.fileSource)&&void 0!==t?t:Ys(this,Ts,"f"),null!==(i=e.password)&&void 0!==i?i:Ys(this,ks,"f"));}))},Es=function(){return Xs(this,void 0,void 0,(function*(){if(0===Ys(this,bs,"f")||Ys(this,bs,"f")!==this.workerId){Qs.logD("["+this.id+"] load font in worker "+this.workerId);const e=Ys(ao,fs,"a",ws),t=Object.keys(e);for(let i of t){const t=e[i],s=yield t.arrayBuffer();yield Ys(this,gs,"m",As).call(this,i,s);}}}))},As=function(e,t){return Xs(this,void 0,void 0,(function*(){return this._addTask(this._createTask("AddSystemFont",[e,t]))}))},Is=function(e,t){return Xs(this,void 0,void 0,(function*(){yield Ys(this,gs,"m",Es).call(this),t=null!=t?t:"";let i,s=this,o=s._createTask("LoadPdf");if(e!==Ys(s,Ts,"f")||t!==Ys(s,ks,"f")){const r=yield s._readFile(e,o);e instanceof Blob?qs(s,Ts,e,"f"):qs(s,Ts,new Blob([r]),"f"),i=r,qs(s,ks,t,"f");}else t=Ys(s,ks,"f");return i||(i=yield Ys(s,Ts,"f").arrayBuffer()),o.params.input=[i,t],o.handleResult=function(t,i){if(t.srcBuffer){let i=Object.prototype.toString.call(e);"[object ArrayBuffer]"!=i&&"[object Uint8ClampedArray]"!=i&&delete t.srcBuffer;}let o=no.decode(t.infoBase64);try{let e;try{o.replace(new RegExp("\\\\","gi"),"\\\\"),e=JSON.parse(o);}catch(t){e=o;}let i={PdfCount:t.pageCount,PdfInfo:e,isTextBased:t.isTextBased};return t.srcBuffer&&(i.srcBuffer=t.srcBuffer,delete t.srcBuffer),qs(s,Ss,!0,"f"),qs(s,Ps,i,"f"),i}catch(t){i.reject({code:Ze.wasmJsInvalidJson,message:t.message,stack:t.stack});}},s._addTask(o)}))},Ms=function(){return Xs(this,void 0,void 0,(function*(){if(qs(this,Ts,null,"f"),qs(this,ks,"","f"),Ys(this,Ss,"f"))return qs(this,Ss,!1,"f"),this._addTask(this._createTask("UnloadDocument",null,this._handleBooleanResult))}))},ps={value:Object.create(null)};const lo=["readPdfPage","readTiffPage","readImage"];class ho{static unload(){qs(this,Os,Object.create(null),"f",_s),ao.removeFont();}static add(e){return Xs(this,void 0,void 0,(function*(){Ys(this,Os,"f",_s).push(e),Ys(this,Os,"f",Ls)||(qs(this,Os,new ao,"f",Ls),Ys(this,Os,"f",Ls).setExternalWorkerChanged(Ys(ho,Os,"m",Fs),this),this.initPdfReaderFunctionMap()),Ys(this,Os,"f",Bs)||(qs(this,Os,new ro,"f",Bs),Ys(this,Os,"f",Bs).setExternalWorkerChanged(Ys(ho,Os,"m",Fs),this),this.initImageReaderFunctionMap());}))}static addFont(e,t){return Xs(this,void 0,void 0,(function*(){ao.addPdfFont(e,t);}))}static delete(e){const t=Ys(this,Os,"f",_s).indexOf(e);if(t>=0&&(Ys(this,Os,"f",_s).splice(t,1),0===Ys(this,Os,"f",_s).length&&!Ys(this,Os,"f",Us))){if(Ys(this,Os,"f",Ls)){Qs.logD("pdfReader destroy");const e=Ys(this,Os,"f",Ls);qs(this,Os,null,"f",Ls),e.terminate();}if(Ys(this,Os,"f",Bs)){Qs.logD("imageReader destroy");const e=Ys(this,Os,"f",Bs);qs(this,Os,null,"f",Bs),e.terminate();}}}static createTask(e,t){const i={api:e,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const e of t)i.params.push(e);const s=new Promise((function(e,t){i.resolves.push(e),i.rejects.push(t);}));return i.promise.push(s),Ys(this,Os,"m",zs).call(this,i),s}static cancelTask(e,t){if(-1!==lo.indexOf(e)){const i={api:e,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const e of t)i.params.push(e);Ys(this,Os,"f",Ns).remove(i);}}static initPdfReaderFunctionMap(){var e,t,i,s,o,r;Ys(this,Os,"f",Ws).findPdfText=null===(e=Ys(this,Os,"f",Ls))||void 0===e?void 0:e.findText,Ys(this,Os,"f",Ws).getPdfPageInfos=null===(t=Ys(this,Os,"f",Ls))||void 0===t?void 0:t.getPageInfos,Ys(this,Os,"f",Ws).getPdfInfo=null===(i=Ys(this,Os,"f",Ls))||void 0===i?void 0:i.getPdfInfo,Ys(this,Os,"f",Ws).readPdfPageAnnot=null===(s=Ys(this,Os,"f",Ls))||void 0===s?void 0:s.readPageAnnot,Ys(this,Os,"f",Ws).readPdfPage=null===(o=Ys(this,Os,"f",Ls))||void 0===o?void 0:o.readPageEx,Ys(this,Os,"f",Ws).readPdfPageImageInfos=null===(r=Ys(this,Os,"f",Ls))||void 0===r?void 0:r.readPageImageInfos;}static initImageReaderFunctionMap(){var e,t,i,s,o,r;Ys(this,Os,"f",Vs).readImage=null===(e=Ys(this,Os,"f",Bs))||void 0===e?void 0:e.readImage,Ys(this,Os,"f",Vs).getImageFormat=null===(t=Ys(this,Os,"f",Bs))||void 0===t?void 0:t.getImageFormat,Ys(this,Os,"f",Vs).readImageInfo=null===(i=Ys(this,Os,"f",Bs))||void 0===i?void 0:i.readImageInfo,Ys(this,Os,"f",Vs).getTiffInfo=null===(s=Ys(this,Os,"f",Bs))||void 0===s?void 0:s.getTiffInfo,Ys(this,Os,"f",Vs).readTiffPage=null===(o=Ys(this,Os,"f",Bs))||void 0===o?void 0:o.readTiffPage,Ys(this,Os,"f",Vs).getTiffPageInfos=null===(r=Ys(this,Os,"f",Bs))||void 0===r?void 0:r.getTiffPageInfos;}}Os=ho,Fs=function(e,t,i){let s=null!=e?e:this;Ys(s,Os,"f",Ls)&&Ys(s,Os,"f",Ls)!==t&&Ys(s,Os,"f",Ls).workerChanged(i),Ys(s,Os,"f",Bs)&&Ys(s,Os,"f",Bs)!==t&&Ys(s,Os,"f",Bs).workerChanged(i);},zs=function(e){Ys(this,Os,"f",Ns).add(e),Ys(this,Os,"f",Us)||(qs(this,Os,!0,"f",Us),Ys(this,Os,"m",js).call(this));},Hs=function(){try{Ys(this,Os,"f",Bs)&&Ys(this,Os,"f",Bs).makeSureWorkerMemoryNotExceed(),Ys(this,Os,"f",Ls)&&Ys(this,Os,"f",Ls).makeSureWorkerMemoryNotExceed();}catch(e){}},js=function(){return Xs(this,void 0,void 0,(function*(){do{if(Ys(this,Os,"f",Ns).isEmpty()||!Ys(this,Os,"f",Ls)||!Ys(this,Os,"f",Bs))break;const e=Ys(this,Os,"f",Ns).pop();if(e)try{let t,i=Ys(this,Os,"f",Ws)[e.api];i?(t=yield Ys(this,Os,"f",Ws)[e.api].apply(Ys(this,Os,"f",Ls),e.params),Ys(this,Os,"f",Ls).makeSureWorkerMemoryNotExceed()):(i=Ys(this,Os,"f",Vs)[e.api],i&&(t=yield Ys(this,Os,"f",Vs)[e.api].apply(Ys(this,Os,"f",Bs),e.params),Ys(this,Os,"f",Bs).makeSureWorkerMemoryNotExceed())),null==e||e.resolves.forEach((e=>{e(t);}));}catch(t){Qs.logD(t),e.retry<1?(e.retry+=1,Ys(this,Os,"m",Hs).call(this),Ys(this,Os,"f",Ns).push(e)):null==e||e.rejects.forEach((e=>{e(t);}));}}while(!Ys(this,Os,"f",Ns).isEmpty());qs(this,Os,!1,"f",Us);}))},_s={value:[]},Ns={value:new class{constructor(e){this.items=[],e&&(this.items=e);}push(e){this.items.push(e);}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}add(e){let t;-1!==lo.indexOf(e.api)&&this.push(e);for(let i of this.items)i.api===e.api&&i.params[0]===e.params[0]&&i.params[1]===e.params[1]&&(t=i);t?(t.resolves=[...t.resolves,...e.resolves],t.rejects=[...t.rejects,...e.rejects]):this.push(e);}remove(e){-1!==lo.indexOf(e.api)&&this.items.forEach(((t,i)=>{t.api===e.api&&t.params[0]===e.params[0]&&t.params[1]===e.params[1]&&this.items.splice(i,1).forEach((e=>{null==e||e.resolves.forEach((e=>{e(null);}));}));}));}}},Ls={value:void 0},Bs={value:void 0},Us={value:!1},Ws={value:Object.create(null)},Vs={value:Object.create(null)};class co{constructor(){ho.add(this);}destroy(){ho.delete(this);}readImage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){return ho.createTask("readImage",[e,t,i,s,o])}))}getImageFormat(e){return Xs(this,void 0,void 0,(function*(){return ho.createTask("getImageFormat",[e])}))}readImageInfo(e){return Xs(this,void 0,void 0,(function*(){return ho.createTask("readImageInfo",[e])}))}cancelReadImage(e,t){return ho.cancelTask("readImage",[e,t])}getTiffInfo(e){return Xs(this,void 0,void 0,(function*(){return ho.createTask("getTiffInfo",[e,!1])}))}readTiffPage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){return ho.createTask("readTiffPage",[e,t,i,s,o])}))}cancelReadTiffPage(e,t){return ho.cancelTask("readTiffPage",[e,t])}getTiffPageInfos(e,t){return Xs(this,void 0,void 0,(function*(){return ho.createTask("getTiffPageInfos",[e,t])}))}}var uo,go,fo,po,mo,vo,yo,wo,bo,xo,Co,So,Po,To,ko,Do,Eo,Ao;!function(e){e[e.NearestNeighbour=1]="NearestNeighbour",e[e.Bilinear=2]="Bilinear",e[e.Bicublic=3]="Bicublic",e[e.BestQuality=5]="BestQuality";}(fo||(fo={}));class Io extends so{constructor(e){super(Zs.ImageProcModule,e),uo.add(this);}initImage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){t=null!=t&&t,i=null!=i?i:0,s=null!=s?s:0,o=null!=o&&o;let r=this,n=r._createTask("InitImageObject");if(n.params.input=[e,i,s],t||o)t?n.params.input.push(Je.IT_RGBA):n.params.input.push(Je.IT_BGRA),r._addTask(n);else {const t=yield r._readFile(e,n);n.params.input[0]=t,n.params.input.push(Je.IT_ALL),r._addTask(n);}const a=yield n.promise;if(a.srcBuffer){let t=Object.prototype.toString.call(e);"[object ArrayBuffer]"!=t&&"[object Uint8ClampedArray]"!=t&&delete a.srcBuffer;}return a}))}restore(){return this._addTask(this._createTask("BackToOriginal",null,this._handleBooleanResult))}filter(e,t,i){var s,o,r,n,a,l,h,c,d,u;let g=this;t=null!=t?t:{},i=null!=i?i:{};let f=g._createTask("Filter");if(f.params.input=[],f.params.input.push(e),"toBW"===e)f.params.input.push(JSON.stringify(Ys(g,uo,"m",go).call(g,t)));else if("toGray"===e)f.params.input.push(JSON.stringify(Ys(g,uo,"m",go).call(g,t)));else if("removeShadow"===e)f.params.input.push(JSON.stringify(Ys(g,uo,"m",go).call(g,t)));else if("enhance"===e)f.params.input.push(JSON.stringify(Ys(g,uo,"m",go).call(g,t)));else if("invert"===e)f.params.input.push(JSON.stringify(Ys(g,uo,"m",go).call(g,t)));else if("brightnessAndContrast"===e){let e=null!==(s=t.brightness)&&void 0!==s?s:0,i=null!==(o=t.contrast)&&void 0!==o?o:0;f.params.input.push(e),f.params.input.push(i);}let p=null!==(r=i.returnType)&&void 0!==r?r:Je.IT_JPG,m=null!==(n=i.jpegQuality)&&void 0!==n?n:this._jpegQuality,v=null!==(a=i.bRGBA)&&void 0!==a&&a,y=null!==(l=i.bitDepth)&&void 0!==l?l:0,w=null!==(h=i.xdpi)&&void 0!==h?h:0,b=null!==(c=i.ydpi)&&void 0!==c?c:0,x=null===(d=i.returnBlob)||void 0===d||d;p=v&&null==p?Je.IT_JPG:null!=p?p:Je.IT_ALL;let C=null!==(u=i.is1BitTo8Bit)&&void 0!==u&&u;return f.params.input.push([p,y,w,b,!1,m,!1,C]),f.params.returnBlob=x,f.handleResult=this._handleImageData,g._addTask(f),f.promise}rotate(e,t,i,s){return e=null!=e?e:0,i=null!=i&&i,s=null!=s?s:fo.Bicublic,t=null!=t?t:"FFFFFF",(e<0||e>360)&&(e%=360)<0&&(e+=360),this._addTask(this._createTask("RotateEx",[e,i,s,t],this._handleBooleanResult))}flip(e){e=null!=e?e:1;let t=this._createTask("");return t.handleResult=this._handleBooleanResult,1===e?t.func="Flip":-1===e&&(t.func="Mirror"),this._addTask(t),t.promise}erase(e,t,i,s,o){let r=this,n=r._createTask("Erase");return n.handleResult=this._handleBooleanResult,n.params.input=[e,t,i,s,JSON.stringify(Ys(r,uo,"m",go).call(r,o))],r._addTask(n),n.promise}crop(e,t,i,s){return this._addTask(this._createTask("Crop",[e,t,i,s],this._handleBooleanResult))}resize(e,t,i){return i=null!=i?i:fo.BestQuality,this._addTask(this._createTask("ChangeImageSize",[e,t,i],this._handleBooleanResult))}toGrayscaleLevel(e){(e=null!=e?e:1)<1&&(e=1),e>3&&(e=3);let t={};return 2===e?(t.clean=!0,t.sigma=3,t.scaleLimit=720,t.alpha=1.05):3===e&&(t.clean=!0,t.sigma=5,t.scaleLimit=1080,t.alpha=1.05),this.toGrayscale(t)}toGrayscale(e){return this._addTask(this._createTask("ConvertToGrayScale",JSON.stringify(Ys(this,uo,"m",go).call(this,e)),this._handleBooleanResult))}toBinaryLevel(e,t){(t=null!=t?t:1)<1&&(t=1),t>3&&(t=3);let i={};return null!=e&&(e?i.method="adaptiveThreshold":(i.method="threshold",2===t?(i.clean=!0,i.sigma=3,i.scaleLimit=720,i.alpha=1.05):3===t&&(i.clean=!0,i.sigma=5,i.scaleLimit=1080,i.alpha=1.05))),this.toBinary(i)}toBinary(e){return this._addTask(this._createTask("ConvertToBW",JSON.stringify(Ys(this,uo,"m",go).call(this,e)),this._handleBooleanResult))}invert(){return this._addTask(this._createTask("Invert",null,this._handleBooleanResult))}setImageWidth(e,t){return this._addTask(this._createTask("SetImageWidth",[e,JSON.stringify(Ys(this,uo,"m",go).call(this,t))],this._handleBooleanResult))}setImageHeight(e,t){return this._addTask(this._createTask("SetImageHeight",[e,JSON.stringify(Ys(this,uo,"m",go).call(this,t))],this._handleBooleanResult))}setDPI(e,t,i,s,o,r){return o=null!=o&&o,r=null!=r?r:fo.Bilinear,this._addTask(this._createTask("SetDPI",[e,t,i,s,o,r],this._handleBooleanResult))}getImage(e,t,i,s,o,r,n,a,l){e=null!=e?e:this._jpegQuality,t=null==t||t,s=null!=s?s:0,o=null!=o?o:0,r=null!=r?r:0,n=null==n||n,a=(i=null!=i&&i)&&null==a?Je.IT_JPG:null!=a?a:Je.IT_ALL,l=null!=l&&l;let h=this._createTask("GetCurrentImage");return h.params.input=[a,s,o,r,!1,e,t,l],h.params.returnBlob=n,h.handleResult=this._handleImageData,this._addTask(h)}getSkewAngle(e){return this._addTask(this._createTask("GetSkewAngle",[JSON.stringify(Ys(this,uo,"m",go).call(this,e))],(function(e,t){return e.skewAngle})))}freeReservedData(){return this._addTask(this._createTask("FreeReservedData",null,this._handleBooleanResult))}detectDocument(e,t,i,s,o){return e=null!=e?e:fo.Bilinear,t=null!=t?t:75,i=null!=i?i:100,s=null!=s?s:0,o=null!=o?o:"",this._addTask(this._createTask("DocumentDetect",[e,t/100,i,s/255,o,"1"]))}perspective(e,t,i,s,o,r,n,a){return this._addTask(this._createTask("Perspective",[e,t,i,s,o,r,n,a],this._handleBooleanResult))}changeBrightness(e,t){return e=null!=e?e:0,0!=(t=null!=t?t:1)&&1!=t&&(t=0),1===t?this._addTask(this._createTask("ChangeBrightnessAndContrast",[e,0],this._handleBooleanResult)):this._addTask(this._createTask("ChangeBrightness",[Math.floor(e/1e3*255)],this._handleBooleanResult))}changeContrast(e,t){return e=null!=e?e:0,0!=(t=null!=t?t:1)&&1!=t&&(t=0),1===t?this._addTask(this._createTask("ChangeBrightnessAndContrast",[0,e],this._handleBooleanResult)):this._addTask(this._createTask("ChangeContrast",[1+e/1e3],this._handleBooleanResult))}changeBrightnessAndContrast(e,t){return e=null!=e?e:0,t=null!=t?t:0,this._addTask(this._createTask("ChangeBrightnessAndContrast",[e,t],this._handleBooleanResult))}removeShadowLevel(e,t){t=null!=t?t:1.05,(e=null!=e?e:1)<1&&(e=1),e>3&&(e=3);let i={};return 1===e&&(i.sigma=3,i.scaleLimit=720,i.alpha=t),2===e?(i.sigma=5,i.scaleLimit=1080,i.alpha=t):3===e&&(i.sigma=10,i.scaleLimit=0,i.alpha=t),this.removeShadow(i)}removeShadow(e){return this._addTask(this._createTask("ShadowRemovel",[JSON.stringify(Ys(this,uo,"m",go).call(this,e))],this._handleBooleanResult))}enhanceAndSharpenImage(){return this._addTask(this._createTask("EnhanceAndSharpen",[""],this._handleBooleanResult))}brighten(){return this._addTask(this._createTask("Brighten",[""],this._handleBooleanResult))}getBlurryScore(){return this._addTask(this._createTask("GetBlurScore",[""],(function(e,t){return e.blurryScore})))}drawQuadrangle(e,t,i,s,o,r,n,a,l){return this._addTask(this._createTask("DrawQuadrangle",[e,t,i,s,o,r,n,a,JSON.stringify(Ys(this,uo,"m",go).call(this,l))],this._handleBooleanResult))}getImageInfo(){return this._addTask(this._createTask("GetImageInfo",[]))}}uo=new WeakSet,go=function(e){let t={};if(null!=e&&"object"==typeof e)for(let i in e)t[i]=e[i];return t};class Mo{constructor(){ho.add(this);}destroy(){ho.delete(this);}static addPdfFont(e,t){return Xs(this,void 0,void 0,(function*(){return ho.addFont(e,t)}))}getPdfInfo(e){return Xs(this,void 0,void 0,(function*(){return ho.createTask("getPdfInfo",[e])}))}readPage(e,t,i,s,o,r,n,a){return Xs(this,void 0,void 0,(function*(){return this.readPageEx(e,t,{convertMode:s,renderOptions:{resolution:i}},o,r,n,a)}))}readPageEx(e,t,i,s,o,r,n){return Xs(this,void 0,void 0,(function*(){return ho.createTask("readPdfPage",[e,t,i,s,o,r,n])}))}cancelReadPage(e,t){return ho.cancelTask("readPdfPage",[e,t])}readPageImageInfos(e,t,i,s,o,r,n){return Xs(this,void 0,void 0,(function*(){return ho.createTask("readPdfPageImageInfos",[e,t,i,s,o,r,n])}))}readPageAnnot(e,t){return Xs(this,void 0,void 0,(function*(){return ho.createTask("readPdfPageAnnot",[e,t])}))}findText(e,t,i,s){return Xs(this,void 0,void 0,(function*(){return ho.createTask("findPdfText",[e,t,i,s])}))}getPageInfos(e,t){return Xs(this,void 0,void 0,(function*(){return ho.createTask("getPdfPageInfos",[e,t])}))}}!function(e){e[e.auto=0]="auto",e[e.store=1]="store";}(vo||(vo={}));class Ro{constructor(){this.version=void 0,this.compression=void 0,this.author=void 0,this.creationDate=void 0,this.creator=void 0,this.keyWords=void 0,this.modifiedDate=void 0,this.producer=void 0,this.subject=void 0,this.title=void 0,this.quality=void 0,this.pageType=void 0,this.jpegMode=void 0;}}class Oo extends so{constructor(e){super(Zs.PdfWriterModule,e),po.add(this);}initPdfSetting(e){return Xs(this,void 0,void 0,(function*(){let t=this,i=t._createTask("CreateDocument");return i.params.input=[JSON.stringify(Ys(t,po,"m",mo).call(t,e))],i.handleResult=this._handleBooleanResult,t._addTask(i)}))}appendPage(e,t){return Xs(this,void 0,void 0,(function*(){let i=this,s=i._createTask("InsertImagePage");t=null!=t&&t;const o=yield i._readFile(e,s);return s.params.input=[o,-1,t],s.handleResult=i._handleBooleanResult,i._addTask(s),s.promise}))}insertPage(e,t,i){return Xs(this,void 0,void 0,(function*(){let s=this,o=s._createTask("InsertImagePage");i=null!=i&&i;const r=yield s._readFile(e,o);return o.params.input=[r,t,i],o.handleResult=s._handleBooleanResult,s._addTask(o),o.promise}))}writePdf(e){return Xs(this,void 0,void 0,(function*(){let t=this._createTask("GetCurrentPdf");return t.params.returnType=null!=e?e:Ke.RT_AUTO,t.params.returnBlob=e!=Ke.RT_AUTO,t.handleResult=this._handleImageData,this._addTask(t)}))}insertBlankPage(e,t,i){return Xs(this,void 0,void 0,(function*(){return e=null!=e?e:0,t=null!=t?t:595,i=null!=i?i:842,this._addTask(this._createTask("InsertBlankPage",[e,t,i]))}))}deletePage(e){return Xs(this,void 0,void 0,(function*(){return e=null!=e?e:0,this._addTask(this._createTask("DeletePdfPage",[e],this._handleBooleanResult))}))}pageSetRotation(e,t){return Xs(this,void 0,void 0,(function*(){e=null!=e?e:0,0!=(t=((t=null!=t?t:0)%360+360)%360)&&90!==t&&180!==t&&270!==t&&(t=0);let i=this._createTask("SetPageRotation");return i.params.input=[e,t],i.handleResult=this._handleBooleanResult,this._addTask(i)}))}pageSetCropBox(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){e=null!=e?e:0,t=null!=t?t:0,i=null!=i?i:0,(s=null!=s?s:t)<t&&(s=t),(o=null!=o?o:i)<i&&(o=i);let r=this._createTask("SetPageCropBox");return r.params.input=[e,t,i,s,o],r.handleResult=this._handleBooleanResult,this._addTask(r)}))}pageAddImage(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){let r=this,n=r._createTask("PageAddImage"),a=JSON.stringify(Ys(r,po,"m",mo).call(r,i));const l=yield r._readFile(e,n);return n.params.input=[l,t,a,s,o],n.handleResult=r._handleBooleanResult,r._addTask(n),n.promise}))}pageAddText(e,t){return Xs(this,void 0,void 0,(function*(){let i=JSON.stringify(t);return this._addTask(this._createTask("PageAddText",[e,i],this._handleBooleanResult))}))}pageAddPath(e,t){return Xs(this,void 0,void 0,(function*(){let i=JSON.stringify(t);return this._addTask(this._createTask("PageAddPath",[e,i],this._handleBooleanResult))}))}pageSetAnnot(e,t){return Xs(this,void 0,void 0,(function*(){e=null!=e?e:0;let i=t.toJsonString();return this._addTask(this._createTask("SetPageAnnot",[e,i],this._handleBooleanResult))}))}pageAddAnnot(e,t){return Xs(this,void 0,void 0,(function*(){e=null!=e?e:0;let i=t.toJsonString();return this._addTask(this._createTask("PageAddAnnot",[e,i],this._handleBooleanResult))}))}pageDeleteAnnot(e,t){return Xs(this,void 0,void 0,(function*(){return e=null!=e?e:0,t=null!=t?t:0,this._addTask(this._createTask("PageDeleteAnnot",[e,t],this._handleBooleanResult))}))}mergePdf(e,t,i,s,o){return Xs(this,void 0,void 0,(function*(){s=null!=s?s:-1,i=null!=i?i:[],t=null!=t?t:"",o=null!=o&&o;let r=this,n=r._createTask("MergePdfPages");const a=yield r._readFile(e,n);return n.params.input=[a,s,t,i,o],n.handleResult=r._handleBooleanResult,r._addTask(n),n.promise}))}}po=new WeakSet,mo=function(e){let t={};if(null!=e&&"object"==typeof e)for(let i in e)t[i]=e[i];return t},function(e){e.Text="Text",e.Link="Link",e.FreeText="FreeText",e.Line="Line",e.Square="Square",e.Circle="Circle",e.Polygon="Polygon",e.PolyLine="PolyLine",e.Hignlight="Hignlight",e.Underline="Underline",e.Squiggly="Squiggly",e.StrikeOut="StrikeOut",e.Stamp="Stamp",e.Caret="Caret",e.Ink="Ink",e.Popup="Popup";}(yo||(yo={})),function(e){e.None="none",e.Invisible="invisible",e.Hidden="hidden",e.Print="print",e.NoZoom="noZoom",e.NoRotate="noRotate",e.NoView="noView",e.ReadOnly="readOnly",e.Locked="locked",e.ToggleNoView="toggleNoView",e.LockedContents="lockedContents";}(wo||(wo={})),function(e){e.Solid="S",e.Dashed="D",e.Beveled="B",e.Insert="I",e.Underline="U";}(bo||(bo={})),function(e){e.NoEffect="S",e.Cloudy="C";}(xo||(xo={})),function(e){e.Comment="Comment",e.Key="Key",e.Note="Note",e.Help="Help",e.NewParagraph="NewParagraph",e.Paragraph="Paragraph",e.Insert="Insert";}(Co||(Co={})),function(e){e.Marked="Marked",e.Review="Review";}(So||(So={})),function(e){e.Accepted="Accepted",e.Rejected="Rejected",e.Cancelled="Cancelled",e.Completed="Completed",e.None="None";}(Po||(Po={})),function(e){e.None="None",e.Square="Square",e.Circle="Circle",e.Diamond="Diamond",e.OpenArrow="OpenArrow",e.ClosedArrow="ClosedArrow",e.Butt="Butt",e.ROpenArrow="ROpenArrow",e.RClosedArrow="RClosedArrow",e.Slash="Slash";}(To||(To={})),function(e){e[e.LeftJustified=0]="LeftJustified",e[e.Centered=1]="Centered",e[e.RightJustified=2]="RightJustified";}(ko||(ko={})),function(e){e.FreeText="FreeText",e.FreeTextCallout="FreeTextCallout",e.FreeTextTypeWriter="FreeTextTypeWriter";}(Do||(Do={})),function(e){e.LineArrow="LineArrow",e.LineDimension="LineDimension";}(Eo||(Eo={})),function(e){e.Approved="Approved",e.Experimental="Experimental",e.NotApproved="NotApproved",e.Asls="Asls",e.Expired="Expired",e.NotForPublicRelease="NotForPublicRelease",e.Confidential="Confidential",e.Final="Final",e.Sold="Sold",e.Departmental="Departmental",e.ForComment="ForComment",e.TopSecret="TopSecret",e.Draft="Draft",e.ForPublicRelease="ForPublicRelease";}(Ao||(Ao={}));const _o="undefined"==typeof self,No=_o?{}:self;let Lo,Bo,Uo,Wo,Vo;"undefined"!=typeof navigator&&(Lo=navigator,Bo=Lo.userAgent,Uo=Lo.platform,Wo=Lo.mediaDevices),function(){if(!_o){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Lo.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Uo,search:"Win"},Mac:{str:Uo},Linux:{str:Uo}};let i="unknownBrowser",s=0,o="unknownOS";for(let t in e){const o=e[t]||{};let r=o.str||Bo,n=o.search||t,a=o.verStr||Bo,l=o.verSearch||t;if(l instanceof Array||(l=[l]),-1!=r.indexOf(n)){i=t;for(let e of l){let t=a.indexOf(e);if(-1!=t){s=parseFloat(a.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let s=i.str||Bo,r=i.search||e;if(-1!=s.indexOf(r)){o=e;break}}"Linux"==o&&-1!=Bo.indexOf("Windows NT")&&(o="HarmonyOS"),Vo={browser:i,version:s,OS:o};}_o&&(Vo={browser:"ssr",version:0,OS:"ssr"});}(),Wo&&Wo.getUserMedia;const Fo="Chrome"===Vo.browser&&Vo.version>66||"Safari"===Vo.browser&&Vo.version>13||"OPR"===Vo.browser&&Vo.version>43||"Edge"===Vo.browser&&Vo.version>15;!_o&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")),!_o&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const zo=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e;if(i._pLoad.isEmpty){let e,s,o,r=i._license||"",n=JSON.parse(JSON.stringify(i._licenseServer)),a=i._sessionPassword,l=0;if(r.startsWith("t")||r.startsWith("f"))l=0;else if(0===r.length||r.startsWith("P")||r.startsWith("L")||r.startsWith("Y")||r.startsWith("A"))l=1;else {l=2;const t=r.indexOf(":");-1!=t&&(r=r.substring(t+1));const i=r.indexOf("?");if(-1!=i&&(s=r.substring(i+1),r=r.substring(0,i)),r.startsWith("DLS2")){let t;try{let e=r.substring(4);e=atob(e),t=JSON.parse(e);}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(r=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof r&&(r=JSON.stringify(r)),0===n.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),n=(e=>{if(null==e)e=[];else {e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!_o){let i=document.createElement("a");i.href=e[t],e[t]=i.href;}e[t].endsWith("/")||(e[t]+="/");}}return e})(e);}!a&&t.sessionPassword&&(a=t.sessionPassword),e=t.remark;}("200001"===r||r.startsWith("200001-"))&&(n&&n.length||(r="")),r||(l=1);}if(l&&(t||(No.crypto||(o="Please upgrade your browser to support online key."),No.crypto.subtle||(o="Require https to use online key in this browser."))),o){if(1!==l)throw new Error(o);l=0,i._lastErrorCode=-1,i._lastErrorString=o;}return 1===l&&(r=""),{lt:l,l:r,ls:n,sp:a,rmk:e,cv:s}}throw new Error("Can't preprocess license again is not allowed to change after `createInstance` or `loadWasm` is called.")},Ho=async(e,t,i)=>{if(!e._bNeverShowDialog)try{let s=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!s.ok)throw Error("Get license dialog fail. Network Error: "+s.statusText);let o=await s.text();if(!o.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let r=document.createElement("div");r.innerHTML=o;let n=[];for(let e=0;e<r.childElementCount;++e){let t=r.children[e];t instanceof HTMLStyleElement&&(n.push(t),document.head.append(t));}let a=1==r.childElementCount?r.children[0]:r;a.remove();let l,h,c,d,u,g=[a],f=a.children;for(let e of f)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let e of g)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",(t=>{if(e==t.target){a.remove();for(let e of n)e.remove();}}));else if(!h&&e.classList.contains("dls-license-icon-close"))h=e,e.addEventListener("click",(()=>{a.remove();for(let e of n)e.remove();}));else if(!c&&e.classList.contains("dls-license-icon-error"))c=e,"error"!=t&&e.remove();else if(!d&&e.classList.contains("dls-license-icon-warn"))d=e,"warn"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-msg-content")){u=e;let t=i;for(;t;){let i=t.indexOf("["),s=t.indexOf("]",i),o=t.indexOf("(",s),r=t.indexOf(")",o);if(-1==i||-1==s||-1==o||-1==r){e.appendChild(new Text(t));break}i>0&&e.appendChild(new Text(t.substring(0,i)));let n=document.createElement("a"),a=t.substring(i+1,s);n.innerText=a;let l=t.substring(o+1,r);n.setAttribute("href",l),n.setAttribute("target","_blank"),e.appendChild(n),t=t.substring(r+1);}}document.body.appendChild(a);}catch(t){e._onLog&&e._onLog(t.message||t);}};var jo=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function Go(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)i.append(e[s]);return i.getBlob(t.type)}}function $o(e,t){t&&e.then((function(e){t(null,e);}),(function(e){t(e);}));}function Xo(e,t,i){"function"==typeof t&&e.then(t),"function"==typeof i&&e.catch(i);}function Yo(e){return "string"!=typeof e&&(e=String(e)),e}function qo(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const Qo="local-forage-detect-blob-support";let Zo;const Jo={},Ko=Object.prototype.toString,er="readonly",tr="readwrite";function ir(e){return "boolean"==typeof Zo?Promise.resolve(Zo):function(e){return new Promise((function(t){var i=e.transaction(Qo,tr),s=Go([""]);i.objectStore(Qo).put(s,"key"),i.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1);},i.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);t(i||!e||parseInt(e[1],10)>=43);};})).catch((function(){return !1}))}(e).then((function(e){return Zo=e,Zo}))}function sr(e){var t=Jo[e.name],i={};i.promise=new Promise((function(e,t){i.resolve=e,i.reject=t;})),t.deferredOperations.push(i),t.dbReady?t.dbReady=t.dbReady.then((function(){return i.promise})):t.dbReady=i.promise;}function or(e){var t=Jo[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function rr(e,t){var i=Jo[e.name].deferredOperations.pop();if(i)return i.reject(t),i.promise}function nr(e,t){return new Promise((function(i,s){if(Jo[e.name]=Jo[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return i(e.db);sr(e),e.db.close();}var o=[e.name];t&&o.push(e.version);var r=jo.open.apply(jo,o);t&&(r.onupgradeneeded=function(t){var i=r.result;try{i.createObjectStore(e.storeName),t.oldVersion<=1&&i.createObjectStore(Qo);}catch(e){if("ConstraintError"!==e.name)throw e}}),r.onerror=function(e){e.preventDefault(),s(r.error);},r.onsuccess=function(){var t=r.result;t.onversionchange=function(e){e.target.close();},i(t),or(e);};}))}function ar(e){return nr(e,!1)}function lr(e){return nr(e,!0)}function hr(e,t){if(!e.db)return !0;var i=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,o=e.version>e.db.version;if(s&&(e.version,e.version=e.db.version),o||i){if(i){var r=e.db.version+1;r>e.version&&(e.version=r);}return !0}return !1}function cr(e){var t=function(e){for(var t=e.length,i=new ArrayBuffer(t),s=new Uint8Array(i),o=0;o<t;o++)s[o]=e.charCodeAt(o);return i}(atob(e.data));return Go([t],{type:e.type})}function dr(e){var t=this,i=t._initReady().then((function(){var e=Jo[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return Xo(i,e,e),i}function ur(e,t,i,s){void 0===s&&(s=1);try{var o=e.db.transaction(e.storeName,t);i(null,o);}catch(o){if(s>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return Promise.resolve().then((()=>{if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),lr(e)})).then((()=>function(e){sr(e);for(var t=Jo[e.name],i=t.forages,s=0;s<i.length;s++){const e=i[s];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null);}return e.db=null,ar(e).then((t=>(e.db=t,hr(e)?lr(e):t))).then((s=>{e.db=t.db=s;for(var o=0;o<i.length;o++)i[o]._dbInfo.db=s;})).catch((t=>{throw rr(e,t),t}))}(e).then((function(){ur(e,t,i,s-1);})))).catch(i);i(o);}}var gr={_driver:"asyncStorage",_initStorage:function(e){var t=this,i={db:null};if(e)for(var s in e)i[s]=e[s];var o=Jo[i.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},Jo[i.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=dr);var r=[];function n(){return Promise.resolve()}for(var a=0;a<o.forages.length;a++){var l=o.forages[a];l!==t&&r.push(l._initReady().catch(n));}var h=o.forages.slice(0);return Promise.all(r).then((function(){return i.db=o.db,ar(i)})).then((function(e){return i.db=e,hr(i,t._defaultConfig.version)?lr(i):e})).then((function(e){i.db=o.db=e,t._dbInfo=i;for(var s=0;s<h.length;s++){var r=h[s];r!==t&&(r._dbInfo.db=i.db,r._dbInfo.version=i.version);}}))},_support:function(){try{if(!jo||!jo.open)return !1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return (!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return !1}}(),getItem:function(e,t){var i=this;e=Yo(e);var s=new Promise((function(t,s){i.ready().then((function(){ur(i._dbInfo,er,(function(o,r){if(o)return s(o);try{var n=r.objectStore(i._dbInfo.storeName).get(e);n.onsuccess=function(){var e=n.result;void 0===e&&(e=null),function(e){return e&&e.__local_forage_encoded_blob}(e)&&(e=cr(e)),t(e);},n.onerror=function(){s(n.error);};}catch(e){s(e);}}));})).catch(s);}));return $o(s,t),s},setItem:function(e,t,i){var s=this;e=Yo(e);var o=new Promise((function(i,o){var r;s.ready().then((function(){return r=s._dbInfo,"[object Blob]"===Ko.call(t)?ir(r.db).then((function(e){return e?t:(i=t,new Promise((function(e,t){var s=new FileReader;s.onerror=t,s.onloadend=function(t){var s=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:s,type:i.type});},s.readAsBinaryString(i);})));var i;})):t})).then((function(t){ur(s._dbInfo,tr,(function(r,n){if(r)return o(r);try{var a=n.objectStore(s._dbInfo.storeName);null===t&&(t=void 0);var l=a.put(t,e);n.oncomplete=function(){void 0===t&&(t=null),i(t);},n.onabort=n.onerror=function(){var e=l.error?l.error:l.transaction.error;o(e);};}catch(e){o(e);}}));})).catch(o);}));return $o(o,i),o},removeItem:function(e,t){var i=this;e=Yo(e);var s=new Promise((function(t,s){i.ready().then((function(){ur(i._dbInfo,tr,(function(o,r){if(o)return s(o);try{var n=r.objectStore(i._dbInfo.storeName).delete(e);r.oncomplete=function(){t();},r.onerror=function(){s(n.error);},r.onabort=function(){var e=n.error?n.error:n.transaction.error;s(e);};}catch(e){s(e);}}));})).catch(s);}));return $o(s,t),s},clear:function(e){var t=this,i=new Promise((function(e,i){t.ready().then((function(){ur(t._dbInfo,tr,(function(s,o){if(s)return i(s);try{var r=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e();},o.onabort=o.onerror=function(){var e=r.error?r.error:r.transaction.error;i(e);};}catch(e){i(e);}}));})).catch(i);}));return $o(i,e),i},length:function(e){var t=this,i=new Promise((function(e,i){t.ready().then((function(){ur(t._dbInfo,er,(function(s,o){if(s)return i(s);try{var r=o.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result);},r.onerror=function(){i(r.error);};}catch(e){i(e);}}));})).catch(i);}));return $o(i,e),i},keys:function(e){var t=this,i=new Promise((function(e,i){t.ready().then((function(){ur(t._dbInfo,er,(function(s,o){if(s)return i(s);try{var r=o.objectStore(t._dbInfo.storeName).openKeyCursor(),n=[];r.onsuccess=function(){var t=r.result;t?(n.push(t.key),t.continue()):e(n);},r.onerror=function(){i(r.error);};}catch(e){i(e);}}));})).catch(i);}));return $o(i,e),i},dropInstance:function(e,t){t=qo.apply(this,arguments);var i,s=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName),e.name){const t=e.name===s.name&&this._dbInfo.db?Promise.resolve(this._dbInfo.db):ar(e).then((t=>{const i=Jo[e.name],s=i.forages;i.db=t;for(var o=0;o<s.length;o++)s[o]._dbInfo.db=t;return t}));i=e.storeName?t.then((t=>{if(!t.objectStoreNames.contains(e.storeName))return;const i=t.version+1;sr(e);const s=Jo[e.name],o=s.forages;t.close();for(let e=0;e<o.length;e++){const t=o[e];t._dbInfo.db=null,t._dbInfo.version=i;}const r=new Promise(((t,s)=>{const o=jo.open(e.name,i);o.onerror=e=>{o.result.close(),s(e);},o.onupgradeneeded=()=>{o.result.deleteObjectStore(e.storeName);},o.onsuccess=()=>{const e=o.result;e.close(),t(e);};}));return r.then((e=>{s.db=e;for(let t=0;t<o.length;t++){const i=o[t];i._dbInfo.db=e,or(i._dbInfo);}})).catch((t=>{throw (rr(e,t)||Promise.resolve()).catch((()=>{})),t}))})):t.then((t=>{sr(e);const i=Jo[e.name],s=i.forages;t.close();for(var o=0;o<s.length;o++){s[o]._dbInfo.db=null;}const r=new Promise(((t,i)=>{var s=jo.deleteDatabase(e.name);s.onerror=()=>{const e=s.result;e&&e.close(),i(s.error);},s.onblocked=()=>{},s.onsuccess=()=>{const e=s.result;e&&e.close(),t(e);};}));return r.then((e=>{i.db=e;for(var t=0;t<s.length;t++){or(s[t]._dbInfo);}})).catch((t=>{throw (rr(e,t)||Promise.resolve()).catch((()=>{})),t}))}));}else i=Promise.reject("Invalid arguments");return $o(i,t),i}};const fr=new Map;function pr(e,t){let i=e.name+"/";return e.storeName!==t.storeName&&(i+=e.storeName+"/"),i}var mr={_driver:"tempStorageWrapper",_initStorage:async function(e){const t={};if(e)for(let i in e)t[i]=e[i];const i=t.keyPrefix=pr(e,this._defaultConfig);this._dbInfo=t,fr.has(i)||fr.set(i,new Map);},getItem:function(e,t){e=Yo(e);const i=this.ready().then((()=>fr.get(this._dbInfo.keyPrefix).get(e)));return $o(i,t),i},setItem:function(e,t,i){e=Yo(e);const s=this.ready().then((()=>(void 0===t&&(t=null),fr.get(this._dbInfo.keyPrefix).set(e,t),t)));return $o(s,i),s},removeItem:function(e,t){e=Yo(e);const i=this.ready().then((()=>{fr.get(this._dbInfo.keyPrefix).delete(e);}));return $o(i,t),i},clear:function(e){const t=this.ready().then((()=>{const e=this._dbInfo.keyPrefix;fr.has(e)&&fr.delete(e);}));return $o(t,e),t},length:function(e){const t=this.ready().then((()=>fr.get(this._dbInfo.keyPrefix).size));return $o(t,e),t},keys:function(e){const t=this.ready().then((()=>[...fr.get(this._dbInfo.keyPrefix).keys()]));return $o(t,e),t},dropInstance:function(e,t){if(t=qo.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName;}let i;return i=e.name?new Promise((t=>{e.storeName?t(pr(e,this._defaultConfig)):t(`${e.name}/`);})).then((e=>{fr.delete(e);})):Promise.reject("Invalid arguments"),$o(i,t),i}};const vr=(e,t)=>e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t),yr=(e,t)=>{const i=e.length;let s=0;for(;s<i;){if(vr(e[s],t))return !0;s++;}return !1},wr=Array.isArray||function(e){return "[object Array]"===Object.prototype.toString.call(e)},br={},xr={},Cr={INDEXEDDB:gr,TEMPSTORAGE:mr},Sr=[Cr.INDEXEDDB._driver,Cr.TEMPSTORAGE._driver],Pr=["dropInstance"],Tr=["clear","getItem","keys","length","removeItem","setItem"].concat(Pr),kr={description:"",driver:Sr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Dr(e,t){e[t]=function(){const i=arguments;return e.ready().then((function(){return e[t].apply(e,i)}))};}function Er(){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(t)for(let e in t)t.hasOwnProperty(e)&&(wr(t[e])?arguments[0][e]=t[e].slice():arguments[0][e]=t[e]);}return arguments[0]}class Ar{constructor(e){for(let e in Cr)if(Cr.hasOwnProperty(e)){const t=Cr[e],i=t._driver;this[e]=i,br[i]||this.defineDriver(t);}this._defaultConfig=Er({},kr),this._config=Er({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}));}config(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t];}return !("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return "string"==typeof e?this._config[e]:this._config}defineDriver(e,t,i){const s=new Promise((function(t,i){try{const s=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void i(o);const r=Tr.concat("_initStorage");for(let t=0,s=r.length;t<s;t++){const s=r[t];if((!yr(Pr,s)||e[s])&&"function"!=typeof e[s])return void i(o)}const n=function(){const t=function(e){return function(){const t=new Error(`Method ${e} is not implemented by the current driver`),i=Promise.reject(t);return $o(i,arguments[arguments.length-1]),i}};for(let i=0,s=Pr.length;i<s;i++){const s=Pr[i];e[s]||(e[s]=t(s));}};n();const a=function(i){br[s],br[s]=e,xr[s]=i,t();};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(a,i):a(!!e._support):a(!0);}catch(e){i(e);}}));return Xo(s,t,i),s}driver(){return this._driver||null}getDriver(e,t,i){const s=br[e]?Promise.resolve(br[e]):Promise.reject(new Error("Driver not found."));return Xo(s,t,i),s}ready(e){const t=this,i=t._driverSet.then((()=>(null===t._ready&&(t._ready=t._initDriver()),t._ready)));return Xo(i,e,e),i}setDriver(e,t,i){const s=this;wr(e)||(e=[e]);const o=this._getSupportedDrivers(e);function r(){s._config.driver=s.driver();}function n(e){return s._extend(e),r(),s._ready=s._initStorage(s._config),s._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>Promise.resolve())):Promise.resolve();return this._driverSet=a.then((()=>{const e=o[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then((e=>{s._driver=e._driver,r(),s._wrapLibraryMethodsWithReady(),s._initDriver=function(e){return function(){let t=0;return function i(){for(;t<e.length;){let o=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(o).then(n).catch(i)}r();const o=new Error("No available storage method found.");return s._driverSet=Promise.reject(o),s._driverSet}()}}(o);}))})).catch((()=>{r();const e=new Error("No available storage method found.");return s._driverSet=Promise.reject(e),s._driverSet})),Xo(this._driverSet,t,i),this._driverSet}supports(e){return !!xr[e]}_extend(e){Er(this,e);}_getSupportedDrivers(e){const t=[];for(let i=0,s=e.length;i<s;i++){const s=e[i];this.supports(s)&&t.push(s);}return t}_wrapLibraryMethodsWithReady(){for(let e=0,t=Tr.length;e<t;e++)Dr(this,Tr[e]);}createInstance(e){return new Ar(e)}}var Ir=new Ar;Date.prototype.kUtilFormat=function(e){const t={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"H+":this.getUTCHours(),"h+":this.getUTCHours()%12||12,"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),"S+":this.getUTCMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length)));for(let i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("000"+t[i]).substr(("000"+t[i]).length-RegExp.$1.length)));return e},String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0==this.indexOf(e)});let Mr=e=>{let t,i,s,o,r,n,a,l,h,c=e.fetch||No.fetch,d=e.btoa||No.btoa,u=e.atob||No.atob,g=e.bd,f=e.dm;const p=["https://mlts.dynamsoft.com/","https://slts.dynamsoft.com/"];let m,v,y,w,b,x,C,S,P,T,k,D,E,A,I,M,R,O=p,_=!1,N=Promise.resolve(),L=e.lf,B=e.log&&function(){try{for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];e.log.apply(null,i);}catch(e){setTimeout((()=>{throw e}),0);}}||(()=>{}),U=g&&B||(()=>{}),W=e.fol,V=e.sutlcb,F=e.feab,z=e=>u(u(e.replace(/\n/g,"+").replace(/\s/g,"=")).substring(1)),H=e=>d(String.fromCharCode(97+25*Math.random())+d(e)).replace(/\+/g,"\n").replace(/=/g," "),j=()=>{if(E)return E;if(No.crypto){let e=new Uint8Array(36);No.crypto.getRandomValues(e);let t="";for(let i=0;i<36;++i){let s=e[i]%36;t+=s<10?s:String.fromCharCode(s+87);}return t}return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return ("x"==e?t:3&t|8).toString(16)}))},G=async()=>(A=A||(async()=>{await(async()=>{L||(L=Ir);})();{let e=await L.createInstance({name:"dynamjssdkhello"});await e.setItem("dynamjssdkhello","available");}if(C=await L.createInstance({name:"dynamdlsinfo"}),S=E?null:d(d("v2")+String.fromCharCode(f.charCodeAt(f.length/2)+1)+d(f)),!E){try{let e=await C.getItem(S);if(!e){let t=await L.createInstance({name:"dynamltsinfo"});e=await t.getItem(S),e&&await C.setItem(S,e);}e&&([a,w]=JSON.parse(await z(e)));}catch(e){}try{null==a&&(a=j(),C.setItem(S,await H(JSON.stringify([a,null]))));}catch(e){}}})(),A),$=async e=>{M=Date.now(),I||(I=(async()=>{try{let u={pd:t,vm:s,v:i,dt:n||"browser",ed:"javascript",cu:a,ad:f,os:l,fn:h};y&&(u.rmk=y),o&&(-1!=o.indexOf("-")?u.hs=o:u.og=o);let g={};if(w&&!E){let e=await C.getItem(S);e&&([a,w]=JSON.parse(await z(e))),g["lts-time"]=w;}v&&(u.sp=v);let p=await Promise.race([(async()=>{let t,i=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");w&&!E&&(C.setItem(S,await H(JSON.stringify([a,i]))),w=i);let s,o="auth/?ext="+encodeURIComponent(d(JSON.stringify(u))),n=!1,l=!1,h=async e=>{if(e&&!e.ok)try{let t=await e.text();if(t){let e=JSON.parse(t);e.errorCode&&(s=e,e.errorCode>100&&e.errorCode<200&&(r=null,n=!0,l=!0));}}catch(e){}};try{t=await c(O[0]+o,{headers:g,cache:e?"reload":"default",mode:"cors",timeout:1e4}),await h(t);}catch(e){}if(!(r||t&&t.ok||n))try{t=await c(O[1]+o,{headers:g,mode:"cors",timeout:3e4}),await h(t);}catch(e){}if(!(r||t&&t.ok||n))try{t=await c(O[0]+o,{headers:g,mode:"cors",timeout:3e4}),await h(t);}catch(e){}s&&151==s.errorCode&&!E&&(C.removeItem(S),C.removeItem(P),a=j(),u.cu=a,w=void 0,o="auth/?ext="+encodeURIComponent(d(JSON.stringify(u))),t=await c(O[0]+o,{headers:g,mode:"cors",timeout:3e4}),await h(t)),(()=>{if(!t||!t.ok){let e;l&&C.setItem(P,""),s?111==s.errorCode?e=s.message:(e=s.message.trim(),e.endsWith(".")||(e+="."),e=m?`An error occurred during authorization: ${e} [Contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.`:`An error occurred during authorization: ${e} Contact the site administrator for more information.`):e=m?"Failed to connect to the Dynamsoft License Server: network connection error. Check your Internet connection or [contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.":"Failed to connect to the Dynamsoft License Server: network connection error. Check your Internet connection or contact the site administrator for more information.";let t=Error(e);throw s&&s.errorCode&&(t.ltsErrorCode=s.errorCode),t}})();let f=await t.text();try{w||E||(C.setItem(S,await H(JSON.stringify([a,i]))),w=i),C.setItem(P,f);}catch(e){}return f})(),new Promise(((e,t)=>{let i;i=m?"Failed to connect to the Dynamsoft License Server: network timed out. Check your Internet connection or [contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.":"Failed to connect to the Dynamsoft License Server: network timed out. Check your Internet connection or contact the site administrator for more information.",setTimeout((()=>t(new Error(i))),r?3e3:15e3);}))]);r=p;}catch(e){b=e;}I=null;})()),await I;},X=async()=>{R||(R=(async()=>{if(U(a),!r){if(!_)throw B(b.message),b;return}let e={dm:f};g&&(e.bd=!0),e.brtk=!0,e.ls=O[0],o&&(-1!=o.indexOf("-")?e.hs=o:e.og=o),e.cu=a,h&&(e.fn=h),t&&(e.pd=t),i&&(e.v=i),n&&(e.dt=n),l&&(e.os=l),y&&(e.rmk=y),U(r);try{e.ar=r,e.bafc=!!b;}catch(e){}U(e);try{await T(e);}catch(e){U("error updl");}await Y(),_||(_=!0),R=null;})()),await R;},Y=async()=>{let e=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),t=await D();if(U(t),t&&t<e)throw b?new Error("Failed to connect to the Dynamsoft License Server. The cached license has expired. Please get connected to the network as soon as possible or contact the site administrator for more information."):new Error("Your system date and time appear to have been changed, causing the license to fail. Please correct the system data and time and try again.")},q=null;const Q=new Promise((e=>{q=()=>{Q.isPending=!1,Q.isFulfilled=!0,e();};}));let Z=null,J=async(e,t)=>(N=N.then((async()=>{try{let i=await x.keys();if(t||(Q.isFulfilled?e&&(i=i.filter((t=>t<e))):e&&i.includes(e)?i=[e]:(i=[],U("Unexpected null key"))),!i.length)return;for(let e=0;e<i.length/1e3;++e){let t=i.slice(1e3*e,1e3*(e+1)),s=[];for(let e=0;e<t.length;++e)s.push(await x.getItem(t[e]));if(w=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),!E){let e=await C.getItem(S);e&&([a]=JSON.parse(await z(e))),C.setItem(S,await H(JSON.stringify([a,w])));}try{let e,i,o=O[0]+"verify/v2";w&&!E&&(o+="?ltstime="+encodeURIComponent(w));try{e=c(o,{method:"POST",body:s.join(";"),keepalive:!0});}finally{!Q.isFulfilled&&Fo&&q();}try{i=await e;}finally{Q.isFulfilled||q();}if(!i.ok)throw new Error("verify failed. Status Code: "+i.status);for(let e=0;e<t.length;++e)await x.removeItem(t[e]);}catch(e){throw Q.isFulfilled||q(),W&&(W(e),W=null),e}}V&&V();}catch(e){}})),await N);return {i:async e=>(t=e.pd,i=e.v,s=i.split(".")[0],e.dt&&(n=e.dt),o=e.l||"",l="string"!=typeof e.os?JSON.stringify(e.os):e.os,h=e.fn,"string"==typeof h&&(h=h.substring(0,50)),e.ls&&e.ls.length&&(O=e.ls,1==O.length&&O.push(O[0])),m=p===O&&(!o||"200001"===o||o.startsWith("200001-")),v=e.sp,y=e.rmk,e.lf&&(L=e.lf),e.lsu&&(a=E=e.lsu),e.feab&&(F=e.feab),T=e.updl,k=e.mnet,D=e.mxet,e.sutlcb&&(V=e.sutlcb),await G(),await(async()=>{P=d(String.fromCharCode(o.charCodeAt(0)+10)+d(t)+d(o)+s+d(""+n)),x=await L.createInstance({name:"dynamdlsuns"+d(d("v2"))+d(String.fromCharCode(o.charCodeAt(0)+10)+d(t)+d(o)+s+d(""+n))});try{r=await C.getItem(P);}catch(e){}})(),await $(),await X(),(!b||b.ltsErrorCode>=102&&b.ltsErrorCode<=120)&&J(null,!0),{ar:r,cu:a}),c:async()=>{let e=new Date;if(e.getTime()<M+36e4)return;let t=e.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),i=await k(),s=await D();if(s&&s<t)await $(!0),await X();else if(i&&i<t){let t=new Date(e.getTime());t.setMinutes(e.getMinutes()-6);let i=t.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");w<i&&$().then((()=>X()));}},s:async(e,t,i,s)=>{if(t){try{let e;e=t.startsWith("{")&&t.endsWith("}")?await F(t):t,e?(U("bs "+i),await x.setItem(i,e),U("ss "+i)):U("ept ecpt");}catch(e){}s&&(U("bd "+i),await J(i,2==s),U("sd "+i)),Z&&clearTimeout(Z),Z=setTimeout((async()=>{await J();}),36e4);}else await J(i);},p:Q,u:async()=>(await G(),a),caret:Y}};function Rr(e,t){if(Number.isNaN(t))return {unit:"px",value:0};if(Fe(t))return {unit:"px",value:0};if(G(t))return {unit:"px",value:t};if(t=t.trim().toLowerCase(),Number.isFinite(Number(t))&&"px".search(e)>=0)return {unit:"px",value:Number(t)};const i=[];t=t.replace(e,(e=>(i.push(e),`U${e}`)));const s=`U(${e.source})`;return i.map((e=>({unit:e,value:Number(t.replace(new RegExp(`U${e}`,"g"),"").replace(new RegExp(s,"g"),"*0"))})))[0]}const Or=e=>Rr(/px/g,e),_r=e=>Rr(/px|%|em/g,e),Nr=e=>Rr(/deg|rad|grad|turn/g,e);class Lr{constructor(e,i,s){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t(this,"r",void 0),t(this,"g",void 0),t(this,"b",void 0),t(this,"alpha",void 0),t(this,"isNone",void 0),t(this,"formatted",""),this.r=e,this.g=i,this.b=s,this.alpha=o,this.isNone=r,this.formatted=`rgba(${e}, ${i}, ${s}, ${o})`;}clone(){return new Lr(this.r,this.g,this.b,this.alpha)}}class Br{constructor(e,i){t(this,"type",void 0),t(this,"value",void 0),this.type=e,this.value=i;}clone(){return new Br(this.type,this.value)}}const Ur={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},Wr=e=>{let t;return t="angular"===e.type?Number(e.value):Ur[e.value]||0,{value:t,unit:"deg"}},Vr=e=>{if(e.includes("linear")||e.includes("radial")){return Me(e).map((e=>{let{type:t,orientation:i,colorStops:s}=e;!function(e){var t;const{length:i}=e;var s;e[i-1].length=null!==(t=e[i-1].length)&&void 0!==t?t:{type:"%",value:"100"},i>1&&(e[0].length=null!==(s=e[0].length)&&void 0!==s?s:{type:"%",value:"0"});let o=0,r=Number(e[0].length.value);for(let t=1;t<i;t++){var n;const i=null===(n=e[t].length)||void 0===n?void 0:n.value;if(!Fe(i)&&!Fe(r)){for(let s=1;s<t-o;s++)e[o+s].length={type:"%",value:`${r+(Number(i)-r)*s/(t-o)}`};o=t,r=Number(i);}}}(s);const o=s.map((e=>({offset:{value:e.length.value,unit:"%"},color:Ie(e)})));if("linear-gradient"===t)return new Br(1,{angle:i?Wr(i):{value:0,unit:"deg"},steps:o});if("radial-gradient"===t&&(i||(i=[{type:"shape",value:"circle"}]),"shape"===i[0].type&&"circle"===i[0].value)){const{cx:e,cy:t}=(e=>{let t=50,i=50,s="%",o="%";if("position"===(null==e?void 0:e.type)){const{x:r,y:n}=e.value;"position-keyword"===(null==r?void 0:r.type)&&("left"===r.value?t=0:"center"===r.value?t=50:"right"===r.value?t=100:"top"===r.value?i=0:"bottom"===r.value&&(i=100)),"position-keyword"===(null==n?void 0:n.type)&&("left"===n.value?t=0:"center"===n.value?i=50:"right"===n.value?t=100:"top"===n.value?i=0:"bottom"===n.value&&(i=100)),"px"!==(null==r?void 0:r.type)&&"%"!==(null==r?void 0:r.type)&&"em"!==(null==r?void 0:r.type)||(s=null==r?void 0:r.type,t=Number(r.value)),"px"!==(null==n?void 0:n.type)&&"%"!==(null==n?void 0:n.type)&&"em"!==(null==n?void 0:n.type)||(o=null==n?void 0:n.type,i=Number(n.value));}return {cx:{value:t,unit:s},cy:{value:i,unit:o}}})(i[0].at);let s;if(i[0].style){const{type:e,value:t}=i[0].style;s="extent-keyword"===e?t:{value:t,unit:e};}return new Br(2,{cx:e,cy:t,size:s,steps:o})}}))}};function Fr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(Fe(e))return null;if("currentColor"===e&&(e="black"),"transparent"===e)return new Lr(0,0,0,0);const t=Vr(e);if(t)return t;const i=O(e),s=[0,0,0,0];return null!==i&&(s[0]=parseInt(i.r,10)||0,s[1]=parseInt(i.g,10)||0,s[2]=parseInt(i.b,10)||0,s[3]=parseFloat(i.opacity)),new Lr(...s)}function zr(e){let t=null;L(e)&&(t=e),$(e)&&(t=e.split(" "));for(let e=0;e<3;e++)t[e]?t[e]=Or(t[e]).value:t[e]=0;const i=Fr(t[3]);return t[3]=i?i.formatted:"black",t.slice(0,4)}function Hr(e){const t=[];return $(e)?e.split(" ").forEach((e=>{const i=Or(e);i&&t.push(i.value);})):t.push(...e),1===t.length?[t[0],t[0]]:t}const jr=e=>{let t=e;if($(e)){const i=_r(e);"%"===i.unit&&(t=i.value/100),"px"===i.unit&&(t=i.value);}return t>1&&(t=1),t};function Gr(e,t,i){const{x:s=0,y:o=0,z:r=0}=i.parsedStyle;e!==t&&i.setLocalPosition(s,o);}class $r{constructor(e){t(this,"bubbles",!0),t(this,"cancelBubble",!0),t(this,"cancelable",!1),t(this,"composed",!1),t(this,"currentTarget",void 0),t(this,"defaultPrevented",!1),t(this,"eventPhase",$r.prototype.NONE),t(this,"isTrusted",void 0),t(this,"returnValue",void 0),t(this,"srcElement",void 0),t(this,"target",void 0),t(this,"timeStamp",void 0),t(this,"type",void 0),t(this,"detail",void 0),t(this,"view",void 0),t(this,"which",void 0),t(this,"path",void 0),t(this,"immediatePropagationStopped",!1),t(this,"propagationStopped",!1),t(this,"nativeEvent",void 0),t(this,"originalEvent",void 0),t(this,"eventService",void 0),t(this,"NONE",0),t(this,"CAPTURING_PHASE",1),t(this,"AT_TARGET",2),t(this,"BUBBLING_PHASE",3),this.eventService=e;}initUIEvent(e,t,i,s,o){}composedPath(){const{path:e,eventService:t,target:i}=this;return !t||e&&e[this.path.length-1]===i||(this.path=i?t.getPropagationPath(i):[]),this.path}bindEvents(e,t,i){}preventDefault(){const{nativeEvent:e}=this;e instanceof Event&&e.cancelable&&e.preventDefault(),this.defaultPrevented=!0;}stopImmediatePropagation(){this.immediatePropagationStopped=!0;}stopPropagation(){this.propagationStopped=!0;}}function Xr(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which;}class Yr extends $r{constructor(e,t){super(null),this.type=e,this.detail=t;}}class qr{constructor(){t(this,"pubsub",J.create());}addEventListener(e,t,i){let s,o=z(i)&&i;B(i)&&(o=i.capture,s=i.once),e=o?`${e}:capture`:e,t=H(t)?t:t.handleEvent,this.pubsub.on(e,t,this,s);}dispatchEvent(e){const t=this.ownerDocument||this.document;var i;t&&(e.eventService=(null===(i=t.defaultView)||void 0===i?void 0:i.eventService)||null,e.defaultPrevented=!1,e.path=[],e.target=this,Zr(e));return !e.defaultPrevented}removeEventListener(e,t,i){let s=z(i)&&i;B(i)&&(s=i.capture),e=s?`${e}:capture`:e,t=H(t)?t:t.handleEvent,this.pubsub.off(e,t);}removeAllEventListeners(){this.pubsub.removeAllEventListeners();}getAllEvents(){return this.pubsub.getAllEvents()}}function Qr(e,t){const i=e.currentTarget.getAllEvents()[t]||[];for(let t=0,s=i.length;t<s;t++){if(e.immediatePropagationStopped)return;const{context:s,fn:o}=i[t];o.call(s,e);}}function Zr(e,t){var i;if(t=null!==(i=t)&&void 0!==i?i:e.type,e.propagationStopped=!1,e.immediatePropagationStopped=!1,!e.target)return;const s=e.composedPath(),o=s.length;e.eventPhase=e.CAPTURING_PHASE;for(let i=0;i<o-1;i++){e.currentTarget=s[i];if(Qr(e,`${t}:capture`),Jr(e))return}if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,Qr(e,t),!Jr(e)){e.eventPhase=e.BUBBLING_PHASE;for(let i=o-2;i>=0;i--)if(e.currentTarget=s[i],Qr(e,t),Jr(e))return}}function Jr(e){return e.propagationStopped||e.immediatePropagationStopped}class Kr extends $r{constructor(){super(...arguments),t(this,"altKey",void 0),t(this,"button",void 0),t(this,"buttons",void 0),t(this,"ctrlKey",void 0),t(this,"metaKey",void 0),t(this,"shiftKey",void 0),t(this,"relatedTarget",void 0),t(this,"client",new ne),t(this,"movement",new ne),t(this,"offset",new ne),t(this,"page",new ne),t(this,"screen",new ne),t(this,"global",new ne),t(this,"canvas",new ne);}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.client.x}get y(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.x}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}getModifierState(e){return "getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,s,o,r,n,a,l,h,c,d,u,g,f){throw this.initUIEvent(e,i,i,s,o),new Error("initMouseEvent() DOM API is deprecated.")}}function en(e,t){t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.relatedTarget=null,t.client.setFromPoint(e.client),t.movement.setFromPoint(e.movement),t.offset.setFromPoint(e.offset),t.page.setFromPoint(e.page),t.screen.setFromPoint(e.screen),t.global.setFromPoint(e.global),t.canvas.setFromPoint(e.canvas);}class tn extends Kr{constructor(){super(...arguments),t(this,"deltaMode",void 0),t(this,"deltaX",void 0),t(this,"deltaY",void 0),t(this,"deltaZ",void 0),t(this,"DOM_DELTA_LINE",0),t(this,"DOM_DELTA_PAGE",1),t(this,"DOM_DELTA_PIXEL",2);}}function sn(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;}class on extends Kr{constructor(e){super(e),t(this,"height",0),t(this,"isPrimary",void 0),t(this,"pointerId",void 0),t(this,"pointerType",void 0),t(this,"pressure",void 0),t(this,"tangentialPressure",void 0),t(this,"tiltX",void 0),t(this,"tiltY",void 0),t(this,"twist",void 0),t(this,"width",0),t(this,"getCoalescedEvents",void 0),t(this,"getPredictedEvents",void 0),this.isPrimary=!1,this.height=0,this.width=0;}}function rn(e,t){t.isPrimary=e.isPrimary,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.pointerType=e.pointerType,t.pointerId=e.pointerId,t.pressure=e.pressure,t.twist=e.twist,t.tangentialPressure=e.tangentialPressure;}class nn{constructor(e,i){t(this,"root",void 0),t(this,"cursor","default"),t(this,"events",void 0),t(this,"trackingData",void 0),t(this,"contextService",void 0),this.root=e,this.contextService=i,this.events={},this.trackingData={},this.on("pointerdown",this.onPointerdown.bind(this)),this.on("pointermove",this.onPointermove.bind(this)),this.on("pointerout",this.onPointerout.bind(this)),this.on("pointerleave",this.onPointerout.bind(this)),this.on("pointerover",this.onPointerover.bind(this)),this.on("pointerup",this.onPointerup.bind(this)),this.on("wheel",this.onWheel.bind(this));}clientToCanvas(e){const t=this.contextService.getBoundingClientRect();return new ne(e.x-(t.x||0),e.y-(t.y||0))}canvasToClient(e){const t=this.root.defaultView.contextService.getBoundingClientRect();return new ne(e.x+(t.x||0),e.y+(t.y||0))}getPropagationPath(e){const t=[e];for(;gn.isNode(e)&&e!==this.root;)e=e.parentNode,t.push(e);return t.reverse()}getHitTarget(e,t){const{root:i}=this,{isInteractive:s}=i,o=hn(i,s,new ne(e,t));return o?o[0]:null}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push({fn:t,order:0}),this.events[e].sort(((e,t)=>e.order-t.order));}emit(e){if(!this.root)return;const t=this.events[e.type]||[];for(let i=0;i<t.length;i++)t[i].fn(e);}onPointerdown(e){if(!(e instanceof on))return;const t=this.generatePointerEvent(e);let i;Zr(t,"pointerdown"),"touch"===t.pointerType?i="touchstart":an(t)&&(i=2===t.button?"rightdown":"mousedown"),Zr(t,i);this.getTrackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath();}onPointermove(e){if(!(e instanceof on))return;const t=this.generatePointerEvent(e),i=an(t),s=this.getTrackingData(e.pointerId),o=ln(s.overTargets);if(o&&o!==t.target){const s="mousemove"===e.type?"mouseout":"pointerout",r=this.generatePointerEvent(e,s,o);Zr(r,"pointerout"),i&&Zr(r,"mouseout");const n=t.composedPath();if(!n.includes(o)){const t=this.generatePointerEvent(e,"pointerleave",o);for(t.eventPhase=t.AT_TARGET;t.target&&!n.includes(t.target);)t.currentTarget=t.target,Qr(t,t.type),i&&Qr(t,"mouseleave"),t.target=t.target.parentNode;}}if(o!==t.target){const s="mousemove"===e.type?"mouseover":"pointerover",r=this.clonePointerEvent(t,s);Zr(r,"pointerover"),i&&Zr(r,"mouseover");let n=gn.isNode(o)&&(null==o?void 0:o.parentNode);for(;n&&n!==(gn.isNode(this.root)&&this.root.parentNode)&&n!==t.target;)n=n.parentNode;if(!n||n===this.root.parentNode){const e=this.clonePointerEvent(t,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==o&&e.target!==this.root.parentNode;)e.currentTarget=e.target,Qr(e,e.type),i&&Qr(e,"mouseenter"),e.target=e.target.parentNode;}}var r;(Zr(t,"pointermove"),"touch"===t.pointerType&&Zr(t,"touchmove"),i)&&(Zr(t,"mousemove"),this.cursor=null===(r=t.target)||void 0===r?void 0:r.cursor);s.overTargets=t.composedPath();}onPointerup(e){if(!(e instanceof on))return;const t=performance.now(),i=this.generatePointerEvent(e);Zr(i,"pointerup");const{pointerType:s}=i;let o;"touch"===s?o="touchend":an(i)&&(o=2===i.button?"rightup":"mouseup"),Zr(i,o);const r=this.getTrackingData(e.pointerId),n=ln(r.pressTargetsByButton[e.button]);let a=n;const l=i.composedPath();if(n&&!l.includes(n)){let t=n;for(;t&&!l.includes(t);)i.currentTarget=t,Qr(i,"pointerupoutside"),"touch"===s?o="touchendoutside":an(i)&&(o=2===i.button?"rightupoutside":"mouseupoutside"),Qr(i,o),t=t.parentNode;delete r.pressTargetsByButton[e.button],a=t;}if(a){const n=this.clonePointerEvent(i,"click");n.target=a,n.path=null,r.clicksByButton[e.button]||(r.clicksByButton[e.button]={clickCount:0,target:n.target,timeStamp:t});const l=r.clicksByButton[e.button];l.target===n.target&&t-l.timeStamp<200?l.clickCount+=1:l.clickCount=1,l.target=n.target,l.timeStamp=t,n.detail=l.clickCount,o="mouse"===s?"click":"touch"===s?"tap":"pointertap",Zr(n,o);}}onPointerout(e){if(!(e instanceof on))return;const t=this.getTrackingData(e.pointerId);if(t.overTargets){const i=an(e),s=ln(t.overTargets),o=this.generatePointerEvent(e,"pointerout",s);Zr(o),i&&Zr(o,"mouseout");const r=this.generatePointerEvent(e,"pointerleave",s);for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.root.parentNode;)r.currentTarget=r.target,Qr(r,r.type),i&&Qr(r,"mouseleave"),r.target=r.target.parentNode;t.overTargets=null;}this.cursor=null;}onPointerover(e){if(!(e instanceof on))return;const t=this.getTrackingData(e.pointerId),i=this.generatePointerEvent(e),s=an(e);var o;(Zr(i,"pointerover"),s&&Zr(i,"mouseover"),"mouse"===i.pointerType)&&(this.cursor=null===(o=i.target)||void 0===o?void 0:o.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.root.parentNode;)r.currentTarget=i.target,Qr(r,r.type),s&&Qr(r,"mouseenter"),r.target=r.target.parentNode;t.overTargets=i.composedPath();}onWheel(e){if(!(e instanceof tn))return;Zr(this.generateWheelEvent(e));}generatePointerEvent(e,t,i){const s=new on(this);return rn(e,s),en(e,s),Xr(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=null!=i?i:this.getHitTarget(s.globalX,s.globalY),s.type=null!=t?t:s.type,s}generateWheelEvent(e){const t=new tn(this);return sn(e,t),en(e,t),Xr(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.getHitTarget(t.globalX,t.globalY),t}clonePointerEvent(e,t){const i=new on(this);return rn(e,i),en(e,i),Xr(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=e.target,i.path=e.composedPath().slice(),i}getTrackingData(e){return this.trackingData[e]||(this.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTargets:null}),this.trackingData[e]}}function an(e){const{pointerType:t}=e;return "mouse"===t||"pen"===t}function ln(e){if(!e)return null;let t=e[0]||null;for(let i=1,s=e.length;i<s&&e[i].parentNode===t;i++)t=e[i];return t}function hn(e,t,i){if(!e||"visible"!==e.style.visibility)return null;const{hitArea:s}=e.style;if(s){const{x:t,y:o}=e.transform.worldTransform.transformPoint(i);if(!s.contains(t,o))return null}const{clipPath:o}=e.style;if(o&&!o.containPoint(i))return null;if(e.isChildrenInteractive&&e.children){const{children:s}=e;for(let o=s.length-1;o>=0;o--){const r=s[o],n=hn(r,t||r.isInteractive,i);if(n)return (n.length>0||e.isInteractive)&&n.push(e),n}}return t&&e.containPoint(i)?e.isInteractive?[e]:[]:null}t(class{constructor(){t(this,"canvasConfig",void 0),t(this,"contextService",void 0),t(this,"renderingContext",void 0),t(this,"eventService",void 0),t(this,"rootPointerEvent",new on(null)),t(this,"rootWheelEvent",new tn(null)),t(this,"autoPreventDefault",!0);}init(e){const{renderingService:t,renderingContext:i,contextService:s,canvasConfig:o}=e;this.eventService=new nn(i.root.parentNode,s),e.eventService=this.eventService,this.renderingContext=i,this.contextService=s,this.canvasConfig=o,t.hooks.wheel.on(this.onWheel),t.hooks.pointerdown.on(this.onPointerdown),t.hooks.pointermove.on(this.onPointermove),t.hooks.pointerup.on(this.onPointerup),t.hooks.pointerout.on(this.onPointermove),t.hooks.pointerover.on(this.onPointermove);}destroy(){}onWheel(e){const t=this.normalizeWheelEvent(e);this.eventService.emit(t);}onPointerdown(e){if(this.isTouchEvent(e))return;const t=this.normalizeToPointerEvent(e);if(this.autoPreventDefault&&t.isNormalized){(e.cancelable||!("cancelable"in e))&&e.preventDefault();}const i=this.bootstrapEvent(t,this.rootPointerEvent);this.eventService.emit(i),this.setCursor(this.eventService.cursor);}onPointermove(e){if(this.isTouchEvent(e))return;const t=this.normalizeToPointerEvent(e),i=this.bootstrapEvent(t,this.rootPointerEvent);this.eventService.emit(i),this.setCursor(this.eventService.cursor);}onPointerup(e){if(this.isTouchEvent(e))return;const t=this.contextService.getDomElement(),i=e.target===t?"":"outside",s=this.normalizeToPointerEvent(e),o=this.bootstrapEvent(s,this.rootPointerEvent);o.type+=i,this.eventService.emit(o),this.setCursor(this.eventService.cursor);}setCursor(e){this.contextService.setCursor(e||this.canvasConfig.cursor||"default");}normalizeWheelEvent(e){const t=this.rootWheelEvent;t.nativeEvent=e,this.transferMouseData(e,t),sn(e,t);const i=new ne(e.clientX,e.clientY),{x:s,y:o}=this.eventService.clientToCanvas(i);return t.canvas.x=s,t.canvas.y=o,t.offset.setFromPoint(t.canvas),t.global.setFromPoint(t.canvas),Xr(e,t),t}normalizeToPointerEvent(e){const t=this.renderingContext.root.ownerDocument.defaultView;if(t.supportTouchEvent&&e instanceof TouchEvent){const t=e;t.isNormalized=!0,t.pointerType="touch";}else if(!MouseEvent||e instanceof MouseEvent&&(!t.supportPointerEvent||!(e instanceof PointerEvent))){const t=e;t.isPrimary=!0,t.width=1,t.height=1,t.tiltX=0,t.tiltY=0,t.pointerType="mouse",t.pointerId=1,t.pressure=.5,t.twist=0,t.tangentialPressure=0,t.isNormalized=!0;}return e}bootstrapEvent(e,t){this.renderingContext.root.ownerDocument.defaultView,t.originalEvent=null,t.nativeEvent=e,rn(e,t),this.transferMouseData(e,t);const{x:i,y:s}=this.eventService.clientToCanvas(new ne(e.clientX,e.clientY));return t.canvas.x=i,t.canvas.y=s,t.offset.setFromPoint(t.canvas),t.global.setFromPoint(t.canvas),Xr(e,t),"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&t.type.replace("mouse","pointer"),t}transferMouseData(e,t){t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.relatedTarget=null,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY;}isTouchEvent(e){return this.renderingContext.root.ownerDocument.defaultView.supportTouchEvent&&"touch"===e.pointerType}},"moduleName","Event");class cn extends $r{constructor(e,i,s,o,r,n,a,l){super(null),t(this,"relatedNode",void 0),t(this,"prevValue",void 0),t(this,"newValue",void 0),t(this,"attrName",void 0),t(this,"attrChange",void 0),t(this,"prevParsedValue",void 0),t(this,"newParsedValue",void 0),this.type=e,this.relatedNode=i,this.prevValue=s,this.newValue=o,this.attrName=r,this.attrChange=n,this.prevParsedValue=a,this.newParsedValue=l;}}t(cn,"ADDITION",2),t(cn,"MODIFICATION",1),t(cn,"REMOVAL",3);const dn=new class{querySelector(e,t){return e.startsWith("#")?t.find((t=>t.id===e.substring(1))):null}querySelectorAll(e,t){return []}},un=new class{constructor(e){t(this,"selector",void 0),this.selector=e;}recursiveUpdateHierarchy(e){const{transform:t,childNodes:i}=e;t.frozen||(t.frozen=!0,(t.localDirty||t.worldDirty)&&this.updateHierarchy(e),i.forEach((e=>{this.recursiveUpdateHierarchy(e);})));}querySelector(e,t){return this.selector.querySelector(e,t)}querySelectorAll(e,t){return this.selector.querySelectorAll(e,t)}append(e,t,i){e.parentNode&&this.remove(e),e.parentNode=t;const{childNodes:s,sortable:o}=t;void 0!==i?s.splice(i,0,e):s.push(e),o&&(o.dirty=!0);const{transform:r}=e;r&&this.dirtyWorld(e,r),r.frozen&&this.unfreezeParentToRoot(e);}remove(e){const{parentNode:t}=e;let i=!0;if(!t)return i=!1,i;const{sortable:s}=t;s&&(s.dirty=!0);const{childNodes:o}=t,r=o.indexOf(e);r>-1?(i=!0,o.splice(r,1)):i=!1;const{transform:n}=e;return n&&this.dirtyWorld(e,n),e.parentNode=null,i}isChildExist(e){const{parentNode:t}=e;if(!t)return !1;const{childNodes:i}=t;return !(i.indexOf(e)<0)}setOrigin(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;G(t)&&(t=se.fromValue(t,i));const{transform:s}=e;s.origin.equals(t)||(s.origin.setFromVector(t),this.dirtyLocal(e,s));}getOrigin(e){return e.transform.origin}setPosition(e,t){const{transform:i}=e;t=se.fromValue(t.x,t.y,t.z||0);const s=this.getPosition(e);if(t.equals(s))return;let o=this.getWorldTransform(e);const r=this.getPosition(e),n=t.x-r.x,a=t.y-r.y,l=t.z-r.z;if(i.position=t,e.hasParentTransform()){o=(new pe).translateSelf(n,a,l).multiply(o);const{worldTransform:s}=e.parentNode.transform,r=this.getWorldTransform(e);r.m41=t.x,r.m42=t.y,r.m43=t.z;const h=s.inverse().multiply(o),c=this.getOrigin(e),d=h.getScaling(),u=this.createScaleMatrix(d.x,d.y,d.z),g=pe.fromMatrix(u).inverse(),f=h.translate(c.x,c.y,c.z).multiply(g),p=f.getRotation(),m=pe.fromQuat(p).inverse(),v=f.multiply(m).getTranslation();v.x-=c.x,v.y-=c.y,v.z-=c.z,i.localPosition.setFromVector(v);}else i.localPosition=t;this.dirtyLocal(e,i);}setLocalPosition(e,t){const{transform:i}=e;(t=se.fromValue(t.x,t.y,t.z||0)).equals(i.localPosition)||(i.localPosition=t,this.dirtyLocal(e,i));}getPosition(e){const t=this.getWorldTransform(e),{transform:i}=e,s=t.getTranslation();return i.position.setFromVector(s),e.transform.position}getLocalPosition(e){return e.transform.localPosition}translate(e,t){if(t.equals(new se))return;const i=this.getPosition(e),s=this.getWorldTransform(e),o=s.getScaling(),r=this.createScaleMatrix(o.x,o.y,o.z),n=s.multiply(pe.fromMatrix(r).inverse()).getRotation(),a=pe.fromQuat(n).transformPoint(t);i.add(a),this.setPosition(e,i);}translateLocal(e,t){const{transform:i}=e;if(t.equals(new se))return;t.multiply(i.localScale);const s=pe.fromQuat(i.localRotation).transformPoint(t);i.localPosition.add(s),this.dirtyLocal(e,i);}scaleLocal(e,t){const{transform:i}=e;i.localScale.multiply(t),this.dirtyLocal(e,i);}setLocalScale(e,t){const{transform:i}=e,s=se.fromValue(t.x,t.y,t.z||i.localScale.z);s.equals(i.localScale)||(i.localScale=s,this.dirtyLocal(e,i));}getScale(e){const{transform:t}=e,i=this.getWorldTransform(e).getScaling();return t.scale.setFromVector(i),t.scale}getLocalScale(e){return e.transform.localScale}getRotation(e){const{transform:t}=e,i=this.getWorldTransform(e),s=i.getScaling(),o=this.createScaleMatrix(s.x,s.y,s.z),r=i.multiply(pe.fromMatrix(o).inverse()).getRotation();return t.rotation.setFromQuat(r),t.rotation}getLocalRotation(e){return e.transform.localRotation}rotate(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{transform:o}=e;if(G(t)&&(t=oe(t,i,s)),e.hasParentTransform()){const i=de(t.x,t.y,t.z),s=this.getRotation(e),r=this.getRotation(e.parentNode).clone().invert().multiply(i).multiply(s).normalize();o.localRotation.setFromQuat(r),this.dirtyLocal(e,o);}else this.rotateLocal(e,t);}rotateLocal(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;G(t)&&(t=oe(t,i,s));const{transform:o}=e,r=de(t.x,t.y,t.z);o.localRotation.multiply(r),this.dirtyLocal(e,o);}setAngle(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;G(t)&&(t=oe(t,i,s));const{transform:o}=e;if(e.hasParentTransform()){const i=de(t.x,t.y,t.z);o.localRotation.setFromQuat(i);const s=this.getRotation(e.parentNode);s.invert(),o.localRotation.setFromQuat(s.multiply(o.localRotation)),this.dirtyLocal(e,o);}else this.setLocalAngle(e,t);}setLocalAngle(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;G(t)&&(t=oe(t,i,s));const{transform:o}=e,r=de(t.x,t.y,t.z);o.localRotation.setFromQuat(r),this.dirtyLocal(e,o);}setRotation(e,t){const{transform:i}=e;if(e.hasParentTransform()){let s=this.getRotation(e.parentNode);s=s.clone().invert().multiply(t).normalize(),i.localRotation.setFromQuat(s),this.dirtyLocal(e,i);}else this.setLocalRotation(e,t);}setLocalRotation(e,t){const{transform:i}=e;i.localRotation.setFromQuat(t),this.dirtyLocal(e,i);}getAngle(e){const t=this.getWorldTransform(e);return he.fromQuat(t.decompose().quaternion).toEuler()}getLocalAngle(e){this.getLocalTransform(e);return this.getLocalRotation(e).toEuler()}setLocalTransform(e,t){const i=this.getOrigin(e),{quaternion:s,rotation:o,scale:r}=t.decompose(),n=this.createScaleMatrix(r.x,r.y,r.z),a=pe.fromMatrix(n).inverse(),l=t.translate(i.x,i.y,i.z).multiply(a).getTranslation();l.x-=i.x,l.y-=i.y,l.z-=i.z,this.setLocalPosition(e,l),this.setLocalAngle(e,o.x,o.y,o.z),this.setLocalScale(e,r);}createScaleMatrix(){return {m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1}}resetLocalTransform(e){this.setLocalScale(e,new se(1,1,1)),this.setLocalPosition(e,new se(0,0,0)),this.setLocalAngle(e,0);}getWorldTransform(e){const{transform:t}=e;if(!t.worldDirty&&!t.localDirty)return t.worldTransform;const{parentNode:i}=e;return i&&i.transform&&this.getWorldTransform(i),this.updateHierarchy(e),t.worldTransform}getLocalTransform(e){const{transform:t}=e;return t.localDirty&&t.updateLocalTransform(),t.localTransform}getBounds(e,t){const{renderable:i,childNodes:s}=e;if(t&&!i.renderBoundsDirty&&i)return i.renderBounds;if(!t&&!i.boundsDirty&&i.bounds)return i.bounds;let o=this.getTransformedGeometryBounds(e,t);s.forEach((e=>{const i=this.getBounds(e,t);i&&(o?o.addBounds(i):o=Zn.fromBounds(i));}));const{clipPath:r}=e.style;if(r){const t=this.getTransformedGeometryBounds(r,!0);let i=null;t&&(i=Zn.create(),i.setFromTransformedBounds(this.getWorldTransform(e),t)),o?i&&(o=i.intersection(o)):o=i;}return t?(i.renderBoundsDirty=!1,o&&(i.renderBounds=o)):(i.boundsDirty=!1,o&&(i.bounds=o)),o||Zn.create()}getLocalBounds(e){const{parentNode:t}=e;if(t){let i=new pe;if(t.transform){i=this.getWorldTransform(t).inverse();}const s=this.getBounds(e);if(!Zn.isEmpty(s)){const e=Zn.create();return e.setFromTransformedBounds(i,s),e}}return this.getBounds(e)}getGeometryBounds(e,t){const{geometry:i}=e;return (t?i.renderBounds:i.contentBounds)||Zn.create()}getBoundingClientRect(e){var t;let i;const s=this.getGeometryBounds(e);Zn.isEmpty(s)||(i=Zn.create(),i.setFromTransformedBounds(this.getWorldTransform(e),s));const o=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView.getContextService().getBoundingClientRect();return i?{x:i.minX+((null==o?void 0:o.left)||0),y:i.minY+((null==o?void 0:o.top)||0),width:i.maxX-i.minX,height:i.maxY-i.minY}:{x:(null==o?void 0:o.left)||0,y:(null==o?void 0:o.top)||0,width:0,height:0}}updateHierarchy(e){const{transform:t}=e;if(t.localDirty&&t.updateLocalTransform(),t.worldDirty){var i;let s=null==e||null===(i=e.parentNode)||void 0===i?void 0:i.transform;e.parentNode&&s||(s=new vn),t.updateWorldTransform(s);}}getTransformedGeometryBounds(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.getGeometryBounds(e,t);if(!Zn.isEmpty(i)){const t=Zn.create();return this.getWorldTransform(e),t.setFromTransformedBounds(this.getWorldTransform(e),i),t}return null}dirtyLocal(e,t){t.localDirty||(t.localDirty=!0,t.worldDirty||this.dirtyWorld(e,t));}dirtyWorld(e,t){t.worldDirty||this.unfreezeParentToRoot(e),this.recursiveDirtyWorld(e,t),function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e;for(;i;){const{renderable:e}=i;e&&(e.boundsDirty=!0,e.renderBoundsDirty=!0),i=i.parentNode;}const s=new Yr("bounds-changed",{affectChildren:t});e.dispatchEvent(s);}(e,!0);}recursiveDirtyWorld(e,t){if(t.worldDirty)return;t.worldDirty=!0,t.frozen=!1,e.childNodes.forEach((e=>{const{transform:t}=e;t.worldDirty||this.recursiveDirtyWorld(e,t);}));const{renderable:i}=e;i&&(i.boundsDirty=!0,i.renderBoundsDirty=!0);const s=new cn("DOMAttrModified",e,null,null,"modelMatrix",cn.MODIFICATION,null,null);e.dispatchEvent(s);}unfreezeParentToRoot(e){let t=e;for(;t;){const{transform:e}=t;e&&(e.frozen=!1),t=t.parentNode;}}}(dn);class gn extends qr{constructor(){super(...arguments),t(this,"baseURI",""),t(this,"childNodes",[]),t(this,"nodeName",""),t(this,"nodeType",0),t(this,"nodeValue",null),t(this,"ownerDocument",null),t(this,"parentNode",null),t(this,"isConnected",!1),t(this,"textContent",void 0);}static isNode(e){return !!e.childNodes}get firstChild(){return this.childNodes.length>0?this.childNodes[0]:null}get lastChild(){const{childNodes:e}=this;return e.length>0?e[e.length-1]:null}get nextSibling(){const{parentNode:e}=this;if(e){const t=e.childNodes.indexOf(this);return e.childNodes[t+1]}return null}get parentElement(){return this.parentNode}get previousSibling(){const{parentNode:e}=this;if(e){const t=e.childNodes.indexOf(this);return e.childNodes[t-1]}return null}contains(e){let t=e;for(;t&&this!==t;)t=t.parentNode;return !!t}getRootNode(e){return this.parentNode?this.parentNode.getRootNode(e):this}hasChildNodes(){return this.childNodes.length>0}isEqualNode(e){return this===e}isSameNode(e){return this.isEqualNode(e)}compareDocumentPosition(e){throw new Error("Method to be implemented")}isDefaultNamespace(e){throw new Error("Method to be implemented")}lookupNamespaceURI(e){throw new Error("Method to be implemented")}lookupPrefix(e){throw new Error("Method to be implemented")}normalize(){throw new Error("Method to be implemented")}recursiveCall(e){e(this)||this.childNodes.forEach((t=>{t.recursiveCall(e);}));}hasParentTransform(){return !(!this.parentNode||!this.parentNode.transform)}}t(gn,"ELEMENT_NODE",1),t(gn,"ATTRIBUTE_NODE",2),t(gn,"TEXT_NODE",3),t(gn,"CDATA_SECTION_NODE",4),t(gn,"ENTITY_REFERENCE_NODE",5),t(gn,"ENTITY_NODE",6),t(gn,"PROCESSING_INSTRUCTION_NODE",7),t(gn,"COMMENT_NODE",8),t(gn,"DOCUMENT_NODE",9),t(gn,"DOCUMENT_TYPE_NODE",10),t(gn,"DOCUMENT_FRAGMENT_NODE",11),t(gn,"NOTATION_NODE",12),t(gn,"DOCUMENT_POSITION_DISCONNECTED",1),t(gn,"DOCUMENT_POSITION_PRECEDING",2),t(gn,"DOCUMENT_POSITION_FOLLOWING",4),t(gn,"DOCUMENT_POSITION_CONTAINS",8),t(gn,"DOCUMENT_POSITION_CONTAINED_BY",16),t(gn,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32);class fn{constructor(){t(this,"contentBounds",void 0),t(this,"renderBounds",void 0);}}class pn{constructor(){t(this,"boundsDirty",!0),t(this,"bounds",void 0),t(this,"renderBoundsDirty",!0),t(this,"renderBounds",void 0);}isRenderable(){return this.boundsDirty||this.renderBoundsDirty}toRenderable(){this.boundsDirty=!0,this.renderBoundsDirty=!0;}}class mn{constructor(){t(this,"renderOrder",0),t(this,"lastSortedIndex",void 0),t(this,"sorted",void 0),t(this,"dirty",!1);}}class vn{constructor(){t(this,"frozen",!0),t(this,"worldDirty",!1),t(this,"localDirty",!1),t(this,"localRotation",ce(0,0,0,1)),t(this,"rotation",ce(0,0,0,1)),t(this,"localScale",oe(1,1,1)),t(this,"scale",oe(1,1,1)),t(this,"localPosition",oe(0,0,0)),t(this,"position",oe(0,0,0)),t(this,"localSkew",oe(0,0,0)),t(this,"skew",oe(0,0,0)),t(this,"origin",oe(0,0,0)),t(this,"worldTransform",new pe),t(this,"localTransform",new pe);}updateLocalTransform(){const{origin:e,localScale:t,localPosition:i,localRotation:s,localSkew:o}=this,r=new pe;r.translateSelf(e.x,e.y,e.z);const n=ge(0,0,0,1),a=this.compose(n,i,s,o,t);r.multiplySelf(a),r.translateSelf(-e.x,-e.y,-e.z),this.localTransform.setFromMatrix(r),this.localDirty=!1;}updateWorldTransform(e){const t=e.worldTransform.clone();t.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(t),this.worldDirty=!1;}compose(e,t,i,s,o){const r=new pe;r.m14=e.x,r.m24=e.y,r.m34=e.z,r.m44=e.w,r.translateSelf(t.x,t.y,t.z);const n=pe.fromQuat(i);r.multiplySelf(n);const a=new pe;return s.z&&(a.m32=s.z,r.multiplySelf(a)),s.y&&(a.m32=0,a.m31=s.y,r.multiplySelf(a)),s.x&&(a.m31=0,a.m21=s.x,r.multiplySelf(a)),r.scaleSelf(o.x,o.y,o.z),r}}class yn extends gn{constructor(){super(...arguments),t(this,"attributes",{}),t(this,"id",void 0),t(this,"pageUid",void 0),t(this,"index",void 0),t(this,"name",void 0),t(this,"scrollLeft",void 0),t(this,"scrollTop",void 0),t(this,"scrollWidth",void 0),t(this,"scrollHeight",void 0),t(this,"renderable",new pn),t(this,"sortable",new mn),t(this,"geometry",new fn),t(this,"transform",new vn),t(this,"parsedStyle",{}),t(this,"style",void 0),t(this,"isDestroyed",!1);}set className(e){this.setAttribute("class",e);}get className(){return this.getAttribute("class")||""}get classList(){return this.className.split(" ").filter((e=>""!==e))}get tagName(){return this.nodeName}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}getAttribute(e){const t=this.attributes[e];return null==t?null:t}getElementsByName(e){return un.querySelectorAll(`[name="${e}"]`,this)}getElementsByClassName(e){return un.querySelectorAll(`.${e}`,this)}getElementsByTagName(e){return un.querySelectorAll(e,this)}hasAttribute(e){return Object.keys(this.attributes).indexOf(e)>-1}removeAttribute(e){this.setAttribute(e,null),delete this.attributes[e];}setAttribute(e,t){this.attributes[e]=t;}appendChild(e,t){un.append(e,this,t);const i=new Yr("child-inserted",{child:e});this.dispatchEvent(i);const s=new cn("DOMNodeInserted",this,"","","",0,"","");return e.dispatchEvent(s),e}cloneNode(e){return null}insertBefore(e,t){if(t){const i=this.childNodes.indexOf(t);this.appendChild(e,i-1);}else this.appendChild(e);return e}removeChild(e){const t=new cn("removed",this,"","","",0,"","");e.dispatchEvent(t);const i=new Yr("child-removed",{child:e});return this.dispatchEvent(i),un.remove(e),e}isChildExist(e){return un.isChildExist(e)}replaceChild(e,t){const i=this.childNodes.indexOf(t);return this.removeChild(t),this.appendChild(e,i),t}destroy(){const e=new Yr("destroy",{});this.dispatchEvent(e),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0;}after(){const{parentNode:e}=this;if(e){const o=e.childNodes.indexOf(this);for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];i.forEach(((t,i)=>{null==e||e.appendChild(t,o+i+1);}));}}before(){const{parentNode:e}=this;if(e){const o=e.childNodes.indexOf(this);for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];i.forEach(((t,i)=>{null==e||e.appendChild(t,o+i);}));}}remove(){this.parentNode&&this.parentNode.removeChild(this);}replaceWith(){this.after(...arguments),this.remove();}append(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{this.appendChild(e);}));}prepend(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(((e,t)=>{this.appendChild(e,t);}));}querySelector(e){return un.querySelector(e,this)}querySelectorAll(e){return un.querySelectorAll(e,this)}find(e){let t=null;return this.recursiveCall((i=>!(i!==this||!e(i))&&(t=i,!0))),t}findAll(e){const t=[];return this.recursiveCall((i=>{i===this&&e(i)&&t.push(i);})),t}getGeometryBounds(){return un.getGeometryBounds(this)}getRenderBounds(){return un.getBounds(this,!0)}getBounds(){return un.getBounds(this)}getLocalBounds(){return un.getLocalBounds(this)}getBoundingClientRect(){return un.getBoundingClientRect(this)}}class wn{constructor(e){t(this,"lineAlign",void 0),t(this,"owner",void 0),this.owner=e,this.reset();}reset(){this.lineAlign=.5;}get x(){return this.owner.getAttribute("x")}set x(e){this.owner.setAttribute("x",e);}get y(){return this.owner.getAttribute("y")}set y(e){this.owner.setAttribute("y",e);}get r(){return this.owner.getAttribute("r")}set r(e){this.owner.setAttribute("r",e);}get width(){return this.owner.getAttribute("width")}set width(e){this.owner.setAttribute("width",e);}get height(){return this.owner.getAttribute("height")}set height(e){this.owner.setAttribute("height",e);}get points(){return this.owner.getAttribute("points")}set points(e){this.owner.setAttribute("points",e);}set selectable(e){this.owner.setAttribute("selectable",e);}get selectable(){return this.owner.getAttribute("selectable")}get origin(){return this.owner.getAttribute("origin")}set origin(e){this.owner.setAttribute("origin",e);}get anchor(){return this.owner.getAttribute("anchor")}set anchor(e){this.owner.setAttribute("anchor",e);}get visibility(){return this.owner.getAttribute("visibility")}set visibility(e){this.owner.setAttribute("visibility",e);}get zIndex(){return this.owner.getAttribute("zIndex")}set zIndex(e){this.owner.setAttribute("zIndex",e);}get transformOrigin(){return this.owner.getAttribute("transformOrigin")}set transformOrigin(e){this.owner.setAttribute("transformOrigin",e);}get borderWidth(){return this.owner.getAttribute("borderWidth")}set borderWidth(e){this.owner.setAttribute("borderWidth",e);}get borderColor(){return this.owner.getAttribute("borderColor")}set borderColor(e){this.owner.setAttribute("borderColor",e);}get opacity(){return this.owner.getAttribute("opacity")}set opacity(e){this.owner.setAttribute("opacity",e);}get fillOpacity(){return this.owner.getAttribute("fillOpacity")}set fillOpacity(e){this.owner.setAttribute("fillOpacity",e);}get borderOpacity(){return this.owner.getAttribute("borderOpacity")}set borderOpacity(e){this.owner.setAttribute("borderOpacity",e);}get background(){return this.owner.getAttribute("background")}set background(e){this.owner.setAttribute("background",e);}get clipPath(){return this.owner.getAttribute("clipPath")}set clipPath(e){this.owner.setAttribute("clipPath",e);}get cursor(){return this.owner.getAttribute("cursor")}set cursor(e){this.owner.setAttribute("cursor",e);}get hitArea(){return this.owner.getAttribute("hitArea")}set hitArea(e){this.owner.setAttribute("hitArea",e);}get pointerEvents(){return this.owner.getAttribute("pointerEvents")}set pointerEvents(e){this.owner.setAttribute("pointerEvents",e);}get miterLimit(){return this.owner.getAttribute("miterLimit")}set miterLimit(e){this.owner.setAttribute("miterLimit",e);}get lineCap(){return this.owner.getAttribute("lineCap")}set lineCap(e){this.owner.setAttribute("lineCap",e);}get lineJoin(){return this.owner.getAttribute("lineJoin")}set lineJoin(e){this.owner.setAttribute("lineJoin",e);}get lineDash(){return this.owner.getAttribute("lineDash")}set lineDash(e){this.owner.setAttribute("lineDash",e);}get lineDashOffset(){return this.owner.getAttribute("lineDashOffset")}set lineDashOffset(e){this.owner.setAttribute("lineDashOffset",e);}get shadow(){return this.owner.getAttribute("shadow")}set shadow(e){this.owner.setAttribute("shadow",e);}get shadowOffsetX(){return this.owner.getAttribute("shadowOffsetX")}set shadowOffsetX(e){this.owner.setAttribute("shadowOffsetX",e);}get shadowOffsetY(){return this.owner.getAttribute("shadowOffsetY")}set shadowOffsetY(e){this.owner.setAttribute("shadowOffsetY",e);}get shadowBlur(){return this.owner.getAttribute("shadowBlur")}set shadowBlur(e){this.owner.setAttribute("shadowBlur",e);}get shadowColor(){return this.owner.getAttribute("shadowColor")}set shadowColor(e){this.owner.setAttribute("shadowColor",e);}get startAngle(){return this.owner.getAttribute("startAngle")}set startAngle(e){this.owner.setAttribute("startAngle",e);}get endAngle(){return this.owner.getAttribute("endAngle")}set endAngle(e){this.owner.setAttribute("endAngle",e);}get rx(){return this.owner.getAttribute("rx")}set rx(e){this.owner.setAttribute("rx",e);}get ry(){return this.owner.getAttribute("ry")}set ry(e){this.owner.setAttribute("ry",e);}get img(){return this.owner.getAttribute("img")}set img(e){this.owner.setAttribute("img",e);}get src(){return this.owner.getAttribute("src")}set src(e){this.owner.setAttribute("src",e);}get x1(){return this.owner.getAttribute("x1")}set x1(e){this.owner.setAttribute("x1",e);}get y1(){return this.owner.getAttribute("y1")}set y1(e){this.owner.setAttribute("y1",e);}get x2(){return this.owner.getAttribute("x2")}set x2(e){this.owner.setAttribute("x2",e);}get y2(){return this.owner.getAttribute("y2")}set y2(e){this.owner.setAttribute("y2",e);}get text(){return this.owner.getAttribute("text")}set text(e){this.owner.setAttribute("text",e);}get wordWarp(){return this.owner.getAttribute("wordWarp")}set wordWarp(e){this.owner.setAttribute("wordWarp",e);}get wordBreak(){return this.owner.getAttribute("wordBreak")}set wordBreak(e){this.owner.setAttribute("wordBreak",e);}get underline(){return this.owner.getAttribute("underline")}set underline(e){this.owner.setAttribute("underline",e);}get strikeout(){return this.owner.getAttribute("strikeout")}set strikeout(e){this.owner.setAttribute("strikeout",e);}get textMaxWidth(){return this.owner.getAttribute("textMaxWidth")}set textMaxWidth(e){this.owner.setAttribute("textMaxWidth",e);}get letterSpacing(){return this.owner.getAttribute("letterSpacing")}set letterSpacing(e){this.owner.setAttribute("letterSpacing",e);}get textAlign(){return this.owner.getAttribute("textAlign")}set textAlign(e){this.owner.setAttribute("textAlign",e);}get textBaseLine(){return this.owner.getAttribute("textBaseLine")}set textBaseLine(e){this.owner.setAttribute("textBaseLine",e);}get textTransform(){return this.owner.getAttribute("textTransform")}set textTransform(e){this.owner.setAttribute("textTransform",e);}get color(){return this.owner.getAttribute("color")}set color(e){this.owner.setAttribute("color",e);}get fontStyle(){return this.owner.getAttribute("fontStyle")}set fontStyle(e){this.owner.setAttribute("fontStyle",e);}get fontVariant(){return this.owner.getAttribute("fontVariant")}set fontVariant(e){this.owner.setAttribute("fontVariant",e);}get fontWeight(){return this.owner.getAttribute("fontWeight")}set fontWeight(e){this.owner.setAttribute("fontWeight",e);}get fontSize(){return this.owner.getAttribute("fontSize")}set fontSize(e){this.owner.setAttribute("fontSize",e);}get lineHeight(){return this.owner.getAttribute("lineHeight")}set lineHeight(e){this.owner.setAttribute("lineHeight",e);}get fontFamily(){return this.owner.getAttribute("fontFamily")}set fontFamily(e){this.owner.setAttribute("fontFamily",e);}get startPoint(){return this.owner.getAttribute("startPoint")}set startPoint(e){this.owner.setAttribute("startPoint",e);}get endPoint(){return this.owner.getAttribute("endPoint")}set endPoint(e){this.owner.setAttribute("endPoint",e);}get lineEnding(){return this.owner.getAttribute("lineEnding")}set lineEnding(e){this.owner.setAttribute("lineEnding",e);}get stampPoints(){return this.owner.getAttribute("stampPoints")}set stampPoints(e){this.owner.setAttribute("stampPoints",e);}}const bn={},xn={};class Cn extends yn{constructor(e){super(),t(this,"shapeType",void 0),t(this,"config",void 0),t(this,"path",void 0),t(this,"steps",void 0),t(this,"strokePath",void 0),t(this,"strokeSteps",void 0),t(this,"externalMatrices",[]),t(this,"clippable",!1),t(this,"imageData",null),this.config=e,this.id=e.id||e.uid||"",this.name=e.name||"",this.index=e.index,this.nodeName=e.type||"container",this.pageUid=e.pageUid||"",(e.className||e.class)&&(this.className=e.className||e.class),this.style=new wn(this),this.initAttributes(e);}get isVisible(){return "visible"===this.parsedStyle.visibility}get isInteractive(){return "none"!==this.parsedStyle.pointerEvents}get width(){return this.parsedStyle.width.value*Math.abs(this.getScale().x)}get height(){return this.parsedStyle.height.value*Math.abs(this.getScale().y)}initAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const t in e)if(ze(t,e)){if("style"===t)continue;this.attributes[t]=e[t];}for(const t in e.style)ze(t,e.style)&&(this.parseStyleProperty(t,e.style[t]),this.attributes[t]=e.style[t]);this.renderable.toRenderable();}setAttribute(e,t){if(!W(t)&&t!==this.attributes[e]){const i=this.attributes[e];super.setAttribute(e,t),this.config.hasOwnProperty(e)||(this.parseStyleProperty(e,t),this.updateStyleProperty(e,i,t));}}parseStyleProperty(e,t){const i=bn[e];this.parsedStyle[e]=i?i(t,this,e):t;}updateStyleProperty(e,t,i){const s=xn[e];s&&s.forEach((s=>{s(t,i,this,e);}));}toFront(){const{parentNode:e}=this;if(e){const t=Math.max(...e.children.map((e=>e.style.zIndex)));this.style.zIndex=t+1;}return this}toBack(){const{parentNode:e}=this;if(e){const t=Math.min(...e.children.map((e=>e.style.zIndex)));this.style.zIndex=t-1;}return this}setOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return un.setOrigin(this,e,t),this}getOrigin(){return un.getOrigin(this)}setPosition(e){return un.setPosition(this,e),this}setLocalPosition(e){const t=oe(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return un.setLocalPosition(this,t),this}getPosition(){return un.getPosition(this)}getLocalPosition(){return un.getLocalPosition(this)}translate(e){const t=oe(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return un.translate(this,t),this}translateLocal(e){const t=oe(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return un.translateLocal(this,t),this}scale(e,t,i){return this.scaleLocal(e,t,i)}scaleLocal(e,t,i){return G(e)&&(e=oe(e,t=t||e,i=i||e)),un.scaleLocal(this,e),this}setLocalScale(e,t,i){return G(e)&&(e=oe(e,t=t||e,i=i||e)),un.setLocalScale(this,e),this}getScale(){return un.getScale(this)}getLocalScale(){return un.getLocalScale(this)}rotate(e,t,i){return W(t)&&W(i)?un.rotate(this,0,0,e):un.rotate(this,e,t,i),this}rotateLocal(e,t,i){return W(t)&&W(i)?un.rotateLocal(this,0,0,e):un.rotateLocal(this,e,t,i),this}setAngle(e){return un.setAngle(this,0,0,e),this}setLocalAngle(e){return un.setLocalAngle(this,0,0,e),this}getAngle(){return un.getAngle(this).z}getLocalAngle(){return un.getLocalAngle(this).z}getLocalTransform(){return un.getLocalTransform(this)}getWorldTransform(){return un.getWorldTransform(this)}setLocalTransform(e){return un.setLocalTransform(this,e),this}resetLocalTransform(){un.resetLocalTransform(this);}getPath(){}getConfig(){}getBoundingRect(){}getBoundingRectObject(){}updateStyle(e){}isPointInPath(e){}}function Sn(e,t){return {type:e,data:t}}function Pn(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[];let[s]=e;i.push(Sn("moveTo",[s]));for(let t=1;t<e.length;t++)s=e[t],i.push(Sn("lineTo",[s]));return t&&e.length>2&&([s]=e,i.push(Sn("lineTo",[s]))),i}function Tn(e,t){const{data:i,type:s}=t,[o,r,n]=i;switch(s){case"moveTo":e.moveTo(o.x,o.y);break;case"lineTo":e.lineTo(o.x,o.y);break;case"bezierCurveTo":e.bezierCurveTo(o.x,o.y,r.x,r.y,n.x,n.y);break;case"quadraticCurveTo":e.quadraticCurveTo(o.x,o.y,r.x,r.y);}}function kn(e){const{min:t,max:i}=Math,{x:s,y:o}=e[0];let r=s,n=o,a=s,l=o;for(let s=1;s<e.length;s++){const o=e[s];r=t(r,o.x),a=i(a,o.x),n=t(n,o.y),l=i(l,o.y);}return {left:r,top:n,right:a,bottom:l,width:a-r,height:l-n}}const Dn={opacity:1,fillOpacity:1,borderOpacity:1,lineJoin:"miter",lineCap:"butt",zIndex:0,visibility:"visible",anchor:[0,0],borderColor:"black",miterLimit:10,lineDash:[0,0],lineDashOffset:0};function En(e){if(e.length<1)return [];const t=[];let i=[];for(let s=0;s<e.length;s++){const o=e[s];if(0===o.step)s>0&&t.push({step:i,close:e[s-1].close}),i=[],i.push(Sn("moveTo",[{x:o.x,y:o.y}]));else if(1===o.step)i.push(Sn("lineTo",[{x:o.x,y:o.y}]));else if(2===o.step&&s+2<e.length&&2===e[s+1].step&&2===e[s+2].step){const t=e[s+1],r=e[s+2];i.push(Sn("bezierCurveTo",[o,t,r])),s+=2;}}return t.push({step:i,close:e[e.length-1].close}),t}function An(e,t,i,s){let o=0,r=0,n=0,a=0;const l=[e,t],h=kn(l),c=function(e,t,i,s){let o=s/2,r=s/2;const n=t.y-e.y,a=t.x-e.x;if(0===n||0===a)return [a,n];const l=-1/((t.y-e.y)/(t.x-e.x)),h=Math.atan(l);return "square"===i?(o=Math.sqrt(2)*s/2,r=Math.sqrt(2)*s/2):"round"===i?(o=s/2,r=s/2):(o=Math.abs(Math.cos(h)*s)/2,r=Math.abs(Math.sin(h)*s)/2),[o,r]}(l[0],l[1],s,i||0);return 0===c[1]?(o=h.left,r=h.top-i/2,n=h.width,a=h.height+i,"square"!==s&&"round"!==s||(o-=i/2,n+=i)):0===c[0]?(o=h.left-i/2,r=h.top,n=h.width+i,a=h.height,"square"!==s&&"round"!==s||(r-=i/2,a+=i)):(o=h.left-c[0],r=h.top-c[1],n=h.width+2*c[0],a=h.height+2*c[1]),{x:o,y:r,width:n,height:a}}function In(e){return Math.abs(e)<1e-6?0:e<0?-1:1}function Mn(e,t,i,s){const{x:o,y:r}=e,{x:n,y:a}=t,{x:l,y:h}=s,c=Math.min(o,n),d=Math.max(o,n),u=Math.min(r,a),g=Math.max(r,a),f=i/2;return l>=c-f&&l<=d+f&&h>=u-f&&h<=g+f&&function(e,t,i,s,o,r){const n=[i-e,s-t];if(new se(n[0],n[1]).equals({x:0,y:0}))return Math.sqrt((o-e)*(o-e)+(r-t)*(r-t));const a=[-n[1],n[0]],l=new se(a[0],a[1]);l.normalize();const h=[o-e,r-t],c=new se(h[0],h[1]);return Math.abs(c.dot(l))}(o,r,n,a,l,h)<=i/2}function Rn(e,t,i,s,o){const r=e.length;if(r<2)return !1;for(let o=0;o<r-1;o++)if(Mn(e[o],e[o+1],t,{x:i,y:s}))return !0;if(o){if(Mn(e[0],e[r-1],t,{x:i,y:s}))return !0}return !1}function On(e,t,i,s,o,r){return o>=e&&o<=e+i&&r>=t&&r<=t+s}function _n(e,t,i,s,o,r){const n=r;let a=s.x,l=s.y,h=o.x,c=o.y;0===t&&(a=o.x,l=o.y,h=s.x,c=s.y);let d=Math.PI/2;const u=h-a>=0?1:-1,g=c-l>=0?1:-1;a!==h&&(d=Math.atan(Math.abs(c-l)/Math.abs(h-a)));const f=Math.cos(d),p=Math.sin(d),m=i?1:-1,v={x:h+9*m*n*f*u-4.5*n*p*u,y:c+9*m*n*p*g+4.5*n*f*g,step:0,close:!1},y={x:h+m*n*f*u,y:c+m*n*p*g,step:1,close:!1},w={x:h+9*m*n*f*u+4.5*n*p*u,y:c+9*m*n*p*g-4.5*n*f*g,step:1,close:!1};e.push(v,y,w);}function Nn(e,t,i,s,o,r){const n=r;let a=s.x,l=s.y,h=o.x,c=o.y;0===t&&(a=o.x,l=o.y,h=s.x,c=s.y);let d=Math.PI/2;const u=h-a>=0?1:-1,g=c-l>=0?1:-1;a!==h&&(d=Math.atan(Math.abs(c-l)/Math.abs(h-a)));const f=Math.cos(d),p=Math.sin(d),m=i?1:-1,v={x:h+9*m*n*f*u-4.5*n*p*u,y:c+9*m*n*p*g+4.5*n*f*g,step:0,close:!1},y={x:h+m*n*f*u,y:c+m*n*p*g,step:1,close:!1},w={x:h+9*m*n*f*u+4.5*n*p*u,y:c+9*m*n*p*g-4.5*n*f*g,step:1,close:!0};e.push(v,y,w);}function Ln(e,t,i,s,o){const r=o;let n=i.x,a=i.y,l=s.x,h=s.y;0===t&&(n=s.x,a=s.y,l=i.x,h=i.y);let c=Math.PI/2;const d=l-n>=0?1:-1,u=h-a>=0?1:-1;n!==l&&(c=Math.atan(Math.abs(h-a)/Math.abs(l-n)));const g=Math.cos(c),f=Math.sin(c),p={x:l-3*r*f*d,y:h+3*r*g*u,step:0,close:!1},m={x:l+3*r*f*d,y:h-3*r*g*u,step:1,close:!1};e.push(p,m);}function Bn(e,t,i,s,o){const r=o;let n=i.x,a=i.y,l=s.x,h=s.y;0===t&&(n=s.x,a=s.y,l=i.x,h=i.y);let c=Math.PI/2;const d=l-n>=0?1:-1,u=h-a>=0?1:-1,g=h>=a&&l>=n||h<=a&&l<=n?-1:1;n!==l&&(c=Math.atan(Math.abs(h-a)/Math.abs(l-n)));const f=Math.cos(c),p=Math.sin(c),m=4.5*Math.sqrt(3)*r,v={x:l+4.5*r*f*d-m*p*d*g,y:h+4.5*r*p*u+m*f*u*g,step:0,close:!1},y={x:l-4.5*r*f*d+m*p*d*g,y:h-4.5*r*p*u-m*f*u*g,step:1,close:!1};e.push(v,y);}function Un(e,t,i,s,o){const r=o;let{x:n,y:a}=s;0===t&&(n=i.x,a=i.y);const l={x:n-3*r,y:a,step:0,close:!1},h={x:n,y:a-3*r,step:1,close:!1},c={x:n+3*r,y:a,step:1,close:!1},d={x:n,y:a+3*r,step:1,close:!0};e.push(l,h,c,d);}function Wn(e,t,i,s,o){const r=o;let{x:n,y:a}=s;0===t&&(n=i.x,a=i.y);const l=3*r-0*r,h=function(e,t,i,s){const o=e-i,r=e+i,n=t-s,a=t+s,l=.551915024494,h=l*i,c=l*s,d=[];return d.push({x:r,y:t}),d.push({x:r,y:t+c},{x:e+h,y:a},{x:e,y:a}),d.push({x:e-h,y:a},{x:o,y:t+c},{x:o,y:t}),d.push({x:o,y:t-c},{x:e-h,y:n},{x:e,y:n}),d.push({x:e+h,y:n},{x:r,y:t-c},{x:r,y:t}),d}(n,a,l,l);h.forEach(((t,i)=>{const s=0===i?0:2,o=i===h.length-1,r={x:t.x,y:t.y,step:s,close:o};e.push(r);}));}class Vn extends Cn{constructor(){let{style:e,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"rect",style:{...Dn,x:0,y:0,width:0,height:0,...e},...i}),t(this,"shapeType","rect");const{x:s,y:o}=this.parsedStyle;this.setLocalPosition(s,o),this.updateOrigin();}updateStyle(e){Object.keys(e).forEach((t=>{ze(t,e)&&(this.style[t]=e[t]);}));}updateOrigin(){const{width:e,height:t}=this.parsedStyle;this.setOrigin(e.value/2,t.value/2);}updatePosition(e,t){this.style.x=e,this.style.y=t;}getPath(){const{width:e,height:t,borderWidth:i}=this.parsedStyle,s=(null==i?void 0:i.value)||0,o=s,r=s,n=e.value-2*s,a=t.value-2*s;return this.path=[{x:o,y:r},{x:o+n,y:r},{x:o+n,y:r+a},{x:o,y:r+a}],this.steps=Pn(this.path),this.path}getStrokePath(){const{width:e,height:t,borderWidth:i}=this.parsedStyle,s=.5*((null==i?void 0:i.value)||0),o=s,r=s,n=e.value-2*s,a=t.value-2*s;return this.strokePath=[{x:o,y:r},{x:o+n,y:r},{x:o+n,y:r+a},{x:o,y:r+a}],this.strokeSteps=Pn(this.strokePath),this.strokePath}getBoundingRect(){const{x:e,y:t,width:i,height:s,borderWidth:o}=this.parsedStyle;return {x:e,y:t,width:i.value,height:s.value}}getBoundingRectObject(){const{x:e,y:t,width:i,height:s}=this.getBoundingRect();return new Vn({style:{x:e,y:t,width:i,height:s,borderWidth:1,background:"rgba(0,0,0,0)"}})}isPointInPath(e){const{x:t,y:i,background:s,borderWidth:o,width:r,height:n}=this.parsedStyle,a=o&&o.value,l=((null==o?void 0:o.value)||0)/2;return s&&a?On(t-l,i-l,r.value+l,n.value+l,e.x,e.y):s?On(t,i,r.value,n.value,e.x,e.y):!!a&&function(e,t,i,s,o,r,n){const a=o/2;return On(e-a,t-a,i,o,r,n)||On(e+i-a,t-a,o,s,r,n)||On(e+a,t+s-a,i,o,r,n)||On(e-a,t+a,o,s,r,n)}(t-l,i-l,r.value,n.value,o.value,e.x,e.y)}}function Fn(e,t,i,s,o){const r=o||[],n=e[t],a=e[i-1];let l=0,h=1;for(let s=t+1;s<i-1;s++){const t=Pe(Se(n,a,e[s]),e[s]);t>l&&(l=t,h=s);}return l>=s?(Fn(e,t,h,s,r),Fn(e,h,i,s,r)):(r.length||r.push(n),r.push(a)),r}let zn=class extends Cn{constructor(){let{style:e,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"image",style:{...Dn,x:0,y:0,width:0,height:0,img:"",...e},...i}),t(this,"shapeType","image"),t(this,"meteData",void 0),this.meteData=(null==i?void 0:i.meteData)||null;const{x:s,y:o}=this.parsedStyle;this.setLocalPosition(s,o),this.updateOrigin();}updateStyle(e){Object.keys(e).forEach((t=>{ze(t,e)&&(this.style[t]=e[t]);}));}updateOrigin(){const{width:e,height:t}=this.parsedStyle;this.setOrigin(e.value/2,t.value/2);}updatePosition(e,t){this.style.x=e,this.style.y=t;}getBoundingRect(){const{x:e,y:t,width:i,height:s}=this.parsedStyle;return {x:e,y:t,width:i.value,height:s.value}}getBoundingRectObject(){const{x:e,y:t,width:i,height:s}=this.getBoundingRect();return new Vn({style:{x:e,y:t,width:i,height:s,borderWidth:1,background:"rgba(0,0,0,0)"}})}isPointInPath(e){return this.getBoundingRectObject().isPointInPath(e)}};class Hn extends Cn{constructor(){let{style:e,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"line",style:{...Dn,x1:0,y1:0,x2:0,y2:0,borderWidth:2,...e},...i}),t(this,"shapeType","line"),t(this,"renderPath",void 0);const{x:s,y:o}=this.getBoundingRect();this.updatePosition(s,o),this.updateOrigin();}updateOrigin(){const{width:e,height:t}=this.getBoundingRect();this.setOrigin(e/2,t/2);}updatePoints(){const{renderPath:e}=this,t=this.getLocalPosition(),i=[];e.forEach((e=>{i.push({x:e.x+t.x,y:e.y+t.y});})),this.updateStyle({x1:i[0].x||0,y1:i[0].y||0,x2:i[1].x||0,y2:i[1].y||0});}updateStyle(e){Object.keys(e).forEach((t=>{ze(t,e)&&(this.style[t]=e[t]);}));}updatePosition(e,t){this.style.x=e,this.style.y=t;}getPath(){const{renderable:e}=this,{x1:t,x2:i,y1:s,y2:o}=this.parsedStyle,{x:r,y:n}=this.getBoundingRect();return this.path&&!e.isRenderable()||(this.renderPath=[{x:t-r,y:s-n},{x:i-r,y:o-n}],this.path=[{x:t,y:s},{x:i,y:o}],this.steps=Pn(this.renderPath,!1),e.toRenderable()),this.path}getBoundingRect(){const{x1:e,x2:t,y1:i,y2:s,borderWidth:o,lineCap:r}=this.parsedStyle;return An({x:e,y:i},{x:t,y:s},o.value,r)}getBoundingRectObject(){const{x:e,y:t,width:i,height:s}=this.getBoundingRect();return new Vn({style:{x:e,y:t,width:i,height:s,borderWidth:1,background:"rgba(0,0,0,0)"}})}isPointInPath(e){if(!this.getBoundingRectObject().isPointInPath(e))return !1;const{x1:t,x2:i,y1:s,y2:o,borderWidth:r}=this.parsedStyle;return Mn({x:t,y:s},{x:i,y:o},r.value<20?10:r.value/2,e)}}class jn extends Cn{constructor(){let{style:e,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"path",style:{...Dn,points:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4,...e},...i}),t(this,"shapeType","path"),t(this,"renderPath",void 0),t(this,"pointArray",[]),t(this,"pointLength",0),t(this,"initialRect",void 0),this.getPath(),this.initialRect=this.getBoundingRect(),this.updatePosition(this.initialRect.x,this.initialRect.y),this.setOrigin(this.initialRect.width,this.initialRect.height);}addPoint(e){const t=[...this.style.points];t.push(e),this.style.points=t;}updateStyle(e){Object.keys(e).forEach((t=>{ze(t,e)&&(this.style[t]=e[t]);}));}updateOrigin(){const{width:e,height:t}=this.getBoundingRect();this.setOrigin(e/2,t/2);}updatePosition(e,t){this.style.x=e,this.style.y=t;}getPath(){let e=this.parsedStyle.points.map((e=>new ne(e.x,e.y)));return e=this.pointArray.concat(Fn(e,this.pointLength,e.length,2)),this.parsedStyle.points.length-this.pointLength==30&&(this.pointArray=U(e),this.pointLength=this.parsedStyle.points.length),e.length<=3&&e.push(e[e.length-1].clone()),e=function(e){const t=e.length;if(t<3)return e;const i=[];if(3===t)i.push(e[0].clone(),e[1].clone(),e[2].clone(),e[2].clone());else {const t=e.slice();i.push(t[0]);for(let e=0;e+2<t.length;e++){const s=t[e+1],o=t[e+2],r=s,n=new ne(((null==s?void 0:s.x)+(null==o?void 0:o.x))/2,((null==s?void 0:s.y)+(null==o?void 0:o.y))/2);i.push(r),e+3===t.length?i.push(o):i.push(n);}}return i}(e),this.path=e,this.renderPath=this.getRenderPath(this.path),this.steps=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.length;if(i<=1)return [];const s=[],[o]=e;s.push(Sn("moveTo",[o]));for(let t=0;t+2<i;t+=2){const i=e[t+1],o=e[t+2];s.push(Sn("quadraticCurveTo",[i,o]));}return t&&e.length>2&&s.push(Sn("lineTo",[o])),s}(this.renderPath),this.path}getRenderPath(e){const{x:t,y:i}=this.getBoundingRect(),s=[];return e.forEach((e=>{!e||Number.isNaN(e.x)||Number.isNaN(e.y)||s.push({x:e.x-t,y:e.y-i});})),s}getBoundingRect(){const{borderWidth:e,points:t,lineCap:i}=this.parsedStyle,s=t.map((e=>new ne(e.x,e.y))),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.length;if(i<3)return e;const s=[];if(3===i)s.push(e[0].clone(),e[1].clone(),e[2].clone(),e[2].clone());else {const i=e.slice();i.unshift(e[0]),i.push(e[e.length-1]);const o=[],r=1-t;s.push(U(i[0]));for(let e=1;e+2<i.length;e++){const t=i[e],n=i[e-1],a=i[e+1],l=i[e+2];o[0]=U(t),o[1]=new ne(t.x+r*(a.x-n.x)/8,t.y+r*(a.y-n.y)/8),o[2]=new ne(a.x-r*(l.x-t.x)/8,a.y-r*(l.y-t.y)/8),o[3]=U(a),s.push(o[1],o[2],o[3]);}}return s}(Fn(s,0,s.length,1)),r=kn(o);if(2===t.length)return An(t[0],t[1],e.value,i);const n=e.value/2;return {x:r.left-n,y:r.top-n,width:r.width+2*n,height:r.height+2*n}}getBoundingRectObject(){const{x:e,y:t,width:i,height:s}=this.getBoundingRect();return new Vn({style:{x:e,y:t,width:i,height:s,borderWidth:1,background:"rgba(0,0,0,0)"}})}isPointInPath(e){if(!this.getBoundingRectObject().isPointInPath(e))return !1;const{borderWidth:t}=this.parsedStyle,i=t.value<20?10:t.value/2;return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;for(let s=0;s<t.length;s++)if(Pe(e,t[s])<=i)return !0;return !1}(e,this.style.points,i)}}class Gn extends Cn{constructor(){let{style:e,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"polygon",style:{...Dn,points:[{x:0,y:0},{x:10,y:10}],miterLimit:4,borderWidth:2,...e},...i}),t(this,"shapeType","polygon"),t(this,"renderPath",void 0),0===this.parsedStyle.points.length&&(this.style.points=[{x:0,y:0},{x:10,y:10}]);const{x:s,y:o,width:r,height:n}=this.getBoundingRect();this.updatePosition(s,o),this.setOrigin(r/2,n/2);}addPoint(e){const t=[...this.style.points];t.push(e),this.style.points=t;}updatePoints(){const{renderPath:e}=this,t=this.getLocalPosition(),i=[];e.forEach((e=>{i.push({x:e.x+t.x,y:e.y+t.y});})),this.style.points=i;}updateStyle(e){Object.keys(e).forEach((t=>{ze(t,e)&&(this.style[t]=e[t]);}));}updateOrigin(){const{width:e,height:t}=this.getBoundingRect();this.setOrigin(e/2,t/2);}updatePosition(e,t){this.style.x=e,this.style.y=t;}getPath(){const{x:e,y:t}=this.getBoundingRect();return this.path=this.parsedStyle.points,this.renderPath=this.parsedStyle.points.map((i=>({x:i.x-e,y:i.y-t}))),this.steps=Pn(this.renderPath,!0),this.path}getBoundingRect(){const{borderWidth:e,points:t,lineCap:i}=this.parsedStyle;if(2===t.length)return An(t[0],t[1],e.value,i);const s=kn(t),o=e.value/2||0;return {x:s.left-o,y:s.top-o,width:s.width+2*o,height:s.height+2*o}}getBoundingRectObject(){const{x:e,y:t,width:i,height:s}=this.getBoundingRect();return new Vn({style:{x:e,y:t,width:i,height:s,borderWidth:1,background:"rgba(0,0,0,0)"}})}isPointInPath(e){if(!this.getBoundingRectObject().isPointInPath(e))return !1;const{borderWidth:t,background:i,points:s}=this.parsedStyle,o=t&&t.value;null==t||t.value;const r=t.value<20?10:t.value/2;let n=!1;return o&&(n=Rn(s,r,e.x,e.y,!0)),!n&&i&&(n=function(e,t,i){let s=!1;const o=e.length;if(o<=2)return !1;for(let r=0;r<o;r++){const n=e[r],a=e[(r+1)%o];if(Te(n,a,{x:t,y:i}))return !0;In(n.y-i)>0!=In(a.y-i)>0&&In(t-(i-n.y)*(n.x-a.x)/(n.y-a.y)-n.x)<0&&(s=!s);}return s}(s,e.x,e.y)),n}}class $n extends Cn{constructor(){let{style:e,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"polyline",style:{...Dn,points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:4,...e},...i}),t(this,"shapeType","polyline"),t(this,"renderPath",void 0),this.getPath();const{x:s,y:o}=this.getBoundingRect();this.updatePosition(s,o),this.updateOrigin();}initPath(){const {points:e,lineEnding:t}=this.parsedStyle,s=[];if(e.forEach(((e,t)=>{0===t?s.push({x:e.x,y:e.y,step:0,close:!1}):s.push({x:e.x,y:e.y,step:1,close:!1});})),t)for(let e=0;e<t.length;e++)switch(t[e]){case"OpenArrow":this.addOpenArrow(s,e,!1);break;case"ROpenArrow":this.addOpenArrow(s,e,!0);break;case"ClosedArrow":this.addCloseArrow(s,e,!1);break;case"RClosedArrow":this.addCloseArrow(s,e,!0);break;case"Butt":this.addButt(s,e);break;case"Slash":this.addSlash(s,e);break;case"Square":this.addSquare(s,e);break;case"Diamond":this.addDiamond(s,e);break;case"Circle":this.addCircle(s,e);}return s}getRenderPath(e){const{x:t,y:i}=this.getBoundingRect(),s=[];return e.forEach((e=>{!e||Number.isNaN(e.x)||Number.isNaN(e.y)||s.push({x:e.x-t,y:e.y-i,step:e.step,close:e.close});})),s}addPoint(e){const t=[...this.style.points];t.push(e),this.style.points=t;}updatePoints(){const{length:e}=this.parsedStyle.points,t=this.getLocalPosition(),i=[];this.renderPath.slice(0,e).forEach((e=>{i.push({x:e.x+t.x,y:e.y+t.y});})),this.style.points=i;}updateStyle(e){Object.keys(e).forEach((t=>{ze(t,e)&&(this.style[t]=e[t]);}));}updateOrigin(){const{width:e,height:t}=this.getBoundingRect();this.setOrigin(e/2,t/2);}updatePosition(e,t){this.style.x=e,this.style.y=t;}updatePoint(){const e=this.getLocalPosition(),t=this.parsedStyle.points.length,i=[];for(let s=0;s<t;s++)i.push({x:this.renderPath[s].x+e.x,y:this.renderPath[s].y+e.y});this.updateStyle({points:i});}getPath(){this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=En(this.renderPath);}getBoundingRect(){const{borderWidth:e,lineCap:t}=this.parsedStyle;if(2===this.path.length)return An(this.path[0],this.path[1],e.value,t);const i=kn(this.path),s=e.value/2;return {x:i.left-s,y:i.top-s,width:i.width+2*s,height:i.height+2*s}}getBoundingRectObject(){const{x:e,y:t,width:i,height:s}=this.getBoundingRect();return new Vn({style:{x:e,y:t,width:i,height:s,borderWidth:1,background:"rgba(0,0,0,0)"}})}isPointInPath(e){if(!this.getBoundingRectObject().isPointInPath(e))return !1;const{borderWidth:t,points:i}=this.parsedStyle;null==t||t.value;return Rn(i,t.value<20?10:t.value/2,e.x,e.y,!1)}isLineArrow(){const{lineEnding:e}=this.parsedStyle;return !!e&&("None"!==e[0]||"None"!==e[1])}addOpenArrow(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:s,borderWidth:o}=this.parsedStyle,{length:r}=s;let n=s[r-2],a=s[r-1];0===t&&(n={...s[1]},a={...s[0]}),_n(e,t,i,n,a,o.value);}addCloseArrow(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:s,borderWidth:o}=this.parsedStyle,{length:r}=s;let n=s[r-2],a=s[r-1];0===t&&(n={...s[1]},a={...s[0]}),Nn(e,t,i,n,a,o.value);}addCircle(e,t){const{points:i,borderWidth:s}=this.parsedStyle,{length:o}=i;Wn(e,t,i[0],i[o-1],s.value);}addDiamond(e,t){const{points:i,borderWidth:s}=this.parsedStyle,{length:o}=i;Un(e,t,i[0],i[o-1],s.value);}addSquare(e,t){const{points:i,borderWidth:s}=this.parsedStyle,{length:o}=i;Bn(e,t,i[0],i[o-1],s.value);}addSlash(e,t){const{points:i,borderWidth:s}=this.parsedStyle,{length:o}=i;let r=i[o-2],n=i[o-1];0===t&&(r={...i[1]},n={...i[0]}),Bn(e,t,r,n,s.value);}addButt(e,t){const{points:i,borderWidth:s}=this.parsedStyle,{length:o}=i;let r=i[o-2],n=i[o-1];0===t&&(r={...i[1]},n={...i[0]}),Ln(e,t,r,n,s.value);}}let Xn=class extends Cn{constructor(){let{style:e,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"text",style:{...Dn,x:0,y:0,text:"",width:300,wordWarp:!0,wordBreak:!0,underline:!1,strikeout:!1,textAlign:"left",textBaseLine:"top",textTransform:"none",letterSpacing:0,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontFamily:"Microsoft YaHei",color:"white",fontSize:12,lineHeight:12,...e},...i}),t(this,"shapeType","text"),t(this,"lines",[]),t(this,"chars",[]),t(this,"totalHeight",void 0),t(this,"textX",void 0),t(this,"textY",void 0),t(this,"rowWidth",void 0),t(this,"realWidth",void 0),t(this,"cacheWidth",void 0),t(this,"font",void 0);const{x:s,y:o}=this.parsedStyle;this.setFont(),this.calculateTextPosition(),this.lineWrap(),this.saveCharPosition(),this.setLocalPosition(s,o),this.updateOrigin();}setFont(){const{fontStyle:e,fontVariant:t,fontWeight:i,fontFamily:s,fontSize:o}=this.parsedStyle;this.font=`${e} ${t} ${i} ${o.value}${o.unit} ${s}`;}updateStyle(e){Object.keys(e).forEach((t=>{ze(t,e)&&(this.style[t]=e[t]);}));}updateOrigin(){if(!this.chars[0])return;const{width:e,height:t}=this.getBoundingRect(),i=this.chars[0].height/10||0,s=this.chars[0].height/2||0;let o=0;switch(this.parsedStyle.textBaseLine){case"top":o=t/2-i;break;case"hanging":o=t/2;break;case"middle":o=-i+s*(this.lines.length-1);break;case"ideographic":o=1.5*-i+s*(this.lines.length-2);break;case"bottom":o=-i+s*(this.lines.length-2);break;default:o=i+s*(this.lines.length-2);}this.setOrigin(e/2-i,o);}updatePosition(e,t){this.style.x=e,this.style.y=t;}calculateTextPosition(){const{x:e,y:t,width:i,letterSpacing:s,borderWidth:o}=this.parsedStyle,r=((null==o?void 0:o.value)||0)/2;this.textX=e+r+s.value,this.textY=t+r+s.value,this.rowWidth=i.value-2*r-2*s.value;}lineWrap(){this.totalHeight=0,this.realWidth=0;const{textX:e,rowWidth:t,parsedStyle:i}=this,{lineHeight:s,wordWarp:o,fontSize:r,borderWidth:n}=i,a=document.createElement("canvas").getContext("2d");let l=0;a.font=this.font;const h=r.value>s?r.value:s,c=this.transformText(this.parsedStyle.text);if(c.length||(this.lines=[],this.totalHeight=0),c.length){const i=[];let{textY:s}=this,r="";for(let n=0;n<c.length;n++){const d=c.charAt(n);if("\n"!==d&&"\r"!==d){if(r+=d,a.measureText(r).width>=t&&o){if(r=r.substring(0,r.length-1),""===r){r=d;continue}l+=r.length;const t=a.measureText(r).width;t>this.realWidth&&(this.realWidth=a.measureText(r).width),i.push({text:r,x:e,y:s,lineWidth:t,length:r.length,sum:l}),r=d,s+=h,this.totalHeight+=h;}}else {const t=a.measureText(r).width;t>this.realWidth&&(this.realWidth=a.measureText(r).width),r+=d,l+=r.length,i.push({text:r,x:e,y:s,lineWidth:t,length:r.length,sum:l}),r="",s+=h,this.totalHeight+=h;}}if(""!==r){l+=r.length;const t=a.measureText(r).width;t>this.realWidth&&(this.realWidth=a.measureText(r).width),i.push({text:r,x:e,y:s,lineWidth:t,length:r.length,sum:l});}this.totalHeight+=h,this.lines=i;}1===this.lines.length&&(this.realWidth=a.measureText(this.lines[0].text).width),n&&n.value&&(this.realWidth+=n.value);}getBoundingRect(){const{x:e,y:t,textBaseLine:i,fontSize:s,lineHeight:o}=this.parsedStyle,r=s.value>o?s.value:o,n=r/10;return {x:e-n,y:Yn(i,t,r)-n,width:this.realWidth+2*n,height:this.totalHeight}}getBoundingRectObject(){const{x:e,y:t,width:i,height:s}=this.getBoundingRect();return new Vn({style:{x:e,y:t,width:i,height:s,borderWidth:1,background:"rgba(0,0,0,0)"}})}isPointInPath(e){return this.getBoundingRectObject().isPointInPath(e)}saveCharPosition(){this.chars=[];const{lines:e}=this,{fontSize:t,textBaseLine:i}=this.parsedStyle,s=document.createElement("canvas").getContext("2d"),o=t.value;s.font=this.font;let r=0;e.forEach(((e,t)=>{let n=e.x;for(let a=0;a<e.text.length;a++){const l=e.text.charAt(a),h=1;let{width:c}=s.measureText(l);"\n"!==l&&"\r"!==l||(c=.1),this.chars.push({char:l,index:r+a+1,charIndex:a+1,lineIndex:t,x:n,y:Yn(i,e.y,o),width:c,height:o}),n+=s.measureText(l).width*h,a===e.text.length-1&&(r+=e.text.length);}}));}getCharByPosition(e,t){const i={x:e,y:t};for(let e=0;e<this.chars.length;e++){if(this.getCharBounding(e).isPointInPath(i))return this.chars[e]}return !1}getCharBounding(e){const{x:t,y:i,width:s,height:o}=this.chars[e];return new Vn({style:{x:t,y:i-o/10,width:s,height:o,borderWidth:1,background:"rgba(0,0,0,0)"}})}transformText(e){const{textTransform:t}=this.parsedStyle;return "capitalize"===t?e=e[0].toUpperCase()+e.substring(1):"lowercase"===t?e.toLowerCase():"uppercase"===t?e.toUpperCase():e}};function Yn(e,t,i){let s;const o=i/10;switch(e){case"top":s=t-.5*o;break;case"hanging":s=t+.5*o;break;case"middle":s=t-i/2-.5*o;break;case"ideographic":s=t-i-.5*o;break;case"bottom":s=t-i;break;default:s=t+2*o-i;}return s}class qn extends Cn{constructor(){let{style:e,...i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"freeline",style:{...Dn,startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:null,borderWidth:2,...e},...i}),t(this,"shapeType","freeline"),t(this,"renderPath",void 0),this.getPath();const{x:s,y:o}=this.getBoundingRect();this.updatePosition(s,o),this.updateOrigin();}initPath(){const{startPoint:e,endPoint:t,lineEnding:i}=this.parsedStyle,s=[{...e,step:0,close:!1},{...t,step:1,close:!0}];if(i)for(let e=0;e<i.length;e++)switch(i[e]){case"OpenArrow":this.addOpenArrow(s,e,!1);break;case"ROpenArrow":this.addOpenArrow(s,e,!0);break;case"ClosedArrow":this.addCloseArrow(s,e,!1);break;case"RClosedArrow":this.addCloseArrow(s,e,!0);break;case"Butt":this.addButt(s,e);break;case"Slash":this.addSlash(s,e);break;case"Square":this.addSquare(s,e);break;case"Diamond":this.addDiamond(s,e);break;case"Circle":this.addCircle(s,e);}return s}getRenderPath(e){const{x:t,y:i}=this.getBoundingRect(),s=[];return e.forEach((e=>{!e||Number.isNaN(e.x)||Number.isNaN(e.y)||s.push({x:e.x-t,y:e.y-i,step:e.step,close:e.close});})),s}updatePoints(){const e=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+e.x,y:this.renderPath[0].y+e.y},endPoint:{x:this.renderPath[1].x+e.x,y:this.renderPath[1].y+e.y}});}updateOrigin(){const{width:e,height:t}=this.getBoundingRect();this.setOrigin(e/2,t/2);}updateStyle(e){Object.keys(e).forEach((t=>{ze(t,e)&&(this.style[t]=e[t]);}));}updatePosition(e,t){this.style.x=e,this.style.y=t;}getPath(){this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=En(this.renderPath);}getBoundingRect(){const{borderWidth:e,lineCap:t}=this.parsedStyle,i=kn(this.path);if(2===this.path.length)return An(this.path[0],this.path[1],e.value,t);const s=e.value/2||0;return {x:i.left-s,y:i.top-s,width:i.width+2*s,height:i.height+2*s}}getBoundingRectObject(){const{x:e,y:t,width:i,height:s}=this.getBoundingRect();return new Vn({style:{x:e,y:t,width:i,height:s,borderWidth:1,background:"rgba(0,0,0,0)"}})}isPointInPath(e){if(!this.getBoundingRectObject().isPointInPath(e))return !1;const{startPoint:t,endPoint:i,borderWidth:s}=this.parsedStyle;return Mn(t,i,s.value<20?10:s.value,e)}isLineArrow(){const{lineEnding:e}=this.parsedStyle;return !!e&&("None"!==e[0]||"None"!==e[1])}addCircle(e,t){const{startPoint:i,endPoint:s,borderWidth:o}=this.parsedStyle;Wn(e,t,i,s,o.value);}addDiamond(e,t){const{startPoint:i,endPoint:s,borderWidth:o}=this.parsedStyle;Un(e,t,i,s,o.value);}addSquare(e,t){const{startPoint:i,endPoint:s,borderWidth:o}=this.parsedStyle;!function(e,t,i,s,o){const r=o;let{x:n,y:a}=s;0===t&&(n=i.x,a=i.y);const l={x:n-3*r,y:a-3*r,step:0,close:!1},h={x:n+3*r,y:a-3*r,step:1,close:!1},c={x:n+3*r,y:a+3*r,step:1,close:!1},d={x:n-3*r,y:a+3*r,step:1,close:!0};e.push(l,h,c,d);}(e,t,i,s,o.value);}addSlash(e,t){const{startPoint:i,endPoint:s,borderWidth:o}=this.parsedStyle;Bn(e,t,i,s,o.value);}addButt(e,t){const{startPoint:i,endPoint:s,borderWidth:o}=this.parsedStyle;Ln(e,t,i,s,o.value);}addOpenArrow(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:s,endPoint:o,borderWidth:r}=this.parsedStyle;_n(e,t,i,s,o,r.value);}addCloseArrow(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:s,endPoint:o,borderWidth:r}=this.parsedStyle;Nn(e,t,i,s,o,r.value);}}const Qn=1/0;class Zn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qn,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Qn,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;t(this,"minX",void 0),t(this,"maxX",void 0),t(this,"minY",void 0),t(this,"maxY",void 0),t(this,"rect",void 0),t(this,"updateId",void 0),this.minX=e,this.maxX=i,this.minY=s,this.maxY=o,this.rect=null,this.updateId=-1;}static isEmpty(e){return e.minX===e.maxX&&e.minY===e.maxY}static fromBounds(e){return (new Zn).setFromBounds(e)}static create(){return new Zn}setFromBounds(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}clear(){return this.minX=Qn,this.maxX=-1/0,this.minY=Qn,this.maxY=-1/0,this}getRect(e){const{minX:t,minY:i,maxX:s,maxY:o}=this;if(t>s||i>o)return new ke(0,0,0,0);const r=e||new ke;return r.update(t,i,s-t,o-i),r}addPoint(e){return this.addBounds({minX:e.x,maxX:e.x,minY:e.y,maxY:e.y})}addBounds(e){const t=Kn(this,e);return this.setFromBounds(t)}addBoundsMask(e,t){const i=Jn(e,t);if(i.minX<=i.maxX&&i.minY<=i.maxY){const e=Kn(i,this);this.setFromBounds(e);}return this}intersection(e){if(i=e,!((t=this).minX<=i.maxX&&t.maxX>=i.minX&&t.minY<=i.maxY&&t.maxY>=i.minY))return null;var t,i;const s=Jn(this,e);return Zn.fromBounds(s)}union(e){const t=Kn(this,e);return Zn.fromBounds(t)}addBoundsArea(e,t){const{x:i,y:s,width:o,height:r}=t,n={minX:i,minY:s,maxX:i+o,maxY:s+r};return this.addBoundsMask(e,n)}addFrame(e,t){return this.setFromTransformedBounds(e.worldTransform,t)}setFromTransformedBounds(e,t){for(let i=0;i<2;i++){const s=e.transformPoint({x:i?t.maxX:t.minX,y:i?t.maxY:t.minY});this.addPoint(s);}return this}addQuad(e){for(let t=0;t<4;t++)this.addPoint({x:e[2*t],y:e[2*t+1]});}}function Jn(e,t){return {minX:e.minX>t.minX?e.minX:t.minX,minY:e.minY>t.minY?e.minY:t.minY,maxX:e.maxX<t.maxX?e.maxX:t.maxX,maxY:e.maxY<t.maxY?e.maxY:t.maxY}}function Kn(e,t){return {minX:e.minX<t.minX?e.minX:t.minX,minY:e.minY<t.minY?e.minY:t.minY,maxX:e.maxX>t.maxX?e.maxX:t.maxX,maxY:e.maxY>t.maxY?e.maxY:t.maxY}}class ea extends gn{constructor(){super(),t(this,"name","Document"),t(this,"defaultView",void 0),t(this,"documentElement",void 0),t(this,"timeLine",void 0),this.nodeName="document",this.documentElement=new Cn({name:"Root",id:"root",style:{visibility:"visible"}}),this.documentElement.ownerDocument=this,this.documentElement.parentNode=this,this.childNodes=[this.documentElement];}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}createElement(e,t){const i=this.defaultView.customElements.get(e);return new i(t)}getElementById(e){return null}getElementsByName(e){return this.documentElement.getElementsByTagName(e)}getElementsByTagName(e){return this.documentElement.getElementsByTagName(e)}getElementsByClassName(e){return this.documentElement.getElementsByClassName(e)}append(){return this.documentElement.append(...arguments)}prepend(){return this.documentElement.prepend(...arguments)}querySelector(e){return this.documentElement.querySelector(e)}querySelectorAll(e){return this.documentElement.querySelectorAll(e)}find(e){return this.documentElement.find(e)}findAll(e){return this.documentElement.findAll(e)}appendChild(e){return this.documentElement.appendChild(e)}cloneNode(e){return this.documentElement.cloneNode(e)}insertBefore(e,t){return this.documentElement.insertBefore(e,t)}removeChild(e){return this.documentElement.removeChild(e)}replaceChild(e,t){return this.documentElement.replaceChild(e,t)}destroy(){}}function ta(e,t,i){i instanceof Xn!=!1&&e!==t&&(i.calculateTextPosition(),i.lineWrap(),i.saveCharPosition(),i.updateOrigin());}function ia(e,t,i){if(i instanceof Hn==!1)return;if(e===t)return;const{x:s,y:o}=i.getBoundingRect();i.updatePosition(s,o);}function sa(e,t,i){if(!(i instanceof Gn||i instanceof $n||i instanceof jn))return;if(e===t)return;i.getPath();const{x:s,y:o}=i.getBoundingRect();i.updatePosition(s,o),i.updateOrigin();}function oa(e,t,i){i instanceof Xn!=!1&&e!==t&&(i.setFont(),i.calculateTextPosition(),i.lineWrap(),i.saveCharPosition(),i.updateOrigin());}function ra(e,t,i){(i instanceof Vn||i instanceof zn)&&e!==t&&i.updateOrigin();}function na(e,t,i){if(i instanceof qn==!1)return;if(e===t)return;i.getPath();const{x:s,y:o}=i.getBoundingRect();i.updatePosition(s,o),i.updateOrigin();}function aa(e,t,i){i instanceof qn==!1&&i instanceof $n==!1||e!==t&&(i.getPath(),i.updateOrigin());}function la(e,t,i){t&&(bn[e]=t),i&&(xn[e]||(xn[e]=[]),xn[e].push(i));}function ha(e,t,i){for(let s=0;s<e.length;s++)la(e[s],t,i);}ha(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth"],Or,void 0),ha(["startAngle","endAngle"],Nr,void 0),ha(["r","rx","ry","width","height","padding","fontSize","arrowWidth","markSize","markLineWidth"],Or,void 0),ha(["borderColor","background","shadowColor","color"],Fr,void 0),ha(["opacity","fillOpacity","borderOpacity"],jr,void 0),la("lineDash",Hr,void 0),la("shadow",zr,void 0),ha(["x","y"],void 0,Gr),ha(["points"],void 0,sa),ha(["x1","y1","x2","y2"],void 0,ia),ha(["startPoint","endPoint"],void 0,na),ha(["lineEnding"],void 0,aa),ha(["fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,oa),ha(["x","y","width","wordWarp","lineHeight","text","textTransform","textBaseLine"],void 0,ta),ha(["width","height"],void 0,ra);class ca{constructor(e){t(this,"contextService",void 0),t(this,"renderingPlugins",[]),t(this,"config",{autoRendering:!0}),Object.assign(this.config,e);}use(e){this.renderingPlugins.includes(e)||this.renderingPlugins.push(e);}initPlugins(e){this.renderingPlugins.forEach((t=>{t.init(e);}));}destroyPlugins(){this.renderingPlugins.forEach((e=>{e.destroy();}));}getPlugins(){return this.renderingPlugins}getConfig(){return this.config}}class da{constructor(e){t(this,"hooks",{init:ee.create(),beginFrame:ee.create(),beforeRender:ee.create(),render:ee.create(),afterRender:ee.create(),putImageData:ee.create(),endFrame:ee.create(),destroy:ee.create(),pointerdown:ee.create(),pointerup:ee.create(),pointermove:ee.create(),pointerout:ee.create(),pointerover:ee.create(),pointerCancel:ee.create(),wheel:ee.create()}),t(this,"isInited",!1),t(this,"zIndexCounter",0),t(this,"renderingContext",void 0),this.renderingContext=e;}init(){this.hooks.init.emit(),this.isInited=!0;}destroy(){this.isInited=!1,this.hooks.destroy.emit();}render(){const{root:e}=this.renderingContext;this.zIndexCounter=0,un.recursiveUpdateHierarchy(e),this.isInited&&(this.renderDisplayObject(e),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear());}renderDisplayObject(e){if(!e.isVisible)return;const{sortable:t}=e;if(t.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),e.imageData)return void this.hooks.putImageData.emit(e);this.hooks.beforeRender.emit(e),this.hooks.render.emit(e),this.hooks.afterRender.emit(e);let i=!1;t.dirty&&(t.sorted=e.childNodes.slice().sort(ua),t.dirty=!1,i=!0);const s=t.sorted||e.childNodes;s.length>1&&s.sort(((e,t)=>e.style.zIndex-t.style.zIndex)),s.forEach((e=>{this.renderDisplayObject(e);})),s.sort(((e,t)=>e.index-t.index)),i&&e.recursiveCall((e=>{const t=new Yr("renderOrderChanged",{renderOrder:e.sortable.renderOrder});e.dispatchEvent(t);}));}dirty(){this.renderingContext.renderCondition.add(0);}}function ua(e,t){const i=Number(e.style.zIndex),s=Number(t.style.zIndex);if(i===s&&e.parentNode){const{childNodes:i=[]}=e.parentNode;return i.indexOf(e)-i.indexOf(t)}return i-s}class ga extends qr{constructor(e){super(),t(this,"document",void 0),t(this,"customElements",void 0),t(this,"devicePixelRatio",void 0),t(this,"eventService",void 0),t(this,"renderingService",void 0),t(this,"renderingContext",void 0),t(this,"canvasConfig",void 0),t(this,"renderer",void 0),t(this,"supportTouchEvent",void 0),t(this,"supportPointerEvent",void 0),t(this,"contextService",void 0);const{renderer:i,dpr:s,width:o,height:r,canvas:n,supportPointerEvent:a,supportTouchEvent:l}=e;this.supportPointerEvent=null!=a?a:!!globalThis.PointerEvent,this.supportTouchEvent=null!=l?l:"touchstart"in window;let h=o,c=r,d=s;n&&(d=s||window.devicePixelRatio||1,h=o||n.width/d,c=r||n.height/d),this.canvasConfig={...e,width:h,height:c,dpr:d},this.canvasConfig=e,this.renderer=i,this.document=new ea,this.document.defaultView=this,this.initRenderingContext(),this.renderingService=new da(this.renderingContext),this.initRenderer(i);}initRenderingContext(){this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new Set},this.document.documentElement.addEventListener("child-inserted",(e=>{this.mountChildren(e.detail.child);})),this.document.documentElement.addEventListener("child-removed",(e=>{this.unmountChildren(e.detail.child);}));}initRenderer(e){this.renderingService.init(),e.initPlugins(this),this.contextService.init();e.getConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall((e=>{const{renderable:t}=e;t&&(t.boundsDirty=!0,t.renderBoundsDirty=!0);})),this.mountChildren(this.document.documentElement);}render(){const e=new Yr("beforeRender",{});this.dispatchEvent(e),this.contextService.clearCanvas(),this.renderingService.render();}setDPR(e){this.canvasConfig.dpr=e,this.contextService.setDPR(e);}resize(e,t){this.canvasConfig.width=e,this.canvasConfig.height=t,this.contextService.resize(e,t);}getContextService(){return this.contextService}getEventService(){return this.eventService}appendChild(e,t){return this.document.documentElement.appendChild(e,t)}insertBefore(e,t){return this.document.documentElement.insertBefore(e,t)}removeChild(e){return this.document.documentElement.removeChild(e)}getBoundingClientRect(){return this.contextService.getBoundingClientRect()}mountChildren(e){e.recursiveCall((e=>{if(!e.isConnected){e.isConnected=!0,e.ownerDocument=this.document;const t=new Yr("DOMNodeInsertedIntoDocument",{});e.dispatchEvent(t);}}));}unmountChildren(e){const t=[];e.recursiveCall((e=>{e.isConnected&&t.push(e);})),t.reverse().forEach((e=>{e.isConnected=!1;const t=new Yr("DOMNodeRemovedFromDocument",{});e.dispatchEvent(t),e!==this.document.documentElement&&(e.ownerDocument=null);}));}}class fa{}class pa extends fa{constructor(){super(...arguments),t(this,"close",!0),t(this,"shape",void 0),t(this,"ctx",void 0);}render(e,t){const{background:i,borderColor:s,visibility:o}=e.parsedStyle;if("hidden"===o)return;this.renderPath(e,t);const r=!Fe(i)&&!i.isNone,n=!Fe(s)&&!s.isNone;r&&this.renderFill(e,t),this.renderStrokePath(e,t),n&&this.renderStroke(e,t);}renderPath(e,t){e.getPath(),t.beginPath(),e.steps.forEach((e=>{Tn(t,e);})),this.close&&e.steps.length>2&&t.closePath();}renderStrokePath(e,t){H(null==e?void 0:e.getStrokePath)&&(e.getStrokePath(),t.beginPath(),e.strokeSteps.forEach((e=>{Tn(t,e);})),this.close&&e.strokeSteps.length>2&&t.closePath());}renderFill(e,t){const{parsedStyle:i}=e,{background:s,opacity:o,fillOpacity:r}=i;if(t.save(),t.globalAlpha=o*r,Array.isArray(s)){this.setShapeGradientOrigin(e,t);for(let i=0;i<s.length;i++)0===i&&this.setShadow(e,t),t.fillStyle=this.getColor(e,s[i],t),t.fill();}else this.setShadow(e,t),t.fillStyle=s.formatted,t.fill();t.restore();}renderStroke(e,t){const{parsedStyle:i}=e,{borderWidth:s,borderColor:o,opacity:r,lineCap:n,lineJoin:a,miterLimit:l,lineDash:h,lineDashOffset:c,borderOpacity:d}=i;s&&s.value>0&&(t.save(),Fe(s)||(t.lineWidth=s.value),t.miterLimit=l,t.globalAlpha=r*d,t.lineCap=n,t.lineJoin=a,t.setLineDash(h),t.lineDashOffset=c.value,Array.isArray(o)?(this.setShapeGradientOrigin(e,t),o.forEach((i=>{t.strokeStyle=this.getColor(e,i,t),t.stroke();}))):(t.strokeStyle=o.formatted,t.stroke()),t.restore());}setShadow(e,t){const{shadow:i,shadowOffsetX:s,shadowOffsetY:o,shadowBlur:r,shadowColor:n}=e.parsedStyle;(i||n)&&(t.shadowOffsetX=(null==s?void 0:s.value)||i[0],t.shadowOffsetY=(null==o?void 0:o.value)||i[1],t.shadowBlur=(null==r?void 0:r.value)||i[2],t.shadowColor=(null==n?void 0:n.formatted)||i[3]);}getColor(e,t,i){let s;if(1===t.type||2===t.type){const o=e.getBoundingRect(),{width:r,height:n}=o,a=r,l=n;s=function(e,t){const{type:i,steps:s,width:o,height:r,angle:n,cx:a,cy:l,size:h}=e;let c=null;if(1===i){const{x1:e,y1:i,x2:s,y2:a}=function(e,t,i){const s=i*Math.PI/180,o=0+e/2,r=0+t/2,n=Math.abs(e*Math.cos(s))+Math.abs(t*Math.sin(s));return {x1:o-Math.cos(s)*n/2,y1:r-Math.sin(s)*n/2,x2:o+Math.cos(s)*n/2,y2:r+Math.sin(s)*n/2}}(o,r,n.value);c=t.createLinearGradient(e,i,s,a);}else if(2===i){const{x:e,y:i,r:s}=function(e,t,i,s,o){let r=i.value,n=s.value;"%"===i.unit&&(r=i.value/100*e),"%"===s.unit&&(n=s.value/100*t);let a=Math.max(Ae({x:0,y:0},{x:r,y:n}),Ae({x:0,y:t},{x:r,y:n}),Ae({x:e,y:t},{x:r,y:n}),Ae({x:e,y:0},{x:r,y:n}));return o&&(B(o)?a=o.value:$(o)&&("closest-side"===o?a=Math.min(r,e-r,n,t-n):"farthest-side"===o?a=Math.max(r,e-r,n,t-n):"closest-corner"===o&&(a=Math.min(Ae({x:0,y:0},{x:r,y:n}),Ae({x:0,y:t},{x:r,y:n}),Ae({x:e,y:t},{x:r,y:n}),Ae({x:e,y:0},{x:r,y:n}))))),{x:r,y:n,r:a}}(o,r,a,l,h);c=t.createRadialGradient(e,i,0,e,i,s);}c&&s.forEach((e=>{let{offset:t,color:i}=e;var s;"%"===t.unit&&(null===(s=c)||void 0===s||s.addColorStop(t.value/100,i.toString()));}));return c}({type:t.type,...t.value,width:a,height:l},i);}return s}setShapeGradientOrigin(e,t){const{type:i}=e.config,{r:s,rx:o,ry:r}=e.parsedStyle;switch(i){case"circle":case"arc":t.translate(0-s.value,0-s.value);break;case"ellipse":t.translate(0-o.value,0-r.value);break;default:t.translate(0,0);}}}class ma extends pa{constructor(){super(),this.close=!1;}}class va extends pa{}class ya extends pa{}class wa extends pa{render(e,t){const{width:i,height:s,src:o,img:r,opacity:n,visibility:a}=e.parsedStyle;"hidden"!==a&&($(r)||r&&(t.save(),t.globalAlpha=n,r instanceof ImageData?t.putImageData(r,0,0):(t.imageSmoothingEnabled=!0,t.imageSmoothingQuality&&(t.imageSmoothingQuality="high"),t.drawImage(r,0,0,i.value,s.value)),t.restore()));}}class ba extends pa{constructor(){super(),this.close=!1;}}class xa extends pa{constructor(){super(),this.close=!1;}}class Ca extends pa{}class Sa extends pa{render(e,t){const{background:i,borderColor:s,visibility:o}=e.parsedStyle;if("hidden"===o)return;const r=!Fe(i)&&!i.isNone,n=!Fe(s)&&!s.isNone;e.getPath();const a=e.steps.length;for(let i=0;i<a;i++){const s=e.steps[i];t.beginPath(),s.step.forEach((e=>{Tn(t,e);})),s.close&&(t.closePath(),r&&this.renderFill(e,t)),n&&this.renderStroke(e,t);}}}class Pa extends pa{}class Ta extends pa{render(e,t){e&&this.renderText(e,t);}renderText(e,t){var i;const{parsedStyle:s,lines:o}=e,{color:r,borderWidth:n,borderColor:a,textBaseLine:l,opacity:h,textAlign:c,lineDash:d,textMaxWidth:u,fillOpacity:g,borderOpacity:f,letterSpacing:p}=s;e.setFont(),t.save(),r&&Array.isArray(r)?r.forEach((i=>{t.fillStyle=this.getColor(e,i,t);})):t.fillStyle=r.formatted,a&&Array.isArray(a)?a.forEach((i=>{t.strokeStyle=this.getColor(e,i,t);})):t.strokeStyle=a.formatted,this.setShadow(e,t),t.font=e.font,t.globalAlpha=h,t.lineWidth=null==n?void 0:n.value,t.textAlign=c,t.textBaseline=l,t.letterSpacing=`${p.value}px`,t.setLineDash(d),t.beginPath();const m=(null===(i=o[0])||void 0===i?void 0:i.y)||0;o.forEach((i=>{let{text:s}=i;const o=i.y-m;s=e.transformText(s),r&&this.fillText(t,s,0,o,g,null==u?void 0:u.value),n&&n.value&&n.value>0&&this.strokeText(t,s,0,o,f,null==u?void 0:u.value);})),t.closePath(),t.restore();}fillText(e,t,i,s,o,r){let n;const a=!Fe(o)&&1!==o;a&&(n=e.globalAlpha,e.globalAlpha=o*o),e.fillText(t,i,s,r),a&&(e.globalAlpha=n);}strokeText(e,t,i,s,o,r){let n;const a=!Fe(o)&&1!==o;a&&(n=e.globalAlpha,e.globalAlpha=o),e.strokeText(t,i,s,r),a&&(e.globalAlpha=n);}}class ka extends pa{}class Da extends pa{render(e,t){const{background:i,borderColor:s,visibility:o}=e.parsedStyle;if("hidden"===o)return;const r=!Fe(i)&&!i.isNone,n=!Fe(s)&&!s.isNone;e.getPath(),t.beginPath();const a=e.steps.length;let l=!0;e.steps.forEach(((i,s)=>{for(let e=0;e<i.step.length;e++)Tn(t,i.step[e]);i.close&&(l=!1,t.closePath(),r&&this.renderFill(e,t),n&&this.renderStroke(e,t)),i.close&&s<a-1&&(l=!0,t.beginPath());})),l&&n&&this.renderStroke(e,t);}}class Ea{constructor(e){t(this,"canvasConfig",void 0),t(this,"container",void 0),t(this,"canvas",void 0),t(this,"dpr",void 0),t(this,"context",void 0),t(this,"shapeRenderers",{}),this.canvasConfig=e;}init(){const{container:e,canvas:t,dpr:i,willReadFrequently:s}=this.canvasConfig;if(t){this.canvas=t;const{parentElement:i}=t;e&&i!==e&&e.appendChild(t),this.container=i,this.canvasConfig.container=i;}else if(e&&(this.container=e,$(e)&&(this.container=document.getElementById(e)),this.container)){const e=document.createElement("canvas");this.container.appendChild(e),this.canvas=e;}this.context=this.canvas.getContext("2d",{willReadFrequently:s}),this.dpr=i||Ne(),this.resize(this.canvasConfig.width,this.canvasConfig.height);}registerShapeRenderer(e,t){this.shapeRenderers[e]||(this.shapeRenderers[e]=t);}getShapeRenderer(e){return this.shapeRenderers[e]}destroy(){const{canvas:e,container:t}=this;t&&null!=e&&e.parentNode&&t.removeChild(e);}resize(e,t){const{canvas:i,dpr:s}=this;i&&(i.width=e*s,i.height=t*s,this.context.scale(s,s));}getDPR(){return this.dpr}setDPR(e){this.canvasConfig.dpr=e,this.dpr=e;}getContext(){return this.context}getDomElement(){return this.canvas}getCanvas(){return this.canvas}setCursor(e){var t;null!=this&&null!==(t=this.container)&&void 0!==t&&t.style&&(this.container.style.cursor=e);}getBoundingClientRect(){var e;return null===(e=this.canvas)||void 0===e?void 0:e.getBoundingClientRect()}clearCanvas(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr));}}class Aa{constructor(){t(this,"restoreStack",[]);}init(e){const{hooks:t}=e.renderingService;t.init.on((()=>{})),t.destroy.on((()=>{})),t.beginFrame.on((()=>{})),t.endFrame.on((()=>{const{contextService:t}=e,i=t.getContext();this.restoreStack.forEach((()=>{i.restore();})),this.restoreStack=[];})),t.render.on((t=>{this.renderDisplayObject(t,e);})),t.putImageData.on((t=>{if(t.imageData){const{x:i,y:s}=t.getPosition(),o=e.contextService.getContext(),r=e.contextService.getDPR();o.putImageData(t.imageData,Math.floor(i*r+1),Math.floor(s*r+1));}}));}renderDisplayObject(e,t){if(!e.isVisible)return;const{contextService:i}=t,s=i.getContext();let o=this.restoreStack[this.restoreStack.length-1];for(;o&&e.parentNode!==o;)s.restore(),this.restoreStack.pop(),o=this.restoreStack[this.restoreStack.length-1];s.save(),this.applyTransform(s,e);const{clipPath:r}=e.style;r&&(s.save(),this.applyTransform(s,r),s.restore(),s.clip()),this.useAnchor(s,e);const n=i.getShapeRenderer(e.shapeType);n&&(n.render(e,s),e.clippable&&s.clip()),this.restoreStack.push(e);}applyTransform(e,t){t.externalMatrices.length&&t.externalMatrices.slice().reverse().forEach((t=>{const{a:i,b:s,c:o,d:r,e:n,f:a}=t;e.transform(i,s,o,r,n,a);}));const i=t.getLocalTransform(),{a:s,b:o,c:r,d:n,e:a,f:l}=i;e.transform(s,o,r,n,a,l);}applyAttributes(e,t,i){}useAnchor(e,t){const{anchor:i}=t.parsedStyle||{};if(!i||0===i.x&&0===i.y)return;const s=t.getGeometryBounds().getRect();e.translate(-(i&&i.x||0)*s.width,-(i&&i.y||0)*s.height);}destroy(){}}t(Aa,"moduleName",void 0);class Ia{init(e){const t=new Ea(e.canvasConfig);e.contextService=t;[{name:"arc",renderer:new ma},{name:"circle",renderer:new va},{name:"ellipse",renderer:new ya},{name:"freeline",renderer:new Da},{name:"image",renderer:new wa},{name:"line",renderer:new ba},{name:"path",renderer:new xa},{name:"polygon",renderer:new Ca},{name:"polyline",renderer:new Sa},{name:"rect",renderer:new Pa},{name:"stampPath",renderer:new ka},{name:"text",renderer:new Ta}].forEach((e=>{let{name:i,renderer:s}=e;t.registerShapeRenderer(i,s);}));}destroy(){}}class Ma extends ca{constructor(e){super(e),this.use(new Ia),this.use(new Aa);}}var Ra,Oa,_a,Na;exports.EnumImageDataType = void 0;exports.EnumImageProcessMethodType = void 0;class Ua{constructor(){t(this,"db",void 0),this.db=new Map;}async set(e,t){return new Promise(((i,s)=>{this.db.has(e)?s(new Error(`The item ${e} already exists.`)):(this.db.set(e,t),i(`Save ${e} to database successful.`));}))}async get(e){return new Promise(((t,i)=>{this.db.has(e)?t(this.db.get(e)):i(new Error(`The item ${e} does not exist.`));}))}async remove(e){return new Promise(((t,i)=>{const s=this.db.get(e);this.db.delete(e),t(s);}))}async update(e,t){return new Promise(((i,s)=>{this.db.has(e)?(this.db.set(e,t),i(`Update ${e} successful.`)):s(new Error(`The item ${e} does not exist.`));}))}destroy(){this.db.clear();}}class Wa{constructor(){t(this,"beforeLoadSource",te()),t(this,"afterLoadSource",te()),t(this,"beforeDeleteDocs",te()),t(this,"afterDeleteDocs",te()),t(this,"createDocument",te()),t(this,"deleteDocument",te()),t(this,"renameDocument",te()),t(this,"createPage",te()),t(this,"beforeDeletePages",te()),t(this,"deletePages",te()),t(this,"addPagesToDoc",te()),t(this,"deletePagesFromDoc",te()),t(this,"deleteAllPagesFromDoc",te()),t(this,"updatePage",te()),t(this,"movePages",te()),t(this,"switchPage",te()),t(this,"reorderPages",te()),t(this,"openDocument",te()),t(this,"closeDocument",te()),t(this,"error",te()),t(this,"warning",te()),t(this,"verbose",te()),t(this,"gotoPage",te()),t(this,"selectPages",te()),t(this,"currentChangedByScroll",te()),t(this,"resize",te()),t(this,"rotatePages",te()),t(this,"afterRotatePages",te()),t(this,"cropPages",te()),t(this,"afterCropPages",te()),t(this,"operationsChanged",te()),t(this,"afterPerspective",te()),t(this,"filterChanged",te()),t(this,"resizeObserver",te()),t(this,"setExternalHandler",te()),t(this,"pagePreloadChanged",te()),t(this,"deleteFileData",te()),t(this,"unload",te());}}class Va{constructor(){t(this,"openDocument",te()),t(this,"renameDocument",te()),t(this,"addPages",te()),t(this,"deletePages",te()),t(this,"updatePage",te()),t(this,"movePage",te()),t(this,"switchPage",te()),t(this,"reorderPages",te()),t(this,"selectedPageChanged",te()),t(this,"viewerModeChanged",te()),t(this,"pageChanged",te()),t(this,"pageChangedAfterRender",te()),t(this,"pageExistenceChanged",te()),t(this,"tabChanged",te()),t(this,"displayModeChanged",te()),t(this,"fitModeChanged",te()),t(this,"filterChanged",te()),t(this,"toolModeChanged",te()),t(this,"zoomChanged",te()),t(this,"visibleChanged",te()),t(this,"cropRectDrawn",te()),t(this,"cropRectDeleted",te()),t(this,"cropModeChanged",te()),t(this,"quadModified",te()),t(this,"autoCaptureChanged",te()),t(this,"autoDetectChanged",te()),t(this,"torchChanged",te()),t(this,"cameraPlayed",te()),t(this,"cameraClosed",te()),t(this,"cameraInit",te()),t(this,"beforeLayout",te()),t(this,"afterLayout",te()),t(this,"beforeRender",te()),t(this,"afterRender",te()),t(this,"destroy",te()),t(this,"quadSelectionStyleChanged",te()),t(this,"perspectiveQuadChanged",te()),t(this,"beforeCropPages",te()),t(this,"operationsChanged",te()),t(this,"resize",te());}}function Fa(e){switch(e){case exports.EnumImageDataType.BGRA:return Je.IT_BGRA;case exports.EnumImageDataType.RGBA:return Je.IT_RGBA;case exports.EnumImageDataType.PNG:return Je.IT_PNG;case exports.EnumImageDataType.JPEG:return Je.IT_JPG;default:return}}function za(e){switch(e){case Je.IT_BGRA:return exports.EnumImageDataType.BGRA;case Je.IT_RGBA:return exports.EnumImageDataType.RGBA;case Je.IT_PNG:return exports.EnumImageDataType.PNG;case Je.IT_JPG:return exports.EnumImageDataType.JPEG;default:return}}!function(e){e[e.RGBA=1]="RGBA",e[e.BGRA=2]="BGRA",e[e.JPEG=3]="JPEG",e[e.PNG=4]="PNG";}(exports.EnumImageDataType||(exports.EnumImageDataType={})),function(e){e[e.BlackAndWhite=1]="BlackAndWhite",e[e.Gray=2]="Gray",e[e.RemoveShadow=3]="RemoveShadow",e[e.Enhance=4]="Enhance",e[e.Invert=5]="Invert",e[e.Brightness=6]="Brightness",e[e.Contrast=7]="Contrast",e[e.BrightnessAndContrast=8]="BrightnessAndContrast",e[e.Perspective=9]="Perspective",e[e.Deskew=10]="Deskew",e[e.Rotate=11]="Rotate",e[e.Flip=12]="Flip",e[e.Resize=13]="Resize",e[e.SetHeight=14]="SetHeight",e[e.SetWidth=15]="SetWidth",e[e.SetDPI=16]="SetDPI",e[e.Crop=17]="Crop",e[e.Erase=18]="Erase",e[e.DrawPolygon=19]="DrawPolygon";}(exports.EnumImageProcessMethodType||(exports.EnumImageProcessMethodType={}));var Ha,ja=new WeakMap,Ga=new WeakSet,$a=new WeakSet,Xa=new WeakSet;class Ya{constructor(){p(this,Xa),p(this,$a),p(this,Ga),f(this,ja,{writable:!0,value:void 0}),s(this,ja,0);}async process(e,t,i){return L(t)||(t=[t]),u(this,Xa,Za).call(this,e,t,i)}}function qa(e){for(const t of e)t.type&&(t.type<=0||(t.type,exports.EnumImageProcessMethodType.DrawPolygon),t.params);}async function Qa(e,t){var i;const s=null!==(i=t.params)&&void 0!==i?i:{};switch(t.type){case exports.EnumImageProcessMethodType.BlackAndWhite:{const{saveInk:t,level:i}=s;return e.toBinaryLevel(t,i)}case exports.EnumImageProcessMethodType.Gray:{const{level:t}=s;return e.toGrayscale(t)}case exports.EnumImageProcessMethodType.RemoveShadow:{const{level:t,alpha:i}=s;return e.removeShadowLevel(t,i)}case exports.EnumImageProcessMethodType.Enhance:return e.brighten();case exports.EnumImageProcessMethodType.Invert:return e.invert();case exports.EnumImageProcessMethodType.Contrast:{const{contrast:t}=s;return e.changeBrightnessAndContrast(void 0,t)}case exports.EnumImageProcessMethodType.Brightness:{const{brightness:t}=s;return e.changeBrightnessAndContrast(t,void 0)}case exports.EnumImageProcessMethodType.BrightnessAndContrast:{const{brightness:t,contrast:i}=s;return e.changeBrightnessAndContrast(t,i)}case exports.EnumImageProcessMethodType.Perspective:{const{location:t}=s,i=t;return e.perspective(i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1],i[3][0],i[3][1])}case exports.EnumImageProcessMethodType.Deskew:{const{options:t,fillColor:i,keepSize:o,mode:r}=s,n=await e.getSkewAngle(t);return e.rotate(n,i,null==o||o,r)}case exports.EnumImageProcessMethodType.Rotate:{const{angle:t,fillColor:i,keepSize:o,mode:r}=s;return e.rotate(t,i,o,r)}case exports.EnumImageProcessMethodType.Flip:return e.flip();case exports.EnumImageProcessMethodType.Resize:{const{newWidth:t,newHeight:i,mode:o}=s;return e.resize(t,i,o)}case exports.EnumImageProcessMethodType.SetHeight:{const{newHeight:t,fillColor:i}=s;return e.setImageHeight(t,i)}case exports.EnumImageProcessMethodType.SetWidth:{const{newWidth:t,fillColor:i}=s;return e.setImageWidth(t,i)}case exports.EnumImageProcessMethodType.SetDPI:{const{xRes:t,yRes:i}=s;return e.setDPI(0,0,t,i,!1,void 0)}case exports.EnumImageProcessMethodType.Crop:{const{left:t,top:i,right:o,bottom:r}=s;return e.crop(t,i,o,r)}case exports.EnumImageProcessMethodType.Erase:{const{left:t,top:i,right:o,bottom:r,fillColor:n}=s;return e.erase(t,i,o,r,n)}case exports.EnumImageProcessMethodType.DrawPolygon:{const{location:t,strokeColor:i,lineWidth:o}=s,r=t;return e.drawQuadrangle(r[0][0],r[0][1],r[1][0],r[1][1],r[2][0],r[2][1],r[3][0],r[3][1],s)}}}async function Za(e,t,i){u(this,Ga,qa).call(this,t);const s=new Io,o={inputImageInfo:void 0,output:void 0,outputImageInfo:void 0,outputContentType:"",outputType:void 0};try{await Ka(e,s,o);for(const e of t)await u(this,$a,Qa).call(this,s,e);const{output:r,outputContentType:n,outputImageInfo:a,outputType:l}=await el(s,e.type===exports.EnumImageDataType.RGBA,null==i?void 0:i.type,null==i?void 0:i.params);o.output=r,o.outputContentType=n,o.outputImageInfo=a,o.outputType=l;}finally{try{s.terminate();}catch(e){Zl.OutputWarning(e);}}return o}function Ja(e){return {width:e.imageWidth,height:e.imageHeight,bitDepth:e.imageBitDepth,resolutionX:e.imageXResolution,resolutionY:e.imageYResolution}}async function Ka(e,t,i){const s=await t.initImage(e.data,e.type===exports.EnumImageDataType.RGBA,e.width,e.height,e.type===exports.EnumImageDataType.BGRA);s.srcBuffer&&(e.data=s.srcBuffer),i.inputImageInfo=Ja(await t.getImageInfo());}async function el(e,t,i,s){const o=null!=s?s:{},{jpegQuality:r,bitDepth:n,xdpi:a,ydpi:l,returnBlob:h}=o,c=Fa(i),d=await e.getImage(r,!0,t,n,a,l,!1,c,Rl.isApple);await e.freeReservedData();return {outputImageInfo:Ja(d),output:d.imageData,outputContentType:d.blobType,inputImageInfo:void 0,outputType:za(d.imageType)}}!function(e){e.NONE="none",e.BLACK_AND_WHITE="blackAndWhite",e.GRAY="gray",e.REMOVE_SHADOW="removeShadow",e.SAVE_INK="saveInk",e.ENHANCE="enhance",e.INVERT="invert",e.BRIGHTNESS="brightness",e.CONTRAST="contrast",e.BRIGHTNESS_AND_CONTRAST="brightnessAndContrast";}(Ha||(Ha={}));const tl=new Map([[Ha.NONE,"None"],[Ha.BLACK_AND_WHITE,"toBW"],[Ha.GRAY,"toGray"],[Ha.REMOVE_SHADOW,"removeShadow"],[Ha.SAVE_INK,"toBW"],[Ha.ENHANCE,"enhance"],[Ha.INVERT,"invert"],[Ha.CONTRAST,"brightnessAndContrast"],[Ha.BRIGHTNESS,"brightnessAndContrast"],[Ha.BRIGHTNESS_AND_CONTRAST,"brightnessAndContrast"]]);var il,sl;exports.EnumPDFCompressionType = void 0;!function(e){e.LEFT="left",e.TOP="top",e.RIGHT="right",e.BOTTOM="bottom";}(il||(il={})),function(e){e.DEFAULT="default",e.CAPTURE="capture",e.PERSPECTIVE="perspective",e.THUMBNAIL="thumbnail";}(sl||(sl={})),function(e){e.PDF_AUTO="pdf/auto",e.PDF_FAX4="pdf/fax4",e.PDF_LZW="pdf/lzw",e.PDF_JPEG="pdf/jpeg",e.PDF_JP2000="pdf/jp2000",e.PDF_JBIG2="pdf/jbig2";}(exports.EnumPDFCompressionType||(exports.EnumPDFCompressionType={}));const rl=new Map([[exports.EnumPDFCompressionType.PDF_AUTO,0],[exports.EnumPDFCompressionType.PDF_FAX4,2],[exports.EnumPDFCompressionType.PDF_LZW,3],[exports.EnumPDFCompressionType.PDF_JPEG,5],[exports.EnumPDFCompressionType.PDF_JP2000,6],[exports.EnumPDFCompressionType.PDF_JBIG2,7]]);exports.EnumTIFFCompressionType = void 0;!function(e){e.TIFF_AUTO="tiff/auto",e.TIFF_FAX3="tiff/fax3",e.TIFF_FAX4="tiff/fax4",e.TIFF_LZW="tiff/lzw",e.TIFF_JPEG="tiff/jpeg";}(exports.EnumTIFFCompressionType||(exports.EnumTIFFCompressionType={}));const al=new Map([[exports.EnumTIFFCompressionType.TIFF_AUTO,0],[exports.EnumTIFFCompressionType.TIFF_FAX3,1],[exports.EnumTIFFCompressionType.TIFF_FAX4,2],[exports.EnumTIFFCompressionType.TIFF_LZW,3],[exports.EnumTIFFCompressionType.TIFF_JPEG,5]]);exports.EnumPDFPageType = void 0;!function(e){e.PAGE_DEFAULT="page/default",e.PAGE_A4="page/a4",e.PAGE_A4_REVERSE="page/a4reverse",e.PAGE_A3="page/a3",e.PAGE_A3_REVERSE="page/a3reverse",e.PAGE_LETTER="page/letter",e.PAGE_LETTER_REVERSE="page/letterreverse",e.PAGE_LEGAL="page/legal",e.PAGE_LEGAL_REVERSE="page/legalreverse";}(exports.EnumPDFPageType||(exports.EnumPDFPageType={}));const hl=new Map([[exports.EnumPDFPageType.PAGE_DEFAULT,0],[exports.EnumPDFPageType.PAGE_A4,2],[exports.EnumPDFPageType.PAGE_A4_REVERSE,3],[exports.EnumPDFPageType.PAGE_A3,4],[exports.EnumPDFPageType.PAGE_A3_REVERSE,5],[exports.EnumPDFPageType.PAGE_LETTER,6],[exports.EnumPDFPageType.PAGE_LETTER_REVERSE,7],[exports.EnumPDFPageType.PAGE_LEGAL,8],[exports.EnumPDFPageType.PAGE_LEGAL_REVERSE,9]]);class cl{static numberArrayIsValid(e,t,i,s,o){return a(this,cl,dl).call(this,e,1,t,i,o,s)}static stringArrayIsValid(e,t){return a(this,cl,dl).call(this,e,2,void 0,void 0,0,t)}static blobArrayIsValid(e,t){return a(this,cl,dl).call(this,e,4,void 0,void 0,void 0,t)}static quadIsValid(e,t){const i=[],s="Quad";a(this,cl,vl).call(this,i,e,6,a(this,cl,pl).call(this,s,t,void 0),4);let o=0;for(const r of e){const e=`[${o}]`;i.push(...a(this,cl,dl).call(this,r,1,void 0,void 0,2,a(this,cl,pl).call(this,s,t,e,!0))),o+=1;}return i}static rectIsValid(e,t){const i=[],s="Rect";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),["height","width","left","top"].forEach((o=>{a(this,cl,vl).call(this,i,e[o],1,a(this,cl,pl).call(this,s,t,o));})),i}static extraPageDataIsValid(e,t,i){const s=[],o="ExtraPageData";return a(this,cl,vl).call(this,s,e,5,a(this,cl,pl).call(this,o,t)),a(this,cl,vl).call(this,s,e.index,1,a(this,cl,pl).call(this,o,t,"index")),W(e.rotation)||(a(this,cl,vl).call(this,s,e.rotation,1,a(this,cl,pl).call(this,o,t,"rotation")),G(e.rotation)&&e.rotation%90!=0&&s.push(`${a(this,cl,pl).call(this,o,t,"rotation")} is not supported.`)),W(e.filter)||(a(this,cl,vl).call(this,s,e.filter,2,a(this,cl,pl).call(this,o,t,"filter")),$(e)&&"none"!==e.filter&&L(i)&&i.length>0&&!i.includes(e.filter)&&s.push(`${a(this,cl,pl).call(this,o,t,"filter")} is not supported.`)),W(e.perspectiveQuad)||s.push(...this.quadIsValid(e.perspectiveQuad,a(this,cl,pl).call(this,o,t,"perspectiveQuad"))),s}static updatePageDataIsValid(e,t,i){const s=[],o="UpdatePageData",r=e=>a(this,cl,pl).call(this,o,t,e);return a(this,cl,vl).call(this,s,e,5,r(void 0)),["fileIndex","width","height","pageWidth","pageHeight","resolutionX","resolutionY","bitDepth","rotation"].forEach((i=>{W(e[i])||(a(this,cl,vl).call(this,s,e[i],1,r(i)),"rotation"===i&&G(e.rotation)&&e.rotation%90!=0&&s.push(`${a(this,cl,pl).call(this,o,t,"rotation")} is not supported.`));})),W(e.filter)||(a(this,cl,vl).call(this,s,e.filter,2,r("filter")),$(e)&&"none"!==e.filter&&L(i)&&i.length>0&&!i.includes(e.filter)&&s.push(`${a(this,cl,pl).call(this,o,t,"filter")} is not supported.`)),W(e.perspectiveQuad)||s.push(...this.quadIsValid(e.perspectiveQuad,t)),s}static sourcesIsValid(e,t,i){const s=[],o="Source[]";if(a(this,cl,vl).call(this,s,e,6,a(this,cl,pl).call(this,o,t)),s.length>0)return s;let r=0;for(const n of e){const e=`[${r}]`;s.push(...this.sourceIsValid(n,a(this,cl,pl).call(this,o,t,e,!0),i)),r+=1;}return s}static sourceIsValid(e,t,i){const s=[],o="Source";if(a(this,cl,vl).call(this,s,e,5,a(this,cl,pl).call(this,o,t)),a(this,cl,vl).call(this,s,null==e?void 0:e.fileData,4,a(this,cl,pl).call(this,o,t,"fileData")),!W(null==e?void 0:e.extraPageData)){a(this,cl,vl).call(this,s,e.extraPageData,6,a(this,cl,pl).call(this,o,t,"extraPageData"));let r=0;for(const n of e.extraPageData){const e=`[${r}]`;s.push(...this.extraPageDataIsValid(n,a(this,cl,pl).call(this,o,t,`extraPageData${e}`,!0),i)),r+=1;}}return s}static configIsValid(e,t){const i=[],s="Configuration";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),a(this,cl,vl).call(this,i,e.license,11,a(this,cl,pl).call(this,s,t,"license")),a(this,cl,vl).call(this,i,e.engineResourcePath,2,a(this,cl,pl).call(this,s,t,"engineResourcePath")),W(e.deviceFriendlyName)||a(this,cl,vl).call(this,i,e.deviceFriendlyName,2,a(this,cl,pl).call(this,s,t,"deviceFriendlyName")),i}static docDetectConfigIsValid(e,t){const i=[],s="DocumentDetectConfig";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),a(this,cl,vl).call(this,i,e.autoCaptureDelay,1,a(this,cl,pl).call(this,s,t,"autoCaptureDelay")),W(e.acceptedPolygonConfidence)||a(this,cl,vl).call(this,i,e.acceptedPolygonConfidence,1,a(this,cl,pl).call(this,s,t,"acceptedPolygonConfidence")),W(e.enableAutoCapture)||a(this,cl,vl).call(this,i,e.enableAutoCapture,3,a(this,cl,pl).call(this,s,t,"enableAutoCapture")),i}static docDetectConfIsValid(e,t){const i=[],s="DocumentDetectConfidence";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),a(this,cl,vl).call(this,i,e.angleConfidence,1,a(this,cl,pl).call(this,s,t,"angleConfidence"),0,100),a(this,cl,vl).call(this,i,e.areaConfidence,1,a(this,cl,pl).call(this,s,t,"areaConfidence"),0,100),a(this,cl,vl).call(this,i,e.centerConfidence,1,a(this,cl,pl).call(this,s,t,"centerConfidence"),0,100),i}static imageDataIsValid(e,t){const i=[],s="VImageData";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),a(this,cl,vl).call(this,i,e.data,8,a(this,cl,pl).call(this,s,t,"data")),a(this,cl,vl).call(this,i,e.type,9,a(this,cl,pl).call(this,s,t,"type")),W(e.height)||a(this,cl,vl).call(this,i,e.height,1,a(this,cl,pl).call(this,s,t,"height")),W(e.width)||a(this,cl,vl).call(this,i,e.width,1,a(this,cl,pl).call(this,s,t,"width")),i}static filterTypeIsValid(e,t){const i=[];return a(this,cl,vl).call(this,i,e,10,a(this,cl,pl).call(this,"EnumImageFilterType",t)),i}static imageEncodeOptionIsValid(e,t){const i=[],s="ImageEncodeOption";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),a(this,cl,vl).call(this,i,e.type,9,a(this,cl,pl).call(this,s,t,"type")),W(e.params)||a(this,cl,vl).call(this,i,e.params,5,a(this,cl,pl).call(this,s,t,"params")),i}static saveJpegSettingsIsValid(e,t){const i=[],s="SaveJpegSettings";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),W(e.quality)||a(this,cl,vl).call(this,i,e.quality,1,a(this,cl,pl).call(this,s,t,"quality"),0,100),i}static savePdfSettingsIsValid(e,t){const i=[],s="SavePdfSettings";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),W(e.author)||a(this,cl,vl).call(this,i,e.author,2,a(this,cl,pl).call(this,s,t,"author")),W(e.compression)||a(this,cl,vl).call(this,i,e.compression,12,a(this,cl,pl).call(this,s,t,"compression")),W(e.creationDate)||a(this,cl,vl).call(this,i,e.creationDate,2,a(this,cl,pl).call(this,s,t,"creationDate")),W(e.creator)||a(this,cl,vl).call(this,i,e.creator,2,a(this,cl,pl).call(this,s,t,"creator")),W(e.includeAnnotations)||a(this,cl,vl).call(this,i,e.includeAnnotations,3,a(this,cl,pl).call(this,s,t,"includeAnnotations")),W(e.keyWords)||a(this,cl,vl).call(this,i,e.keyWords,2,a(this,cl,pl).call(this,s,t,"keyWords")),W(e.modifiedDate)||a(this,cl,vl).call(this,i,e.modifiedDate,2,a(this,cl,pl).call(this,s,t,"modifiedDate")),W(e.pageType)||a(this,cl,vl).call(this,i,e.pageType,14,a(this,cl,pl).call(this,s,t,"pageType")),W(e.producer)||a(this,cl,vl).call(this,i,e.producer,2,a(this,cl,pl).call(this,s,t,"producer")),W(e.quality)||a(this,cl,vl).call(this,i,e.quality,1,a(this,cl,pl).call(this,s,t,"quality"),0,100),W(e.subject)||a(this,cl,vl).call(this,i,e.subject,2,a(this,cl,pl).call(this,s,t,"subject")),W(e.title)||a(this,cl,vl).call(this,i,e.title,2,a(this,cl,pl).call(this,s,t,"title")),W(e.version)||a(this,cl,vl).call(this,i,e.version,15,a(this,cl,pl).call(this,s,t,"version")),W(e.mimeType)||a(this,cl,vl).call(this,i,e.mimeType,16,a(this,cl,pl).call(this,s,t,"mimeType")),i}static saveTiffSettingsIsValid(e,t){const i=[],s="SaveTiffSettings";if(a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),W(e.compression)||a(this,cl,vl).call(this,i,e.compression,13,a(this,cl,pl).call(this,s,t,"compression")),!W(e.customTag)){a(this,cl,vl).call(this,i,e.customTag,6,a(this,cl,pl).call(this,s,t,"customTag"));let o=0;for(const r of e.customTag){const e=`[${o}]`;i.push(...a(this,cl,gl).call(this,r,a(this,cl,pl).call(this,s,t,`customTag${e}`))),o+=1;}}return W(e.quality)||a(this,cl,vl).call(this,i,e.quality,1,a(this,cl,pl).call(this,s,t,"quality"),0,100),i}static containerIsValid(e,t){const i=[],s="container";let o;if(Z(e)&&(o=e),$(e)){const t=document.getElementById(e);Z(t)&&(o=t);}return o||i.push(`${a(this,cl,pl).call(this,s,t,s)}: ${Zl.CONTAINER_NOTEXIST.message}`),i}static uiConfigIsValid(e,t){const i=[],s="uiConfig";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),a(this,cl,vl).call(this,i,e.type,2,a(this,cl,pl).call(this,s,t,"type")),["id","name","flexDirection","tooltip","className","label"].forEach((o=>{W(e[o])||a(this,cl,vl).call(this,i,e[o],16,a(this,cl,pl).call(this,s,t,o));})),["style","events"].forEach((o=>{W(e[o])||a(this,cl,vl).call(this,i,e[o],5,a(this,cl,pl).call(this,s,t,o));})),W(e.children)||(a(this,cl,vl).call(this,i,e.children,6,"children"),L(e.children)&&e.children.forEach(((e,o)=>{if($(e)||B(e)||i.push(`${s}.children[${o}] is invalid.`),B(e)){const r=this.uiConfigIsValid(e,a(this,cl,pl).call(this,s,t,`children[${o}]`));i.push(...r);}}))),i}static loadSourceOptionsIsValid(e,t){const i=[],s="LoadSourceOptions";return a(this,cl,vl).call(this,i,e,5,a(this,cl,pl).call(this,s,t)),W(e.insertBeforeIndex)||a(this,cl,vl).call(this,i,e.insertBeforeIndex,1,a(this,cl,pl).call(this,s,t,"insertBeforeIndex")),W(e.exception)||a(this,cl,vl).call(this,i,e.exception,2,a(this,cl,pl).call(this,s,t,"insertBeforeIndex")),i}static async makeSureSourcesTypeSupported(e,t,i,s){const o=[],r=[];let n=0;for(const i of e){const e=`[${n}]`,s=await Gs(i.fileData);if(0===s.length){const i=a(this,cl,pl).call(this,"Source[]",t,`${e}.fileData`,!0);r.push(`${i}: ${Zl.FILE_NOTSUPPORT.message}`);}else o.push(s);n+=1;}if(r.length>0){throw Zl.buildError({...Zl.FILE_NOTSUPPORT,details:r},i,s)}return o}static async makeSureSourceTypeSupported(e,t,i,s){const o=[],r=await Gs(e.fileData);if(0===r.length){const e=a(this,cl,pl).call(this,"Source",t,"fileData");o.push(`${e}: ${Zl.FILE_NOTSUPPORT.message}`);}return this.makeSureValid(o,i,s,Zl.FILE_NOTSUPPORT),r}static makeSureExternalHandlerTypeValid(e,t,i,s){this.makeSureMissing(e,t,i),a(this,cl,ul).call(this,a(this,cl,fl).call(this,e),t,i,s);}static makeSureDocDetectHandlerValid(e,t,i,s){var o;this.makeSureMissing(e,t,i),("function"!=typeof(o=e).detect||"function"!=typeof o.destroy)&&a(this,cl,ml).call(this,void 0,t,i);}static makeSureImageFilterHandlerValid(e,t,i,s){var o;this.makeSureMissing(e,t,i),"function"==typeof(o=e).querySupported&&"defaultFilterType"in o&&"function"==typeof o.applyFilter&&"function"==typeof o.destroy||a(this,cl,ml).call(this,void 0,t,i);}static makeSureContainerValid(e,t,i){this.makeSureMissing(e,t,i),$(e)||Z(e)||Zl.throw(Zl.PARAM_INVALID,t,i),this.containerIsValid(e).length>0&&Zl.throw(Zl.CONTAINER_NOTEXIST,t,i);}static makeSureNumberValid(e,t,i,s,o,r){return a(this,cl,ul).call(this,a(this,cl,Dl).call(this,e,t,i),s,o,r)}static makeSureStringValid(e,t,i,s){return a(this,cl,ul).call(this,[a(this,cl,Al).call(this,e),!0],t,i,s)}static makeSureDocOptionsValid(e,t,i,s){const o=[],r=i||"CreateDocumentOptions";a(this,cl,vl).call(this,o,e,5,a(this,cl,pl).call(this,r,s)),W(null==e?void 0:e.name)||a(this,cl,vl).call(this,o,e.name,2,a(this,cl,pl).call(this,r,s,"name")),W(null==e?void 0:e.author)||a(this,cl,vl).call(this,o,e.author,2,a(this,cl,pl).call(this,r,s,"author")),W(null==e?void 0:e.creationDate)||a(this,cl,vl).call(this,o,e.creationDate,2,a(this,cl,pl).call(this,r,s,"creationDate")),W(null==e?void 0:e.deleteOriginal)||a(this,cl,vl).call(this,o,e.deleteOriginal,3,a(this,cl,pl).call(this,r,s,"deleteOriginal")),this.makeSureValid(o,t,i);}static makeSureTransferOptions(e,t,i,s,o,r){const n=[],l="TransferOptions";a(this,cl,vl).call(this,n,e,5,a(this,cl,pl).call(this,l,r)),W(null==e?void 0:e.sourceIndices)||n.push(...this.numberArrayIsValid(e.sourceIndices,t,i,`${l}.sourceIndices`)),W(null==e?void 0:e.insertBeforeIndex)||a(this,cl,vl).call(this,n,e.insertBeforeIndex,1,a(this,cl,pl).call(this,l,r,"insertBeforeIndex"),0),this.makeSureValid(n,s,o);}static makeSureDetectResultValid(e,t,i,s){const o=[],r="DetectResult";a(this,cl,vl).call(this,o,e,5,a(this,cl,pl).call(this,r,s)),o.push(...cl.quadIsValid(null==e?void 0:e.location,r)),a(this,cl,vl).call(this,o,null==e?void 0:e.width,1,a(this,cl,pl).call(this,r,s,"width"),1,void 0),a(this,cl,vl).call(this,o,null==e?void 0:e.height,1,a(this,cl,pl).call(this,r,s,"height"),1,void 0),o.push(...cl.docDetectConfigIsValid(null==e?void 0:e.config,r)),null!=e&&e.confidence&&a(this,cl,vl).call(this,o,e.confidence,1,a(this,cl,pl).call(this,r,s,"confidence")),this.makeSureValid(o,t,i);}static makeSureValid(e,t,i,s){0!==e.length&&a(this,cl,ml).call(this,e,t,i,s);}static makeSureMissing(e,t,i){W(e)&&a(this,cl,ml).call(this,void 0,t,i,Zl.PARAM_MISS);}static makeSureCameraObject(e,t,i){const s=[],o=i;this.makeSureMissing(e,t,i),$(e)?this.makeSureStringValid(e,t,i):(a(this,cl,vl).call(this,s,e,5,a(this,cl,pl).call(this,o)),a(this,cl,vl).call(this,s,e.deviceId,2,a(this,cl,pl).call(this,o,void 0,"deviceId")),a(this,cl,vl).call(this,s,e.label,2,a(this,cl,pl).call(this,o,void 0,"label")),this.makeSureValid(s,t,i));}static initTypeCheckMap(){r(this,cl,Ml)[1]=a(this,cl,Dl),r(this,cl,Ml)[2]=a(this,cl,Al),r(this,cl,Ml)[3]=z,r(this,cl,Ml)[4]=F,r(this,cl,Ml)[5]=B,r(this,cl,Ml)[6]=a(this,cl,bl),r(this,cl,Ml)[7]=V,r(this,cl,Ml)[8]=a(this,cl,wl),r(this,cl,Ml)[9]=a(this,cl,xl),r(this,cl,Ml)[10]=a(this,cl,Cl),r(this,cl,Ml)[11]=a(this,cl,El),r(this,cl,Ml)[12]=a(this,cl,Sl),r(this,cl,Ml)[13]=a(this,cl,Pl),r(this,cl,Ml)[14]=a(this,cl,Tl),r(this,cl,Ml)[15]=a(this,cl,kl),r(this,cl,Ml)[16]=$;}}function dl(e,t,i,s,o,r){const n=[],l="Array";if(a(this,Ra,vl).call(this,n,e,6,a(this,Ra,pl).call(this,l,r),o),n.length>0)return n;let h=0;for(const o of e){const e=`[${h}]`;a(this,Ra,vl).call(this,n,o,t,a(this,Ra,pl).call(this,l,r,e,!0),i,s),h+=1;}return n}function ul(e,t,i,s){const o=e[0],r=e[1];o&&r||(s||r||(s=Zl.PARAM_OUTOFRANGE),a(this,Ra,ml).call(this,void 0,t,i,s));}function gl(e,t){const i=[],s="CustomTag";return a(this,Ra,vl).call(this,i,e,5,a(this,Ra,pl).call(this,s,t)),W(e.content)||a(this,Ra,vl).call(this,i,e.content,2,a(this,Ra,pl).call(this,s,t,"content")),W(e.contentIsBase64)||a(this,Ra,vl).call(this,i,e.contentIsBase64,3,a(this,Ra,pl).call(this,s,t,"contentIsBase64")),W(e.id)||a(this,Ra,vl).call(this,i,e.id,1,a(this,Ra,pl).call(this,s,t,"id")),i}function fl(e){let t=!1;if($(e)){switch(e){case"documentBoundariesDetect":case"imageFilter":t=!0;break;default:t=!1;}}return [t,!0]}function pl(e,t,i,s){return t?i?s?`${t}${i}`:`${t}.${i}`:`${t}`:i?s?`${e}${i}`:`${e}.${i}`:`${e}`}function ml(e,t,i,s){const o=W(s)?{...Zl.PARAM_INVALID}:{...s};e&&(o.details=e),Zl.throw(o,t,i);}function vl(e,t,i,s,o,r){const n=a(this,Ra,yl).call(this,t,i,s,o,r);n&&e.push(n);}function yl(e,t,i,s,o){if(W(e))return `${i} is missing.`;const n=r(this,Ra,Ml)[t];if(n){const t=n.bind(this)(e,s,o);if(z(t)){if(!t)return `${i} is invalid.`}else if(L(t)){if(z(t[0])&&!t[0])return `${i} is invalid.`;if(z(t[1])&&!t[1])return `${i} is out of range.`}}}function wl(e){return V(e)||F(e)}function bl(e,t){return !!L(e)&&((!G(t)||0!==e.length)&&(!(!W(t)&&e.length<t)&&[!0,!!W(t)||e.length>=t]))}function xl(e){return !!G(e)&&[!0,e>=exports.EnumImageDataType.RGBA&&e<=exports.EnumImageDataType.PNG]}function Cl(e){return !!$(e)&&[!0,(t=e,!!tl.get(t))];var t;}function Sl(e){return void 0!==rl.get(e)}function Pl(e){return void 0!==al.get(e)}function Tl(e){return void 0!==hl.get(e)}function kl(e){if($(e)){const t=e.trim();return -1!==r(this,Ra,Il).indexOf(t)}return !1}function Dl(e,t,i){let s=!1,o=!0;return G(e)&&(s=!0,W(t)||(o=e>=t),!W(i)&&o&&(o=e<=i)),[s,o]}function El(e){if($(e)){const t=e.trim();if(0===t.length)return !0;if(t.startsWith("DLS"))return !0;if((t.startsWith("f")||t.startsWith("t"))&&t.length>50)return !0}return !1}function Al(e){return !!$(e)&&0!==e.trim().length}Ra=cl;var Il={writable:!0,value:["1.1","1.2","1.3","1.4","1.5","1.6","1.7"]},Ml={writable:!0,value:Object.create(null)};cl.initTypeCheckMap();class Rl{static get isApple(){return r(this,Rl,Fl)}static get version(){return Zs.CryptoModule.ver}static enableDebugOutput(e,t){if(e){const e=t,i=function(t){let i=t,s=null,o=null,r=null,n=null,l=null;if(i.srcBuffer&&(s=i.srcBuffer,i.srcBuffer=a(Rl,Rl,Ol).call(Rl,s)),i.result&&i.result.srcBuffer&&(n=i.result.srcBuffer,i.result.srcBuffer=a(Rl,Rl,Ol).call(Rl,n)),i.result&&i.result.imageData&&(o=i.result.imageData,i.result.imageData=a(Rl,Rl,Ol).call(Rl,o)),i.result&&i.result.pdfData&&(l=i.result.pdfData,i.result.pdfData=a(Rl,Rl,Ol).call(Rl,l)),i.imageData&&(r=i.imageData,i.imageData=a(Rl,Rl,Ol).call(Rl,r)),e)if($(i)){const t=Date.now();e(`[${t}]${i}`);}else {const t=JSON.stringify(i);try{i=JSON.parse(t);}catch(t){e(t);}e(i);}s&&(t.srcBuffer=s),n&&(t.result.srcBuffer=n),o&&(t.result.imageData=o),r&&(t.imageData=r),l&&(t.result.pdfData=l);};Zs.setLogFunc("logDebug",i);}else Zs.setLogFunc("",void 0);}static getMemoryUsed(){return to.Instance.getMemoryUsed()}static get heapConfig(){return Zs.HeapConfig}static updateHeapConfig(e,t,i){Zs.UpdateHeapConfig(e,t,i),r(this,Rl,zl)[e]||(r(this,Rl,zl)[e]={}),t&&(r(this,Rl,zl)[e].maxHeapSize=t),i&&(r(this,Rl,zl)[e].initHeapSize=i);}static async getLicenseInfo(e,t,i){this.Init(e,t,i),t&&await to.Instance.loadModule(Zs.CryptoModule),await to.Instance.loadModule(Zs.ImageIOModule);const s=new oo(r(this,Rl,Ll));try{return await s.getLicenseInfo()}finally{s.terminate();}}static Init(e,t,i){var s;n(this,Rl,Ll,null!=e?e:r(this,Rl,Ll)),void 0!==t&&n(this,Rl,Bl,t?1:0),n(this,Rl,Ul,null!=i?i:r(this,Rl,Ul));const o={bMac:"Mac"===Vo.OS,biPhone:"iPhone"===Vo.OS,biPad:"iPad"===Vo.OS};n(this,Rl,Fl,o.bMac||o.biPhone||o.biPad),Zs.NavInfo=o,Zs.License=r(this,Rl,Ll),Zs.UUID=r(this,Rl,Ul),Zs.LicMode=r(this,Rl,Bl),a(this,Rl,Nl).call(this),Zs.UpdateHeapConfig(Xe.detector,null!==(s=a(this,Rl,_l).call(this,Xe.detector))&&void 0!==s?s:100);}static async isResourceDirValid(){a(this,Rl,Nl).call(this);try{const e=Zs.PdfReaderModule;return (await fetch(e.script,e.fetchOptions)).ok}catch(e){return !1}}static async loadPdfReader(e,t,i){if(this.Init(e,t,i),"Pending"===r(this,Rl,Wl))return !1;n(this,Rl,Wl,"Pending"),await to.Instance.loadModule(Zs.ImageProcModule);const s=await to.Instance.loadModule(Zs.PdfReaderModule);return n(this,Rl,Wl,""),s}static async loadMain(e,t,i){if(this.Init(e,t,i),"Pending"===r(this,Rl,Vl))return !1;n(this,Rl,Vl,"Pending");const s=await to.Instance.loadModule(Zs.ImagecoreModule);return to.Instance.loadModule(Zs.ImageProcModule),n(this,Rl,Vl,""),s}static async load(e,t,i){to.Instance.terminate(!0),this.Init(e,t,i),await this.loadMain(e,t,i);}static async preloadModule(e){try{switch(e){case"core":await to.Instance.loadModule(Zs.ImagecoreModule);const e=new Io;try{await e.freeReservedData();}finally{e.terminate();}break;case"pdf":await to.Instance.loadModule(Zs.PdfReaderModule);}}catch(e){Zl.OutputWarning(e);}}static unloadMainWorker(){to.Instance.terminateWorker(Zs.ImageIOModule.workerName);}static unloadPdfReaderWorker(){to.Instance.terminateWorker(Zs.PdfReaderModule.workerName);}static unloadDocumentDetectorWorker(){to.Instance.terminateWorker(Zs.DetectorModule.workerName);}static async unloadWorker(){await to.Instance.terminate(!0);}static async unload(){await to.Instance.terminate(!0),to.unload(),Zs.unload(),n(this,Rl,Vl,""),n(this,Rl,Wl,"");}static getUseSimd(){if(!this.enableSimd)return !1;if(void 0!==navigator.userAgentData&&void 0!==navigator.userAgentData.brands){const{brands:e}=navigator.userAgentData;for(const t of e)if(t.brand&&("Chromium"===t.brand||"Google Chrome"===t.brand)&&t.version&&parseInt(t.version,10)>=94)return !0}return !1}static async getPdfInfo(e,t){let i;try{i=new Mo;const s=await i.getPdfInfo({fileSource:e,password:t});return i.destroy(),s}catch(e){Zl.OutputWarning(e);}finally{i&&i.destroy();}return null}}function Ol(e){return e instanceof ArrayBuffer?{type:"ArrayBuffer",length:e.byteLength}:e instanceof Uint8ClampedArray?{type:"Uint8ClampedArray",length:e.byteLength}:{type:Object.prototype.toString.call(e)}}function _l(e){return void 0!==r(this,Oa,zl)[e]?r(this,Oa,zl)[e].maxHeapSize:null}function Nl(){this.enableSimd?Zs.UseSimd=this.getUseSimd():Zs.UseSimd=!1;const e={resourceDir:this.resourceDir,workerScript:"",useFastCompEdition:!1,useSimd:Zs.UseSimd,fetchOptions:this.fetchOptions};e.workerScript=Zs.ImageIOWorkerJS,Zs.ImageIOResource=e;const t={...e};t.workerScript=Zs.ImageIOWorkerJS,Zs.PdfReaderResource=t;}Oa=Rl,t(Rl,"resourceDir","");var Ll={writable:!0,value:""},Bl={writable:!0,value:Qe.LONG_KEY},Ul={writable:!0,value:""};t(Rl,"fetchOptions",{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}),t(Rl,"enableSimd",!0);var Wl={writable:!0,value:""},Vl={writable:!0,value:""},Fl={writable:!0,value:!1},zl={writable:!0,value:Object.create(null)};class Hl{unload(){n(Hl,Hl,Yl,void 0),n(Hl,Hl,ql,void 0),n(Hl,Hl,Ql,void 0);}Verbose(){Hl.Verbose(...arguments);}static Verbose(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];a(Hl,Hl,Gl).call(Hl,r(Hl,Hl,Yl),...t);}static Warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];a(Hl,Hl,Gl).call(Hl,r(Hl,Hl,ql),...t);}static Error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];a(Hl,Hl,Gl).call(Hl,r(Hl,Hl,Ql),...t);}on(e,t){a(Hl,Hl,jl).call(Hl),"error"===e&&r(Hl,Hl,Ql).push(t),"verbose"===e&&(r(Hl,Hl,Yl).push(t),Rl.enableDebugOutput(!0,Hl.Verbose)),"warning"===e&&r(Hl,Hl,ql).push(t);}off(e,t){a(Hl,Hl,jl).call(Hl),"error"===e&&a(Hl,Hl,$l).call(Hl,r(Hl,Hl,Ql),t),"verbose"===e&&(a(Hl,Hl,$l).call(Hl,r(Hl,Hl,Yl),t),Rl.enableDebugOutput(!1,void 0)),"warning"===e&&a(Hl,Hl,$l).call(Hl,r(Hl,Hl,ql),t);}}function jl(){r(_a,_a,Yl)||n(_a,_a,Yl,[]),r(_a,_a,ql)||n(_a,_a,ql,[]),r(_a,_a,Ql)||n(_a,_a,Ql,[]);}function Gl(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];for(const t of e)t(...i);}function $l(e,t){if(t){const i=e.indexOf(t);e.splice(i,1);}else e.splice(0,e.length);}_a=Hl;exports.EnumDocumentDetectionStatus = void 0;var Yl={writable:!0,value:void 0},ql={writable:!0,value:void 0},Ql={writable:!0,value:void 0};class Zl{static buildError(e,t,i){if(e&&!e.code&&e.cause&&e.cause.code&&e.cause.message)return $(e.message)&&(e.message=a(this,Zl,Jl).call(this,e.message,t,i)),e;const s={code:e.code,message:e.message};null!=e&&e.details&&(s.details=e.details);let o={...e};return s.code>-8e4&&0!==s.code?s.code<=-2e4||(s.code=Zl.WASM_ERR.code,s.message=Zl.WASM_ERR.message,o.actualCode=o.code,o.code=s.code):s.code?(s.message=a(this,Zl,Jl).call(this,s.message,t,i),o={...s},Array.isArray(s.details)&&0!==s.details.length&&(o.details=s.details)):(s.code=Zl.EXTERNAL_ERR.code,s.message=Zl.EXTERNAL_ERR.message,o.actualCode=e.code,o.message=e.message,e.name&&(o.name=e.name),e.stack&&(o.stack=e.stack),o.code=s.code,o.actualError=e),new Error(s.message,{cause:o})}static OutputWarning(e,t,i){Hl.Warning(Zl.buildError(e,t,i));}static OutputError(e,t,i){Hl.Error(Zl.buildError(e,t,i));}static throw(e,t,i){const s=Zl.buildError(e,t,i);throw Hl.Error(s),s}static reject(e,t,i){const s=Zl.buildError(e,t,i);return Hl.Error(s),Promise.reject(s)}}function Jl(e,t,i){let s=e;return t&&(s=s.replace("<%api%>",t)),i&&(s=s.replace("<%param%>",i)),s}t(Zl,"LIC_EMPTY",{code:-8e4,message:"No license."}),t(Zl,"LIC_INVALID",{code:-80001,message:"License string is invalid."}),t(Zl,"LIC_EXPIRED",{code:-80002,message:"XXX module license has expired."}),t(Zl,"LIC_MISSMODULE",{code:-80003,message:"XXX module license is missing."}),t(Zl,"LIC_VERNOTMATCHED",{code:-80004,message:"XXX module license version does not match."}),t(Zl,"LIC_DOMAINNOTMATCHED",{code:-80005,message:"Domain does not match the domain bound to the XXX module license."}),t(Zl,"INIT_SHOULDSETCONFIG",{code:-80050,message:"DDV.setConfig has not been set up yet."}),t(Zl,"INIT_CONFIGNOTDONE",{code:-80051,message:"DDV.setConfig has not been completed."}),t(Zl,"PARAM_INVALID",{code:-80100,message:"<%api%>: <%param%> is invalid."}),t(Zl,"PARAM_OUTOFRANGE",{code:-80101,message:"<%api%>: <%param%> is out of range."}),t(Zl,"PARAM_MISS",{code:-80102,message:"<%api%>: <%param%> is missing."}),t(Zl,"PARAM_NOTSUPPORT",{code:-80103,message:"<%api%>: The value for <%param%> is not supported."}),t(Zl,"DOC_NOTEXIST",{code:-80104,message:"<%api%>: The specified document(s) do not exist."}),t(Zl,"PAGE_NOTEXIST",{code:-80105,message:"<%api%>: The specified page(s) do not exist."}),t(Zl,"FILE_NOTSUPPORT",{code:-80200,message:"File type is not supported."}),t(Zl,"DOCUID_DUPLICATE",{code:-80201,message:"DocUid does not allow duplicate."}),t(Zl,"CONTAINER_NOTEXIST",{code:-80301,message:"The specified container does not exist."}),t(Zl,"MINZOOM_INVALID",{code:-80302,message:"minZoom value cannot be larger than maxZoom value."}),t(Zl,"MAXZOOM_INVALID",{code:-80303,message:"maxZoom value cannot be smaller than minZoom value."}),t(Zl,"DOC_NOTOPEN",{code:-80304,message:"No document opened."}),t(Zl,"DOC_NOIMAGE",{code:-80305,message:"There is no image in the current document."}),t(Zl,"ZOOM_TOOLARGE",{code:-80306,message:"The value for zoom is larger than maxZoom value."}),t(Zl,"ZOOM_TOOSMALL",{code:-80307,message:"The value for zoom is smaller than minZoom value."}),t(Zl,"ROWCOLUMN_CANNOTCHANGE",{code:-80308,message:"<%api%>: Not available in current displayMode."}),t(Zl,"RECT_EXCEEDPAGEBOUND",{code:-80309,message:"The specified rect exceeds the bounds of the current page."}),t(Zl,"UNDO_NOOP",{code:-80310,message:"No operations to undo."}),t(Zl,"REDO_NOOP",{code:-80311,message:"No operations to redo."}),t(Zl,"QUAD_EXCEEDPAGEBOUND",{code:-80312,message:"The specified quad exceeds the bounds of the current page."}),t(Zl,"ELEMENT_UNSUPPORTED",{code:-80313,message:"The element <%param%> is not supported in <%api%> class."}),t(Zl,"RECT_NOTAVL",{code:-80314,message:"<%api%>: Not available in current toolMode."}),t(Zl,"DOCDETECT_MISS",{code:-80315,message:"DocumentDetect needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the document detection feature."}),t(Zl,"IMGFILTER_MISS",{code:-80316,message:"ImageFilter needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the image filter feature."}),t(Zl,"CAMERA_NOTEXIST",{code:-80400,message:"The specified camera does not exist."}),t(Zl,"CAMERA_OCCUPIED",{code:-80401,message:"The specified camera is occupied."}),t(Zl,"CAMERA_NOVIDEO",{code:-80402,message:"No video stream is played."}),t(Zl,"CAMERA_NEEDHTTPS",{code:-80403,message:"Not HTTPS, failed to play the video stream."}),t(Zl,"CAMERA_NOTSUPPORTTORCH",{code:-80404,message:"The camera does not support a flashlight."}),t(Zl,"CAMERA_NOCAMERA",{code:-80405,message:"No camera available."}),t(Zl,"CAMERA_DENIED",{code:-80406,message:"The selected camera is denied by browser."}),t(Zl,"CONTAINER_NOBOUND",{code:-80407,message:"No bound container."}),t(Zl,"WASM_ERR",{code:-81e3,message:"WASM Error"}),t(Zl,"EXTERNAL_ERR",{code:-81100,message:"External Error"}),function(e){e.GOOD="Good",e.AUTO_CAPTURE="AutoCaptured",e.SMALL_SIZE="SmallSize",e.OFF_CENTER="OffCenter",e.SKEW="Skew",e.NOTHING_DETECTED="NothingDetected";}(exports.EnumDocumentDetectionStatus||(exports.EnumDocumentDetectionStatus={}));var Kl=new WeakMap,eh=new WeakMap,th=new WeakMap,ih=new WeakMap,sh=new WeakSet,oh=new WeakSet,rh=new WeakSet,nh=new WeakSet,ah=new WeakSet,lh=new WeakSet,hh=new WeakSet,ch=new WeakSet,dh=new WeakSet,uh=new WeakSet,gh=new WeakSet;class fh{constructor(){p(this,gh),p(this,uh),p(this,dh),p(this,ch),p(this,hh),p(this,lh),p(this,ah),p(this,nh),p(this,rh),p(this,oh),p(this,sh),f(this,Kl,{writable:!0,value:void 0}),f(this,eh,{writable:!0,value:0}),f(this,th,{writable:!0,value:0}),f(this,ih,{writable:!0,value:0}),s(this,eh,0),s(this,th,0);}reset(){s(this,eh,0),s(this,th,0),s(this,ih,0);}destroy(){this.clear();}clear(){const e=i(this,Kl);s(this,Kl,void 0);try{e&&e.terminate(),Rl.unloadDocumentDetectorWorker();}catch(e){Zl.OutputWarning(e);}}async detect(e,t){const i="DocumentDetect.detect";return cl.makeSureValid(cl.imageDataIsValid(e),i,"image"),t&&cl.makeSureValid(cl.docDetectConfigIsValid(t),i,"config"),Promise.resolve({success:!1})}getStatusMsg(e){switch(e){case exports.EnumDocumentDetectionStatus.AUTO_CAPTURE:return "Auto capture completed.";case exports.EnumDocumentDetectionStatus.GOOD:return "Capturing your document... Please do not move the camera.";case exports.EnumDocumentDetectionStatus.SMALL_SIZE:return "The document is too small. Try moving closer.";case exports.EnumDocumentDetectionStatus.OFF_CENTER:return "Try holding the device at the center of the document.";case exports.EnumDocumentDetectionStatus.SKEW:return "Please hold the device over a document to start scanning.";case exports.EnumDocumentDetectionStatus.NOTHING_DETECTED:return "No document is detected."}Zl.throw(Zl.PARAM_OUTOFRANGE,"DocumentDetect.getStatusMsg","status");}processDetectResult(e){if(cl.makeSureDetectResultValid(e,"DocumentDetect.processDetectResult"),[].concat(...e.location).every((e=>0===e)))return {success:!1,confidence:0,status:exports.EnumDocumentDetectionStatus.NOTHING_DETECTED};let t;const o=this.calculateConfidence(e.location,e.width,e.height);t=W(e.confidence)?this.calculateTotalConfidence(o):e.confidence;const r={success:!0,location:e.location,confidence:t},{angleConfidence:n,areaConfidence:a,centerConfidence:l}=o,{config:h}=e;if(t>=(null==h?void 0:h.acceptedPolygonConfidence))if(s(this,eh,i(this,eh)+1),r.status=exports.EnumDocumentDetectionStatus.GOOD,i(this,eh),5===i(this,eh)||i(this,eh),null!=h&&h.enableAutoCapture)if(i(this,ih)<=0)s(this,ih,(new Date).getTime());else {(new Date).getTime()-i(this,ih)>h.autoCaptureDelay&&(s(this,ih,0),r.status=exports.EnumDocumentDetectionStatus.AUTO_CAPTURE);}else s(this,ih,0);else .45*n+.45*l+10>=(null==h?void 0:h.acceptedPolygonConfidence)?(u(this,rh,mh).call(this),r.status=exports.EnumDocumentDetectionStatus.SMALL_SIZE):.45*n+.45*a+10>=(null==h?void 0:h.acceptedPolygonConfidence)?(u(this,rh,mh).call(this),r.status=exports.EnumDocumentDetectionStatus.OFF_CENTER):.45*a+.45*l+10>=(null==h?void 0:h.acceptedPolygonConfidence)?(u(this,rh,mh).call(this),r.status=exports.EnumDocumentDetectionStatus.SKEW):(r.success=!1,r.status=exports.EnumDocumentDetectionStatus.NOTHING_DETECTED,s(this,th,i(this,th)+1),s(this,ih,0));return i(this,th)>5&&u(this,rh,mh).call(this),r.statusMsg=this.getStatusMsg(r.status),r}calculateConfidence(e,t,i){const s="DocumentDetect.calculateConfidence";return cl.makeSureValid(cl.quadIsValid(e),s,"location"),cl.makeSureNumberValid(t,1,void 0,s,"width"),cl.makeSureNumberValid(i,1,void 0,s,"height"),u(this,nh,vh).call(this,u(this,sh,ph).call(this,e),t,i)}calculateTotalConfidence(e){cl.makeSureValid(cl.docDetectConfIsValid(e),"DocumentDetect.calculateTotalConfidence","conf");const{angleConfidence:t,areaConfidence:i,centerConfidence:s}=e;return t&&i&&s?.3*t+.3*i+.3*s+10:0}}function ph(e){if(!e)return [0,0,0,0,0,0,0,0];return [e[0][0],e[0][1],e[1][0],e[1][1],e[2][0],e[2][1],e[3][0],e[3][1]]}function mh(){s(this,eh,0),s(this,th,0),s(this,ih,0);}function vh(e,t,i){return {angleConfidence:u(this,ah,yh).call(this,e),areaConfidence:u(this,lh,wh).call(this,e,t,i),centerConfidence:u(this,hh,bh).call(this,e,t,i)}}function yh(e){let t=0;const i=u(this,dh,Ch).call(this,[e[0],e[1]],[e[2],e[3]],[e[4],e[5]]),s=u(this,dh,Ch).call(this,[e[2],e[3]],[e[4],e[5]],[e[6],e[7]]),o=u(this,dh,Ch).call(this,[e[4],e[5]],[e[6],e[7]],[e[0],e[1]]),r=u(this,dh,Ch).call(this,[e[6],e[7]],[e[0],e[1]],[e[2],e[3]]);return t+=Math.abs(i-90),t+=Math.abs(s-90),t+=Math.abs(o-90),t+=Math.abs(r-90),Math.max(0,100*Math.min(1,1-.025*t))}function wh(e,t,i){const s=u(this,gh,Ph).call(this,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);return Math.min(100,400*Math.max(0,s/(t*i)))}function bh(e,t,i){const s=[(e[0]+e[2]+e[4]+e[6])/4,(e[1]+e[3]+e[5]+e[7])/4],o=u(this,ch,xh).call(this,s,[t/2,i/2]);return Math.max(0,100*Math.min(1,1-o/Math.min(t,i)))}function xh(e,t){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}function Ch(e,t,i){const s=u(this,ch,xh).call(this,t,e),o=u(this,ch,xh).call(this,t,i),r=u(this,ch,xh).call(this,e,i);return 0===s||0===o?0:Math.acos((s*s+o*o-r*r)/(2*s*o))/Math.PI*180}function Sh(e,t,i,s,o,r){return (e*s+t*o+i*r-o*s-r*e-i*t)/2}function Ph(e,t,i,s,o,r,n,a){return u(this,uh,Sh).call(this,e,t,i,s,o,r)+u(this,uh,Sh).call(this,e,t,o,r,n,a)}var Th=new WeakMap,kh=new WeakMap,Dh=new WeakMap,Eh=new WeakSet,Ah=new WeakSet;class Ih{constructor(e){p(this,Ah),p(this,Eh),f(this,Th,{writable:!0,value:void 0}),f(this,kh,{writable:!0,value:void 0}),f(this,Dh,{writable:!0,value:!1}),s(this,Th,e);}async applyFilter(e,t,o,r){4===arguments.length&&0===cl.imageDataIsValid(e).length?i(this,Th).data!==e.data&&(this.destroy(),s(this,Th,e)):(r=o,o=t,t=e);const n=u(this,Eh,Mh).call(this,t,o),a=u(this,Ah,Rh).call(this,r);i(this,kh)||s(this,kh,new Io);const l={inputImageInfo:void 0,output:void 0,outputImageInfo:void 0,outputContentType:"",outputType:void 0};if(i(this,Dh)||(await Ka(i(this,Th),i(this,kh),l),s(this,Dh,!0)),t===Ha.NONE){const e=await el(i(this,kh),i(this,Th).type===exports.EnumImageDataType.RGBA,a.type,a.params);l.outputImageInfo=e.outputImageInfo,l.output=e.output,l.outputContentType=e.outputContentType,l.outputType=e.outputType;}else {const e=await i(this,kh).filter(tl.get(t),n,a.params);l.outputImageInfo=Ja(e),l.output=e.imageData,l.outputContentType=e.blobType,l.outputType=za(e.imageType);}return l}destroy(){if(s(this,Dh,!1),s(this,Th,void 0),i(this,kh))try{const e=i(this,kh);s(this,kh,void 0),e.terminate();}catch(e){Zl.OutputWarning(e);}}}function Mh(e,t){let i={};switch(B(t)&&(i={...t}),e){case Ha.BLACK_AND_WHITE:case Ha.GRAY:case Ha.REMOVE_SHADOW:case Ha.ENHANCE:case Ha.INVERT:break;case Ha.SAVE_INK:i.method="adaptiveThreshold";break;case Ha.CONTRAST:i.brightness=void 0,G(t)&&(i.contrast=t);break;case Ha.BRIGHTNESS:i.contrast=void 0,G(t)&&(i.brightness=t);break;case Ha.BRIGHTNESS_AND_CONTRAST:L(t)&&t.length>1&&([i.brightness,i.contrast]=t);}return i}function Rh(e){var t;const s={};return e?(s.type=e.type,s.params=e.params):s.type=i(this,Th).type,s.params||(s.params={}),s.params.returnType=Fa(s.type),s.params.bRGBA=s.type===exports.EnumImageDataType.RGBA,s.params.returnBlob=null!==(t=s.params.returnBlob)&&void 0!==t&&t,s.params.bRGBA&&void 0===s.params.returnType?s.params.returnType=Je.IT_JPG:s.params.returnType=void 0!==s.params.returnType?s.params.returnType:Je.IT_ALL,s.params.is1BitTo8Bit=Rl.isApple,s}var Oh=new WeakMap,_h=new WeakSet;class Nh{constructor(e){p(this,_h),f(this,Oh,{writable:!0,value:void 0}),e&&(u(this,_h,Lh).call(this,e),s(this,Oh,new Ih(e)));}async applyFilter(e,t){const s="ImageFilterHandler.apply";let o,r=!0,n=i(this,Oh);$(e)?(cl.makeSureValid(cl.filterTypeIsValid(e),s,"type"),t=e,n||u(this,_h,Lh).call(this,void 0),r=!1):(cl.makeSureValid(cl.imageDataIsValid(e),s,"image"),cl.makeSureValid(cl.filterTypeIsValid(t),s,"type"),n=new Ih(e)),o||(o=this.queryParams(t));try{const e=await n.applyFilter(t,o,void 0);if(r){return new Blob([e.output],{type:e.outputContentType})}return e.output}catch(e){Zl.throw(e,s);}finally{n!==i(this,Oh)&&n.destroy();}}queryParams(e){}get defaultFilterType(){return Ha.NONE}querySupported(){return [{type:Ha.NONE,label:"Original"},{type:Ha.BLACK_AND_WHITE,label:"B&W"},{type:Ha.GRAY,label:"Grayscale"},{type:Ha.SAVE_INK,label:"Save Toner"}]}destroy(){var e;null===(e=i(this,Oh))||void 0===e||e.destroy(),s(this,Oh,null);}}function Lh(e){cl.makeSureValid(cl.imageDataIsValid(e),"ImageFilterHandler.constructor","image");}const Bh="1.0.0";var Uh;!function(e){e[e.publicTrial=0]="publicTrial",e[e.privateTrial=1]="privateTrial",e[e.normal=2]="normal";}(Uh||(Uh={}));var Wh=new WeakMap,Vh=new WeakMap,Fh=new WeakMap,zh=new WeakMap,Hh=new WeakMap,jh=new WeakMap,Gh=new WeakMap,$h=new WeakMap,Xh=new WeakSet,Yh=new WeakSet,qh=new WeakSet,Qh=new WeakSet,Zh=new WeakSet,Jh=new WeakSet;class Kh{constructor(e){p(this,Jh),p(this,Zh),p(this,Qh),p(this,qh),p(this,Yh),p(this,Xh),f(this,Wh,{writable:!0,value:void 0}),f(this,Vh,{writable:!0,value:void 0}),f(this,Fh,{writable:!0,value:void 0}),f(this,zh,{writable:!0,value:void 0}),f(this,Hh,{writable:!0,value:void 0}),f(this,jh,{writable:!0,value:void 0}),f(this,Gh,{writable:!0,value:void 0}),f(this,$h,{writable:!0,value:void 0}),s(this,Vh,void 0),s(this,Wh,void 0),s(this,Fh,""),s(this,zh,""),s(this,jh,Uh.publicTrial),s(this,$h,void 0),s(this,Gh,"");const t=zo({_pLoad:{isEmpty:!0},_license:e,_licenseServer:[]},!0);let o;if(t&&$(t.l)?(o=t.l.trim(),1===t.lt?s(this,jh,Uh.publicTrial):2===t.lt?s(this,jh,Uh.privateTrial):s(this,jh,Uh.normal)):(o="",s(this,jh,Uh.publicTrial)),""===o?s(this,Wh,o):o.includes("-")?s(this,Vh,o):s(this,Wh,o),L(t.ls)){t.ls.length>0&&s(this,$h,t.ls);const e=i(this,$h);let r,n;if(e&&e.length>0){for(r=0;r<e.length;r++)n=e[r],n.endsWith("/")||(e[r]=`${n}/`);u(this,Xh,ec).call(this,e,o)&&s(this,jh,Uh.publicTrial);}}s(this,Gh,t.sp);}async init(e,t){let s=e;s.endsWith("/")||(s=`${s}/`),i(this,Hh)||await u(this,qh,ic).call(this,t);try{await u(this,Jh,rc).call(this);}catch(e){const t=function(e){let t;if(e){let i,s=e.message;i=e.ltsErrorCode,G(i)?111===i?i=Zl.LIC_EXPIRED.code:106===i||108===i?i=Zl.LIC_INVALID.code:i>0&&(i=-(2e4+i)):i=Zl.LIC_INVALID.code,s=s.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-capture-vision-router/#javascript)"),t={code:i,message:s};}else t=Zl.LIC_INVALID;return t}(e);let i=!1;t.code===Zl.LIC_EXPIRED.code?-1!==t.message.toLowerCase().indexOf("trial license")&&(i=!0):this.isPublicTrial()&&(i=!0),i&&Ho({_bNeverShowDialog:!1,engineResourcePath:s,_onLog:console.log},"error",t.message),Zl.throw(t);}}getClientUUID(){return i(this,zh)}getAuthResult(){return i(this,Fh)}isPublicTrial(){return i(this,jh)===Uh.publicTrial}setClientUUID(e){s(this,zh,e);}setAuthResult(e){s(this,Fh,e);}}function ec(e,t){let i=!0;if(L(e)&&e.length>0){const t=e[0];$(t)&&""!==t&&!t.includes("https://mlts.dynamsoft.com")&&(i=!1);}return i&&(!t||"200001"===t||t.startsWith("200001-"))}function tc(){return window.location.origin?window.location.origin.startsWith("http")?window.location.origin:"https://localhost":window.location.href.startsWith("http")?window.location.href:"https://localhost"}function ic(e){const t={dm:u(this,Yh,tc).call(this),fetch:window.fetch};e&&(t.bd=!0,t.log=console.log),s(this,Hh,Mr(t));}function sc(){return this.isPublicTrial()?"":i(this,Vh)||i(this,Wh)}function oc(){const e=[];return e.push(Vo.browser),e.push(Vo.version.toString()),e.push(Vo.OS),e.join(" ")}async function rc(){if(this.getAuthResult()&&this.getClientUUID())return {ar:this.getAuthResult(),cu:this.getClientUUID()};const e={pd:"ddv",dt:"browser",v:Bh,os:u(this,Zh,oc).call(this),l:u(this,Qh,sc).call(this),ls:i(this,$h),sp:i(this,Gh),mnet(){},mxet(){}};""!==this.getClientUUID()&&(e.lsu=this.getClientUUID()),e.updateLicense=e=>{this.setAuthResult(e.ar),this.getClientUUID()||this.setClientUUID(e.cu);};const t=await i(this,Hh).i(e);return this.getAuthResult()||this.setAuthResult(t.ar),this.getClientUUID()||this.setClientUUID(t.cu),t}class nc{static init(){n(this,nc,hc,void 0),n(this,nc,cc,void 0),n(this,nc,dc,"init");}static setLicenseInfo(e){var t;n(this,nc,dc,"done"),n(this,nc,hc,[]),n(this,nc,hc,null!==(t=null==e?void 0:e.modules)&&void 0!==t?t:[]);}static setLicenseErr(e){n(this,nc,cc,e),n(this,nc,dc,"done");}static makeSureLoadLicenseExist(){return a(this,nc,lc).call(this,3101,5001)}static makeSureCoreLicenseExist(){return a(this,nc,lc).call(this,3101)}static makeSureCameraLicenseExist(){return a(this,nc,lc).call(this,3006,8002)}}function ac(e){for(const t of r(this,Na,hc))if(t.module===e)return t;return {code:Zl.LIC_MISSMODULE.code,message:Zl.LIC_MISSMODULE.message,module:e}}function lc(e,t){""===r(this,Na,dc)&&Zl.throw(Zl.INIT_SHOULDSETCONFIG),"done"!==r(this,Na,dc)&&Zl.throw(Zl.INIT_CONFIGNOTDONE),r(this,Na,cc)&&Zl.throw(r(this,Na,cc));const i=a(this,Na,ac).call(this,e);0!==i.code&&(!t||t&&0!==a(this,Na,ac).call(this,t).code)&&Zl.throw({code:i.code,message:i.message});}Na=nc;var hc={writable:!0,value:void 0},cc={writable:!0,value:void 0},dc={writable:!0,value:""};async function uc(e){let t=e.engineResourcePath.trim();t.endsWith("/")||(t=`${t}/`),Rl.resourceDir=t;await Rl.isResourceDirValid()||cl.makeSureValid(cl.configIsValid({license:"",engineResourcePath:""}),"DDV.setConfig","DDV.setConfig"),nc.init();const i=e.license.trim(),s=i.startsWith("DLS")||0===i.length;let o,r,n=!1;if(s)try{const e=await async function(e,t,i){const s=new Kh(e);return await s.init(t,i),{authResult:s.getAuthResult(),clientUUID:s.getClientUUID(),bPublicTrial:s.isPublicTrial()}}(i,t);o=e.authResult,r=e.clientUUID,n=e.bPublicTrial;}catch(e){throw nc.setLicenseErr(e),e}else o=i,r="";const a={licenseInfo:""};try{const e=await Rl.getLicenseInfo(o,s,r);a.licenseInfo=e,nc.setLicenseInfo(e),n&&e.trial&&e.msg&&Ho({_bNeverShowDialog:!1,engineResourcePath:t,_onLog:console.log},"warn",e.msg);}catch(e){throw e&&e.code<=-8e4&&nc.setLicenseErr(e),e}return s&&(a.deviceId=r),a}const gc={scrollToLatest:!1};class fc{constructor(e){t(this,"viewerUids",void 0),t(this,"groupUid",void 0),t(this,"config",void 0),t(this,"isSetScrollToLatest",!1),this.groupUid=e,this.viewerUids=new Set,this.config=gc;}getViewerUids(){return [...this.viewerUids.values()]}updateConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this.config,e);}}class pc{constructor(e){t(this,"maxConcurrency",void 0),t(this,"currentConcurrency",void 0),t(this,"queue",void 0),this.maxConcurrency=e,this.currentConcurrency=0,this.queue=[];}async acquire(){return new Promise((e=>{this.currentConcurrency<this.maxConcurrency?(this.currentConcurrency+=1,e(!0)):this.queue.push(e);}))}release(){if(this.queue.length>0){this.queue.shift()();}else this.currentConcurrency-=1;}}class mc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;t(this,"tasks",void 0),t(this,"semaphore",void 0),this.tasks=[],this.semaphore=new pc(e);}async process(e){await this.semaphore.acquire();let t=null;if(e.cancelled||(t=await this.handler(e.taskUid)),e.completed=!0,this.tasks.includes(e)){const t=this.tasks.indexOf(e);this.tasks.splice(t,1);}e.emitter.emit(e.taskUid,t),this.semaphore.release();}async executeTask(e){return new Promise(((t,i)=>{let s=this.tasks.find((t=>t.taskUid===e));s||(s={taskUid:e,emitter:new J,completed:!1,cancelled:!1,running:!1},this.tasks.push(s)),s.emitter.on(e,(e=>{t(e);})),s.running||(s.running=!0,this.process(s));}))}cancel(e){const t=this.tasks.find((t=>t.taskUid===e));t&&(t.cancelled=!0);}destroy(){this.tasks=[];}async handler(e){return Promise.resolve(null)}}class vc extends mc{async handler(e){return new Promise(((t,i)=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{s.onload=null,s.onerror=null,t(s);},s.onerror=e=>{s.onload=null,s.onerror=null,t(null);},s.src=e;}))}}class yc extends vc{constructor(e,i){super(),t(this,"core",void 0),t(this,"imageLoader",void 0),this.core=e,this.imageLoader=i;}async handler(e){let t=this.core.pageService.getPage(e);if(!t||t.isDestroyed)return null;let{img:i}=t.raw;if(!i){let{url:s}=t.raw;if(!s){let i=t.raw.data;if(!i){let s=await this.core.imageDataService.getRaw(e);const o=this.core.pageService.getPage(e);if(!o)return null;if(t.isDestroyed&&!o.isDestroyed&&(s=await this.core.imageDataService.getRaw(e,!0)),!s||o.isDestroyed)return null;i=s.data;}s=URL.createObjectURL(i),t.raw.url=s;}if(i=await this.imageLoader.executeTask(s),t=this.core.pageService.getPage(e),!t||t.isDestroyed)return null;t.raw.img=i;}return i}}class wc extends vc{constructor(e,i){super(),t(this,"core",void 0),t(this,"imageLoader",void 0),this.core=e,this.imageLoader=i;}async handler(e){var t;let i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;let s=null===(t=i.original)||void 0===t?void 0:t.img;if(!s){var o;let t=null===(o=i.original)||void 0===o?void 0:o.url;if(!t){var r;let s=null===(r=i.original)||void 0===r?void 0:r.data;if(!s){let t=await this.core.imageDataService.getOriginal(e);const o=this.core.pageService.getPage(e);if(!o)return null;if(i.isDestroyed&&!o.isDestroyed&&(t=await this.core.imageDataService.getRaw(e,!0)),!t||o.isDestroyed)return null;s=t.data;}t=URL.createObjectURL(s),i.original.url=t;}if(s=await this.imageLoader.executeTask(t),i=this.core.pageService.getPage(e),!i||i.isDestroyed)return null;i.original.img=s;}return s}}class bc extends vc{constructor(e,i){super(),t(this,"core",void 0),t(this,"imageLoader",void 0),this.core=e,this.imageLoader=i;}async handler(e){var t;let i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;let s=null===(t=i.display)||void 0===t?void 0:t.img;if(!s){var o;let t=null===(o=i.display)||void 0===o?void 0:o.url;if(!t){var r;let s=null===(r=i.display)||void 0===r?void 0:r.data;if(!s){let t=await this.core.imageDataService.getDisplay(e,!0);const o=this.core.pageService.getPage(e);if(!o)return null;if(i.isDestroyed&&!o.isDestroyed&&(t=await this.core.imageDataService.getDisplay(e,!0)),!t||o.isDestroyed)return null;s=t.data;}t=URL.createObjectURL(s),i.display.url=t;}const{filter:n}=i;if(s=await this.imageLoader.executeTask(t),i=this.core.pageService.getPage(e),!i||i.isDestroyed)return null;if(n!==i.filter)return this.handler(i.uid);i.display.img=s;}return s}}class xc extends vc{constructor(e,i){super(),t(this,"core",void 0),t(this,"imageLoader",void 0),this.core=e,this.imageLoader=i;}async handler(e){var t;let i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;let s=null===(t=i.thumbnail)||void 0===t?void 0:t.img;if(!s){var o;let t=null===(o=i.thumbnail)||void 0===o?void 0:o.url;if(!t){var r;let s=null===(r=i.thumbnail)||void 0===r?void 0:r.data;if(!s){const t=await this.core.imageDataService.getThumbnail(e);if(i=this.core.pageService.getPage(e),!t||i.isDestroyed)return null;s=t.data;}t=URL.createObjectURL(s),i.thumbnail.url=t;}if(s=await this.imageLoader.executeTask(t),i=this.core.pageService.getPage(e),i.isDestroyed)return null;i.thumbnail.img=s;}return s}}class Cc{constructor(e){t(this,"rawImageLoader",void 0),t(this,"originalImageLoader",void 0),t(this,"displayImageLoader",void 0),t(this,"thumbnailImageLoader",void 0);const i=new vc;this.rawImageLoader=new yc(e,i),this.originalImageLoader=new wc(e,i),this.displayImageLoader=new bc(e,i),this.thumbnailImageLoader=new xc(e,i);}async loadRawImage(e){return this.rawImageLoader.executeTask(e)}async loadOriginalImage(e){return this.originalImageLoader.executeTask(e)}async loadDisplayImage(e){return this.displayImageLoader.executeTask(e)}async loadThumbnailImage(e){return this.thumbnailImageLoader.executeTask(e)}}function Sc(){onmessage=e=>{const{core:t}=e.data,i=e.data.sourceWidth,s=e.data.sourceHeight,o=e.data.width,r=e.data.height,n=e.data.source.data,a=o*r*4,l=new ArrayBuffer(a);let h=null;try{h=new Uint8ClampedArray(l,0,a);}catch(e){h=new Uint8Array(l,0,a);}for(let e=0;e<r;e++){const t=e*s/r,a=Math.floor(t),l=1-(t-a),c=a,d=(e+1)*s/r,u=Math.floor(d-1e-5),g=d-u,f=u;let p=e*o*4;for(let e=0;e<o;e++){const t=e*i/o,s=Math.floor(t),r=1-(t-s),a=s,d=(e+1)*i/o,u=Math.floor(d-1e-5),m=d-u,v=u;let y=0,w=0,b=0,x=0,C=0;const S=255;let P,T,k=(c+1)*i*4+4*a;for(P=c+1;P<f;++P){const e=S;y+=n[k+2]*r*e,w+=n[k+1]*r*e,b+=n[k]*r*e,x+=n[k+3]*r*e,C+=S*r,k+=4*i;}let D=(c+1)*i*4+4*v;for(P=c+1;P<f;++P){const e=S;y+=n[D+2]*m*e,w+=n[D+1]*m*e,b+=n[D]*m*e,x+=n[D+3]*m*e,C+=S*m,D+=4*i;}let E=c*i*4+4*(a+1);for(T=a+1;T<v;++T){const e=S;y+=n[E+2]*l*e,w+=n[E+1]*l*e,b+=n[E]*l*e,x+=n[E+3]*l*e,C+=S*l,E+=4;}let A=f*i*4+4*(a+1);for(T=a+1;T<v;++T){const e=S;y+=n[A+2]*g*e,w+=n[A+1]*g*e,b+=n[A]*g*e,x+=n[A+3]*g*e,C+=S*g,A+=4;}for(P=c+1;P<f;++P){let e=P*i*4+4*(a+1);for(T=a+1;T<v;++T){const t=S;y+=n[e+2]*t,w+=n[e+1]*t,b+=n[e]*t,x+=n[e+3]*t,C+=t,e+=4;}}let I=c*i*4+4*a;const M=S;y+=n[I+2]*(l*r)*M,w+=n[I+1]*(l*r)*M,b+=n[I]*(l*r)*M,x+=n[I+3]*(l*r)*M,C+=S*(l*r),I=c*i*4+4*v;const R=S;y+=n[I+2]*(l*m)*R,w+=n[I+1]*(l*m)*R,b+=n[I]*(l*m)*R,x+=n[I+3]*(l*m)*R,C+=S*(l*m),I=f*i*4+4*a;const O=S;y+=n[I+2]*(g*r)*O,w+=n[I+1]*(g*r)*O,b+=n[I]*(g*r)*O,x+=n[I+3]*(g*r)*O,C+=S*(g*r),I=f*i*4+4*v;const _=S;y+=n[I+2]*(g*m)*_,w+=n[I+1]*(g*m)*_,b+=n[I]*(g*m)*_,x+=n[I+3]*(g*m)*_,C+=S*(g*m);let N=x/C,L=0,B=0,U=0;0!==N&&(L=y/C,B=w/C,U=b/C),L+=.5,B+=.5,U+=.5,N+=.5,h[p]=Math.floor(U),p+=1,h[p]=Math.floor(B),p+=1,h[p]=Math.floor(L),p+=1,h[p]=Math.floor(N),p+=1;}}const c={core:t,target:h,taskUid:e.data.taskUid,callbackId:e.data.callbackId};try{postMessage(c,[h.buffer]);}catch(e){postMessage(c,null);}h=null;};}class Pc{constructor(e,i,s){t(this,"worker",void 0),t(this,"id",void 0),t(this,"manager",void 0),t(this,"callbacks",{}),t(this,"busy",!1),t(this,"counter",0),t(this,"tasks",[]),this.worker=e,this.id=i,this.manager=s,this.worker.addEventListener("message",(e=>{this.onMessage(e);}),!1);}setBusy(e){if(this.busy=e,!e)if(this.tasks.length){const e=this.tasks.shift();this.send(e);}else this.worker.terminate(),this.manager.removeActor(this);}isBusy(){return this.busy}getWorker(){return this.worker}onMessage(e){this.setBusy(!1);const{callbackId:t}=e.data,i=t?this.callbacks[t]:null;i&&i(e.data),delete this.callbacks[t];}send(e,t){if(this.busy)return void this.tasks.push({...e});this.setBusy(!0);const i=`${this.id}-${e.action}-cb-${this.counter}`;e.callback&&(this.callbacks[i]=e.callback,this.counter+=1),e.callbackId=i;const s={...e.data,callbackId:i};t?this.worker.postMessage(s,[t]):this.worker.postMessage(s);}}class Tc{constructor(e,i){t(this,"concurrency",1),t(this,"actors",[]),t(this,"workerUrl",void 0),this.workerUrl=e,this.concurrency=i;}send(e,t){this.getActor().send(e,t);}getActor(){const e=this.actors.filter((e=>!e.isBusy()))[0];if(e)return e;if(this.actors.length<this.concurrency){const e=new Worker(this.workerUrl),t=new Pc(e,this.actors.length,this);return this.actors.push(t),t}const t=Math.floor(Math.random()*this.concurrency);return this.actors[t]}removeActor(e){const t=this.actors.indexOf(e);this.actors.splice(t,1);}clear(){for(const e of this.actors)e.getWorker().terminate();this.actors=[];}}class kc{constructor(){t(this,"actorSystem",void 0),t(this,"hermiteWorkerUrl",void 0),t(this,"concurrency",3),this.createWorkerUlr(),this.actorSystem=new Tc(this.hermiteWorkerUrl,this.concurrency);}createWorkerUlr(){this.hermiteWorkerUrl=window.URL.createObjectURL(new Blob(["(",Sc.toString(),")()"],{type:"application/javascript"}));}}var Dc;!function(e){e.IMAGE_PNG="image/png",e.IMAGE_JPEG="image/jpeg",e.IMAGE_BMP="image/bmp",e.IMAGE_TIFF="image/tiff",e.IMAGE_JP2="image/jp2",e.APPLICATION_PDF="application/pdf";}(Dc||(Dc={}));let Ec=0;const Ac=()=>{const e=`doc-${Date.now().toString()}-${Ec.toString()}`;return Ec+=1,e};class Ic{constructor(){var e,i,s;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,"type",void 0),t(this,"uid",void 0),t(this,"name",void 0),t(this,"pages",void 0),t(this,"tags",void 0),t(this,"creationDate",void 0),t(this,"author",void 0),t(this,"isDestroyed",void 0),this.uid=q(),this.name=null!==(e=o.name)&&void 0!==e?e:Ac(),this.type=o.type||"document",this.pages=[],this.tags=o.tags||[],this.creationDate=null!==(i=o.creationDate)&&void 0!==i?i:((e,t)=>{var i;e=null!==(i=e)&&void 0!==i?i:"yyyy-MM-dd hh:mm:ss";const s=W(t)?new Date:new Date(t),o={"M+":(s.getMonth()+1).toString(),"d+":s.getDate().toString(),"h+":s.getHours().toString(),"m+":s.getMinutes().toString(),"s+":s.getSeconds().toString(),"q+":Math.floor((s.getMonth()+3)/3).toString(),S:s.getMilliseconds().toString()};return /(y+)/.test(e)&&(e=e.replace(RegExp.$1,`${s.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(o).forEach((t=>{new RegExp(`(${t})`).test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?o[t]:`00${o[t]}`.substring(`${o[t]}`.length)));})),e})("yyyyMMddhhmmss",new Date),this.author=null!==(s=o.author)&&void 0!==s?s:"";}destroy(){this.isDestroyed=!0;}}class Mc{constructor(){t(this,"users",void 0),this.users=[];}addUser(e){this.users.push(e);}deleteUser(e){const t=this.users.indexOf(e);t>-1&&this.users.splice(t,1);}}class Rc{constructor(e){let{uid:i,mime:s,pageCount:o}=e;t(this,"uid",void 0),t(this,"mime",void 0),t(this,"pageCount",void 0),t(this,"name",void 0),t(this,"count",void 0),t(this,"pages",void 0),this.uid=i,this.mime=s,this.count=0,this.pages=[],this.pageCount=o;for(let e=0;e<o;e++){const e=new Mc;this.pages.push(e);}}getPageByIndex(e){return this.pages[e]}addUser(e,t){const i=this.pages[e];return !!i&&(i.addUser(t),this.count+=1,!0)}deleteUser(e,t){const i=this.pages[e];return !!i&&(i.deleteUser(t),this.count-=1,!0)}}function Oc(e,t,i,s){if(0===(t=(t%360+360)%360))return e;const o=t/90;for(let t=0;t<4;t++){const r=e[2*t],n=e[2*t+1];1===o?(e[2*t]=n,e[2*t+1]=s-r):2===o?(e[2*t]=i-r,e[2*t+1]=s-n):3===o&&(e[2*t]=i-n,e[2*t+1]=r);}return Lc(e,8-2*o),e}function _c(e,t,i,s){if(0===(t=(t%360+360)%360))return e;const o=t/90;for(let t=0;t<4;t++){const r=e[2*t],n=e[2*t+1];1===o?(e[2*t]=s-n,e[2*t+1]=r):2===o?(e[2*t]=i-r,e[2*t+1]=s-n):3===o&&(e[2*t]=n,e[2*t+1]=i-r);}return Lc(e,2*o),e}function Nc(e,t,i){for(;t<i;){const s=e[t];e[t]=e[i],e[i]=s,t+=1,i-=1;}}function Lc(e,t){const i=t%e.length;0!==i&&(Nc(e,0,e.length-1),Nc(e,0,i-1),Nc(e,i,e.length-1));}const Bc=e=>Array(4).fill(0).map(((t,i)=>[e[2*i],e[2*i+1]])),Uc=(e,t,i)=>0===e[0][0]&&0===e[0][1]&&e[1][0]===t&&0===e[1][1]&&e[2][0]===t&&e[2][1]===i&&0===e[3][0]&&e[3][1]===i;class Wc{constructor(e){t(this,"data",void 0),t(this,"width",void 0),t(this,"height",void 0),t(this,"url",void 0),t(this,"img",void 0),t(this,"users",void 0),t(this,"isDestroyed",void 0),t(this,"isAvailable",void 0),t(this,"pageWidth",void 0),t(this,"pageHeight",void 0),t(this,"docPage",void 0),this.isDestroyed=!1,this.users=[],this.isAvailable=!1,this.docPage=e;}getImageDetail(){const{docPage:e}=this;return {data:this.data,width:this.width,height:this.height,pageWidth:this.pageWidth,pageHeight:this.pageHeight,resolutionX:e.resolutionX,resolutionY:e.resolutionY,displayResolutionX:e.displayResolutionX,displayResolutionY:e.displayResolutionY,url:this.url,img:this.img}}getPageSize(){return {width:this.pageWidth,height:this.pageHeight}}updateImageDetail(e){if(!e)return;e.data&&(this.isAvailable=!0,this.data=e.data);const{docPage:t}=this;this.width=e.width,this.height=e.height,this.pageWidth=e.width/t.resolutionX*t.displayResolutionX,this.pageHeight=e.height/t.resolutionY*t.displayResolutionY;}addUser(e){this.getUserIndex(e)<0&&this.users.push(e);}deleteUser(e){const t=this.getUserIndex(e);t>-1&&this.users.splice(t,1);}reset(){this.resetBlob(),this.resetImg();}resetBlob(){this.isAvailable=!1,this.data=null,this.width=0,this.height=0,this.url&&URL.revokeObjectURL(this.url),this.url=null;}resetImg(){this.img&&(this.img.src=""),this.img=null;}getUserIndex(e){return this.users.findIndex((t=>{let{viewerUid:i,docUid:s,pageUid:o}=t;return i===e.viewerUid&&s===e.docUid&&o===e.pageUid}))}destroy(){this.isDestroyed=!0,this.isAvailable=!1,this.reset();}}function Vc(e){const t=function(e){const t=[...e];t.sort(((e,t)=>t[1]-e[1]));let i=Number.MAX_SAFE_INTEGER,s=0;e.forEach(((e,t)=>{e[1]<i&&([,i]=e,s=t);}));const o=(s+3)%4,r=(s+1)%4,n=Fc(e[o],e[s]),a=Fc(e[r],e[s]);if(a>n)return o;return s}(e),i=e.map(((t,i)=>{let s=e[i+1];return 3===i&&([s]=e),zc(s,t)}));let s=Math.max(i[t],i[(t+2)%4]),o=Math.max(i[(t+1)%4],i[(t+3)%4]);return s=Math.round(s),o=Math.round(o),{width:s,height:o}}function Fc(e,t){const i=Math.abs(e[0]-t[0]),s=zc(e,t);return Math.acos(i/s)}function zc(e,t){return ((e[0]-t[0])**2+(e[1]-t[1])**2)**.5}const Hc=e=>{if(!e)return;e.forEach((e=>{const t=Math.ceil(e[0]);t-e[0]<=1e-7?e[0]=t:e[0]=Math.floor(e[0]);const i=Math.ceil(e[1]);i-e[1]<=1e-7?e[1]=i:e[1]=Math.floor(e[1]);}));};class jc{constructor(e,i,s,o,r,n){let{fileIndex:a,pageUid:l,fileUid:h,width:c,height:d,pageWidth:u,pageHeight:g,resolutionX:f,resolutionY:p,rotation:m,filter:v,perspectiveQuad:y}=e;t(this,"uid",void 0),t(this,"doc",void 0),t(this,"metadata",void 0),t(this,"customData",void 0),t(this,"fileUid",void 0),t(this,"fileIndex",void 0),t(this,"resolutionX",void 0),t(this,"resolutionY",void 0),t(this,"filter",void 0),t(this,"rotation",void 0),t(this,"quad",void 0),t(this,"activeQuad",void 0),t(this,"isFull",void 0),t(this,"raw",void 0),t(this,"original",void 0),t(this,"display",void 0),t(this,"thumbnail",void 0),t(this,"editedDisplay",void 0),t(this,"initRotation",void 0),t(this,"editRotation",void 0),t(this,"actionRotation",void 0),t(this,"actions",void 0),t(this,"pActions",void 0),t(this,"isDestroyed",void 0),t(this,"displayResolutionX",void 0),t(this,"displayResolutionY",void 0),t(this,"enableResolution",void 0),t(this,"core",void 0),this.uid=l,this.doc=i,this.displayResolutionX=s,this.displayResolutionY=o,this.enableResolution=r,this.core=n,this.resolutionX=f,this.resolutionY=p,this.fileIndex=a,this.fileUid=h,this.filter=v,this.rotation=m||0,this.initRotation=m||0,this.editRotation=m||0,this.actionRotation=0,this.isFull=!0,this.raw=new Wc(this),this.original=new Wc(this),this.display=new Wc(this),this.thumbnail=new Wc(this),this.editedDisplay=new Wc(this);let w={width:c,height:d};if(this.raw.updateImageDetail(w),y){w=Vc(y);const e=this.quadToDisplayPPI(y);this.setQuad(e);}if(this.original.updateImageDetail(w),this.display.updateImageDetail(w),this.actions=[],this.pActions=[],G(m)&&m%360){const e={actionUid:q(),type:"rotate",docUid:i.uid,pageUids:[l],options:{angle:m,type:"contain"}};this.pActions.push(e);}}copy(e,t){const i=new jc({...this,...this.raw,pageUid:e},t,this.displayResolutionX,this.displayResolutionY,this.enableResolution,this.core),s=U(this.actions);s.forEach((e=>{e.docUid=t.uid;}));const o=U(this.pActions);return o.forEach((e=>{e.docUid=t.uid;})),i.actions=s,i.pActions=o,i.rotation=this.rotation,i.initRotation=this.initRotation,i.actionRotation=this.actionRotation,i.editRotation=this.editRotation,i.filter=this.filter,i.quad=U(this.quad),i.activeQuad=U(this.activeQuad),i.isFull=this.isFull,i}setQuad(e){const t=this.isQuadFull(e);let i=!1;if(this.isFull=t,t)this.quad&&(i=!0,this.editRotation=this.rotation),this.quad=null,this.activeQuad=null;else {const{width:t,height:s}=this.raw.getPageSize(),o=Oc(e.flat(),this.rotation,t,s),r=Bc(o);let n,a;this.quad&&(a=this.quadToPixelPPI(r),n=this.quadToPixelPPI(this.quad),Hc(n),Hc(a)),this.quad&&this.isEqual(n,a)||(this.quad=r,this.activeQuad=r,i=!0),this.editRotation=this.actionRotation;}return i&&this.clearActions(),i}setActiveQuad(e){const{width:t,height:i}=this.raw.getPageSize();if(!this.isFull){const s=Oc(e.flat(),this.rotation,t,i),o=Bc(s);this.activeQuad=o;}}getQuadVertices(){let e;const{width:t,height:i}=this.raw.getPageSize();return e=this.isFull?[0,0,t,0,t,i,0,i]:this.activeQuad.flat(),e=_c(e,this.rotation,t,i),e}getProcessedQuad(){if(this.quad){let{width:e,height:t}=this.raw.getPageSize(),{quad:i}=this;this.enableResolution&&(i=this.quad.map((e=>[this.toPixelPPI(e[0],!1),this.toPixelPPI(e[1],!0)])),e=this.toPixelPPI(e,!1),t=this.toPixelPPI(t,!0));const s=_c(i.flat(),this.initRotation,e,t);return Bc(s)}return null}toggleFull(){let e=!1;return this.isFull&&this.activeQuad?(this.isFull=!1,e=!0):this.isFull||(this.isFull=!0,e=!0),e}isEqual(e,t){return e.every(((e,i)=>{let[s,o]=e;const[r,n]=t[i];return s===r&&o===n}))}isQuadFull(e){let{width:t,height:i}=this.raw.getPageSize();const s=Math.abs((this.rotation%360+360)%360);if(90===s||270===s){const e=t;t=i,i=e;}return Uc(e,t,i)}getActions(){const e=[...this.actions],{editRotation:t}=this;if(G(t)&&t%360){const i={actionUid:q(),type:"rotate",docUid:this.doc.uid,pageUids:[this.uid],options:{angle:t,type:"contain"}};e.unshift(i);}return e}getPerspectiveActions(){return this.pActions}addAction(e){this.actions.push(e),"rotate"===e.type&&(this.pActions.push(e),this.rotation+=e.options.angle,this.actionRotation+=e.options.angle);}deleteAction(e){var t,i;if((null===(t=this.actions[this.actions.length-1])||void 0===t?void 0:t.actionUid)===e){const e=this.actions.pop();"rotate"===e.type&&(this.actionRotation-=e.options.angle);}if((null===(i=this.pActions[this.pActions.length-1])||void 0===i?void 0:i.actionUid)===e){const e=this.pActions.pop();this.rotation-=e.options.angle;}}clearActions(){this.actions=[];}toDisplayPPI(e,t){const{resolutionX:i,resolutionY:s,displayResolutionX:o,displayResolutionY:r}=this;return t?e/s*r:e/i*o}toPixelPPI(e,t){const{resolutionX:i,resolutionY:s,displayResolutionX:o,displayResolutionY:r}=this;return t?e*s/r:e*i/o}quadToDisplayPPI(e){const t=U(e);if(this.enableResolution)for(let e=0;e<4;e++)t[e][0]=this.toDisplayPPI(t[e][0],!1),t[e][1]=this.toDisplayPPI(t[e][1],!0);return t}quadToPixelPPI(e){const t=U(e);if(this.enableResolution)for(let e=0;e<4;e++)t[e][0]=this.toPixelPPI(t[e][0],!1),t[e][1]=this.toPixelPPI(t[e][1],!0);return t}rectToDisplayPPI(e){const t={...e};return this.enableResolution&&(t.left=this.toDisplayPPI(e.left,!1),t.top=this.toDisplayPPI(e.top,!0),t.width=this.toDisplayPPI(e.width,!1),t.height=this.toDisplayPPI(e.height,!0)),t}rectToPixelPPI(e){const t={...e};return this.enableResolution&&(t.left=this.toPixelPPI(e.left,!1),t.top=this.toPixelPPI(e.top,!0),t.width=this.toPixelPPI(e.width,!1),t.height=this.toPixelPPI(e.height,!0)),t}destroy(){this.raw.reset(),this.original.reset(),this.display.reset(),this.thumbnail.reset(),this.isDestroyed=!0;}}var Gc=new WeakMap,$c=new WeakMap,Xc=new WeakMap,Yc=new WeakMap,qc=new WeakSet;class Qc{async getPageCount(e,t){return s(this,Xc,{fileSource:e}),1}constructor(){p(this,qc),t(this,"once",!1),f(this,Gc,{writable:!0,value:void 0}),f(this,$c,{writable:!0,value:!1}),f(this,Xc,{writable:!0,value:void 0}),f(this,Yc,{writable:!0,value:void 0}),s(this,Gc,new co);}destroy(){if(i(this,Gc))try{i(this,Gc).destroy(),s(this,Gc,void 0),s(this,$c,!0);}catch(e){Zl.OutputWarning(e);}}async parse(e,t,o){if(u(this,qc,Zc).call(this))return null;s(this,Yc,null!=o?o:{});const r=await i(this,Gc).readImageInfo(i(this,Xc));return [{width:r.imageWidth,height:r.imageHeight,fileIndex:0,bitDepth:r.imageBitDepth,resolutionX:r.imageXResolution,resolutionY:r.imageYResolution}]}async getPage(e){if(u(this,qc,Zc).call(this))return null;const{outputType:t,jpegQuality:s,returnBase64:o}=i(this,Yc),r=await i(this,Gc).readImage(i(this,Xc),t,s,o,Rl.isApple);if(r){return {width:r.imageWidth,height:r.imageHeight,data:r.imageData,fileIndex:0,bitDepth:r.imageBitDepth,resolutionX:r.imageXResolution,resolutionY:r.imageYResolution}}return null}cancelGetPage(e){if(u(this,qc,Zc).call(this))return;const{outputType:t}=i(this,Yc);i(this,Gc).cancelReadImage(i(this,Xc),t);}}function Zc(){return !(!i(this,$c)&&i(this,Gc)&&i(this,Xc))}var Jc=new WeakMap,Kc=new WeakMap,ed=new WeakMap,td=new WeakMap,id=new WeakMap,sd=new WeakSet,od=new WeakSet,rd=new WeakSet,nd=new WeakSet,ad=new WeakSet;class ld{constructor(){p(this,ad),p(this,nd),p(this,rd),p(this,od),p(this,sd),t(this,"once",!1),f(this,Jc,{writable:!0,value:void 0}),f(this,Kc,{writable:!0,value:{convertMode:exports.EnumConvertMode.CM_AUTO}}),f(this,ed,{writable:!0,value:void 0}),f(this,td,{writable:!0,value:void 0}),f(this,id,{writable:!0,value:!1}),s(this,Jc,new Mo);}async getPageCount(e,t){s(this,Kc,null!=t?t:{convertMode:exports.EnumConvertMode.CM_AUTO}),s(this,ed,e),s(this,td,{fileSource:i(this,ed),password:u(this,nd,ud).call(this)}),await u(this,ad,gd).call(this);return (await i(this,Jc).getPdfInfo(i(this,td))).PdfCount}destroy(){if(i(this,Jc))try{i(this,Jc).destroy(),s(this,Jc,null),s(this,id,!0);}catch(e){Zl.OutputWarning(e);}}async parse(e,t,s){if(u(this,sd,hd).call(this))return null;await u(this,ad,gd).call(this),await i(this,Jc).getPdfInfo(i(this,td));const o=[];let r=[];L(t)&&(r=t.slice(0));const n=await i(this,Jc).readPageImageInfos(i(this,td),r,u(this,rd,dd).call(this),Je.IT_JPG);for(let e=0;e<n.imageInfos.length;++e){const t={fileIndex:n.imageInfos[e].pageIndex,width:n.imageInfos[e].imageWidth,height:n.imageInfos[e].imageHeight,bitDepth:n.imageInfos[e].imageBitDepth,resolutionX:n.imageInfos[e].imageXResolution,resolutionY:n.imageInfos[e].imageYResolution,rotation:n.imageInfos[e].rotation};o.push(t);}return o}async getPage(e){if(u(this,sd,hd).call(this))return null;const t=await i(this,Jc).readPageEx(i(this,td),e,u(this,rd,dd).call(this),Je.IT_JPG,!1,!1,Rl.isApple);if(t){const e=t.imageInfos[0];return {fileIndex:t.pageIndex,width:e.imageWidth,height:e.imageHeight,bitDepth:e.imageBitDepth,resolutionX:e.imageXResolution,resolutionY:e.imageYResolution,data:t.imageData,pageWidth:t.pageWidth,pageHeight:t.pageHeight}}return null}cancelGetPage(e){u(this,sd,hd).call(this)||i(this,Jc).cancelReadPage(i(this,td),e);}}function hd(){return !(!i(this,id)&&i(this,Jc)&&i(this,td))}function cd(e){switch(e){case exports.EnumConvertMode.CM_IMAGEONLY:return 2;case exports.EnumConvertMode.CM_RENDERALL:return 1;case exports.EnumConvertMode.CM_AUTO:default:return 3}}function dd(){var e,t,s,o,r,n;if(u(this,sd,hd).call(this))return null;if(!i(this,Kc))return null;return {convertMode:u(this,od,cd).call(this,null===(e=i(this,Kc))||void 0===e?void 0:e.convertMode),renderOptions:{renderAnnotations:null===(t=i(this,Kc).renderOptions)||void 0===t?void 0:t.renderAnnotations,resolution:null===(s=i(this,Kc).renderOptions)||void 0===s?void 0:s.resolution,maxWidth:null===(o=i(this,Kc).renderOptions)||void 0===o?void 0:o.maxWidth,maxHeight:null===(r=i(this,Kc).renderOptions)||void 0===r?void 0:r.maxHeight,renderGrayscale:null===(n=i(this,Kc).renderOptions)||void 0===n?void 0:n.renderGrayscale}}}function ud(){var e;return null===(e=i(this,Kc))||void 0===e?void 0:e.password}function gd(){var e;if(u(this,sd,hd).call(this))return;const t=null===(e=i(this,Kc))||void 0===e||null===(e=e.renderOptions)||void 0===e?void 0:e.fonts;if(t)for(const e of t)if(e.name&&e.data){let t=e.name;-1===t.indexOf(".")&&(t+=".ttf"),Mo.addPdfFont(t,e.data);}}var fd=new WeakMap,pd=new WeakMap,md=new WeakMap,vd=new WeakMap,yd=new WeakSet;class wd{constructor(){p(this,yd),t(this,"once",!1),f(this,fd,{writable:!0,value:void 0}),f(this,pd,{writable:!0,value:void 0}),f(this,md,{writable:!0,value:void 0}),f(this,vd,{writable:!0,value:!1}),s(this,fd,new co);}async getPageCount(e){s(this,md,{fileSource:e});return (await i(this,fd).getTiffInfo(i(this,md))).pageCount}destroy(){if(i(this,fd))try{i(this,fd).destroy(),s(this,fd,void 0),s(this,vd,!0);}catch(e){Zl.OutputWarning(e);}}async parse(e,t,o){if(u(this,yd,bd).call(this))return null;s(this,pd,null!=o?o:{});const r=await i(this,fd).getTiffPageInfos(i(this,md),t),n=[];for(let e=0;e<r.imageInfos.length;e++){const t=r.imageInfos[e],i={fileIndex:t.pageIndex,width:t.imageWidth,height:t.imageHeight,bitDepth:t.imageBitDepth,resolutionX:t.imageXResolution,resolutionY:t.imageYResolution};n.push(i);}return n}async getPage(e){if(u(this,yd,bd).call(this))return null;const{outputType:t,returnBase64:s}=i(this,pd),o=await i(this,fd).readTiffPage(i(this,md),e,t,s,Rl.isApple);if(o){return {width:o.imageWidth,height:o.imageHeight,data:o.imageData,fileIndex:o.pageIndex,bitDepth:o.imageBitDepth,resolutionX:o.imageXResolution,resolutionY:o.imageYResolution}}return null}cancelGetPage(e){u(this,yd,bd).call(this)||i(this,fd).cancelReadTiffPage(i(this,md),e);}}function bd(){return !(!i(this,vd)&&i(this,fd)&&i(this,md))}var xd=new WeakMap,Cd=new WeakMap;class Sd{constructor(){t(this,"once",!1),f(this,xd,{writable:!0,value:void 0}),f(this,Cd,{writable:!0,value:[]}),s(this,xd,new Io);}async getPageCount(e){return 1}destroy(){if(i(this,xd))try{i(this,xd).terminate(),s(this,xd,void 0);}catch(e){Zl.OutputWarning(e);}}async parse(e,t,o){const r=null!=o?o:{},{outputType:n,jpegQuality:a,returnBase64:l,width:h,height:c,bitDepth:d,xResolution:u,yResolution:g}=r,f=await e.arrayBuffer();await i(this,xd).initImage(f,!0,h,c,!1);const p=await i(this,xd).getImage(a,!0,!0,d,u,g,!0,n),m={width:p.imageWidth,height:p.imageHeight,data:p.imageData,fileIndex:0,bitDepth:p.imageBitDepth,resolutionX:p.imageXResolution,resolutionY:p.imageYResolution};return p.srcBuffer,s(this,Cd,[m]),i(this,Cd)}async getPage(e){return Promise.resolve(i(this,Cd)[e])}}var Pd=new WeakMap,Td=new WeakMap,kd=new WeakMap,Dd=new WeakSet;class Ed{unload(){i(this,Pd).forEach((e=>e.destroy())),i(this,Pd).clear(),i(this,kd).clear();}constructor(e){p(this,Dd),f(this,Pd,{writable:!0,value:new Map}),f(this,Td,{writable:!0,value:new Map}),f(this,kd,{writable:!0,value:new Map}),this.registerParser(Dc.IMAGE_JPEG,Qc),this.registerParser(Dc.IMAGE_BMP,Qc),this.registerParser(Dc.IMAGE_PNG,Qc),this.registerParser(Dc.IMAGE_TIFF,wd),this.registerParser(Dc.IMAGE_JP2,Qc),this.registerParser(Dc.APPLICATION_PDF,ld),this.registerParser("image/rgba",Sd),e.globalHooks.deleteFileData.on((e=>{const t=i(this,Pd).get(e);t&&(t.destroy(),i(this,Pd).delete(e));}));}getParserDefaultOptions(e){if(i(this,kd).has(e))return i(this,kd).get(e)}setParserDefaultOptions(e,t){return !!(t&&B(t)&&i(this,Td).has(e))&&(i(this,kd).set(e,U(t)),!0)}async parse(e,t,i,s,o){const r=this.getParser(i,t);return o=o||this.getParserDefaultOptions(t),L(s)?r.parse(e,s,o):r.parse(e,o)}async getPage(e,t,s,o){let r=null;return i(this,Pd).has(s)?r=this.getParser(s,t):(r=this.getParser(s,t),r.parse(e)),r.getPage(o)}cancelGetPage(e,t){if(i(this,Pd).has(e)){i(this,Pd).get(e).cancelGetPage(t);}}async getParseInfo(e,t,i,s){const o=this.getParser(i,t);let r=0;var n;(s=s||this.getParserDefaultOptions(t))&&(r=null!==(n=s.batchSize)&&void 0!==n?n:0);return {pageCount:await o.getPageCount(e,s),batchSize:r}}getParser(e,t){if(i(this,Pd).has(e))return i(this,Pd).get(e);const s=u(this,Dd,Ad).call(this,t);return s.once||i(this,Pd).set(e,s),s}registerParser(e,t){i(this,Td).set(e,t);}}function Ad(e){return new(i(this,Td).get(e))}class Id{static correctQuad(e){let t=function(e){const t=function(e){const t=[];for(let i=0;i<e.length;i+=2){const s={x:e[i],y:e[i+1]};t.push(s);}return t}(e),i=function(e){const t={x:0,y:0};return e.forEach((e=>{t.x+=e.x,t.y+=e.y;})),t.x/=e.length,t.y/=e.length,t}(t);return t.sort(((e,t)=>Math.atan2(e.y-i.y,e.x-i.x)-Math.atan2(t.y-i.y,t.x-i.x))),t}([e[0][0],e[0][1],e[1][0],e[1][1],e[2][0],e[2][1],e[3][0],e[3][1]]);t=function(e){const t=e.slice().sort(((e,t)=>e.y-t.y)),i=t[0],s=e.indexOf(i);let o=e[s-1];const r=e[s+1];0===s&&(o=e[s+3]);const n={x:i.x-o.x,y:i.y-o.y},a={x:r.x-i.x,y:r.y-i.y},l={x:10,y:0},h=Md(l,n),c=Md(l,a);let d=s;h<c&&(d=s-1,0===s&&(d=3));const u=e.slice(d).concat(e.slice(0,d));return u}(t);const i=function(e){const t=[];return e.forEach((e=>{t.push(e.x,e.y);})),t}(t);return [[i[0],i[1]],[i[2],i[3]],[i[4],i[5]],[i[6],i[7]]]}}function Md(e,t){const i=(e.x**2+e.y**2)**.5,s=(t.x**2+t.y**2)**.5,o=e.x*t.x+e.y*t.y;return Math.acos(o/(i*s))}class Rd{constructor(e){t(this,"items",[]),e&&(this.items=e);}push(e){this.items.push(e);}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}remove(e){"filter"===e.api&&this.items.forEach(((t,i)=>{if(t.api===e.api&&t.params[0]===e.params[0]&&t.params[1]===e.params[1]&&t.params[2]===e.params[2]){this.items.splice(i,1).forEach((e=>{null==e||e.resolve(null);}));}}));}}var Od=new WeakMap,_d=new WeakMap,Nd=new WeakMap,Ld=new WeakMap,Bd=new WeakMap,Ud=new WeakSet,Wd=new WeakSet,Vd=new WeakSet,Fd=new WeakSet;class zd{constructor(){p(this,Fd),p(this,Vd),p(this,Wd),p(this,Ud),f(this,Bd,{get:Hd,set:void 0}),f(this,Od,{writable:!0,value:void 0}),f(this,_d,{writable:!0,value:void 0}),f(this,Nd,{writable:!0,value:new Rd}),f(this,Ld,{writable:!0,value:!1}),s(this,Od,new Ya);}unload(){if(i(this,_d)){const e=i(this,_d);s(this,_d,null),e.destroy();}}get enableFilter(){return !!i(this,_d)}setFilterHandler(e){e?s(this,_d,e):i(this,_d)&&(i(this,_d).destroy(),s(this,_d,null));}getDefaultFilterType(){if(i(this,_d))try{return i(this,_d).defaultFilterType}catch(e){Zl.OutputError(e);}return Ha.NONE}getFilterTypeList(){if(i(this,_d))try{return i(this,_d).querySupported()}catch(e){Zl.OutputError(e);}return []}async filter(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.createTask("filter",[e,t,i,s])}cancelFilter(e,t,i){this.cancelTask("filter",[e,t,i]);}async perspective(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.createTask("perspective",[e,t,i,s])}async perspectivePreview(e,t,s,o){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{var n,a,l;const h=[];let c=o.width,d=o.height;const u=null!==(n=o.angle)&&void 0!==n?n:0;90!==u&&270!==u||(c=o.height,d=o.width);const g=Math.min((null!==(a=r.width)&&void 0!==a?a:c)/c,(null!==(l=r.height)&&void 0!==l?l:d)/d),f=Math.floor(c*g+.5),p=Math.floor(d*g+.5);h.push({type:exports.EnumImageProcessMethodType.Resize,params:{newWidth:f,newHeight:p,mode:r.mode}}),o.angle&&h.push({type:exports.EnumImageProcessMethodType.Rotate,params:{angle:o.angle}});const m=[[Math.floor(s[0][0]*g+.5),Math.floor(s[0][1]*g+.5)],[Math.floor(s[1][0]*g+.5),Math.floor(s[1][1]*g+.5)],[Math.floor(s[2][0]*g+.5),Math.floor(s[2][1]*g+.5)],[Math.floor(s[3][0]*g+.5),Math.floor(s[3][1]*g+.5)]];h.push({type:exports.EnumImageProcessMethodType.DrawPolygon,params:{location:Id.correctQuad(m),strokeColor:r.strokeColor,lineWidth:r.lineWidth}});const v=await i(this,Od).process({type:t,data:e,...o},h),y={},w=new Blob([v.output],{type:v.outputContentType});return y.data=w,Object.assign(y,v.outputImageInfo),y}catch(e){return Zl.OutputError(e),null}}async resize(e,t,s,o,r){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};try{const a=[];let l=1;if(r>0){l=s>o?s/r:o/r;const e=Math.floor(s/l+.5),t=Math.floor(o/l+.5);a.push({type:exports.EnumImageProcessMethodType.Resize,params:{newWidth:e,newHeight:t,mode:n.mode}});}const h=await i(this,Od).process({type:t,data:e,width:s,height:o,...n},a),c={},d=new Blob([h.output],{type:h.outputContentType});return c.data=d,Object.assign(c,h.outputImageInfo),c}catch(e){return Zl.OutputError(e),null}}createTask(e,t){const i={api:e,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const e of t)i.params.push(e);return i.promise=new Promise(((e,t)=>{i.resolve=e,i.reject=t;})),u(this,Vd,$d).call(this,i)}cancelTask(e,t){const s={api:e,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const e of t)s.params.push(e);i(this,Nd).remove(s);}}function Hd(){return Object.getPrototypeOf(i(this,_d))===Nh.prototype}async function jd(e,t,s){let o,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(i(this,_d)){try{o=await i(this,_d).applyFilter({type:t,data:e,...r},s);}catch(e){i(this,Bd)||Zl.OutputError(e);}return o}}async function Gd(e,t,s){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const r=[];o.angle&&r.push({type:exports.EnumImageProcessMethodType.Rotate,params:{angle:o.angle}}),r.push({type:exports.EnumImageProcessMethodType.Perspective,params:{location:Id.correctQuad(s)}});const n=await i(this,Od).process({type:t,data:e,...o},r),a={},l=new Blob([n.output],{type:n.outputContentType});return a.data=l,Object.assign(a,n.outputImageInfo),a}catch(e){return Zl.OutputError(e),null}}function $d(e){return i(this,Nd).push(e),i(this,Ld)||(s(this,Ld,!0),u(this,Fd,Xd).call(this)),e.promise}async function Xd(){do{if(i(this,Nd).isEmpty())break;const e=i(this,Nd).pop();try{let t;switch(null==e?void 0:e.api){case"filter":t=await u(this,Ud,jd).apply(this,e.params);break;case"perspective":t=await u(this,Wd,Gd).apply(this,e.params);}null==e||e.resolve(t);}catch(t){e.retry<1?(e.retry+=1,i(this,Nd).push(e)):null==e||e.reject(t);}}while(!i(this,Nd).isEmpty());s(this,Ld,!1);}var Yd=new WeakMap,qd=new WeakMap;class Qd{constructor(){f(this,qd,{get:Zd,set:void 0}),f(this,Yd,{writable:!0,value:null});}get enableDetect(){return !!i(this,Yd)&&!i(this,qd)}unload(){if(i(this,Yd)){const e=i(this,Yd);s(this,Yd,null),e.destroy();}}setDetector(e){e?s(this,Yd,e):i(this,Yd)&&(i(this,Yd).destroy(),s(this,Yd,null));}async detect(e,t){if(!i(this,Yd))return null;try{return await i(this,Yd).detect(e,t)}catch(e){if(!i(this,qd))throw Zl.OutputError(e),e}return null}async resetDetector(){var e;i(this,Yd)&&(null===(e=i(this,Yd))||void 0===e||e.reset());}}function Zd(){return Object.getPrototypeOf(i(this,Yd))===fh.prototype}class Jd{on(e,t){}emit(e){}}(new Jd).on("debug",(function(){}));var Kd=new WeakMap;class eu{constructor(e){t(this,"notify",void 0),f(this,Kd,{writable:!0,value:void 0}),this.notify=e,this.init();}init(){this.on("error",(e=>{s(this,Kd,e);})),this.on("warning",(e=>{s(this,Kd,e);}));}unload(){this.clearLastError(),this.notify.unload(),this.init();}get lastError(){return i(this,Kd)}clearLastError(){s(this,Kd,void 0);}on(e,t){this.notify&&this.notify.on(e,t);}emit(e){}off(e,t){this.notify&&this.notify.off(e,t);}}class tu{constructor(){t(this,"undoStack",void 0),t(this,"redoStack",void 0),this.undoStack=[],this.redoStack=[];}getOperation(){return {undo:this.undoStack.length,redo:this.redoStack.length}}execute(e){return !!e.execute()&&(this.undoStack.push(e),this.redoStack.length>0&&(this.redoStack.length=0),!0)}undo(){const e=this.undoStack.pop();return e&&(e.undo(),this.redoStack.push(e)),!!e}redo(){const e=this.redoStack.pop();return e&&(e.execute(),this.undoStack.push(e)),!!e}removeUidsFromCommand(e){this.removeFromStack(this.undoStack,e),this.removeFromStack(this.redoStack,e);}removeFromStack(e,t){e.slice().forEach((i=>{const{pageUids:s}=i.action;if(s&&(s.slice().forEach((e=>{if(t.indexOf(e)>-1){const t=s.indexOf(e);s.splice(t,1);}})),!s.length)){const t=e.indexOf(i);e.splice(t,1);}}));}reset(){this.undoStack=[],this.redoStack=[];}}class iu{constructor(e){t(this,"invokers",void 0),t(this,"hooks",void 0),this.hooks=e,this.invokers=new Map,this.listenEvents();}listenEvents(){const{hooks:e}=this;e.createDocument.on((e=>{if(this.invokers.has(e.docUid))return;const t=new tu;this.invokers.set(e.docUid,t);})),e.deleteDocument.on((e=>{this.invokers.has(e.docUid)&&this.invokers.delete(e.docUid);}));}createInvoker(e){if(!this.invokers.has(e)){const t=new tu;this.invokers.set(e,t);}}deleteInvokers(e){e.forEach((e=>{this.invokers.has(e)&&this.invokers.delete(e);}));}execute(e,t){const i=this.invokers.get(t);!(null==i||!i.execute(e))&&this.emitOperationsChanged(t);}undo(e){const t=this.invokers.get(e),i=!(null==t||!t.undo());return i&&this.emitOperationsChanged(e),i}redo(e){const t=this.invokers.get(e),i=!(null==t||!t.redo());return i&&this.emitOperationsChanged(e),i}saveOperations(e){if(this.invokers.has(e)){return this.invokers.get(e).reset(),this.emitOperationsChanged(e),!0}return !1}removePageFromCommand(e,t){this.invokers.get(e).removeUidsFromCommand(t),this.emitOperationsChanged(e);}emitOperationsChanged(e){const t={...this.invokers.get(e).getOperation(),docUid:e};this.hooks.operationsChanged.emit(t);}destroy(){this.invokers.clear();}}class su{constructor(e){t(this,"actions",void 0),t(this,"operands",void 0),t(this,"hooks",void 0),this.hooks=e,this.actions=new Map,this.operands=new Map,this.listenEvents();}destroy(){this.actions.clear(),this.operands.clear();}listenEvents(){const{hooks:e}=this;e.createPage.on((e=>{this.createOperand(e.pageUid);})),e.deletePages.on((e=>{this.deleteOperands(e.pageUids);})),e.deletePagesFromDoc.on((e=>{this.deleteOperandsFromAction(e.pageUids);})),e.deleteAllPagesFromDoc.on((e=>{this.deleteOperandsFromAction(e.pageUids);}));}createOperand(e){const t={pageUid:e,actions:[]};return this.operands.set(e,t),t}addAction(e){this.actions.set(e.actionUid,e),e.pageUids.forEach((t=>{this.operands.get(t).actions.push(e.actionUid);}));}addActionToOperands(e,t){t.forEach((t=>{this.operands.get(t).actions.push(e.actionUid);}));}deleteAction(e){const t=this.actions.get(e);t.pageUids.forEach((e=>{const i=this.operands.get(e);i.actions[i.actions.length-1]===t.actionUid&&i.actions.pop();})),this.actions.delete(e);}deleteOperands(e){this.deleteOperandsFromAction(e),e.forEach((e=>{this.operands.delete(e);}));}deleteOperandsFromAction(e){e.forEach((e=>{this.operands.get(e).actions.forEach((t=>{const i=this.actions.get(t);if(null!=i&&i.pageUids.includes(e)){const t=i.pageUids.indexOf(e);i.pageUids.splice(t,1);}}));}));}}class ou{constructor(e){t(this,"files",void 0),t(this,"hooks",void 0),this.hooks=e,this.files=new Map;}destroy(){this.files.clear();}addFile(e,t,i){const s=new Rc({uid:e,mime:t,pageCount:i});this.files.set(e,s);}getByUid(e){return this.files.get(e)}addUser(e,t,i){const s=this.getByUid(e);return null==s?void 0:s.addUser(t,i)}deleteUser(e,t,i){const s=this.getByUid(e);return s&&(s.deleteUser(t,i),s.count||(this.hooks.deleteFileData.emit(e),this.files.delete(e))),!1}}class ru{constructor(e,i){t(this,"pages",void 0),t(this,"hooks",void 0),t(this,"core",void 0),this.core=e,this.pages=new Map,this.hooks=i,i.pagePreloadChanged.on((e=>{this.handlePagePreloadChange(e);}));}handlePagePreloadChange(e){let{viewerUid:t,type:i,docUid:s,changes:o}=e;o.forEach((e=>{let{pageUid:o,from:r,to:n}=e;const a=this.getPage(o),l={viewerUid:t,docUid:s,pageUid:o},{autoReleaseBlob:h,autoReleaseImg:c}=this.core;r&&!n?(a.raw.deleteUser(l),a.raw.users.length||(h&&a.raw.resetBlob(),c&&a.raw.resetImg()),i!==sl.DEFAULT&&i!==sl.THUMBNAIL||(a.original.deleteUser(l),a.original.users.length||(h&&a.original.resetBlob(),c&&a.original.resetImg()),a.display.deleteUser(l),a.display.users.length||(h&&a.display.resetBlob(),c&&a.display.resetImg())),i===sl.THUMBNAIL&&(a.thumbnail.deleteUser(l),a.thumbnail.users.length||(h&&a.thumbnail.resetBlob(),c&&a.thumbnail.resetImg())),a.raw.users.length||this.core.parserService.cancelGetPage(a.fileUid,a.fileIndex)):(a.raw.addUser(l),i!==sl.DEFAULT&&i!==sl.THUMBNAIL||(a.original.addUser(l),a.display.addUser(l)),i===sl.THUMBNAIL&&a.thumbnail.addUser(l));}));}destroy(){this.pages.clear();}getPage(e){return this.pages.get(e)}createPage(e,t){const i=new jc(e,t,this.core.displayResolutionX,this.core.displayResolutionY,this.core.enableResolution,this.core);this.pages.set(i.uid,i);const s={pageUid:e.pageUid,fileUid:e.fileUid,fileIndex:e.fileIndex};return this.hooks.createPage.emit(s),i}copyPage(e,t,i){const s=i.copy(e,t);this.pages.set(s.uid,s);const o={pageUid:e,fileUid:s.fileUid,fileIndex:s.fileIndex};return this.hooks.createPage.emit(o),s}deletePages(e){const t={pageUids:e};this.hooks.beforeDeletePages.emit(t),e.forEach((e=>{const t=this.pages.get(e);t&&t.destroy(),this.pages.delete(e);})),this.hooks.deletePages.emit(t);}updatePage(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.pages.get(e);if(s){const{doc:o,customData:r}=s;s.destroy();const n=new jc({...i,pageUid:e},o,this.core.displayResolutionX,this.core.displayResolutionY,this.core.enableResolution,this.core);n.customData=r,this.pages.set(e,n);const a={pageUid:e,docUid:o.uid,data:t};this.hooks.updatePage.emit(a);}}getPageCount(){return this.pages.size}}class nu{constructor(e){t(this,"uid",void 0),t(this,"emitter",void 0),t(this,"repo",void 0),t(this,"globalHooks",void 0),this.emitter=new J,this.uid=q(),this.repo=new Map,this.globalHooks=e;}destroy(){this.repo.clear();}createDocument(){const e=new Ic(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});this.repo.set(e.uid,e);const t={docUid:e.uid,docName:e.name};return this.globalHooks.createDocument.emit(t),e}getDocument(e){return this.repo.get(e)}getAllDocuments(){return Array.from(this.repo.values())}renameDocument(e,t){const i=this.repo.get(e);if(!i)return !1;const s={docUid:e,oldName:i.name,newName:t};return i.name=t,this.globalHooks.renameDocument.emit(s),!0}deleteDocuments(e){return e.forEach((e=>{const t=this.getDocument(e);t.destroy(),this.repo.delete(e);const i={docUid:e,docName:t.name};this.globalHooks.deleteDocument.emit(i);})),!0}addPagesToDocument(e,t,i){const s=this.repo.get(e);if(!s)return !1;const{length:o}=t,r=[];let n=s.pages.length;G(i)?(s.pages.splice(i,0,...t),n=i):s.pages.push(...t);for(let e=0;e<o;e++)r.push(n+e);const a={docUid:e,pageUids:t,index:i,indices:r};return this.globalHooks.addPagesToDoc.emit(a),!0}removePagesFromDocument(e,t){const i=this.getDocument(e);if(!i)return !1;const s=t.map((e=>i.pages.indexOf(e)));t.forEach((e=>{Be(i.pages,e);}));const o={docUid:e,pageUids:t,indices:s};return this.globalHooks.deletePagesFromDoc.emit(o),!0}removeAllPagesFromDocument(e){const t=this.getDocument(e);if(!t)return !1;const i=[...t.pages.keys()],s=[...t.pages];t.pages.length=0;const o={docUid:e,pageUids:s,indices:i};return this.globalHooks.deleteAllPagesFromDoc.emit(o),!0}movePages(e,t,i){const s=this.repo.get(e);if(!s)return !1;Ue(s.pages,t,i);const o={docUid:e,indices:t,insertBeforeIndex:i};return this.globalHooks.movePages.emit(o),!0}switchPage(e,t,i){const s=this.repo.get(e);if(!s)return !1;We(s.pages,t,i);const o={docUid:e,one:t,another:i};return this.globalHooks.switchPage.emit(o),!0}reorderPages(e,t){const i=this.repo.get(e);if(!i)return !1;Ve(i.pages,t);const s={docUid:e,indices:t};return this.globalHooks.reorderPages.emit(s),!0}}var au=new WeakMap;class lu{constructor(){f(this,au,{writable:!0,value:void 0}),s(this,au,new oo);}destroy(){if(i(this,au))try{i(this,au).terminate(),s(this,au,void 0);}catch(e){Zl.OutputWarning(e);}}async save(e,t){const s=null!=t?t:{},{outputType:o,jpegQuality:r,returnType:n}=s;return (await i(this,au).saveImage(e,o,r,n)).imageData}}var hu=new WeakMap,cu=new WeakMap;class du{constructor(){f(this,hu,{writable:!0,value:void 0}),f(this,cu,{writable:!0,value:void 0}),s(this,hu,new Oo);}destroy(){if(i(this,hu))try{i(this,hu).terminate(),s(this,hu,void 0);}catch(e){Zl.OutputWarning(e);}}convertPdfSettings(e){const t=new Ro;return t.author=null==e?void 0:e.author,t.compression=null!=e&&e.compression?rl.get(e.compression):void 0,t.creationDate=null==e?void 0:e.creationDate,t.creator=null==e?void 0:e.creator,t.keyWords=null==e?void 0:e.keyWords,t.modifiedDate=null==e?void 0:e.modifiedDate,t.pageType=null!=e&&e.pageType?hl.get(e.pageType):void 0,t.producer=null==e?void 0:e.producer,t.quality=null==e?void 0:e.quality,t.subject=null==e?void 0:e.subject,t.title=null==e?void 0:e.title,t.version=null==e?void 0:e.version,t}async create(e){s(this,cu,this.convertPdfSettings(e));return await i(this,hu).initPdfSetting(i(this,cu))}async appendImagePage(e,t){return await i(this,hu).appendPage(e)}async appendPdfPages(e,t,s){return await i(this,hu).mergePdf(e,t,s)}async setPageRotation(e){e.forEach((async(e,t,s)=>{let o=(e%360+360)%360;await i(this,hu).pageSetRotation(t,o);}));}async getPdf(e){const t=null!=e?e:{},{returnType:s}=t;return (await i(this,hu).writePdf(s)).pdfData}}var uu=new WeakMap,gu=new WeakMap,fu=new WeakMap;class pu{constructor(){f(this,uu,{writable:!0,value:void 0}),f(this,gu,{writable:!0,value:void 0}),f(this,fu,{writable:!0,value:void 0}),s(this,uu,new oo),s(this,gu,al.get(exports.EnumTIFFCompressionType.TIFF_AUTO));}destroy(){if(i(this,uu))try{i(this,uu).terminate(),s(this,uu,void 0);}catch(e){Zl.OutputWarning(e);}}async create(e){const t=await i(this,uu).createTiff();if(e&&(s(this,fu,e.quality),e.compression&&s(this,gu,al.get(e.compression)),e.customTag))for(let t=0;t<e.customTag.length;t++)await i(this,uu).addTag(e.customTag[t].id,e.customTag[t].content,e.customTag[t].contentIsBase64);return t}async appendPage(e,t){const s=null!=t?t:{},{inputType:o}=s;return await i(this,uu).appendImage(e,o,i(this,gu),i(this,fu))}async getTiff(e){const t=null!=e?e:{},{outputType:s}=t;return (await i(this,uu).getTiff(s)).imageData}}var mu=new WeakMap,vu=new WeakSet;class yu{constructor(e){p(this,vu),f(this,mu,{writable:!0,value:void 0}),s(this,mu,e);}unload(){}async saveToPng(e){const t=i(this,mu).pageService.getPage(e);if(!t)return Promise.resolve(null);const s=await i(this,mu).getPageData(e,{display:!0});if("image/png"===s.fileData.type&&!u(this,vu,wu).call(this,t))return s.fileData;const o=new lu;try{return await o.save(s.display.data,{outputType:3})}finally{o.destroy();}}async saveToJpeg(e,t){const s=i(this,mu).pageService.getPage(e);if(!s)return Promise.resolve(null);const o=await i(this,mu).getPageData(e,{display:!0});if("image/jepg"===o.fileData.type&&!u(this,vu,wu).call(this,s))return o.fileData;const r=new lu;try{return await r.save(o.display.data,{outputType:1,jpegQuality:null==t?void 0:t.quality})}finally{r.destroy();}}async saveToTiff(e,t){const s=new pu;try{await s.create(t);for(let t=0;t<e.length;t++){const o=e[t];if(!i(this,mu).pageService.getPage(o))break;const r=await i(this,mu).imageDataService.getDisplay(o,!1);await s.appendPage(r.data);}return await s.getTiff()}finally{s.destroy();}}async saveToPdf(e,t){const s=(null==t?void 0:t.mimeType)||"application/pdf",o=new du;try{await o.create(t);const n=new Map,a=t&&t.pageType&&t.pageType!==exports.EnumPDFPageType.PAGE_DEFAULT;let l=0;for(let t=0;t<e.length;t++){const s=e[t],h=i(this,mu).pageService.getPage(s);if(!h)break;const c=await i(this,mu).getPageData(s,{raw:!0,display:!0}),d=[];if("application/pdf"===c.fileData.type&&!a)for(let s=t;s<e.length;s++){const t=e[s],o=i(this,mu).pageService.getPage(t);if(!o)break;if(o.fileUid!==h.fileUid)break;if(!o.isFull)break;if(o.filter&&"none"!==o.filter)break;const r=o.getActions(),a=o.getPerspectiveActions();let c=!1,u=0;for(const e of r)if("rotate"!==e.type){c=!0;break}if(c)break;for(const e of a)if("rotate"!==e.type){c=!0;break}if(c)break;u=o.rotation,u&&n.set(l+d.length,u),d.push(o.fileIndex);}if(d.length>0){var r;const e=null===(r=(await i(this,mu).store.get(h.fileUid)).loadOptions)||void 0===r?void 0:r.password;await o.appendPdfPages(c.fileData,e,d),t+=d.length-1,l+=d.length;}else await o.appendImagePage(c.display.data),l+=1;}n.size>0&&await o.setPageRotation(n);const h=await o.getPdf({returnType:1});return Promise.resolve(new Blob([h],{type:s}))}finally{o.destroy();}}}function wu(e){if(!e.isFull)return !0;if(e.filter&&"none"!==e.filter)return !0;if(e.getActions().some((e=>"rotate"!==e.type)))return !0;return !!e.getPerspectiveActions().some((e=>"rotate"!==e.type))||0!==e.rotation}const bu=e=>{const t=new Set(e);return Array.from(t.values())};class xu{constructor(e){t(this,"observer",void 0),t(this,"hooks",void 0),this.hooks=e,this.observer=new ResizeObserver((e=>{e.forEach((e=>{this.hooks.resizeObserver.emit(e);}));}));}observe(e){this.observer.observe(e);}unobserve(e){this.observer.unobserve(e);}disConnect(){this.observer.disconnect();}}class Cu{constructor(){t(this,"canvas",void 0),t(this,"renderer",void 0),t(this,"root",void 0);document.createElement("canvas").getContext("2d",{willReadFrequently:!0}),this.renderer=new Ma,this.canvas=new ga({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement;}render(e){this.root.children.slice().forEach((e=>{this.root.removeChild(e);})),this.root.appendChild(e),this.canvas.resize(e.width,e.height),this.canvas.render();}clear(){this.root.children.slice().forEach((e=>{this.root.removeChild(e);})),this.root.sortable.sorted=[];}getCanvas(){return this.canvas.contextService.getDomElement()}}let Su;function Pu(e){let t=-1;Su||(Su=function(){const e=new Int32Array(256);for(let t=0;t<256;t++){let i=t;for(let e=0;e<8;e++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i;}return e}());for(let i=0;i<e.length;i++)t=Su[255&(t^e[i])]^t>>>8;return -1^t}const Tu="image/png",ku="image/jpeg",Du="p".charCodeAt(0),Eu="H".charCodeAt(0),Au="Y".charCodeAt(0),Iu="s".charCodeAt(0);function Mu(e,t){const i=e.slice(0,33);return new Promise(((s,o)=>{const r=new FileReader;r.onload=()=>{const i=new Uint8Array(r.result),o=e.slice(33),n=function(e,t,i,s){if(i===ku)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(i===Tu){const i=new Uint8Array(13);t*=39.3701,i[0]=Du,i[1]=Eu,i[2]=Au,i[3]=Iu,i[4]=t>>>24,i[5]=t>>>16,i[6]=t>>>8,i[7]=255&t,[i[8],i[9],i[10],i[11]]=[i[4],i[5],i[6],i[7]],i[12]=1;const o=Pu(i),r=new Uint8Array(4);if(r[0]=o>>>24,r[1]=o>>>16,r[2]=o>>>8,r[3]=255&o,s){const t=function(e){for(let t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===Du&&e[t-2]===Eu&&e[t-1]===Au&&e[t]===Iu)return t-3;return -1}(e);return e.set(i,t),e.set(r,t+13),e}const n=new Uint8Array(4);n[0]=0,n[1]=0,n[2]=0,n[3]=9;const a=new Uint8Array(54);return a.set(e,0),a.set(n,33),a.set(i,37),a.set(r,50),a}throw new Error(`The format ${i} is not supported.`)}(i,t,e.type),a=new Blob([n,o],{type:e.type});s(a);},r.onerror=e=>{o(e);},r.readAsArrayBuffer(i);}))}class Ru{constructor(e){t(this,"core",void 0),this.core=e;}async getPageData(e){const t=this.core.pageService.getPage(e);if(!t)return null;const i=await this.core.store.get(t.fileUid);let{quad:s}=t;s&&(s=t.quadToPixelPPI(t.quad),Hc(s));const o={uid:t.uid,fileData:i.fileData,fileIndex:t.fileIndex,perspectiveQuad:s,rotation:t.rotation,filter:t.filter},r=await this.getRaw(e,!1);o.raw={...r};const n=await this.getEditedDisplay(e);o.display={...n};const a=await this.getEditedDisplay(e);return o.thumbnail={...a},o}async getRaw(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{const i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;if(i.raw.isAvailable)return i.raw.getImageDetail();const{fileUid:s,fileIndex:o}=i,r=await this.core.store.get(s),n=await Gs(r.fileData);0===n.length&&Zl.throw(Zl.FILE_NOTSUPPORT);const a=await this.core.parserService.getPage(r.fileData,n,s,o);if(!a)return null;let{raw:l}=i;return t||(l=new Wc(i)),l.updateImageDetail(a),l.getImageDetail()}catch(e){return Zl.OutputError(e),null}}async getOriginal(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;const{original:s}=i;if(s.isAvailable)return s.getImageDetail();const o=await this.getRaw(e);if(!o)return null;const r=await this.handlePerspectiveQuad(e,o);return t&&r&&i.original.updateImageDetail(r),r}async handlePerspectiveQuad(e,t){const i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;let s=t;const o=i.getProcessedQuad();if(o&&(s=await this.core.processService.perspective(t.data,3,o,{angle:i.initRotation}),!s))return null;const r=new Wc(i);return r.updateImageDetail(s),r.getImageDetail()}async getDisplay(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;if(i.display.isAvailable)return i.display.getImageDetail();const s=await this.getOriginal(e);if(!s)return null;const{filter:o}=i,r=await this.handleFilter(e,s);return i.filter!==o?this.getDisplay(e):(t&&r&&i.display.updateImageDetail(r),r)}async handleFilter(e,t){const i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;const s=t,{filter:o}=i;if(o&&"none"!==o){const e=await this.core.processService.filter(t.data,3,o,{width:t.width,height:t.height});if(!e)return null;s.data=e;}const r=new Wc(i);return r.updateImageDetail(s),r.getImageDetail()}async getEditedDisplay(e){const t=this.core.pageService.getPage(e),i=await this.getDisplay(e,!1);if(t.getActions().length){const i=await this.applyEditToDisplay(e),s=new Wc(t);return s.updateImageDetail(i),s.getImageDetail()}return i}async getThumbnail(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(e);if(!i||i.isDestroyed)return null;if(i.thumbnail.isAvailable)return i.thumbnail.getImageDetail();const s=await this.getDisplay(e,!0);if(!s)return null;const o=await this.displayToThumbnail(s.data);return o?(t&&i.thumbnail.updateImageDetail(o),o):null}async displayToThumbnail(e){return e}async applyEditToDisplay(e){const t=await this.core.imageLoadService.loadDisplayImage(e),i=this.core.pageService.getPage(e),s=await this.getDisplay(e,!1),{width:o,height:r}=s,n=this.core.editService.editPageForSave(e),a={width:Math.floor(n.width),height:Math.floor(n.height),data:null},l=new zn({style:{x:0,y:0,img:t,width:o,height:r}});l.externalMatrices=n.matrices;const h=new Vn({style:{x:0,y:0,width:n.width,height:n.height}});h.appendChild(l),this.core.commonCanvas.render(h),this.core.commonCanvas.clear();const c=this.core.commonCanvas.getCanvas();return new Promise(((e,t)=>{c.toBlob((async t=>{t=await Mu(t,i.resolutionX||this.core.displayResolutionX),a.data=t,e(a);}),"image/jpeg",1);}))}}exports.EnumConvertMode = void 0;!function(e){e.CM_RENDERALL="cm/renderall",e.CM_IMAGEONLY="cm/imageonly",e.CM_AUTO="cm/auto";}(exports.EnumConvertMode||(exports.EnumConvertMode={}));const _u=new Map,Nu=new class{constructor(){t(this,"canvas",void 0),t(this,"renderer",void 0),t(this,"root",void 0),this.renderer=new Ma,this.canvas=new ga({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement;}render(e){this.clear(),this.root.appendChild(e),this.canvas.resize(e.width,e.height),this.canvas.render();}clear(){this.root.children.slice().forEach((e=>{this.root.removeChild(e);})),this.root.sortable.sorted=[];}getCanvas(){return this.canvas.contextService.getDomElement()}},Lu=[];class Bu{constructor(){t(this,"globalHooks",new Wa),t(this,"viewerService",void 0),t(this,"editService",void 0),t(this,"documentService",void 0),t(this,"trackerService",void 0),t(this,"imageLoadService",void 0),t(this,"optimizationService",void 0),t(this,"canvasService",void 0),t(this,"parserService",void 0),t(this,"processService",void 0),t(this,"documentDetectService",void 0),t(this,"commandService",void 0),t(this,"errorService",void 0),t(this,"errorNotify",void 0),t(this,"actionService",void 0),t(this,"fileSaveService",void 0),t(this,"fileService",void 0),t(this,"pageService",void 0),t(this,"resizeService",void 0),t(this,"imageDataService",void 0),t(this,"store",void 0),t(this,"commonCanvas",void 0),t(this,"displayResolutionX",96),t(this,"displayResolutionY",96),t(this,"enableResolution",!0),t(this,"autoReleaseImg",!0),t(this,"autoReleaseBlob",!1),this.commonCanvas=new Cu;const e=new Wa;this.globalHooks=e,this.store=new Ua,this.trackerService=new Jd,this.canvasService=Nu,this.documentService=new nu(e),this.fileService=new ou(e),this.pageService=new ru(this,e),this.imageLoadService=new Cc(this),this.optimizationService=new kc,this.parserService=new Ed(this),this.processService=new zd,this.documentDetectService=new Qd,this.commandService=new iu(e),this.errorNotify=new Hl,this.errorService=new eu(this.errorNotify),this.actionService=new su(e),this.fileSaveService=new yu(this),this.resizeService=new xu(e),this.imageDataService=new Ru(this),Lu.forEach((e=>{var t;null===(t=e.apply)||void 0===t||t.call(e,this);})),e.deleteFileData.on((e=>{this.store.remove(e);}));}setDisplayResolution(e,t){this.displayResolutionX=e,this.displayResolutionY=t;}static getClass(e){return _u.get(e)}static setClass(e,t){_u.set(e,t);}static registerPlugin(e){Lu.includes(e)||Lu.push(e),e.install&&e.install(Bu);}getClass(e){return _u.get(e)}createAsyncRepository(){return new Ua}createViewer(e){const t=Bu.getClass("Viewer"),i=e.groupUid||q();this.viewerService.getViewersByGroupUid(i);const s={...e,core:this,groupUid:i},o=this.viewerService.createViewer(t,s);return o.context.isInitialized=!0,o}removeViewer(e){this.viewerService.removeViewer(e.uid);}getViewer(e){return this.viewerService.getViewer(e)}getViewers(){return this.viewerService.getAllViewers()}getFileParserDefaultOptions(e){return this.parserService.getParserDefaultOptions(e)}setFileParserDefaultOptions(e,t){return this.parserService.setParserDefaultOptions(e,t)}setFileParser(e,t){this.parserService.registerParser(e,t);}getSourceParseOptions(e){if("convertMode"in e){return U(e)}if("width"in e){return U(e)}}async loadSource(e,t,i){var s;L(e)||(e=[e]);const o=this.documentService.getDocument(t);if(!o)return null;let r,n={};G(i)?n.insertBeforeIndex=i:n={...i},n.exception=null!==(s=n.exception)&&void 0!==s?s:"fail","fail"===n.exception&&(r=await cl.makeSureSourcesTypeSupported(e,"sources")),this.globalHooks.beforeLoadSource.emit({docUid:t});const a=[];try{for(const[i,s]of e.entries())try{let e;e="fail"===n.exception?r[i]:await cl.makeSureSourceTypeSupported(s,`sources[${i}]`);const l=q(),h=this.getSourceParseOptions(s),{pageCount:c,batchSize:d}=await this.parserService.getParseInfo(s.fileData,e,l,h);e===s.fileData.type?this.store.set(l,{fileData:s.fileData,loadOptions:h}):this.store.set(l,{fileData:s.fileData.slice(0,s.fileData.size,e),loadOptions:h}),this.fileService.addFile(l,e,c);for(let i=0;i<c;){const r=[];if(d>0)for(let e=0;e<d&&i<c;e++)r.push(i),i+=1;else for(;i<c;)r.push(i),i+=1;const u=await this.parserService.parse(s.fileData,e,l,r,h).catch((e=>{throw e}));s.extraPageData&&s.extraPageData.forEach((e=>{const{index:t}=e;for(const i of u)if(i.fileIndex===t){const t={...e};delete t.index,i.rotation&&t.rotation&&(t.rotation+=i.rotation),Object.assign(i,t);break}}));const g=u.map((e=>{var t;const i=q();return e.pageUid=i,e.fileUid=l,e.filter=null!==(t=e.filter)&&void 0!==t?t:this.processService.getDefaultFilterType()||"none",a.push(i),this.fileService.addUser(e.fileUid,e.fileIndex,e.pageUid),this.pageService.createPage(e,o),i}));this.documentService.addPagesToDocument(t,g,n.insertBeforeIndex),W(n.insertBeforeIndex)||(n.insertBeforeIndex+=u.length);}}catch(e){if("fail"===n.exception)throw e;Zl.OutputWarning(e);}}finally{const e=a.map((e=>o.pages.indexOf(e))),i={docUid:t,pageUids:a,indices:e};this.globalHooks.afterLoadSource.emit(i);}return a}async getPageData(e,t){var i;null!==(i=t)&&void 0!==i||(t={raw:!0,display:!0,thumbnail:!0});const s=this.pageService.getPage(e);if(!s)return null;const o=await this.store.get(s.fileUid);let{quad:r}=s;r&&(r=s.quadToPixelPPI(s.quad),Hc(r));const n={uid:s.uid,fileData:o.fileData,fileIndex:s.fileIndex,perspectiveQuad:r,rotation:s.rotation,filter:s.filter};if(t.raw){const t=await this.imageDataService.getRaw(e);n.raw={...t};}if(t.display){const t=await this.imageDataService.getEditedDisplay(e);n.display={...t};}if(t.thumbnail){const t=await this.imageDataService.getEditedDisplay(e);n.thumbnail={...t};}return n}async setCustomData(e,t){const i=this.pageService.getPage(e);return i?(i.customData=U(t),!0):Promise.reject()}async getCustomData(e){const t=this.pageService.getPage(e);if(!t)return Promise.reject();return U(t.customData)}async updatePage(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.pageService.getPage(e);if(!s)return !1;const o=q(),[r]=await cl.makeSureSourcesTypeSupported([{fileData:t}],"data"),n=this.getSourceParseOptions({fileData:t}),{pageCount:a,batchSize:l}=await this.parserService.getParseInfo(t,r,o,n);if(G(i.fileIndex)&&(i.fileIndex>=a||i.fileIndex<0))throw Zl.buildError(Zl.PARAM_OUTOFRANGE,"IDocument.updatePage","updatePageOptions.fileIndex");this.store.set(o,{fileData:t,loadOptions:n}),this.fileService.addFile(o,r,a);const[h]=await this.parserService.parse(t,r,o,[i.fileIndex||0],n);return this.commandService.removePageFromCommand(s.doc.uid,[e]),this.fileService.addUser(o,i.fileIndex,e),this.fileService.deleteUser(s.fileUid,s.fileIndex,e),this.pageService.updatePage(e,t,{...h,...i,fileUid:o}),!0}async getPerspectivePreviewData(e,t,i){const s=this.pageService.getPage(e),o=await this.imageDataService.getRaw(e);if(!s||!o)return null;let{quad:r}=s;r||(r=[[0,0],[o.width,0],[o.width,o.height],[0,o.height]]);const n=await this.processService.perspectivePreview(o.data,4,r,{width:o.width,height:o.height},{...t,...i});return Promise.resolve(n)}createDocument(e){return this.documentService.createDocument(e)}getDocument(e){return this.documentService.getDocument(e)}deleteDocuments(e){const{documentService:t,pageService:i}=this;if(e.map((e=>t.getDocument(e))).includes(void 0))return !1;this.globalHooks.beforeDeleteDocs.emit({docUids:e}),e.forEach((e=>{const s=t.getDocument(e);if(s){const e=s.pages;e.forEach((e=>{const t=i.getPage(e);this.fileService.deleteUser(t.fileUid,t.fileIndex,e);})),i.deletePages(e);}}));const s=t.deleteDocuments(e);return this.globalHooks.afterDeleteDocs.emit({docUids:e}),s}renameDocument(e,t){this.documentService.renameDocument(e,t);}transferDocument(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{documentService:s}=this,o=s.getDocument(e),r=s.getDocument(t);if(!o||!r)return !1;if(e===t&&!i.copy)return !i.sourceIndices||this.movePages(e,i.sourceIndices,i.insertBeforeIndex);let n=[];if(null!=i&&i.sourceIndices){n=bu(i.sourceIndices).map((e=>o.pages[e]));}else n=[...o.pages];if(!n.length)return !0;i.copy?n.forEach(((e,t,i)=>{const s=this.pageService.getPage(e),o=q();this.fileService.addUser(s.fileUid,s.fileIndex,o),this.pageService.copyPage(o,r,s),i[t]=o;})):(s.removePagesFromDocument(o.uid,n),n.forEach((e=>{this.pageService.getPage(e).doc=r;}))),s.addPagesToDocument(r.uid,n,i.insertBeforeIndex);const a=n.map((e=>r.pages.indexOf(e))),l={docUid:r.uid,pageUids:n,indices:a};return this.globalHooks.afterLoadSource.emit(l),!0}mergeDocuments(e,t){const{documentService:i}=this,s=i.createDocument(t);if(!e.length)return s;e=bu(e);const o=[];if(e.forEach((e=>{const t=i.getDocument(e);o.push(...t.pages);})),null!=t&&t.deleteOriginal?(i.deleteDocuments(e),o.forEach((e=>{this.pageService.getPage(e).doc=s;}))):o.forEach(((e,t,i)=>{const o=this.pageService.getPage(e),r=q();this.fileService.addUser(o.fileUid,o.fileIndex,r),this.pageService.copyPage(r,s,o),i[t]=r;})),o.length){i.addPagesToDocument(s.uid,o);const e=o.map((e=>s.pages.indexOf(e))),t={docUid:s.uid,pageUids:o,indices:e};this.globalHooks.afterLoadSource.emit(t);}return s}openDocument(e,t){return this.openOrCloseDocument(e,t)}closeDocument(e,t){return this.openOrCloseDocument(e,t,!0)}openOrCloseDocument(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=this.documentService.getDocument(e);if(!s||!this.viewerService.hasViewer(t))throw Zl.DOC_NOTOPEN;const o={doc:s,viewerUid:t,groupUid:this.viewerService.getViewer(t).groupUid};return i?this.globalHooks.closeDocument.emit(o):this.globalHooks.openDocument.emit(o),this.commandService.emitOperationsChanged(e),!0}deletePages(e,t){return t=bu(t),this.commandService.removePageFromCommand(e,[...t]),t.forEach((e=>{const t=this.pageService.getPage(e);this.fileService.deleteUser(t.fileUid,t.fileIndex,e);})),this.documentService.removePagesFromDocument(e,[...t]),this.pageService.deletePages(t),!0}deleteAllPages(e){const t=this.documentService.getDocument(e),i=[...t.pages];return this.commandService.removePageFromCommand(e,i),t.pages.forEach((e=>{const t=this.pageService.getPage(e);this.fileService.deleteUser(t.fileUid,t.fileIndex,e);})),this.documentService.removeAllPagesFromDocument(e),this.pageService.deletePages(i),!0}movePages(e,t,i){return t=bu(t),this.documentService.movePages(e,t,i)}switchPage(e,t,i){return this.documentService.switchPage(e,t,i)}reorderPages(e,t){return t=bu(t),this.documentService.reorderPages(e,t)}async printPages(e,t){const i=this.documentService.getDocument(e);if(!i)return Promise.reject(Zl.DOC_NOTEXIST);const s=t||Array.from(Array(i.pages.length).keys()),o=[];for(let e=0;e<s.length;e++){const t=await this.getPageData(i.pages[s[e]],{raw:!1,display:!0,thumbnail:!1});o.push(t);}if(0===o.length)return Promise.reject();const r=[];return o.forEach((e=>{r.push({data:e.display.data,width:e.display.width,height:e.display.height});})),function(e){let t,i,s="";e.forEach(((e,o)=>{let r=1120,n=850;const a=n/e.width,l=r/e.height;a<l?r=Math.floor(e.height*a):a>l&&(n=Math.floor(e.width*l)),s+=`<div style="width:${n}px; height:${r}px;"><img id="DDV_Image${o}" src="${Q(e.data).data}" style="position:relative; left:0px; top:0px;width:${n}px; height:${r}px; referrerpolicy='strict-origin-when-cross-origin'"/></div>`,t+=n,i+=r;}));const o=`alwaysRaised=yes, z-look=yes, top=0, left=0, toolbar=no, menubar=no, location=no, status=no,width=${t}, height=${i}`,r=window.open("about:blank","_blank",o),n=`<html><body id='DDV_body'>${s}</body></html>`;if(r){r.document.write(n),r.document.close(),r.focus();const e=r.document.getElementById("DDV_body");e&&(e.onload=()=>{r&&r.print();});}}(r),!0}setDetectHandler(e,t){return this.globalHooks.setExternalHandler.emit({type:"detect"}),this.documentDetectService.setDetector(t)}setImageFilterHandler(e){return this.globalHooks.setExternalHandler.emit({type:"filter"}),this.processService.setFilterHandler(e)}clearExternalHandler(e){if($(e)){switch(e){case"documentBoundariesDetect":this.setDetectHandler(e,null);break;case"imageFilter":this.setImageFilterHandler(null);}}}setConfig(e){return uc(e)}unload(){this.displayResolutionX=96,this.displayResolutionY=96,this.enableResolution=!0,this.viewerService.unload(),this.commonCanvas.clear(),this.store.destroy(),this.canvasService.clear(),this.documentService.destroy(),this.fileService.destroy(),this.pageService.destroy(),this.commandService.destroy(),this.actionService.destroy(),this.resizeService.disConnect(),this.errorService.unload(),this.processService.unload(),this.documentDetectService.unload(),this.parserService.unload(),this.fileSaveService.unload(),nc.init(),Rl.unload();}preloadModule(e){Rl.preloadModule(e);}undo(e){return this.commandService.undo(e)}redo(e){return this.commandService.redo(e)}getOperationState(e){return this.commandService.invokers.get(e).getOperation()}saveOperations(e){return this.commandService.saveOperations(e)}async perspectivePage(e,t,i){let s;const o=this.pageService.getPage(t);o.enableResolution&&(i=o.quadToDisplayPPI(i));if(o.setQuad(i)){if(this.commandService.removePageFromCommand(e,[t]),o.quad){const e=o.quadToDisplayPPI(o.quad),{width:t,height:i}=Vc(e);o.original.updateImageDetail({width:t,height:i}),o.display.updateImageDetail({width:t,height:i});}o.original.reset(),s=await this.imageDataService.getOriginal(t),o.display.reset(),o.thumbnail.reset();const{width:r,height:n}=o.original.getPageSize();this.globalHooks.afterPerspective.emit({docUid:e,pageUid:t,quad:i,width:r,height:n});}return s||this.imageDataService.getOriginal(t)}async filterPages(e,t,i){t.forEach((e=>{const t=this.pageService.getPage(e);t.filter!==i&&(t.filter=i,t.display.reset(),t.thumbnail.reset());}));const s={type:i,docUid:e,pageUids:t};return this.globalHooks.filterChanged.emit(s),!0}}function Uu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{tag:i,style:s,id:o,className:r,children:n}=e,a=document.createElement(i);return o&&(a.id=o+t),r&&(a.className=r),s&&function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if($(t))e.style.cssText=t;else if(i){let i="";Object.keys(t).forEach((e=>{i+=`${e}:${t[e]};`;})),e.style.cssText=i;}else Object.keys(t).forEach((i=>{e.style[i]=t[i];}));}(a,s),n&&n.forEach((e=>{const i=Uu(e,t);a.appendChild(i);})),a}function Wu(e){e&&(e.style.display="none");}function Vu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e&&(e.style.display=t);}function Fu(e,t,i,s){t=(t%360+360)%360;const o={...e},{left:r,top:n,width:a,height:l}=e,h=Math.floor(t/90);return 1===h?(o.left=s-n-l,o.top=r):2===h?(o.left=i-r-a,o.top=s-n-l):3===h&&(o.left=n,o.top=i-r-a),h%2>0&&(o.width=l,o.height=a),o}const zu=e=>parseFloat(Number(e).toFixed(4)),Hu=e=>{if(!e)return;const t=1e-7,{left:i,top:s,width:o,height:r}=e,n=Math.ceil(i);e.left=n-i<t?n:Math.floor(i);const a=Math.ceil(s);e.top=a-s<t?a:Math.floor(s);const l=Math.ceil(o);e.width=l-o<t?l:Math.floor(o);const h=Math.ceil(r);e.height=h-r<t?h:Math.floor(r);},ju={canvasStyle:{cursor:"default"},currentPageStyle:{border:""},pageStyle:{border:"2px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"2px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"2px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{width:24,height:24,left:"50%",top:"",right:"",bottom:"0px",translateX:"-50%",translateY:0,border:"0px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",onPage:!1,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle"},checkboxStyle:{width:24,height:24,left:0,top:0,right:"",bottom:"",translateX:0,translateY:0,border:"1px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",visibleByHover:!0,checkMarkColor:"#000",checkMarkLineWidth:2},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",border:"1px solid #515151",borderRadius:"50%",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},quadSelectionStyle:{border:"1px dashed #fe8e14",ctrlBorderRadius:0,ctrlBorder:"1px dashed #fe8e14",ctrlWidth:10,ctrlHeight:10,invalidCtrlBorderColor:"#fe8e14",invalidBorderColor:"#fe8e14"},enableDragPage:!0,enableKeyboardControl:!0,multiselectMode:!1,enableOptimizeImage:!1,zoomOrigin:{x:"center",y:"center"},zoom:1,minZoom:.02,maxZoom:8,enableZoom:!0,enableScrollX:!0,enableScrollY:!0,keepZoom:!0,zoomInDelta:1.2,zoomOutDelta:1.2,wheelZoomDelta:1.2,scrollDirection:"vertical",displayMode:"single",toolMode:"pan",fitMode:"window",enableSlide:!0,visibility:"visible",rows:4,columns:1,margin:10,autoScroll:!0,autoChangeIndex:!0,scrollToLatest:!1,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableZoomWithCtrl:!0,tabMode:"single",enableSingleModeBorder:!0,blankFillColor:"#fff",dragThreshold:3,startSlideThreshold:20,StartSlideThresholdForPerspective:30,slideThreshold:.2,slideThresholdForPerspective:.2,panThreshold:3,maxOptimizationSize:7e3,viewerMode:sl.DEFAULT,maxRows:20,maxColumns:20};class Gu extends Cn{constructor(){super({name:"Checkbox"}),t(this,"shapeType","checkbox"),t(this,"checkboxStyle",void 0),t(this,"parsedCheckboxStyle",void 0),t(this,"isChecked",!1);}get checked(){return this.isChecked}set checked(e){this.isChecked=e;}updateStyle(e){this.style.visibility=e.visibility;}}class $u extends Cn{constructor(){super({name:"PageNumber"}),t(this,"shapeType","pageNumber"),t(this,"text",void 0),t(this,"parsedPageNumberStyle",void 0),this.text="0";}updateText(e){this.text=e;}updateStyle(e){Object.assign(this.style,e);}}class Xu extends Vn{constructor(e){super({...e,name:"TabPage"}),t(this,"uid",void 0),t(this,"tab",void 0),t(this,"isSelected",!1),t(this,"isHovered",!1),t(this,"isDragging",!1),t(this,"isLoading",!1),t(this,"isPreload",!1),t(this,"isLoaded",!1),t(this,"rWidth",void 0),t(this,"rHeight",void 0),t(this,"rWidthP",void 0),t(this,"rHeightP",void 0),t(this,"isPreloadP",void 0),t(this,"isLoadedP",void 0),t(this,"zoom",1),t(this,"blanks",void 0),t(this,"image",void 0),t(this,"borderBox",void 0),t(this,"imageContainer",void 0),t(this,"checkbox",void 0),t(this,"pageNumber",void 0),t(this,"currentStyleBox",void 0),this.tab=e.tab,this.uid=e.uid,this.rWidth=e.style.width,this.rHeight=e.style.height;const i=new zn({name:"PageImage",id:this.uid,style:{x:0,y:0}}),s=new Vn({name:"PageImageContainer",style:{x:0,y:0}});s.clippable=!0;const o=new Vn({name:"PageBorderBox",style:{...e.style,...e.formattedPageStyle}}),r=new Vn({name:"CurrentStyleBox",style:{visibility:"hidden"}}),n=new Gu,a=new $u;s.appendChild(i),o.appendChild(s),o.appendChild(r),o.appendChild(n),this.appendChild(a),this.appendChild(o),this.image=i,this.borderBox=o,this.imageContainer=s,this.pageNumber=a,this.checkbox=n,this.currentStyleBox=r;}getRect(){const e=this.imageContainer.getPosition();return {left:e.x,top:e.y,width:this.rWidth,height:this.rHeight}}setImg(e){this.image.style.img=e;}getImg(){return this.image.style.img}destroy(){this.image.style.img=null,this.image=null,this.imageContainer=null,this.blanks=null;}}class Yu{constructor(e,i){t(this,"tab",void 0),t(this,"viewerContext",void 0),t(this,"viewportWidth",600),t(this,"viewportHeight",800),t(this,"defaultWidth",600),t(this,"defaultHeight",800),t(this,"isScrollbarAppeared",!1),t(this,"isScrollbarXAppeared",!1),t(this,"isScrollbarYAppeared",!1),t(this,"isScrollbarChanged",!1),t(this,"currentViewportWidth",0),t(this,"currentViewportHeight",0),t(this,"currentLayoutWidth",0),t(this,"currentLayoutHeight",0),t(this,"scrollLeft",0),t(this,"scrollTop",0),t(this,"maxScrollLeft",0),t(this,"maxScrollTop",0),t(this,"direction","vertical"),t(this,"preloadCount",1),t(this,"placeholderPages",[]),t(this,"pagePreloadChanges",[]),t(this,"startRow",0),t(this,"endRow",0),t(this,"startColumn",0),t(this,"endColumn",0),t(this,"displayMode",void 0),t(this,"fitMode",void 0),t(this,"rows",void 0),t(this,"columns",void 0),t(this,"zoom",void 0),t(this,"defaultReference",void 0),t(this,"zoomReference",void 0),t(this,"resizeReference",void 0),t(this,"oldZoom",void 0),t(this,"isZoomChanged",void 0),t(this,"isOutOfBounds",void 0),this.tab=e,this.viewerContext=i;const{viewerConfig:s}=i;this.rows=s.rows,this.columns=s.columns,this.zoom=s.zoom,this.oldZoom=s.zoom,this.displayMode=s.displayMode,this.fitMode=s.fitMode,this.direction=s.scrollDirection,this.isZoomChanged=!1,this.isOutOfBounds=!1;}get isVertical(){return "vertical"===this.direction}get isContinuousDisplay(){return "continuous"===this.displayMode}get isSingleDisplay(){return "single"===this.displayMode}get scrollbarWidth(){return this.getScrollbarWidth()}getScrollbarWidth(){const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);const t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t}getRealRowAndColumnContinuous(){const{rows:e,columns:t,direction:i}=this,{total:s}=this.tab;let o=e,r=t;return "vertical"===i?(o=Math.ceil(s/t),s<=t&&(r=Math.max(1,s),o=1)):(r=Math.ceil(s/e),s<=e&&(o=Math.max(1,s),r=1)),{realRow:o,realColumn:r}}getRealRowAndColumnThumbnail(){const{total:e}=this.tab,{rows:t,columns:i,isVertical:s}=this,o=s?i:Math.ceil(e/t);return {realRow:s?Math.ceil(e/i):t,realColumn:o}}getZoomOriginCord(){const{zoomOrigin:e}=this.viewerContext.viewerConfig,t={start:0,center:.5,end:1};return {originX:this.currentViewportWidth*t[e.x],originY:this.currentViewportHeight*t[e.y]}}getMargin(){return this.formatMarginAndGap(this.viewerContext.viewerConfig.margin)}getPageBorderWidth(){const{styleService:e}=this.viewerContext,{borderWidth:t}=e.getParsedPageStyle();return {borderWidth:t,selectedBorderWidth:e.getParsedSelectedPageStyle().borderWidth,hoveredBorderWidth:e.getParsedHoveredPageStyle().borderWidth}}getPages(){return this.tab.pages}getParsedPageNumberStyle(e,t){return this.viewerContext.styleService.getParsedPageNumberStyle({width:e,height:t})}getPageNumberStyle(){return this.viewerContext.viewerConfig.pageNumberStyle}getParsedCheckboxStyle(e,t){return this.viewerContext.styleService.getParsedCheckboxStyle({width:e,height:t})}getParsedPageStyle(){return this.viewerContext.styleService.getParsedPageStyle()}getParsedCurrentPageStyle(){return this.viewerContext.styleService.getParsedCurrentPageStyle()}getParsedSelectedPageStyle(){return this.viewerContext.styleService.getParsedSelectedPageStyle()}getParsedHoveredPageStyle(){return this.viewerContext.styleService.getParsedHoveredPageStyle()}getParsedPlaceholderStyle(){return this.viewerContext.styleService.getParsedPlaceholderStyle()}getParsedCanvasStyle(){return this.viewerContext.styleService.getParsedCanvasStyle()}formatMarginAndGap(e){if($(e)){if(/px/.test(e)){const[t]=e.match(/(\d+)/);return parseInt(t,10)}const t=this.viewerContext.rendererService.getCanvasDom();if(/%/.test(e)){const i=t.width/Ne(),[s]=e.match(/(\d+)/);return i*parseInt(s,10)/100}if(/em/.test(e)){const i=getComputedStyle(t).fontSize,[s]=i.match(/(\d+)/),[o]=e.match(/(\d+)/);return parseInt(s,10)*parseInt(o,10)}}return G(e)?e:parseInt(e,10)}updateLayoutOptions(e){Object.assign(this,e);}setZoom(e){this.oldZoom=this.zoom,this.zoom=e,this.tab.pages.forEach((t=>{t.zoom=e;}));}resetScrollbarStatus(){this.isScrollbarAppeared=!1,this.isScrollbarChanged=!1,this.isScrollbarXAppeared=!1,this.isScrollbarYAppeared=!1;}reset(){this.viewportWidth=0,this.viewportHeight=0;}getTabOffset(){const{maxScrollLeft:e,maxScrollTop:t,currentLayoutWidth:i,currentLayoutHeight:s,currentViewportWidth:o,currentViewportHeight:r,scrollLeft:n,scrollTop:a}=this;let l=0,h=0;const c=this.getParsedCanvasStyle().borderWidth||0;return l=e>0?-n:(o-(i-2*c))/2,h=t>0?-a:(r-(s-2*c))/2,{offsetX:l,offsetY:h}}parseReferenceDefault(){const{tab:e,maxScrollLeft:t,maxScrollTop:i}=this,s=e.current,o=this.placeholderPages[s];if(!o)return {scrollLeft:0,scrollTop:0};const r=this.getMargin();let n=o.x-r,a=o.y-r;return this.isContinuousDisplay&&(n=o.pageX-r,a=o.pageY-r),n=X(n,0,t),a=X(a,0,i),{scrollLeft:n,scrollTop:a}}parseReferenceZoom(e,t,i){if(W(e)&&(e=this.zoomReference),W(t)||W(i)){const{originX:e,originY:s}=this.getZoomOriginCord();t=e,i=s;}let{scrollLeft:s,scrollTop:o}=this.parseReference(e,t,i);const{maxScrollLeft:r,maxScrollTop:n}=this;return s=X(s,0,r),o=X(o,0,n),{scrollLeft:s,scrollTop:o}}parseReferenceResize(){const{resizeReference:e}=this;let{scrollLeft:t,scrollTop:i}=this.parseReference(e,0,0);const{maxScrollLeft:s,maxScrollTop:o}=this;return t=Math.min(t,s),i=Math.min(i,o),{scrollLeft:t,scrollTop:i}}updateReference(){const{currentViewportWidth:e,currentViewportHeight:t}=this,i=this.generateReference(0,0),s=this.generateReference(e/2,t/2),{originX:o,originY:r}=this.getZoomOriginCord(),n=this.generateReference(o,r);this.defaultReference=s,this.resizeReference=i,this.zoomReference=n;}generateReference(e,t){let i,s,o,r,n=null,a=Number.MAX_VALUE;const{offsetX:l,offsetY:h}=this.getTabOffset(),{zoom:c}=this;this.placeholderPages.forEach((d=>{if(d&&("single"===this.displayMode&&d.uid===this.tab.currentUid||"continuous"===this.displayMode)){const u=d.x+l,g=d.y+h,f=new ne(u+d.width/2,g+d.height/2).distanceTo({x:e,y:t});f<a&&(a=f,n=d.uid,e<u?(i="start",o=u-e):e>u+d.width?(i="end",o=e-(u+d.width)):(i="center",o=(e-u)/c),t<g?(s="start",r=g-t):t>g+d.height?(s="end",r=t-(g+d.height)):(s="center",r=(t-g)/c));}}));return {pageX:o,pageY:r,positionX:i,positionY:s,pageUid:n}}parseReference(e,t,i){const{pageX:s,pageY:o,positionX:r,positionY:n,pageUid:a}=e,l=this.placeholderPages.find((e=>e.uid===a)),{zoom:h}=this;let c,d,u=0,g=0;return l&&("start"===r?c=l.x-s:"center"===r?c=l.x+s*h:"end"===r&&(c=l.x+l.width+s),"start"===n?d=l.y-o:"center"===n?d=l.y+o*h:"end"===n&&(d=l.y+l.height+o)),u=c-t,g=d-i,{scrollLeft:u,scrollTop:g}}getScrollValuesByCurrentChanged(){const{placeholderPages:e,currentViewportWidth:t,currentViewportHeight:i,startRow:s,endRow:o,startColumn:r,endColumn:n,isVertical:a}=this,{current:l}=this.tab,h=this.getMargin(),{realRow:c,realColumn:d}=this.getRealRowAndColumnThumbnail();let u=l,g=l;a?(u=s*d+r,g=o*d+n):(u=r*c+s,g=n*c+n);let f=X(this.scrollLeft,0,this.maxScrollLeft),p=X(this.scrollTop,0,this.maxScrollTop);if(l>=u&&l<=g)return {scrollLeft:f,scrollTop:p};const m=e[l];return m&&(a?(f=0,l<u?p=m.y-h:l>g&&(p=m.y+m.height+h-i)):(p=0,l<u?f=m.x-h:l>g&&(f=m.x+m.width+h-t))),f=X(f,0,this.maxScrollLeft),p=X(p,0,this.maxScrollTop),{scrollLeft:f,scrollTop:p}}getCurrentByScroll(){const{placeholderPages:e,currentViewportWidth:t,currentViewportHeight:i,startRow:s,endRow:o,startColumn:r,endColumn:n,isVertical:a}=this,{realRow:l,realColumn:h}=this.getRealRowAndColumnContinuous(),c=t/2,d=i/2,{offsetX:u,offsetY:g}=this.getTabOffset(),{current:f}=this.tab;let p=Number.MAX_VALUE,m=Number.MAX_VALUE,v=a?Math.floor(f/h):f%l,y=a?f%h:Math.floor(f/l);for(let t=s;t<=o;t++){const i=e[t*h];if(!i)continue;const{y:s,height:o}=i,r=s+g,n=r-d,a=d-r-o;if(n<=0&&a<=0){v=t;break}n>0&&n<m?(m=n,v=t):a>0&&a<m&&(m=a,v=t);}for(let t=r;t<=n;t++){const i=e[r];if(!i)continue;const{x:s,width:o}=i,n=s+u,a=n-c,l=c-n-o;if(a<=0&&l<=0){y=t;break}a>0&&a<p?(p=a,y=t):l>0&&l<p&&(p=l,y=t);}const w=v*h+y;return w===f?null:w}setTabScrollValue(e,t){this.updateLayoutOptions({scrollLeft:e,scrollTop:t});const{offsetX:i,offsetY:s}=this.getTabOffset();this.tab.setPosition({x:i,y:s});}}function qu(e){const{borderWidth:t,borderColor:i,borderStyle:s}=Le(e),o=parseInt(t||"0px",10);let r=[0,0];return "dashed"===s&&(r=[2*o,o]),{borderWidth:o,borderStyle:r,borderColor:i||"",lineDash:r}}function Qu(e,t){if(W(e)||""===e)return null;const i=_r(e);return "%"===i.unit?t*i.value/100:i.value}function Zu(e,t,i){e.style.width=`${t}px`,e.style.height=`${i}px`;}function Ju(e){const t=devicePixelRatio;return G(e)&&e>0?(e=Math.floor(e*t)/t)||(e=1/t):e=0,e}function Ku(e){const t=devicePixelRatio;return G(e)?(e=Math.round(e*t)/t)||(e=1/t):e=0,e}function eg(e){return Ku(e)}const tg=()=>{const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);const t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t};class ig extends Cn{constructor(e,i){super({name:"DocTab"}),t(this,"uid",void 0),t(this,"docType",void 0),t(this,"docName",void 0),t(this,"doc",void 0),t(this,"isActive",!1),t(this,"currentUid",void 0),t(this,"total",void 0),t(this,"selected",void 0),t(this,"context",void 0),t(this,"viewerContext",void 0),t(this,"shiftReference",void 0),t(this,"oldCurrentUid",void 0),t(this,"oldCurrent",void 0),this.doc=e,this.uid=e.uid,this.docName=e.name,this.docType=e.type,this.total=0,this.selected=[],this.viewerContext=i,this.context=new Yu(this,i),this.oldCurrent=-1,this.oldCurrentUid=void 0,e.pages.forEach((e=>{const t=this.createPage(e);this.appendChild(t);})),this.total=e.pages.length,this.total>0&&(this.updateOldInfo(),this.currentUid=this.pages[this.scrollToLatest?this.total-1:0].uid);}get scrollToLatest(){let{scrollToLatest:e}=this.viewerContext.viewer.group.config;return W(e)&&(e=this.viewerContext.viewerConfig.scrollToLatest),e}get pages(){return this.childNodes}get current(){return this.currentUid?this.uidToIndex(this.currentUid):-1}get isDocType(){return "document"===this.docType}createPage(e){const{pageStyle:t,pageNumberStyle:i,checkboxStyle:s,removeBtnStyle:o,blankFillColor:r}=this.viewerContext.viewerConfig,n=function(e){const{border:t,background:i}=e;let s={};t&&(s=qu(t));return {background:i,...s}}(t),{width:a,height:l}=this.viewerContext.getPageRenderSize(e);return new Xu({tab:this,uid:e,formattedPageStyle:n,pageNumberStyle:i,checkboxStyle:s,removeBtnStyle:o,blankFillColor:r,style:{pointerEvents:"auto",width:a,height:l}})}updateOldInfo(){this.oldCurrentUid=this.currentUid,this.oldCurrent=this.current;}updateViewportSize(e,t){this.context.updateLayoutOptions({viewportWidth:e,viewportHeight:t});}rename(e){this.docName=e;}getCurrentPage(){return this.getPageByUid(this.currentUid)}getAllPageUids(){return this.pages.map((e=>e.uid))}appendPages(e,t,i){const s=e.length;if(!s)return;const o=G(i);if(e.forEach(((e,t)=>{const s=this.createPage(e);this.appendChild(s,o?i+t:void 0);})),this.total=this.pages.length,t)this.currentUid=this.indexToUid(o?i+s-1:this.total-1),this.updateDefaultReference();else if(!this.currentUid){var r;this.currentUid=null===(r=this.pages[0])||void 0===r?void 0:r.uid,this.updateDefaultReference();}}deletePages(e){this.updateOldInfo();const t=[...e],i=e.includes(this.currentUid);if(i){const i=e.indexOf(this.currentUid);t.splice(i,1),t.push(this.currentUid);}t.forEach((e=>{const t=this.getPageByUid(e);if(i&&t.uid===this.currentUid){if(1===this.total)this.currentUid=null;else {const{current:e}=this,t=e===this.total-1?-1:1;this.currentUid=this.indexToUid(e+t);}this.updateDefaultReference();}Be(this.selected,e),this.removeChild(t),this.total-=1;}));}deleteAllPages(){this.updateOldInfo();[...this.pages].forEach((e=>{this.removeChild(e);})),this.currentUid=null,this.selected=[],this.total=0;}movePages(e,t){return this.updateOldInfo(),Ue(this.pages,e,t)}switchPage(e,t){return this.updateOldInfo(),We(this.pages,e,t)}reorderPages(e){return (!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.updateOldInfo(),Ve(this.pages,e)}gotoPage(e){return 0===this.total?-1:(this.updateOldInfo(),e!==this.current&&(e=X(e,0,this.total-1),this.currentUid=this.indexToUid(e),this.updateDefaultReference()),this.updateShiftReference(),e)}selectPages(e){this.pages.forEach((t=>{t.isSelected=e.includes(t.uid);})),this.selected=e;}selectPagesByIndices(e){const t=this.indicesToUids(e);this.selectPages(t);}getSelected(){return this.selected.slice()}getSelectedIndices(){return this.selected.map((e=>this.uidToIndex(e)))}getPageByIndex(e){return this.pages[e]}getPageByUid(e){return this.pages.find((t=>t.uid===e))}getPageIndex(e){return this.pages.findIndex((t=>t.uid===e.uid))}uidToIndex(e){return this.pages.findIndex((t=>t.uid===e))}uidsToIndices(e){return e.map((e=>this.uidToIndex(e)))}indexToUid(e){var t;return null===(t=this.pages[e])||void 0===t?void 0:t.uid}indicesToUids(e){return e.map((e=>this.indexToUid(e)))}updateShiftReference(){this.shiftReference=this.currentUid;}updateDefaultReference(){this.context.defaultReference={pageUid:this.currentUid};}destroy(){super.destroy(),this.deleteAllPages(),this.isActive=!1,this.doc=null,this.context=null,this.viewerContext=null,this.isDestroyed=!0;}}class sg{constructor(e){t(this,"uid",void 0),t(this,"docType",void 0),t(this,"docName",void 0),t(this,"doc",void 0),t(this,"isActive",!1),this.uid=e.uid,this.docType=e.type,this.docName=e.name,this.doc=e;}rename(e){this.docName=e;}}class og{constructor(e){t(this,"uid",void 0),t(this,"docType",void 0),t(this,"docName",void 0),t(this,"doc",void 0),t(this,"isActive",!1),this.uid=e.uid,this.docType=e.type,this.docName=e.name,this.doc=e;}rename(e){this.docName=e;}}class rg{constructor(e){t(this,"selectionStack",void 0),t(this,"tabs",void 0),t(this,"activeTabUid",void 0),t(this,"tabMode",void 0),t(this,"context",void 0),this.selectionStack=[],this.tabs=new Map,this.context=e,this.tabMode=e.viewerConfig.tabMode;}destroy(){this.clearTabs(),this.selectionStack.length=0;}updateViewportSize(e,t){const i=this.getActiveTab();null!=i&&i.isDocType&&i.updateViewportSize(e,t);}createTab(e){if(this.tabs.has(e.uid))return this.tabs.get(e.uid);let t=null;return "document"===e.type?t=new ig(e,this.context):"video"===e.type?t=new og(e):"audio"===e.type&&(t=new sg(e)),"single"===this.tabMode&&this.clearTabs(),this.tabs.set(t.uid,t),t}closeTab(e){if(!this.tabs.has(e))return !1;const{selectionStack:t}=this;if(t.includes(e)){const i=t.indexOf(e);t.splice(i,1);}return this.getTab(e).isActive=!1,this.tabs.delete(e),this.activeTabUid===e&&(this.activeTabUid=t[t.length-1]),!0}getTab(e){return this.tabs.get(e)}getDocTab(e){const t=this.getTab(e);return null!=t&&t.isDocType?t:null}hasTab(e){return this.tabs.has(e)}getActiveTab(){return this.tabs.get(this.activeTabUid)}getActiveTabUid(){return this.activeTabUid}getAllTabs(){return Array.from(this.tabs.values())}activateTab(e){if(!this.tabs.has(e))return !1;const{selectionStack:t}=this;if("single"===this.tabMode)t.length=0;else if(t.includes(e)){const i=t.indexOf(e);t.splice(i,1);}return t.push(e),this.activeTabUid=e,this.tabs.forEach((t=>{t.isActive=t.uid===e;})),!0}clearTabs(){this.getAllTabs().forEach((e=>{e.destroy();})),this.tabs.clear();}}class ng{constructor(e){t(this,"parsedPageStyleCache",void 0),t(this,"parsedCurrentPageStyleCache",void 0),t(this,"parsedSelectedPageStyleCache",void 0),t(this,"parsedHoveredPageStyleCache",void 0),t(this,"parsedPlaceholderStyleCache",void 0),t(this,"parsedCheckboxStyleCache",void 0),t(this,"parsedPageNumberStyleCache",void 0),t(this,"parsedQuadSelectionStyleCache",void 0),t(this,"parsedCanvasStyleCache",void 0),t(this,"context",void 0),t(this,"isPageStyleChanged",void 0),t(this,"isCurrentPageStyleChanged",void 0),t(this,"isSelectedPageStyleChanged",void 0),t(this,"isHoveredPageStyleChanged",void 0),t(this,"isPlaceholderStyleChanged",void 0),t(this,"isCheckboxStyleChanged",void 0),t(this,"isPageNumberStyleChanged",void 0),t(this,"isQuadSelectionStyleChanged",void 0),t(this,"isCanvasStyleChanged",void 0),this.context=e;}getParsedCanvasStyle(){return !this.isCanvasStyleChanged&&this.parsedCanvasStyleCache||(this.parsedCanvasStyleCache=ag(this.context.viewerConfig.canvasStyle),this.isCanvasStyleChanged=!1),this.parsedCanvasStyleCache}getParsedCheckboxStyle(e){return !this.isCheckboxStyleChanged&&this.parsedCheckboxStyleCache||(this.parsedCheckboxStyleCache=ag(this.context.viewerConfig.checkboxStyle,e),this.isCheckboxStyleChanged=!1),this.parsedCheckboxStyleCache}getParsedPageNumberStyle(e){return !this.isPageNumberStyleChanged&&this.parsedPageNumberStyleCache||(this.parsedPageNumberStyleCache=ag(this.context.viewerConfig.pageNumberStyle,e),this.isPageStyleChanged=!1),this.parsedPageNumberStyleCache}getParsedPageStyle(){return !this.isPageStyleChanged&&this.parsedPageStyleCache||(this.parsedPageStyleCache=ag(this.context.viewerConfig.pageStyle),this.isPageStyleChanged=!1),this.parsedPageStyleCache}getParsedCurrentPageStyle(){return !this.isCurrentPageStyleChanged&&this.parsedCurrentPageStyleCache||(this.parsedCurrentPageStyleCache=ag(this.context.viewerConfig.currentPageStyle),this.isCurrentPageStyleChanged=!1),this.parsedCurrentPageStyleCache}getParsedSelectedPageStyle(){return !this.isSelectedPageStyleChanged&&this.parsedSelectedPageStyleCache||(this.parsedSelectedPageStyleCache=ag(this.context.viewerConfig.selectedPageStyle),this.isSelectedPageStyleChanged=!1),this.parsedSelectedPageStyleCache}getParsedHoveredPageStyle(){return !this.isHoveredPageStyleChanged&&this.parsedHoveredPageStyleCache||(this.parsedHoveredPageStyleCache=ag(this.context.viewerConfig.hoveredPageStyle),this.isHoveredPageStyleChanged=!1),this.parsedHoveredPageStyleCache}getParsedPlaceholderStyle(){return !this.isPlaceholderStyleChanged&&this.parsedPlaceholderStyleCache||(this.parsedPlaceholderStyleCache=ag(this.context.viewerConfig.placeholderStyle),this.isPlaceholderStyleChanged=!1),this.parsedPlaceholderStyleCache}getParsedQuadSelectionStyle(){return !this.isQuadSelectionStyleChanged&&this.parsedQuadSelectionStyleCache||(this.parsedQuadSelectionStyleCache=ag(this.context.viewerConfig.quadSelectionStyle),this.isQuadSelectionStyleChanged=!1),this.parsedQuadSelectionStyleCache}}function ag(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:0,height:0};const i={};if(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{border:i,ctrlBorder:s}=e;if(!W(i)){const e=qu(i);Object.assign(t,e);}if(!W(s)){const e=qu(s);Object.assign(t,{ctrlBorderWidth:e.borderWidth,ctrlBorderColor:e.borderColor,ctrlBorderStyle:e.borderStyle});}}(e,i),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};lg.forEach((i=>{W(e[i])||(t[i]=Or(e[i]).value||0);}));}(e,i),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};hg.forEach((i=>{W(e[i])||(t[i]=e[i]);}));}(e,i),function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!W(e.width)&&(i.width=Qu(e.width,t.width),W(e.translateX)||(i.translateX=Qu(e.translateX,i.width)),!W(e.borderRadius))){const t=Qu(e.borderRadius,i.width);i.borderRadiusX=Math.max(0,Math.min(t,i.width/2));}if(!W(e.height)&&(i.height=Qu(e.height,t.height),W(e.translateY)||(i.translateY=Qu(e.translateY,i.height)),!W(e.borderRadius))){const t=Qu(e.borderRadius,i.height);i.borderRadiusY=Math.max(0,Math.min(t,i.height/2));}if(!W(e.borderRadius)){const s=Qu(e.borderRadius,t.width);i.borderRadius=Math.max(0,Math.min(s,t.height/2,t.width/2));}if(!W(e.ctrlBorderRadius)){const t=Qu(e.ctrlBorderRadius,i.ctrlWidth);i.ctrlBorderRadius=Math.max(0,Math.min(t,i.ctrlWidth/2,i.ctrlHeight/2));}cg.forEach((s=>{const o=["left","right"].includes(s)?t.width:t.height,r=_r(e[s]);let n=r.value;"%"===r.unit&&(n=o*r.value/100),i[s]=n;}));}(e,t,i),e.left||e.right||e.bottom||e.top){const{left:s,top:o,right:r,bottom:n,width:a,height:l,translateX:h,translateY:c}=i;""!==e.left?i.x=s+h||0:""!==e.right&&G(a)?i.x=t.width-a-r+h||0:i.x=0,""!==e.top?i.y=o+c||0:""!==e.bottom&&G(l)?i.y=t.height-l-n+c||0:i.y=0;}return i}const lg=["borderWidth","ctrlBorderWidth","checkMarkLineWidth","fontSize","ctrlWidth","ctrlHeight"],hg=["background","maskColor","color","borderColor","borderStyle","invalidBorderColor","ctrlBorderColor","ctrlBackground","ctrlBorderStyle","invalidCtrlBorderColor","checkMarkColor","onPage","opacity","visibility","visibleByHover","fontFamily","textAlign","textBaseline","lineJoin","lineCap"],cg=["left","top","right","bottom"];const dg="visible",ug="hidden";class gg{constructor(e){t(this,"context",void 0),this.context=e;}handleVisibility(e){if(this.context.isDestroyed||e.isDestroyed||!e.total)return;const{context:t}=this;if(t.isDefaultViewer?e.context.isContinuousDisplay?this.continuousVisibility(e):e.context.isSingleDisplay&&this.singleVisibility(e):t.isThumbnailViewer?this.thumbnailVisibility(e):t.isPerspectiveViewer&&e.context.isSingleDisplay&&this.singleVisibility(e),e.context.pagePreloadChanges.length){e.context.pagePreloadChanges.forEach((t=>{if(t.from&&!t.to){const i=e.getPageByUid(t.pageUid);i&&(i.isLoaded=!1);}}));const i={changes:e.context.pagePreloadChanges,docUid:e.uid,type:t.viewerConfig.viewerMode,viewerUid:t.uid};t.core.globalHooks.pagePreloadChanged.emit(i);}}thumbnailVisibility(e){const{total:t}=e;if(!t)return;const i=e.context;if(i.isOutOfBounds)return void e.pages.forEach((e=>{e.updateStyle({visibility:"hidden"});}));const{rows:s,columns:o,placeholderPages:r,preloadCount:n,isVertical:a}=i,{width:l,height:h}=r[0],c=i.getParsedPageStyle(),d=i.getParsedCurrentPageStyle(),u=i.getParsedSelectedPageStyle(),g=i.getParsedHoveredPageStyle(),f=i.getParsedPlaceholderStyle(),p=i.getParsedPageNumberStyle(l,h),m=i.getParsedCheckboxStyle(l,h),{visibility:v,top:y,bottom:w,onPage:b,height:x}=p;let C=0;const S="visible"===v,P=i.getPageNumberStyle();if(S){const e=""!==P.top?y:w||0;b||(C=""!==P.top?x+e:0);}const{realColumn:T,realRow:k}=i.getRealRowAndColumnThumbnail(),{startRow:D,endRow:E}=this.getVisibleRow(e,k,T),{startColumn:A,endColumn:I}=this.getVisibleColumn(e,k,T);e.context.updateLayoutOptions({startRow:D,endRow:E,startColumn:A,endColumn:I});const M=Ju(d.borderWidth),R=[];e.pages.forEach(((t,i)=>{const r=a?Math.floor(i/o):i%s,l=a?i%o:Math.floor(i/s),h=r>=D-n&&r<=E+n&&l>=A-n&&l<=I+n,v=r>=D&&r<=E&&l>=A&&l<=I?dg:ug;t.isPreload!==h&&R.push({from:t.isPreload,to:h,pageUid:t.uid,index:i});let y={borderWidth:0,background:"#ffffff00"};t.isDragging&&(y=f);let w=c;t.isHovered&&(w=g),t.isSelected&&(w=u);const x=Ju(w.borderWidth);if(t.isPreload=h,t.updateStyle({visibility:v,...y}),t.borderBox.updateStyle({...w,visibility:v,borderWidth:x}),t.imageContainer.updateStyle({visibility:v,background:"#fff"}),t.image.updateStyle({visibility:v}),S){let e=p.y;b||(e=""!==P.top?-C:p.y+p.bottom),t.pageNumber.parsedPageNumberStyle={...p,y:e},t.pageNumber.updateText((i+1).toString());}t.pageNumber.updateStyle({visibility:p.visibility,zIndex:p.onPage?1:0});let T=m.visibility;m.visibleByHover&&(T=t.isHovered||t.isSelected?m.visibility:"hidden"),t.checkbox.parsedCheckboxStyle={...m},t.checkbox.updateStyle({visibility:T}),t.checkbox.checked=t.isSelected,t.currentStyleBox.updateStyle({...d,visibility:t.uid===e.currentUid?dg:ug,borderWidth:M});})),e.context.pagePreloadChanges=R;}continuousVisibility(e){const{preloadCount:t,isVertical:i}=e.context,{pages:s}=e,o=e.context.getParsedPageStyle(),r=e.context.getParsedCurrentPageStyle(),{realRow:n,realColumn:a}=e.context.getRealRowAndColumnContinuous(),{startRow:l,endRow:h}=this.getVisibleRow(e,n,a),{startColumn:c,endColumn:d}=this.getVisibleColumn(e,n,a);e.context.updateLayoutOptions({startRow:l,endRow:h,startColumn:c,endColumn:d});const u=Ju(o.borderWidth),g=Ju(r.borderWidth),f=[];s.forEach(((s,p)=>{const m=i?Math.floor(p/a):p%n,v=i?p%a:Math.floor(p/n),y=m>=l&&m<=h&&v>=c&&v<=d,w=m>=l-t&&m<=h+t&&v>=c-t&&v<=d+t;s.isPreload!==w&&f.push({from:s.isPreload,to:w,pageUid:s.uid,index:p}),s.checkbox.updateStyle({visibility:ug}),s.pageNumber.updateStyle({visibility:ug}),s.currentStyleBox.updateStyle({...r,visibility:s.uid===e.currentUid?dg:ug,borderWidth:g}),s.borderBox.updateStyle({...o,borderWidth:u}),s.updateStyle({visibility:y?dg:ug}),s.isPreload=w;})),e.context.pagePreloadChanges=f;}singleVisibility(e){const{preloadCount:t}=e.context,{current:i,total:s,pages:o}=e,r=e.getCurrentPage(),n=e.context.getParsedPageStyle(),a=Math.max(i-t,0),l=Math.min(i+t,s-1);r.checkbox.updateStyle({visibility:ug}),r.pageNumber.updateStyle({visibility:ug});const h=Ju(n.borderWidth),c=[];o.forEach(((e,t)=>{const i=t>=a&&t<=l,s=e.uid===r.uid;e.isPreload!==i&&c.push({from:e.isPreload,to:i,pageUid:e.uid,index:t}),e.borderBox.updateStyle({...n,borderWidth:h}),e.updateStyle({visibility:s?dg:ug}),e.isPreload=i,e.currentStyleBox.updateStyle({visibility:ug});})),e.context.pagePreloadChanges=c;}getVisibleColumn(e,t,i){const{scrollLeft:s,placeholderPages:o,currentViewportWidth:r,isVertical:n}=e.context;let a=0,l=i-1;if(n&&this.context.isThumbnailViewer)return {startColumn:a,endColumn:l};let h=Number.MAX_VALUE,c=Number.MAX_VALUE,d=null,u=null;for(let e=0;e<i;e++){const i=o[n?e:e*t];if(!i)continue;const{width:g,x:f}=i;if(null===d){const t=f-s;t<=0&&s-(f+g)<-1?(d=e,a=e):t>0&&t<h&&(h=t,a=e);}if(null===u){const t=s+r,i=t-(f+g);f-t<-1&&i<=0?(u=e,l=e):i>0&&i<c&&(c=i,l=e);}if(null!==d&&null!==u)break}return {startColumn:a,endColumn:l}}getVisibleRow(e,t,i){const{scrollTop:s,placeholderPages:o,currentViewportHeight:r,isVertical:n}=e.context;let a=0,l=t-1;if(!n&&this.context.isThumbnailViewer)return {startRow:a,endRow:l};let h=Number.MAX_VALUE,c=Number.MAX_VALUE,d=null,u=null;for(let e=0;e<t;e++){const t=o[n?e*i:e];if(!t)continue;const{y:g,height:f}=t;if(null===d){const t=g-s;t<=0&&s-(g+f)<-1?(d=e,a=e):t>0&&t<h&&(h=t,a=e);}if(null===u){const t=s+r,i=t-(g+f);g-t<-1&&i<=0?(u=e,l=e):i>0&&i<c&&(c=i,l=e);}if(null!==d&&null!==u)break}return {startRow:a,endRow:l}}}function fg(e,t,i){const s={isOver:!1,pointerX:-1,pointerY:-1,page:e};if(e&&e.isVisible){const{x:o,y:r}=e.getPosition(),{width:n,height:a}=e;s.isOver=t>=o&&i>=r&&t<=o+n&&i<=r+a;const l=e.getScale();s.pointerX=(t-o)/l.x,s.pointerY=(i-r)/l.y;}return s}const pg={tag:"div",id:"ddv-thumbnail-container",className:"ddv-thumbnail-container"},mg={tag:"div",id:"ddv-main-container",className:"ddv-main-container",children:[{tag:"div",id:"ddv-scroller-and-canvas",className:"ddv-scroller-and-canvas",children:[{tag:"div",id:"ddv-scroll-container",className:"ddv-scroll-container",children:[{tag:"div",id:"ddv-scroll-content",className:"ddv-scroll-content"}]},{tag:"div",id:"ddv-canvas-container",className:"ddv-canvas-container",children:[]}]}]},vg={tag:"div",id:"ddv-video-container",className:"ddv-video-container"},yg={tag:"div",id:"ddv-audio-container",className:"ddv-audio-container"},wg={tag:"div",id:"ddv-main-and-thumbnail",className:"ddv-main-and-thumbnail"},bg={tag:"div",id:"ddv-core",className:"ddv-core"};class xg{constructor(e,i){t(this,"container",void 0),t(this,"defaultDom",void 0),t(this,"mainAndThbContainer",void 0),t(this,"thumbnailContainer",void 0),t(this,"mainContainer",void 0),t(this,"scrollerAndCanvasContainer",void 0),t(this,"scrollContainer",void 0),t(this,"scrollContent",void 0),t(this,"canvasContainer",void 0),t(this,"videoContainer",void 0),t(this,"audioContainer",void 0),t(this,"rootDom",void 0),t(this,"hooks",void 0),t(this,"isBindContainer",!1),t(this,"viewportWidth",void 0),t(this,"viewportHeight",void 0),t(this,"context",void 0),t(this,"dpr",Ne()),this.context=e,this.hooks=i;const s=Uu(bg,e.postfix);this.defaultDom=s;}destroy(){var e,t;null===(e=this.rootDom)||void 0===e||e.remove(),null===(t=this.thumbnailContainer)||void 0===t||t.remove(),this.defaultDom=null,this.rootDom=null,this.thumbnailContainer=null;}createMainAndThbContainer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainAndThbContainer){const t=Uu(wg,e);this.mainAndThbContainer=t,this.defaultDom.appendChild(t);}}createMainContainer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainContainer){const t=Uu(mg,e);this.mainContainer=t,this.mainAndThbContainer.appendChild(t);const i=t.querySelector(`#ddv-scroller-and-canvas${e}`),s=t.querySelector(`#ddv-canvas-container${e}`),o=t.querySelector(`#ddv-scroll-container${e}`),r=t.querySelector(`#ddv-scroll-content${e}`);this.scrollerAndCanvasContainer=i,this.canvasContainer=s,this.scrollContainer=o,this.scrollContent=r;const n=e=>{e.target===t&&this.isBindContainer&&this.context.isInitialized&&this.context.resize();},{resizeService:a}=this.context.core;a.observe(t),a.hooks.resizeObserver.on(n),this.context.hooks.destroy.on((()=>{a.unobserve(t),a.hooks.resizeObserver.off(n);}));}}createThumbnailContainer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.thumbnailContainer){const t=Uu(pg,e);this.thumbnailContainer=t,this.mainAndThbContainer.insertBefore(t,this.mainContainer);}}createVideoContainer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.videoContainer){const t=Uu(vg,e);this.mainContainer.appendChild(t);}}createAudioContainer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.audioContainer){const t=Uu(yg,e);this.mainContainer.appendChild(t);}}getViewportSize(){if(!this.mainContainer)return {width:0,height:0};const{offsetWidth:e,offsetHeight:t}=this.getElSize(this.mainContainer),i=this.getCanvasBorderSize();return {width:e-2*i,height:t-2*i}}resetViewport(){const{scrollContent:e,canvasContainer:t}=this;Zu(t,0,0),Zu(e,0,0);const{width:i,height:s}=this.getViewportSize();this.viewportWidth=i,this.viewportHeight=s,this.updateCanvasContainerSize();}resizeViewport(){const{canvasContainer:e,scrollContainer:t}=this;Zu(e,0,0);const{offsetWidth:i,offsetHeight:s}=this.getElSize(t);this.viewportWidth=i,this.viewportHeight=s,this.updateCanvasContainerSize();}checkIsRound(e){const t=getComputedStyle(e);return {roundWidth:parseFloat(t.width)%1>=.5,roundHeight:parseFloat(t.height)%1>=.5}}getElSize(e){const{roundWidth:t,roundHeight:i}=this.checkIsRound(e);let{clientWidth:s,clientHeight:o,offsetWidth:r,offsetHeight:n}=e;return t&&(s-=1,r-=1),i&&(o-=1,n-=1),{clientWidth:s,clientHeight:o,offsetWidth:r,offsetHeight:n}}getMaxScrollValue(){const{scrollContainer:e}=this;return {scrollLeft:e.scrollWidth-e.clientWidth,scrollTop:e.scrollHeight-e.clientHeight}}isViewerResized(){return this.scrollContainer.offsetWidth!==this.viewportWidth||this.scrollContainer.offsetHeight!==this.viewportHeight}isDPRChanged(){const e=Ne();return this.dpr!==e&&(this.dpr=e,!0)}isScrollbarAppeared(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight}bindContainer(e){let t=e;return e&&$(e)&&(t=document.querySelector(`#${e}`)),t instanceof HTMLElement&&(t.appendChild(this.defaultDom),this.container=t,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0)}unbindContainer(){if(!this.container||0===this.container.children.length)return !1;for(let e=0;e<this.container.children.length;e++)if(this.container.children[e]===this.rootDom){this.container.removeChild(this.rootDom);break}return this.isBindContainer=!1,!0}scrollTo(e,t){const{scrollContainer:i}=this;i.scrollTo?i.scrollTo(e,t):(i.scrollLeft=e,i.scrollTop=t);}scrollBy(e,t){const{scrollContainer:i}=this;i.scrollBy?i.scrollBy(e,t):(i.scrollLeft+=e,i.scrollTop+=t);}updateScrollerContentSize(e){const{currentLayoutWidth:t,currentLayoutHeight:i}=e.context,{scrollContent:s,canvasContainer:o,scrollContainer:r}=this;Zu(o,0,0),Zu(s,t,i);const n=r.scrollWidth-r.clientWidth,a=r.scrollHeight-r.clientHeight;e.context.updateLayoutOptions({maxScrollLeft:n,maxScrollTop:a}),this.updateCanvasContainerSize();}updateCanvasContainerSize(){const{scrollContainer:e,canvasContainer:t}=this,{width:i,height:s}=getComputedStyle(this.scrollContainer);let o,r=parseFloat(i),n=parseFloat(s);e.offsetWidth!==e.clientWidth&&(G(o)||(o=tg()),r-=o),e.offsetHeight!==e.clientHeight&&(G(o)||(o=tg()),n-=o),Zu(t,r,n);}getCanvasBorderSize(){const{canvasContainer:e}=this;return (e.offsetWidth-e.clientWidth)/2}}class Cg{constructor(e){t(this,"canvasDom",void 0),t(this,"context",void 0),t(this,"canvas",void 0),t(this,"renderer",void 0),t(this,"isInitialized",!1),t(this,"canvasWidth",0),t(this,"canvasHeight",0),this.context=e;}render(e){const t=this.canvas.document.documentElement;if(e)if(0===t.children.length)t.appendChild(e);else {t.children.indexOf(e)<0&&t.replaceChild(e,t.children[0]);}else {const e=[...t.children];for(let i=e.length;i>=0;i--)t.removeChild(e[i]);}this.canvas.render();}initCanvas(e){let{container:t,width:i,height:s}=e;const o=new Ma({}),r=new ga({renderer:o,container:t,width:i,height:s});this.canvasWidth=i,this.canvasHeight=s,this.renderer=o,this.canvas=r,this.canvasDom=r.contextService.getDomElement(),this.canvasDom.style.width="100%",this.canvasDom.style.height="100%",this.isInitialized=!0;}registerShapeRenderer(e,t){this.canvas.contextService.registerShapeRenderer(e,t);}getCanvasPosition(){const e=this.canvasDom.getBoundingClientRect(),{scrollX:t,scrollY:i}={scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};return {x:e.left+t,y:e.top+i}}resize(e,t){const i=Ne();this.canvas.setDPR(i),this.canvasWidth=e,this.canvasHeight=t,this.canvas.resize(e,t);}}class Sg{render(e,t){const{opacity:i,visibility:s}=e.parsedCheckboxStyle;0!==i&&"hidden"!==s&&(t.save(),t.globalAlpha=i,this.renderBox(e,t,"out"),t.clip(),this.renderBox(e,t,"in"),this.fill(e,t),this.renderBox(e,t,"center"),this.stroke(e,t),this.renderCheckMark(e,t),t.restore());}renderBox(e,t,i){const{x:s,y:o,width:r,height:n,borderWidth:a,borderRadiusX:l,borderRadiusY:h}=e.parsedCheckboxStyle;let c=0;"center"===i?c=a/2:"in"===i&&(c=a);const d=[{x:s+l,y:o+h,start:Math.PI,end:3*Math.PI/2},{x:s+r-l,y:o+h,start:3*Math.PI/2,end:2*Math.PI},{x:s+r-l,y:o+n-h,start:0,end:Math.PI/2},{x:s+l,y:o+n-h,start:Math.PI/2,end:Math.PI}],u=Math.max(l-c,0),g=Math.max(h-c,0);if(t.beginPath(),t.ellipse&&u&&g)for(let e=0;e<4;e++){const{x:i,y:s,start:o,end:r}=d[e];t.ellipse(i,s,u,g,0,o,r);}else t.rect(s,o,r,n);t.closePath();}fill(e,t){const{background:i}=e.parsedCheckboxStyle;i&&""!==i&&(t.fillStyle=i,t.fill());}stroke(e,t){const{borderColor:i,borderWidth:s,borderStyle:o}=e.parsedCheckboxStyle;t.setLineDash(o),t.strokeStyle=i,t.lineWidth=s,s>0&&i&&""!==i&&t.stroke();}renderCheckMark(e,t){if(!e.checked)return;const{x:i,y:s,width:o,height:r,borderWidth:n,checkMarkLineWidth:a,checkMarkColor:l}=e.parsedCheckboxStyle,h=Math.max(Math.min(o-2*n,r-2*n),0);let c=i,d=s;0!==h&&(o<r?(c+=n,d=d+n+(r-o)/2):(c=c+n+(o-r)/2,d+=n),t.setLineDash([0,0]),t.lineWidth=a,t.strokeStyle=l,t.beginPath(),t.moveTo(c+.15*h,d+.5*h),t.lineTo(c+.4*h,d+.8*h),t.lineTo(c+.85*h,d+.2*h),t.stroke());}}class Pg{render(e,t){const{opacity:i,visibility:s}=e.parsedPageNumberStyle;0!==i&&"hidden"!==s&&(t.save(),t.globalAlpha=i,this.renderBox(e,t,"out"),t.clip(),this.renderBox(e,t,"in"),this.fill(e,t),this.renderBox(e,t,"center"),this.stroke(e,t),this.renderFont(e,t),t.restore());}renderBox(e,t,i){const{x:s,y:o,width:r,height:n,borderWidth:a,borderRadiusX:l,borderRadiusY:h}=e.parsedPageNumberStyle;let c=0;"center"===i?c=a/2:"in"===i&&(c=a);const d=[{x:s+l,y:o+h,start:Math.PI,end:3*Math.PI/2},{x:s+r-l,y:o+h,start:3*Math.PI/2,end:2*Math.PI},{x:s+r-l,y:o+n-h,start:0,end:Math.PI/2},{x:s+l,y:o+n-h,start:Math.PI/2,end:Math.PI}],u=Math.max(l-c,0),g=Math.max(h-c,0);if(t.beginPath(),t.ellipse&&u&&g)for(let e=0;e<4;e++){const{x:i,y:s,start:o,end:r}=d[e];t.ellipse(i,s,u,g,0,o,r);}else t.rect(s,o,r,n);t.closePath();}renderFont(e,t){const{x:i,y:s,width:o,height:r,fontSize:n,color:a,fontFamily:l}=e.parsedPageNumberStyle;t.fillStyle=a,t.textAlign="center",t.textBaseline="middle",t.font=`${n}px ${l}`,t.fillText(e.text,i+o/2,s+r/2+n/8,o);}fill(e,t){const{background:i}=e.parsedPageNumberStyle;i&&""!==i&&(t.fillStyle=i,t.fill());}stroke(e,t){const{borderColor:i,borderWidth:s,borderStyle:o}=e.parsedPageNumberStyle;t.setLineDash(o),t.strokeStyle=i,t.lineWidth=s,s>0&&i&&""!==i&&t.stroke();}}class Tg{constructor(e,i){t(this,"context",void 0),t(this,"docRenderer",void 0),t(this,"hooks",void 0),this.context=e,this.hooks=i,this.docRenderer=new Cg(e);}initRenderer(e,t,i){this.docRenderer.isInitialized||(Object.assign(e.style,this.context.viewerConfig.canvasStyle),this.docRenderer.initCanvas({container:e,width:t,height:i}),this.docRenderer.registerShapeRenderer("checkbox",new Sg),this.docRenderer.registerShapeRenderer("pageNumber",new Pg));}getCanvasDom(){return this.docRenderer.canvasDom}clearCanvas(){const e=this.getCanvasDom();if(!e)return;Zu(e,e.width,e.height);e.getContext("2d").clearRect(0,0,e.width,e.height);}resize(e,t){this.docRenderer&&this.docRenderer.resize(e,t);}updateCanvasSize(){if(this.docRenderer){const e=this.getCanvasDom();if(!e)return;const{clientWidth:t,clientHeight:i}=e;this.docRenderer.resize(t,i);}}render(e){if(!e.isDestroyed){if(this.context.isDefaultViewer){const t=this.context.styleService.getParsedPageStyle();t.borderColor&&t.borderWidth&&e.pages.forEach((e=>{e.isVisible&&e.isLoaded&&e.borderBox.updateStyle({background:t.borderColor});}));}this.hooks.beforeRender.emit(e),this.docRenderer.render(e),this.hooks.afterRender.emit(e),e.pages.forEach(((e,t)=>{e.isVisible&&e.isLoaded&&this.context.viewer.emit("pageRendered",{index:t,pageUid:e.uid});}));}}getCanvasPosition(){const e=this.docRenderer.canvasDom.getBoundingClientRect(),{scrollX:t,scrollY:i}=window;return {x:e.left+t,y:e.top+i}}}function kg(e){const t=e.getPages(),i=t.length;if(!i)return void e.updateLayoutOptions({currentLayoutWidth:0,currentLayoutHeight:0});let{viewportWidth:s,viewportHeight:o}=e;const{rows:r,columns:n,scrollbarWidth:a,tab:l,isVertical:h}=e,c=e.getMargin();n*r<i&&(h?s-=a:o-=a);let d=0,u=0;h?(d=(s-(n+1)*c)/n,u=(o-(r+1)*c)/r):(u=(o-(r+1)*c)/r,d=(s-(n+1)*c)/n);let g=!1;(d<0||u<0)&&(g=!0,d=Math.max(0,d),u=Math.max(0,u));const f=h?Math.max(r,Math.ceil(i/n)):r,p=h?n:Math.max(n,Math.ceil(i/r)),m=d*p+(p+1)*c,v=u*f+(f+1)*c,y=l.pages.map((e=>({uid:e.uid,x:0,y:0,width:d,height:u}))),w=e.getParsedPageStyle(),b=e.getParsedSelectedPageStyle(),x=e.getParsedHoveredPageStyle(),C=e.getParsedPageNumberStyle(d,u),{visibility:S,top:P,bottom:T,onPage:k,height:D}=C;let E=d,A=u;const I=d;let M=u,R=0;const O="visible"===S,_=e.getPageNumberStyle();if(O){const e=""!==_.top?P:T||0;k||(A=u-D-e,M=u-D-e,R=""!==_.top?D+e:0);}A<0&&(g=!0,A=Math.max(0,A)),(E-2*w.borderWidth<0||A-2*w.borderWidth<0)&&(g=!0);const N=e.viewerContext.viewService.getCanvasBorderSize();e.updateLayoutOptions({currentLayoutWidth:g?0:m+2*N,currentLayoutHeight:g?0:v+2*N,currentViewportWidth:g?e.viewportWidth:s,currentViewportHeight:g?e.viewportHeight:o,isOutOfBounds:g}),g||(E=eg(E),A=eg(A),t.forEach(((t,i)=>{let s=w.borderWidth;t.isHovered&&(s=x.borderWidth),t.isSelected&&(s=b.borderWidth),s=Ju(s);const o=h?i%n:Math.floor(i/r),a=h?Math.floor(i/n):i%r,l=c+o*(c+d),g=c+a*(c+u);y[i].x=l,y[i].y=g;let f=E-2*s,p=A-2*s;f=Math.max(f,0),p=Math.max(p,0);const m=t.rWidth,v=t.rHeight;let C=m,S=v,P=1;(m>f||v>p)&&(m/v>f/p?(P=f/m,C=f,S=v*P):(P=p/v,S=p,C=m*P)),t.zoom=P;const T=Ku(l),k=Ku(g+R);t.updateStyle({x:T,y:k,width:I,height:M}),t.borderBox.updateStyle({x:0,y:0,width:E,height:A,borderWidth:s});let D=s+(f-C)/2,O=s+(p-S)/2;D=Ku(D),O=Ku(O);const _=eg(m),N=eg(v),L=_*(1-P)/2,B=N*(1-P)/2;t.imageContainer.updateStyle({x:D-L,y:O-B,width:_,height:N}),t.imageContainer.setLocalScale(P,P,1);const{width:U,height:W}=e.viewerContext.getPageRenderSize(t.uid);t.image.updateStyle({x:0,y:0,width:U,height:W});const V=eg(C),F=eg(S);t.currentStyleBox.updateStyle({x:D,y:O,width:V,height:F});})),e.placeholderPages=y);}function Dg(e){const{tab:t}=e,i=t.getCurrentPage();if(!i)return void e.updateLayoutOptions({currentLayoutWidth:0,currentLayoutHeight:0});const{viewportWidth:s,viewportHeight:o,scrollbarWidth:r,fitMode:n}=e,a=e.getMargin(),l=e.getParsedPageStyle();let{borderWidth:h=0}=l;const c=2*h,d=i.rWidth,u=i.rHeight,g=2*a,f=c+g,p=c+g,m=s-f,v=o-p;let{zoom:y}=e;const w=Ag(n,{zoom:y,validLayoutWidth:d,validLayoutHeight:u,scrollbarWidth:r,fitViewportWidth:m,fitViewportHeight:v,isZoomChanged:e.isZoomChanged},Eg);e.isZoomChanged=!1;const{zoomedLayoutWidth:b,zoomedLayoutHeight:x,zoomedViewportWidth:C,zoomedViewportHeight:S,newFitMode:P}=w;y=w.zoom,P&&n!==P&&(e.fitMode=P,e.viewerContext.viewerConfig.fitMode=P,e.viewerContext.hooks.fitModeChanged.emit({oldFitMode:n,newFitMode:P})),e.setZoom(y);const T=b+f,k=x+p,D=C+f,E=S+p,A=e.viewerContext.viewService.getCanvasBorderSize();e.updateLayoutOptions({currentLayoutWidth:T+2*A,currentLayoutHeight:k+2*A,currentViewportWidth:D,currentViewportHeight:E}),i.zoom=y,e.tab.setPosition({x:-0,y:-0});const{image:I,imageContainer:M,borderBox:R}=i,O=t.pages.map((e=>({uid:e.uid,x:0,y:0,width:0,height:0}))),_=O[t.current];_.x=a,_.y=a,_.width=b+c,_.height=x+c,e.placeholderPages=O;const N=eg(b+c),L=eg(x+c),B=Ku(a),U=B;i.updateStyle({x:B,y:U,width:N,height:L}),R.updateStyle({x:0,y:0,width:N,height:L}),h=Ju(h);const W=h,V=h,F=eg(d),z=eg(u),H=F*(1-y)/2,j=z*(1-y)/2;M.setLocalScale(1),M.updateStyle({x:W-H,y:V-j,width:F,height:z}),M.setLocalScale(y);const{width:G,height:$}=e.viewerContext.getPageRenderSize(i.uid);I.updateStyle({x:0,y:0,width:G,height:$});}function Eg(e,t){let{zoom:i,validLayoutWidth:s,validLayoutHeight:o,scrollbarWidth:r,fitViewportWidth:n,fitViewportHeight:a}=t;return "none"===e||"actualSize"===e?("actualSize"===e&&(i=1),Math.floor(s*i)>n&&(a-=r),Math.floor(o*i)>a&&(n-=r)):"width"===e||"window"===e&&s/n>=o/a?(i=n/s,o*i>a&&(n-=r,i=n/s)):(i=a/o,s*i>n&&(a-=r,i=a/o)),{zoom:i,zoomedLayoutWidth:s*i,zoomedLayoutHeight:o*i,zoomedViewportWidth:n,zoomedViewportHeight:a}}function Ag(e,t,i){const{zoom:s,isZoomChanged:o}=t;let r={};if(o){let o;const n=zu(s);if(1===s)o="actualSize",r=i("actualSize",t);else {r=i("width",t);if(zu(r.zoom)===n)o="width","window"===e&&(o="window");else {r=i("height",t);n===zu(r.zoom)&&(o="height","window"===e&&(o="window"));}}o?r.newFitMode=o:(r=i("none",t),r.newFitMode="none");}else r=i(e,t);return r}function Ig(e,t){let{zoom:i,fitWidth:s,fitHeight:o,validLayoutWidth:r,validLayoutHeight:n,scrollbarWidth:a,isVertical:l,fitViewportWidth:h,fitViewportHeight:c}=t;return "none"===e||"actualSize"===e?("actualSize"===e&&(i=1),Math.floor(r*i)>h&&(c-=a),Math.floor(n*i)>c&&(h-=a)):"width"===e||"window"===e&&s/h>=o/c?(i=h/s,l?n*i>c&&(h-=a,i=h/s):(r*i>h&&(c-=a),o*i>c&&(h-=a,i=h/s))):(i=c/o,l?(n*i>c&&(h-=a),s*i>h&&(c-=a,i=c/o)):r*i>h&&(c-=a,i=c/o)),{zoom:i,zoomedLayoutWidth:r*i,zoomedLayoutHeight:n*i,zoomedViewportWidth:h,zoomedViewportHeight:c}}const Mg=e=>{const t=e.getPages();if(!t.length)return;const{viewportWidth:i,tab:s}=e,{x:o,y:r}=s.getPosition(),n=s.current,a=t[n-1],l=t[n+1];if(a){const{left:t,top:s}=Rg(e,a);a.updateStyle({x:-i+t-o,y:s-r});}if(l){const{left:t,top:s}=Rg(e,l);l.updateStyle({x:i+t-o,y:s-r});}};function Rg(e,t){const{viewportWidth:i,viewportHeight:s}=e,o=e.getParsedPageStyle(),{borderWidth:r=0}=o,n=e.getMargin(),{rWidth:a,rHeight:l}=t,h=i-2*n-2*r,c=s-2*n-2*r;let d=0,u=0,g=1;a/l>h/c?(d=h,g=h/a,u=l*g):(u=c,g=c/l,d=a*g);let f=(h-d)/2+n,p=(c-u)/2+n;f=Math.max(n,f),p=Math.max(n,p);const m=a*(1-g)/2,v=l*(1-g)/2,y="visible",w="hidden";t.borderBox.updateStyle({x:0,y:0,width:d+2*r,height:u+2*r,...o,background:"#ffffff00"}),t.borderBox.updateStyle({...o,background:"#ffffff00"}),t.imageContainer.setLocalScale(1),t.imageContainer.updateStyle({x:r-m,y:r-v,width:a,height:l,visibility:y}),t.imageContainer.setLocalScale(g,g,1),t.zoom=g;const{width:b,height:x}=e.viewerContext.getPageRenderSize(t.uid);return t.image.updateStyle({x:0,y:0,width:b,height:x,visibility:y}),t.updateStyle({visibility:y,width:d+2*r,height:u+2*r}),t.checkbox.updateStyle({visibility:w}),t.pageNumber.updateStyle({visibility:w}),{left:f,top:p}}function Og(e){const{displayMode:t}=e;"single"===t?Dg(e):"continuous"===t?function(e){const t=e.getPages();if(!t.length)return void e.updateLayoutOptions({currentLayoutWidth:0,currentLayoutHeight:0});let{zoom:i}=e;const{viewportWidth:s,viewportHeight:o,tab:r,fitMode:n,scrollbarWidth:a,isVertical:l}=e,h=e.getParsedPageStyle(),{borderWidth:c}=h,d=2*c,u=e.getMargin(),{realRow:g,realColumn:f}=e.getRealRowAndColumnContinuous(),p=new Array(f).fill(0),m=new Array(g).fill(0);let v=0,y=0;t.forEach(((e,t)=>{const i=l?Math.floor(t/f):t%g,s=l?t%f:Math.floor(t/g),o=e.rWidth+d,r=e.rHeight+d;p[s]=Math.max(p[s],o),m[i]=Math.max(m[i],r),v=Math.max(p[s],v),y=Math.max(m[i],y);}));let w=p.reduce(((e,t)=>e+t),0),b=m.reduce(((e,t)=>e+t),0);const x=(f+1)*u,C=(g+1)*u,S=f*d+x,P=g*d+C;w+=x,b+=C;const T=w-S,k=b-P;let D=0,E=0,A=0,I=0;l?(D=s-S,E=o-2*u-d,A=p.reduce(((e,t)=>e+t-d),0),I=y-d):(D=s-2*u-d,E=o-P,A=v-d,I=m.reduce(((e,t)=>e+t-d),0));const M=Ag(n,{zoom:i,fitWidth:A,fitHeight:I,validLayoutWidth:T,validLayoutHeight:k,scrollbarWidth:a,isVertical:l,fitViewportWidth:D,fitViewportHeight:E,isZoomChanged:e.isZoomChanged},Ig);e.isZoomChanged=!1;const{zoomedLayoutWidth:R,zoomedLayoutHeight:O,zoomedViewportWidth:_,zoomedViewportHeight:N,newFitMode:L}=M;i=M.zoom,L&&n!==L&&(e.fitMode=L,e.viewerContext.viewerConfig.fitMode=L,e.viewerContext.hooks.fitModeChanged.emit({oldFitMode:n,newFitMode:L})),e.setZoom(i);const B=R+S,U=O+P;let W=0,V=0;l?(W=_+(f+1)*u+f*d,V=N+2*u+d):(W=_+2*u+d,V=N+(g+1)*u+g*d);const F=e.viewerContext.viewService.getCanvasBorderSize();e.updateLayoutOptions({currentLayoutWidth:B+2*F,currentLayoutHeight:U+2*F,currentViewportWidth:W,currentViewportHeight:V}),e.tab.setPosition({x:-0,y:-0});const z=r.pages.map((e=>({uid:e.uid,x:0,y:0,width:0,height:0,pageX:0,pageY:0})));t.forEach(((t,s)=>{const o=l?Math.floor(s/f):s%g,r=l?s%f:Math.floor(s/g),n=(p[r]-d)*i+d,a=(m[o]-d)*i+d,h=t.rWidth,v=t.rHeight;let y=0,w=0;if(0===r)y=u;else {const e=z[l?s-1:(r-1)*g+o];y=e.x+e.width+u;}if(0===o)w=u;else {const e=z[l?(o-1)*f+r:s-1];w=e.y+e.height+u;}const b=z[s];b.width=n,b.height=a,b.x=y,b.y=w,t.zoom=i;const x=h*i,C=v*i,S=w+(a-C)/2-c,P=Ku(y+(n-x)/2-c),T=Ku(S);b.pageX=P,b.pageY=T;let k=x+d,D=C+d;k=eg(k),D=eg(D),t.updateStyle({x:P,y:T,width:k,height:D}),t.borderBox.updateStyle({x:0,y:0,width:k,height:D});const E=Ku(c),A=E,I=eg(h),M=eg(v),R=I*(1-i)/2,O=M*(1-i)/2;t.imageContainer.setLocalScale(1),t.imageContainer.updateStyle({x:E-R,y:A-O,width:I,height:M}),t.imageContainer.setLocalScale(i);const{width:_,height:N}=e.viewerContext.getPageRenderSize(t.uid);t.image.updateStyle({x:0,y:0,width:_,height:N});const L=eg(x),B=eg(C);t.currentStyleBox.updateStyle({x:E,y:A,width:L,height:B});})),e.placeholderPages=z;}(e):"slide"===t&&Mg(e);}class _g{constructor(e,i){t(this,"context",void 0),t(this,"hooks",void 0),this.context=e,this.hooks=i;}layout(e){if(e.isDestroyed||!e.isActive)return;let t;if(this.context.isDefaultViewer)t=Og;else if(this.context.isThumbnailViewer)t=kg;else if(this.context.isPerspectiveViewer){const{displayMode:i}=e.context;"single"===i?t=Dg:"slide"===i&&(t=Mg);}t&&(this.hooks.beforeLayout.emit(e),t(e.context),this.hooks.afterLayout.emit(e));}}const Ng=["viewerMode","displayMode","toolMode","fitMode","visibility","zoom","zoomOrigin","minZoom","maxZoom","multiselectMode","canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle","quadSelectionStyle","rows","columns","maxColumns","maxRows"];class Lg{constructor(e){t(this,"context",void 0),t(this,"handlers",{}),this.context=e;}destroy(){this.context=null,this.handlers={};}updateConfig(e){for(const[t,i]of Object.entries(e))Ng.includes(t)&&this[t](i);}registerHandler(e,t){return !this[e]&&(this[e]=t,!0)}viewerMode(e){const{context:t}=this;t.viewerConfig.viewerMode=e,sl.CAPTURE;}toolMode(e){const{context:t}=this,i=t.viewerConfig.toolMode;e!==i&&(t.viewerConfig.toolMode=e,t.hooks.toolModeChanged.emit({oldToolMode:i,newToolMode:e}));}fitMode(e){const{context:t}=this,i=t.getActiveDocTab();if(!i){const i=t.viewerConfig.fitMode;if(i===e)return;return t.viewerConfig.fitMode=e,void t.hooks.fitModeChanged.emit({oldFitMode:i,newFitMode:e})}const s=i.context.fitMode;s!==e&&(i.context.fitMode=e,"none"!==e&&(t.showTab(i),t.hooks.fitModeChanged.emit({oldFitMode:s,newFitMode:e})));}displayMode(e){const{context:t}=this,i=t.getActiveDocTab();let s;if(i){if(s=i.context.displayMode,e===s)return;i.context.updateLayoutOptions({displayMode:e}),t.showTab(i);}else {if(s=t.viewerConfig.displayMode,e===s)return;t.viewerConfig.displayMode=e;}"slide"!==s&&"slide"!==e&&t.viewer.hooks.displayModeChanged.emit({oldDisplayMode:s,newDisplayMode:e});}rows(e){const{context:t}=this,i=t.getActiveDocTab();i?e!==i.context.rows&&(t.styleService.isCheckboxStyleChanged=!0,t.styleService.isPageNumberStyleChanged=!0,i.context.updateLayoutOptions({rows:e}),this.context.showTab(i)):t.viewerConfig.rows=e;}columns(e){const{context:t}=this,i=t.getActiveDocTab();i?e!==i.context.columns&&(t.styleService.isCheckboxStyleChanged=!0,t.styleService.isPageNumberStyleChanged=!0,i.context.updateLayoutOptions({columns:e}),this.context.showTab(i)):t.viewerConfig.columns=e;}maxColumns(e){e=Math.max(1,e);const{context:t}=this;t.viewerConfig.maxColumns=e;const i=t.getActiveDocTab();i&&i.context.columns>e&&this.columns(e);}maxRows(e){e=Math.max(1,e);const{context:t}=this;t.viewerConfig.maxRows=e;const i=t.getActiveDocTab();i&&i.context.rows>e&&this.rows(e);}zoom(e){const{context:t}=this;t.getActiveDocTab()&&t.zoomTo(e);}visibility(e){const{context:t}=this;if(e===t.viewerConfig.visibility)return;const{rootDom:i,defaultDom:s,thumbnailContainer:o}=t.viewService;if(!i)return;const{ui:r}=t.viewer,n=!o&&r.container.classList.contains("ddv-thumbnail-container");t.viewerConfig.visibility=e,"visible"===e?(i.style.display="flex",s.style.display="flex",n?(r.container.style.display="flex",t.core.globalHooks.resize.emit()):t.core.globalHooks.resize.emit()):(i.style.display="none",n&&(r.container.style.display="none",t.core.globalHooks.resize.emit())),t.hooks.visibleChanged.emit({newVisibility:e,oldVisibility:"visible"===e?"hidden":"visible"});}zoomOrigin(e){const{context:t}=this;t.viewerConfig.zoomOrigin=e;}minZoom(e){const{context:t}=this;t.viewerConfig.minZoom=e;}maxZoom(e){const{context:t}=this;t.viewerConfig.maxZoom=e;}multiselectMode(e){const{context:t}=this;t.viewerConfig.multiselectMode=e;}canvasStyle(e){const{context:t}=this;if(B(e))if(Object.assign(t.viewerConfig.canvasStyle,e),t.isCaptureViewer){var i;const s=null===(i=t.viewer)||void 0===i||null===(i=i.cameraContext)||void 0===i?void 0:i.cameraContainer;s&&Object.assign(s.style,e);}else {const{canvasContainer:i}=t.viewService,s=t.rendererService.getCanvasDom();i&&(Object.assign(i.style,e),e.cursor&&s&&Object.assign(s.style,{cursor:e.cursor}),t.styleService.isCanvasStyleChanged=!0,e.border&&t.resize());}}pageStyle(e){const{context:t}=this;B(e)&&(Object.assign(t.viewerConfig.pageStyle,e),t.styleService.isPageStyleChanged=!0,t.showCurrentTab());}selectedPageStyle(e){const{context:t}=this;B(e)&&(Object.assign(t.viewerConfig.selectedPageStyle,e),t.styleService.isSelectedPageStyleChanged=!0,t.showCurrentTab());}hoveredPageStyle(e){const{context:t}=this;B(e)&&(Object.assign(t.viewerConfig.hoveredPageStyle,e),t.styleService.isHoveredPageStyleChanged=!0,t.showCurrentTab());}placeholderStyle(e){const{context:t}=this;B&&(Object.assign(t.viewerConfig.placeholderStyle,e),t.styleService.isPlaceholderStyleChanged=!0,t.showCurrentTab());}currentPageStyle(e){const{context:t}=this;B&&(Object.assign(t.viewerConfig.currentPageStyle,e),t.styleService.isCurrentPageStyleChanged=!0,t.showCurrentTab());}pageNumberStyle(e){const{context:t}=this;B(e)&&(Object.assign(t.viewerConfig.pageNumberStyle,e),t.styleService.isPageNumberStyleChanged=!0,t.showCurrentTab());}checkboxStyle(e){const{context:t}=this;B(e)&&(Object.assign(t.viewerConfig.checkboxStyle,e),t.styleService.isCheckboxStyleChanged=!0,t.showCurrentTab());}quadSelectionStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{context:t}=this;B(e)&&(Object.assign(t.viewerConfig.quadSelectionStyle,e),t.styleService.isQuadSelectionStyleChanged=!0,t.hooks.quadSelectionStyleChanged.emit(),t.showCurrentTab());}scrollDirection(e){const{context:t}=this;t.viewerConfig.scrollDirection=e;const i=t.getActiveDocTab();i&&(i.context.updateLayoutOptions({direction:e}),t.resize());}}class Bg{constructor(e){t(this,"context",void 0),this.context=e;}handleExternalEvents(){const{context:e}=this,{hooks:t}=this.context;if(t.pageChanged.on((e=>{const i=this.context.getActiveDocTab();if(!i)return void t.pageExistenceChanged.emit({pageCount:0});const{current:s,oldCurrent:o}=i;-1===o||-1!==s?-1===o&&-1!==s&&t.pageExistenceChanged.emit({pageCount:e.total}):t.pageExistenceChanged.emit({pageCount:0});})),t.pageChangedAfterRender.on((()=>{const t=this.context.getActiveDocTab();if(!t)return;const{current:i,oldCurrent:s,currentUid:o,oldCurrentUid:r}=t;s!==i&&e.emit("currentIndexChanged",{oldIndex:s,newIndex:i}),r!==o&&e.emit("currentPageChanged",{oldPageUid:r||"",newPageUid:o||""});})),t.displayModeChanged.on((t=>{e.emit("displayModeChanged",{...t});})),t.fitModeChanged.on((t=>{e.emit("fitModeChanged",{...t});})),t.toolModeChanged.on((t=>{e.emit("toolModeChanged",{...t});})),t.zoomChanged.on((e=>{e.oldZoomRatio!==e.newZoomRatio&&this.context.viewer.emit("zoomChanged",{...e});})),!this.context.isCaptureViewer){const t=this.context.rendererService.getCanvasDom();t.addEventListener("click",(t=>{const i=this.formatEvent(t);e.emit("click",i);})),t.addEventListener("dblclick",(t=>{const i=this.formatEvent(t);e.emit("dblclick",i);})),t.addEventListener("contextmenu",(t=>{t.preventDefault();const i=this.formatEvent(t);e.emit("rightclick",i);}));}}formatEvent(e){var t,i;const[s]=this.context.formatTouches(e),o=this.context.getPointerOverPageInfo(s.pageX,s.pageY);return {index:o.index,pageUid:null!==(t=null===(i=o.pageInfo.page)||void 0===i?void 0:i.uid)&&void 0!==t?t:"",canvasX:Math.floor(s.pageX),canvasY:Math.floor(s.pageY),imageX:Math.floor(o.imageInfo.pointerX),imageY:Math.floor(o.imageInfo.pointerY),nativeEvent:e}}}class Ug{constructor(e){t(this,"context",void 0),t(this,"offsetX",0),t(this,"offsetY",0),t(this,"startX",0),t(this,"startY",0),t(this,"isDragging",!1),t(this,"startPage",void 0),t(this,"newIndexes",void 0),t(this,"cacheChildren",void 0),t(this,"cacheSelectedIndexes",void 0),t(this,"isMousedown",!1),t(this,"draggingTimer",null),t(this,"starDragIndices",[]),this.context=e;}handleDragEvents(){if(this.context.isThumbnailViewer){const e=this.context.getCanvasDom(),t=e=>{this.mousemoveHandler(e);},i=e=>{this.mouseupHandler(e);};j()?(e.addEventListener("touchstart",(e=>{this.mousedownHandler(e);})),document.addEventListener("touchmove",t,{passive:!1}),document.addEventListener("touchend",i)):(e.addEventListener("mousedown",(e=>{this.mousedownHandler(e);})),document.addEventListener("mousemove",t),document.addEventListener("mouseup",i)),this.context.hooks.destroy.on((()=>{j()?(document.removeEventListener("touchmove",t),document.removeEventListener("touchend",i)):(document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",i));}));}}mousedownHandler(e){const{context:t}=this,{viewerConfig:i}=t;if("pan"!==i.toolMode)return;if(t.isLoadSource)return;const s=t.getActiveDocTab();if(null==s||!s.total)return;this.isMousedown=!0;const[o]=t.formatTouches(e),{page:r}=t.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;if(!t.isThumbnailViewer||!r)return;if(t.isPanning)return;if("mousedown"===e.type?t.isDragPrepared=!0:"touchstart"===e.type&&(this.draggingTimer=setTimeout((()=>{t.isPanning||(t.isDragPrepared=!0);}),500)),r){this.startX=o.pageX,this.startY=o.pageY;const e=r.getPosition();this.offsetX=o.pageX-e.x,this.offsetY=o.pageY-e.y,this.startPage=r,this.cacheChildren=s.pages.slice();}if(e.ctrlKey)return;const n=s.getPageIndex(r),a=s.getCurrentPage(),l=e.shiftKey&&i.enableSelectWithShift;if(l&&s.selected.length){if(l&&a!==r&&s.shiftReference){const e=s.uidToIndex(s.shiftReference),i=Math.min(n,e),o=Math.max(n,e),r=[];for(let e=i;e<=o;e++)r.push(e);n>e&&r.reverse(),t.viewer.gotoPage(n),t.viewer.selectPagesByIndices(r);}}else i.multiselectMode||(r.uid!==s.currentUid&&t.viewer.gotoPage(n),r.isSelected||t.viewer.selectPagesByIndices([n]));}mousemoveHandler(e){const{context:t}=this;this.isMousedown&&t.isDragPrepared&&this.draggingTimer&&(clearTimeout(this.draggingTimer),this.draggingTimer=null);const[i]=t.formatTouches(e),s=t.getActiveDocTab();if(!s||!t.isThumbnailViewer)return;const o=t.getPointerOverPageInfo(i.pageX,i.pageY),{page:r}=o.pageInfo;if(this.isDragging){var n,a,l;if(r&&!r.isSelected){const e=s.selected.map((e=>s.uidToIndex(e))).sort(((e,t)=>e-t)),i=e[0],o=s.getPageIndex(r),n=s.pages.slice();e.slice().reverse().forEach((e=>{n.splice(e,1);}));let a=n.indexOf(r);o>i&&(a+=1),this.cacheSelectedIndexes.forEach(((e,t)=>{const i=s.getPageByUid(e.uid);n.splice(a+t,0,i);})),this.newIndexes=n.map((e=>s.getPageIndex(e))),s.reorderPages(this.newIndexes,!1),t.layoutService.layout(s),t.visibilityService.handleVisibility(s);}const e=t.styleService.getParsedPlaceholderStyle(),o=devicePixelRatio;let h=i.pageX-this.offsetX,c=i.pageY-this.offsetY;h=Math.round(h*o)/o,c=Math.round(c*o)/o,s.selected.forEach((t=>{const i=s.getPageByUid(t);i.isDragging=!0,i.updateStyle({...e}),i.borderBox.updateStyle({visibility:"hidden"});})),null===(n=this.startPage)||void 0===n||n.updateStyle({zIndex:1}),null===(a=this.startPage)||void 0===a||a.borderBox.updateStyle({visibility:"visible"}),null===(l=this.startPage)||void 0===l||l.borderBox.setPosition({x:h,y:c}),t.loadThumbnailPages(s),t.rendererService.render(s);}else {if(r&&r===this.startPage&&r.isSelected&&t.isDragPrepared){if(((i.pageX-this.startX)**2+(i.pageY-this.startY)**2)**.5>=t.viewerConfig.dragThreshold&&this.startPage&&t.viewerConfig.enableDragPage){this.isDragging=!0,this.cacheSelectedIndexes=s.selected.map((e=>({uid:e,index:s.uidToIndex(e)}))).sort(((e,t)=>e.index-t.index));const e=s.uidsToIndices(s.selected);this.starDragIndices=[...e],t.viewer.emit("pagesDragged",{indices:e,pageUids:[...s.selected]});}}let e=!1;j()||s.pages.forEach((t=>{r&&r.uid===t.uid?(t.isHovered||(e=!0),t.isHovered=!0):(t.isHovered&&(e=!0),t.isHovered=!1);})),e&&(t.layoutService.layout(s),t.visibilityService.handleVisibility(s),t.rendererService.render(s));}}mouseupHandler(e){var t;if(!this.isMousedown)return;const{context:i}=this;"mouseup"===e.type?i.isDragPrepared=!1:"touchend"===e.type&&(this.draggingTimer&&(clearTimeout(this.draggingTimer),this.draggingTimer=null),i.isDragPrepared=!1);const[s]=i.formatTouches(e,!0),o=i.getActiveDocTab();if(!o)return;const r=i.getPointerOverPageInfo(s.pageX,s.pageY).pageInfo.page;if(this.isDragging){if(this.newIndexes){const e=o.pages.map((e=>this.cacheChildren.indexOf(e)));o.childNodes=this.cacheChildren,i.viewer.reorderPages(e),this.newIndexes=null;}o.selected.forEach((e=>{const t=o.getPageByUid(e);t.borderBox.setLocalPosition({x:0,y:0}),t.isDragging=!1,t.borderBox.updateStyle({visibility:"visible"});}));const e=o.uidsToIndices(o.selected);i.viewer.emit("pagesDropped",{indicesBefore:this.starDragIndices,indicesAfter:e,pageUids:[...o.selected]});}else if(r&&r===this.startPage&&!e.shiftKey)if(e.ctrlKey&&i.viewerConfig.enableSelectWithCtrl||i.viewerConfig.multiselectMode){const e=o.selected.slice(),t=e.indexOf(r.uid);r.isSelected?e.splice(t,1):e.push(r.uid);const s=o.uidsToIndices(e);if(r.uid!==o.currentUid){const e=o.uidToIndex(r.uid);i.viewer.gotoPage(e);}i.viewer.selectPagesByIndices(s);}else if(!e.ctrlKey&&!e.shiftKey){const e=o.getPageIndex(r);r.uid!==o.currentUid&&i.viewer.gotoPage(e),i.viewer.selectPagesByIndices([e]);}null===(t=this.startPage)||void 0===t||t.updateStyle({zIndex:0}),this.isDragging&&(i.scrollReason="currentChanged",i.layoutService.layout(o),i.visibilityService.handleVisibility(o),i.rendererService.render(o)),this.isMousedown=!1,this.startPage=null,this.isDragging=!1;}}class Wg{constructor(e){t(this,"context",void 0),t(this,"isStart",!1),t(this,"startX",void 0),t(this,"startY",void 0),t(this,"lastX",void 0),t(this,"lastY",void 0),t(this,"startTime",void 0),t(this,"isScrolling",void 0),t(this,"scrollTimer",void 0),t(this,"scrollDirectionX","left"),t(this,"scrollDirectionY","top"),this.context=e,this.isScrolling=!1;}handleMoveEvents(){const{context:e}=this;if(e.isDefaultViewer||e.isThumbnailViewer){const t=e.rendererService.getCanvasDom(),i=e=>{this.mouseupHandler(e);};j()?(t.addEventListener("touchstart",(e=>{this.mousedownHandler(e);}),{passive:!1}),t.addEventListener("touchmove",(e=>{this.mousemoveHandler(e);}),{passive:!1}),document.addEventListener("touchend",i)):(t.addEventListener("mousedown",(e=>{this.mousedownHandler(e);})),t.addEventListener("mousemove",(e=>{this.mousemoveHandler(e);})),document.addEventListener("mouseup",i)),this.context.hooks.destroy.on((()=>{document.removeEventListener(j()?"touchend":"mouseup",i);}));}}mousedownHandler(e){const{context:t}=this;if(t.isPanning)return;const i=t.getActiveDocTab();if(null==i||!i.total)return;const s=t.formatTouches(e);if(s.length>1)return;const{pageX:o,pageY:r}=s[0];this.isStart=!0,this.startX=o,this.startY=r,this.lastX=o,this.lastY=r,this.startTime=(new Date).getTime(),this.isScrolling=!1,this.scrollTimer&&(Ee.clearTimer(this.scrollTimer),this.scrollTimer=null);}mousemoveHandler(e){if(!this.isStart)return;window.TouchEvent&&e instanceof TouchEvent&&e.cancelable&&e.preventDefault();const{context:t}=this;if("crop"===t.viewerConfig.toolMode&&!t.canMoveInCropMode)return;if(t.isDragPrepared)return;const i=t.formatTouches(e);if(i.length>1)return;const s=t.getActiveDocTab(),{maxScrollLeft:o,maxScrollTop:r}=s.context;let{scrollLeft:n,scrollTop:a}=s.context;if(!o&&!r)return;const{viewerConfig:l}=t,{panThreshold:h,enableScrollX:c,enableScrollY:d}=l,{pageX:u,pageY:g}=i[0],f=Math.abs(u-this.startX),p=Math.abs(g-this.startY),m=u-this.lastX,v=g-this.lastY;if(t.isPanning){if(!n&&!a&&m>=0&&v>=0)return;if(n===o&&a===r&&m<=0&&v<=0)return;c&&(n-=m),d&&(a-=v),t.viewService.scrollTo(n,a);}else t.isPanning=c&&f>=h||d&&p>=h;this.lastX=u,this.lastY=g;}mouseupHandler(e){if(!this.isStart)return;this.isStart=!1,this.context.isPanning=!1;const{context:t}=this,i=t.formatTouches(e,!0);if(i.length>1)return;if(!j())return;if("crop"===t.viewerConfig.toolMode&&!t.canMoveInCropMode)return;const{scrollLeft:s,scrollTop:o}=this.context.viewService.getMaxScrollValue(),{scrollLeft:r,scrollTop:n}=this.context.viewService.scrollContainer;if(!this.isScrolling&&!t.isDragPrepared&&(s>0||o>0)){const e=(new Date).getTime(),t=i[0].pageX,a=i[0].pageY,l=t-this.startX,h=a-this.startY;let c=!1,d=!1;l>0?(c=0!==r,this.scrollDirectionX="right"):(c=r!==s,this.scrollDirectionX="left"),h>0?(d=0!==n,this.scrollDirectionY="bottom"):(d=n!==o,this.scrollDirectionY="top");const u=e-this.startTime;if((Math.abs(l)>10||Math.abs(h)>10)&&u>0&&u<300&&(c||d)){let e=Math.abs(l)/u,t=Math.abs(h)/u;(e>.4||t>.4)&&(e=Math.min(e,2.8),t=Math.min(t,2.8),this.scroll(e,t,-.05));}}}scroll(e,t,i){this.isScrolling=!0;const{scrollLeft:s,scrollTop:o}=this.context.viewService.scrollContainer;let r=0,n=0;this.scrollTimer=Ee.createTimer((()=>{const{scrollLeft:a,scrollTop:l}=this.context.viewService.getMaxScrollValue();if(e<=0&&t<=0||!1===this.isScrolling)return Ee.clearTimer(this.scrollTimer),this.scrollTimer=null,void(this.isScrolling=!1);e>=0&&("right"===this.scrollDirectionX?r-=40*e:r+=40*e,e+=i),t>=0&&("bottom"===this.scrollDirectionY?n-=40*t:n+=40*t,t+=i);const h=X(s+r,0,a),c=X(o+n,0,l);this.context.viewService.scrollTo(h,c);}),25);}}class Vg{constructor(e){t(this,"context",void 0),t(this,"scrollTimer",void 0),this.context=e;}handleScrollEvents(){const{context:e}=this;if(e.isDefaultViewer||e.isThumbnailViewer){e.getCanvasDom().addEventListener("wheel",(t=>{const i=e.getActiveDocTab();null!=i&&i.total&&i.isActive&&this.wheelHandler(t);}),{passive:!1});const{scrollContainer:t}=e.viewService;t.addEventListener("scroll",(e=>{this.scrollHandler(e);}));}}scrollHandler(e){const{context:t}=this;if("currentChanged"===t.scrollReason)t.scrollReason=null;else {const i=t.getActiveDocTab();if(null==i||!i.total)return;const{scrollLeft:s,scrollTop:o}=e.target;i.context.setTabScrollValue(s,o),t.visibilityService.handleVisibility(i),this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout((()=>{if(!t.isDestroyed&&i.isActive){if(t.isDefaultViewer){if(i.context.updateReference(),i.context.isContinuousDisplay&&t.viewerConfig.autoChangeIndex){const e=i.context.getCurrentByScroll();null!==e&&(i.gotoPage(e),t.visibilityService.handleVisibility(i),t.emitPageChangedEvent(i),t.emitPageChangedAfterRenderEvent(i),t.core.globalHooks.currentChangedByScroll.emit({viewerUid:t.uid,docUid:i.uid,groupUid:t.groupUid,current:e}));}t.loadDisplayPages(i);}else t.isThumbnailViewer&&t.loadThumbnailPages(i);this.scrollTimer=null;}}),42),t.rendererService.render(i);}}wheelHandler(e){const{context:t}=this;let{wheelDelta:i}=e;if(e.deltaY&&(i=-e.deltaY),1===e.deltaMode?i*=16:2===e.deltaMode&&(i=i<0?-100:100),!e.ctrlKey){const{scrollLeft:s,scrollTop:o}=t.viewService.getMaxScrollValue();if(s>0||o>0)e.shiftKey&&s>0?(e.cancelable&&e.preventDefault(),t.viewService.scrollBy(-i,0)):(e.cancelable&&e.preventDefault(),t.viewService.scrollBy(0,-i));else {const s=t.getActiveDocTab();if("single"===s.context.displayMode){e.cancelable&&e.preventDefault();let o=s.current;i>0&&0!==s.current?o-=1:i<0&&s.current!==s.total-1&&(o+=1),s.current!==o&&t.viewer.gotoPage(o);}}}}}class Fg{constructor(e){t(this,"context",void 0),t(this,"wheelTimer",void 0),t(this,"isStart",void 0),t(this,"isZooming",void 0),t(this,"startDistance",void 0),t(this,"lastScale",void 0),t(this,"touchZoomTimer",void 0),this.context=e,this.isZooming=!1,this.isStart=!1,this.lastScale=1;}zoomTo(e,t,i){e=zu(e);const{context:s}=this;if(!s.isDefaultViewer)return;const o=s.getActiveDocTab();if(null==o||!o.total)return;const{viewerConfig:r}=s;if((e=X(e,r.minZoom,r.maxZoom))===r.zoom)return;if(!G(t)||!G(i)){const{originX:e,originY:s}=o.context.getZoomOriginCord();t=e,i=s;}const n=o.context.generateReference(t,i),a=o.context.zoom;o.context.setZoom(e),r.zoom=e,o.context.isZoomChanged=!0,s.layoutService.layout(o),s.viewService.updateScrollerContentSize(o),s.rendererService.updateCanvasSize();const{scrollLeft:l,scrollTop:h}=o.context.parseReferenceZoom(n,t,i);o.context.setTabScrollValue(l,h),s.viewService.scrollTo(l,h),s.visibilityService.handleVisibility(o),s.loadDisplayPages(o),s.rendererService.render(o),o.context.oldZoom=a,s.emitZoomChangedEvent(o);}handleZoomEvents(){const{context:e}=this;if(e.isDefaultViewer){const t=e.getCanvasDom();t.addEventListener("wheel",(t=>{const i=e.getActiveDocTab();null!=i&&i.total&&this.wheelHandler(t);}),{passive:!1}),t.addEventListener("touchstart",(t=>{const i=e.getActiveDocTab();null!=i&&i.total&&this.touchstartHandler(t);}),{passive:!1}),t.addEventListener("touchmove",(t=>{const i=e.getActiveDocTab();null!=i&&i.total&&this.touchmoveHandler(t);}),{passive:!1}),t.addEventListener("touchend",(t=>{const i=e.getActiveDocTab();null!=i&&i.total&&this.touchendHandler(t);}));}}wheelHandler(e){const{context:t}=this,{viewerConfig:i}=t;let{wheelDelta:s}=e;e.deltaY&&(s=-e.deltaY);const o=i.enableZoom&&i.enableZoomWithCtrl;e.ctrlKey&&!e.shiftKey&&o&&(e.cancelable&&e.preventDefault(),this.wheelTimer||(this.wheelTimer=setTimeout((()=>{clearTimeout(this.wheelTimer),this.wheelTimer=null;const o=s>0?i.wheelZoomDelta:1/i.wheelZoomDelta,{x:r,y:n}=t.rendererService.getCanvasPosition();this.zoomTo(i.zoom*o,e.pageX-r,e.pageY-n);}),40)));}touchstartHandler(e){const{context:t}=this,{viewerConfig:i}=t;if("pan"!==i.toolMode)return;const s=t.getActiveDocTab(),{displayMode:o}=s.context,r="continuous"===o||"single"===o;if(!t.viewerConfig.enableZoom||!r)return;if(t.isPanning)return;const n=t.formatTouches(e);n.length<2||(this.startDistance=zg(n),this.isStart=!0);}touchmoveHandler(e){if(!this.isStart)return;window.TouchEvent&&e instanceof TouchEvent&&e.cancelable&&e.preventDefault();const{context:t}=this;if(t.isDragPrepared)return;const i=t.formatTouches(e);if(i.length<2)return;const s=(i[0].pageX+i[1].pageX)/2,o=(i[0].pageY+i[1].pageY)/2;let r=zg(i)/this.startDistance;e.scale&&(r=e.scale);const n=t.getActiveDocTab();let{zoom:a}=n.context;const l=a;a=a/this.lastScale*r,a!==l&&(this.touchZoomTimer||(this.touchZoomTimer=setTimeout((()=>{t.zoomTo(a,s,o),clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null;}),25))),this.lastScale=r,this.isZooming=!0;}touchendHandler(e){this.isStart&&(this.isStart=!1,this.lastScale=1,this.isZooming=!1);}}function zg(e){return ((e[0].pageX-e[1].pageX)**2+(e[0].pageY-e[1].pageY)**2)**.5}class Hg{constructor(e){t(this,"context",void 0),t(this,"isStart",!1),t(this,"startX",void 0),t(this,"isSliding",void 0),t(this,"slideDistance",void 0),t(this,"slideDirection",void 0),t(this,"slideTimer",void 0),t(this,"tabX",void 0),t(this,"tabY",void 0),this.context=e,this.isSliding=!1;}handleSlideEvents(){const{context:e}=this;if(e.isDefaultViewer){const t=e.rendererService.getCanvasDom(),i=e=>{this.mouseupHandler(e);};j()?(t.addEventListener("touchstart",(e=>{this.mousedownHandler(e);}),{passive:!1}),t.addEventListener("touchmove",(e=>{this.mousemoveHandler(e);}),{passive:!1}),document.addEventListener("touchend",i)):(t.addEventListener("mousedown",(e=>{this.mousedownHandler(e);})),t.addEventListener("mousemove",(e=>{this.mousemoveHandler(e);})),document.addEventListener("mouseup",i)),this.context.hooks.destroy.on((()=>{document.removeEventListener(j()?"touchend":"mouseup",i);}));}}mousedownHandler(e){if(!this.context.viewerConfig.enableSlide)return;if(this.isSliding)return;const t=this.context.getActiveDocTab();if(null==t||!t.total)return;const{scrollLeft:i,scrollTop:s}=this.context.viewService.getMaxScrollValue();if(i||s)return;const o=this.context.formatTouches(e);if(o.length>1)return;const r=t.getPosition();this.tabX=r.x,this.tabY=r.y,this.startX=o[0].pageX,this.isStart=!0;}mousemoveHandler(e){if(!this.isStart)return;const{context:t}=this,i=t.getActiveDocTab(),s=t.formatTouches(e)[0].pageX-this.startX;if(s>0?this.slideDirection="right":s<0&&(this.slideDirection="left"),this.slideDistance=Math.min(i.context.viewportWidth,Math.abs(s)),this.isSliding)"right"===this.slideDirection?i.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&i.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),t.render();else if("single"===i.context.displayMode&&"pan"===t.viewerConfig.toolMode&&t.viewerConfig.enableSlide){const{scrollLeft:e,scrollTop:i}=this.context.viewService.getMaxScrollValue();Math.abs(s)>t.viewerConfig.startSlideThreshold&&!e&&!i&&(this.isSliding=!0,t.configService.updateConfig({displayMode:"slide"}));}}mouseupHandler(e){if(!this.isStart)return;const{context:t}=this;this.context.formatTouches(e,!0);const i=t.getActiveDocTab(),{displayMode:s}=i.context;"slide"===s&&this.slide(i),this.isStart=!1;}slide(e){let t,i=0,s=0,o=0,r=!1;const{viewerConfig:n}=this.context,a=e.context.viewportWidth*n.slideThresholdForPerspective;this.slideDistance>=Math.max(a,n.startSlideThreshold)?(s=e.context.viewportWidth,t=s-this.slideDistance,"left"===this.slideDirection?e.current!==e.total-1?(o=-this.slideDistance,i=-t/8):(s=0,t=this.slideDistance,r=!0,o=-this.slideDistance,i=t/8):0!==e.current?(o=this.slideDistance,i=t/8):(s=0,t=this.slideDistance,r=!0,o=this.slideDistance,i=-t/8)):(r=!0,s=0,t=this.slideDistance,"left"===this.slideDirection?(o=-this.slideDistance,i=t/8):(o=this.slideDistance,i=-t/8)),this.slideTimer=Ee.createTimer((()=>{o+=i;const t=o>=0;if(Math.abs(o)>=s&&(o=s,t||(o*=-1)),e.setPosition({x:o+this.tabX,y:this.tabY,z:0}),Math.abs(o)===s)return r||("right"===this.slideDirection?this.context.viewer.gotoPage(e.current-1):this.context.viewer.gotoPage(e.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void Ee.clearTimer(this.slideTimer);this.context.render();}),25);}}class jg{constructor(e,i){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t(this,"core",void 0),t(this,"viewer",void 0),t(this,"uid",void 0),t(this,"groupUid",void 0),t(this,"hooks",void 0),t(this,"viewService",void 0),t(this,"rendererService",void 0),t(this,"tabService",void 0),t(this,"layoutService",void 0),t(this,"styleService",void 0),t(this,"configService",void 0),t(this,"visibilityService",void 0),t(this,"eventsService",void 0),t(this,"dragService",void 0),t(this,"moveService",void 0),t(this,"scrollService",void 0),t(this,"zoomService",void 0),t(this,"slideService",void 0),t(this,"viewerConfig",U(ju)),t(this,"postfix",void 0),t(this,"isDestroyed",!1),t(this,"viewportWidth",0),t(this,"viewportHeight",0),t(this,"scrollReason",void 0),t(this,"isInitialized",!1),t(this,"addPagesTimer",null),t(this,"isDragPrepared",!1),t(this,"isPanning",void 0),t(this,"isSliding",void 0),t(this,"isLoadSource",!1),t(this,"canMoveInCropMode",!1),this.core=e,this.viewer=i,this.postfix=i.postfix,this.hooks=i.hooks,this.uid=i.uid,this.groupUid=i.groupUid,je(s,this.viewerConfig),this.styleService=new ng(this),this.viewService=new xg(this,this.hooks),this.rendererService=new Tg(this,this.hooks),this.layoutService=new _g(this,this.hooks),this.configService=new Lg(this),this.tabService=new rg(this),this.visibilityService=new gg(this),this.handleViewerModeChanged(),this.eventsService=new Bg(this),this.dragService=new Ug(this),this.moveService=new Wg(this),this.scrollService=new Vg(this),this.zoomService=new Fg(this),this.slideService=new Hg(this),this.dragService.handleDragEvents(),this.moveService.handleMoveEvents(),this.eventsService.handleExternalEvents(),this.scrollService.handleScrollEvents(),this.zoomService.handleZoomEvents(),this.slideService.handleSlideEvents();}get isCropToolMode(){throw new Error("Method not implemented.")}get isVisible(){var e;return "visible"===(null===(e=this.viewerConfig)||void 0===e?void 0:e.visibility)}syncViewer(e){const t=e.getActiveTab();if(!t)return;const i=this.tabService.createTab(t.doc);if(i.isDocType){const{width:e,height:t}=this.viewService.getViewportSize();i.updateViewportSize(e,t);}i.currentUid=t.currentUid,i.selectPages([...t.selected]),this.tabService.activateTab(i.uid),this.emitPageChangedEvent(i),this.showTab(i),this.emitPageChangedAfterRenderEvent(i);}formatTouches(e){const t=[];let i=null;i=e instanceof MouseEvent?[e]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.changedTouches:e.touches;const{x:s,y:o}=this.rendererService.getCanvasPosition();for(let e=0;e<i.length;e++){const r=i[e];t.push({pageX:r.pageX-s,pageY:r.pageY-o});}return t}getPointerOverPageInfo(e,t){const i=function(e,t,i){const s={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},index:-1};if(e)for(let o=0;o<e.pages.length;o++){const r=e.pages[o],n=fg(r,t,i);if(n.isOver){s.index=o,Object.assign(s.pageInfo,n);const e=fg(r.imageContainer,t,i);return e.isOver&&Object.assign(s.imageInfo,e),s}}return s}(this.getActiveDocTab(),e,t);return i}getCanvasDom(){return this.rendererService.getCanvasDom()}resize(){if(this.isCaptureViewer)return;this.viewService.resizeViewport(),this.updateViewportSize(),this.rendererService.updateCanvasSize(),this.styleService.isCheckboxStyleChanged=!0,this.styleService.isPageNumberStyleChanged=!0;const e=this.getActiveDocTab();e&&this.showTab(e);}updateViewportSize(){const{width:e,height:t}=this.viewService.getViewportSize();this.viewportWidth=e,this.viewportHeight=t,this.tabService.updateViewportSize(e,t);}handleViewerModeChanged(){const{postfix:e,viewService:t,isDefaultViewer:i,isPerspectiveViewer:s,isThumbnailViewer:o}=this;if(i||s||o){t.createMainAndThbContainer(e),t.createMainContainer(e),o||t.createThumbnailContainer(e),i&&(t.createVideoContainer(e),t.createAudioContainer(e)),Vu(t.mainAndThbContainer,"flex");const{width:s,height:r}=t.getViewportSize();this.rendererService.initRenderer(t.canvasContainer,s,r),this.rendererService.updateCanvasSize();}}loadSource(e){const t=this.getActiveTab();let i=null==t?void 0:t.uid;if(!t){const e=this.core.createDocument({name:Ac(),type:"document"});this.viewer.openDocument(e),i=e.uid;}return this.core.loadSource(e,i,{exception:"ignore"})}openDocument(e){const{tabService:t}=this;let i=t.getTab(e.uid);if(!i&&(i=t.createTab(e),i.isDocType)){const{width:e,height:t}=this.viewService.getViewportSize();i.updateViewportSize(e,t);}i.isActive||(this.tabService.activateTab(i.uid),this.emitPageChangedEvent(i),this.showTab(i),this.hooks.openDocument.emit(e),this.emitPageChangedAfterRenderEvent(i));}closeTabs(e){if(!e.filter((e=>this.tabService.hasTab(e))).length)return;e.forEach((e=>{this.tabService.closeTab(e);}));const t=this.tabService.getActiveTab();t?this.showTab(t):(this.resetCanvas(),this.hooks.pageChanged.emit({total:0,current:-1}));}resetCanvas(){this.isCaptureViewer||(this.viewService.resetViewport(),this.rendererService.updateCanvasSize(),this.rendererService.clearCanvas());}render(){if("hidden"===this.viewerConfig.visibility)return;if(this.isDestroyed)return;const e=this.getActiveDocTab();e&&this.rendererService.render(e);}showCurrentTab(){const e=this.getActiveDocTab();null!=e&&e.total&&this.showTab(e);}showTab(e){this.isDestroyed||e.isDestroyed||(this.tabService.activateTab(e.uid),"hidden"!==this.viewerConfig.visibility&&(this.isDefaultViewer?this.showTabDefault(e):this.isThumbnailViewer?this.showTabThumbnail(e):this.isPerspectiveViewer&&this.showTabPerspective(e)));}showTabDefault(e){const t=e;if(!t.isDocType)return;if(t.style.visibility="visible",this.layoutService.layout(t),this.viewerConfig.zoom=t.context.zoom,this.viewService.updateScrollerContentSize(t),this.rendererService.updateCanvasSize(),!t.total)return void this.rendererService.render(t);const{scrollLeft:i,scrollTop:s}=t.context.parseReferenceDefault();t.context.setTabScrollValue(i,s),this.viewService.scrollTo(i,s),this.visibilityService.handleVisibility(t),this.loadDisplayPages(t),this.rendererService.render(t),this.emitZoomChangedEvent(t);}showTabPerspective(e){const t=e;if(!t.isDocType)return;if(t.style.visibility="visible",this.layoutService.layout(t),this.viewService.updateScrollerContentSize(t),this.rendererService.updateCanvasSize(),!t.total)return void this.rendererService.render(t);const{scrollLeft:i,scrollTop:s}=t.context.parseReferenceDefault();t.context.setTabScrollValue(i,s),this.viewService.scrollTo(i,s),this.visibilityService.handleVisibility(t),this.loadPerspectivePages(t),this.rendererService.render(t);}showTabThumbnail(e){if(!e.isDocType)return;if(e.style.visibility="visible",this.layoutService.layout(e),this.viewService.updateScrollerContentSize(e),this.rendererService.updateCanvasSize(),!e.total)return void this.rendererService.render(e);if(e.isActive&&this.isVisible&&this.viewerConfig.autoScroll){const{scrollLeft:t,scrollTop:i}=e.context.getScrollValuesByCurrentChanged();e.context.setTabScrollValue(t,i);}const{scrollLeft:t,scrollTop:i}=e.context;this.viewService.scrollTo(t,i),this.visibilityService.handleVisibility(e),this.loadThumbnailPages(e),this.rendererService.render(e);}loadDisplayPages(e){e.isDestroyed||e.pages.forEach((t=>{!t.isPreload||t.isLoaded||t.isLoading||(t.isLoading=!0,this.core.imageLoadService.loadDisplayImage(t.uid).then((i=>{t.isLoading=!1,i&&this.renderPage(e,t,i);})));}));}loadThumbnailPages(e){e.isDestroyed||e.pages.forEach((t=>{!t.isPreload||t.isLoaded||t.isLoading||(t.isLoading=!0,this.core.imageLoadService.loadDisplayImage(t.uid).then((i=>{t.isLoading=!1,i&&this.renderPage(e,t,i);})));}));}loadPerspectivePages(e){e.isDestroyed||e.pages.forEach((t=>{!t.isPreload||t.isLoaded||t.isLoading||(t.isLoading=!0,this.core.imageLoadService.loadRawImage(t.uid).then((i=>{t.isLoading=!1,i&&this.renderPage(e,t,i);})));}));}renderPage(e,t,i){if(!this.isDestroyed&&this.isVisible&&e.isActive&&e.pages.includes(t)&&!e.isDestroyed&&t.isPreload&&(t.isLoaded=!0,t.setImg(i),t.isVisible)){if(this.isDefaultViewer&&e.context.isSingleDisplay){const t=e.getCurrentPage();if(t&&!t.isLoaded)return}this.rendererService.render(e);}}emitPageChangedEvent(e){this.hooks.pageChanged.emit({total:e.total,current:e.current});}emitPageChangedAfterRenderEvent(e){this.hooks.pageChangedAfterRender.emit({total:e.total,current:e.current});}emitZoomChangedEvent(e){const{oldZoom:t,zoom:i}=e.context;this.hooks.zoomChanged.emit({oldZoomRatio:zu(t),newZoomRatio:zu(i)});}beforeLoadSource(e){this.isLoadSource=!0;const{tabService:t}=this,i=t.getDocTab(e);i&&i.updateOldInfo();}afterLoadSource(e){this.isLoadSource=!1;const{tabService:t}=this,i=t.getDocTab(e);i&&(this.emitPageChangedEvent(i),this.emitPageChangedAfterRenderEvent(i),i.updateOldInfo());}addPages(e,t,i,s){const{tabService:o}=this,r=o.getDocTab(e);r&&(r.appendPages(t,i,s),this.emitPageChangedEvent(r),r.isActive&&!this.addPagesTimer&&(this.addPagesTimer=setTimeout((()=>{this.scrollReason="currentChanged",this.showTab(r),clearTimeout(this.addPagesTimer),this.addPagesTimer=null;}),42)));}deletePages(e,t){const{tabService:i}=this,s=i.getDocTab(e);s&&(s.deletePages(t),this.hooks.deletePages.emit({pageUids:t}),s.isActive&&(this.emitPageChangedEvent(s),this.scrollReason="currentChanged",this.showTab(s),this.emitPageChangedAfterRenderEvent(s)));}deleteAllPages(e){const{tabService:t}=this,i=t.getDocTab(e);i&&(i.deleteAllPages(),i.isActive&&(this.emitPageChangedEvent(i),this.scrollReason="currentChanged",this.showTab(i),this.emitPageChangedAfterRenderEvent(i)));}setCurrentPage(e,t){const{tabService:i}=this,s=i.getDocTab(e);s&&s.current!==t&&(s.gotoPage(t),s.isActive&&(this.emitPageChangedEvent(s),this.scrollReason="currentChanged",this.showTab(s),this.emitPageChangedAfterRenderEvent(s)));}selectPages(e,t){const{tabService:i}=this,s=i.getDocTab(e);if(!s)return;const o=s.getSelected(),r=s.getSelectedIndices();let n=!1;if(r.length!==t.length)n=!0;else for(let e=0;e<t.length;e++)if(r[e]!==t[e]){n=!0;break}if(!n)return;const a=s.indicesToUids(t);if(s.selectPages(a),s.isActive){this.showTab(s);const e={oldIndices:r,oldPageUids:o,newIndices:[...t],newPageUids:[...a]};this.hooks.selectedPageChanged.emit(e),this.viewer.emit("selectedPagesChanged",e);}}movePages(e,t,i){const{tabService:s}=this,o=s.getDocTab(e);o&&(o.movePages(t,i),o.isActive&&(this.emitPageChangedEvent(o),this.scrollReason="currentChanged",this.showTab(o),this.emitPageChangedAfterRenderEvent(o)));}switchPage(e,t,i){const{tabService:s}=this,o=s.getDocTab(e);o&&(o.switchPage(t,i),o.isActive&&(this.emitPageChangedEvent(o),this.scrollReason="currentChanged",this.showTab(o),this.emitPageChangedAfterRenderEvent(o)));}reorderPages(e,t){const{tabService:i}=this,s=i.getDocTab(e);s&&(s.reorderPages(t),s.isActive&&(this.emitPageChangedEvent(s),this.scrollReason="currentChanged",this.showTab(s),this.emitPageChangedAfterRenderEvent(s)));}updatePage(e,t,i){const s=this.getTab(e);if(s&&s.isActive){const e=s.getPageByUid(t);e.isLoaded=!1,e.isLoading=!1,e.isVisible&&this.showTab(s);}}renameDoc(e,t){const{tabService:i}=this,s=i.getTab(e);s&&(s.rename(t),this.hooks.tabChanged.emit());}filter(e,t,i){if(this.isPerspectiveViewer||this.isCaptureViewer)return;const s=this.getActiveDocTab();s&&s.uid===e&&(t.forEach((e=>{const t=s.getPageByUid(e);t&&(t.isLoaded=!1);})),this.hooks.filterChanged.emit({type:i,docUid:e,pageUids:t}),this.scrollReason="currentChanged",this.showTab(s));}getTab(e){return this.tabService.getTab(e)}activateTab(e){const t=this.tabService.getTab(e);return !!t&&(this.showTab(t),!0)}getActiveTab(){return this.tabService.getActiveTab()}getActiveDocTab(){const e=this.tabService.getActiveTab();return null!=e&&e.isDocType?e:null}getAllTabs(){return this.tabService.getAllTabs()}destroy(){this.tabService.getAllTabs().forEach((e=>{const t=[];if(e.pages.forEach(((e,i)=>{e.isPreload&&t.push({from:!0,to:!1,pageUid:e.uid,index:i});})),t.length){const i={changes:t,docUid:e.uid,type:this.viewerConfig.viewerMode,viewerUid:this.uid};this.core.globalHooks.pagePreloadChanged.emit(i);}})),this.isDestroyed=!0,this.hooks.destroy.emit(),this.tabService.destroy(),this.viewService.destroy();}get isDefaultViewer(){return this.viewerConfig.viewerMode===sl.DEFAULT}get isThumbnailViewer(){return this.viewerConfig.viewerMode===sl.THUMBNAIL}get isPerspectiveViewer(){return this.viewerConfig.viewerMode===sl.PERSPECTIVE}get isCaptureViewer(){return this.viewerConfig.viewerMode===sl.CAPTURE}zoomTo(e,t,i){this.zoomService.zoomTo(e,t,i);}getPageRenderSize(e){const t=this.core.pageService.getPage(e);return this.isPerspectiveViewer?t.raw.getPageSize():t.original.getPageSize()}emit(e,t){this.viewer.emit(e,t);}}class Gg{constructor(e){t(this,"isDestroy",!1),t(this,"uid",void 0),t(this,"groupUid",void 0),t(this,"group",void 0),t(this,"postfix",void 0),t(this,"context",void 0),t(this,"emitter",void 0),t(this,"hooks",void 0),t(this,"core",void 0),this.emitter=new J,e.core&&(this.core=e.core),this.uid=q(),this.groupUid=e.groupUid,this.postfix=`-${this.uid}`,this.hooks=new Va,this.context=new jg(this.core,this,e.viewerConfig),e.container&&!e.uiConfig&&this.context.viewService.bindContainer(e.container);}undo(){const e=this.context.getActiveDocTab();return !!e&&this.core.undo(e.uid)}redo(){const e=this.context.getActiveDocTab();return !!e&&this.core.redo(e.uid)}getOperationState(){const e=this.context.getActiveDocTab();return e?this.core.getOperationState(e.uid):{undo:0,redo:0}}saveOperations(){const e=this.context.getActiveDocTab();return !!e&&this.core.saveOperations(e.uid)}destroy(){this.isDestroy||(this.unbindContainer(),this.context.destroy(),this.context=null,this.isDestroy=!0,this.core.removeViewer(this));}setRowAndColumn(e,t){return this.context.configService.updateConfig({rows:e,columns:t}),!0}getRowAndColumn(){const e=this.context.getActiveDocTab();if(e)return {rows:e.context.rows,columns:e.context.columns};const{viewerConfig:t}=this.context;return {rows:t.rows||1,columns:t.columns||1}}on(e,t){this.emitter.on(e,t);}emit(e,t){this.emitter.emit(e,t);}off(e,t){this.emitter.off(e,t);}getViewerConfig(){return this.context.viewerConfig}updateViewerConfig(e){this.context.configService.updateConfig(e);}bindContainer(e){return this.context.viewService.bindContainer(e)}unbindContainer(){this.context.viewService.unbindContainer();}show(){this.updateViewerConfig({visibility:"visible"}),this.context.showCurrentTab();}hide(){this.updateViewerConfig({visibility:"hidden"});}render(){}resize(){this.context.resize();}indexToUid(e){const t=this.context.getActiveDocTab();return null==t?void 0:t.indexToUid(e)}uidToIndex(e){const t=this.context.getActiveDocTab();return t?t.uidToIndex(e):-1}getCurrentPageIndex(){const e=this.context.getActiveDocTab();return e?e.current:-1}getPageCounts(){const e=this.context.getActiveDocTab();return e?e.total:0}getCurrentPageUid(){var e;const t=this.context.getActiveDocTab();return null==t||null===(e=t.getCurrentPage())||void 0===e?void 0:e.uid}selectAllPages(){const e=this.getPageCounts();return this.selectPagesByIndices(Array.from(Array(e).keys()))}selectPagesByIndices(e){const t=this.context.getActiveDocTab();if(!t)return [];const i=t.indicesToUids(e);return this.core.globalHooks.selectPages.emit({viewerUid:this.uid,groupUid:this.groupUid,docUid:t.uid,indices:e}),[...i]}getSelectedPageIndices(){const e=this.context.getActiveDocTab();if(!e)return [];return e.getSelectedIndices()}gotoPage(e){const t=this.context.getActiveDocTab();return t?(e=X(e,0,t.total-1),t.current===e||this.core.globalHooks.gotoPage.emit({index:e,viewerUid:this.uid,groupUid:this.groupUid,docUid:t.uid}),e):-1}movePages(e,t){const i=this.context.getActiveDocTab();return !!i&&this.core.movePages(i.uid,e,t)}switchPage(e,t){const i=this.context.getActiveDocTab();return !!i&&this.core.switchPage(i.uid,e,t)}reorderPages(e){const t=this.context.getActiveDocTab();return !!t&&this.core.reorderPages(t.uid,e)}deletePages(e){const t=this.context.getActiveDocTab();if(!t)return !1;if(!e.every((e=>e>=0&&e<t.total)))return !1;const i=t.indicesToUids(e);return this.core.deletePages(t.uid,i)}deleteAllPages(){const e=this.context.getActiveDocTab();return !!e&&this.core.deleteAllPages(e.uid)}openDocument(e){this.core.openDocument(e.uid,this.uid);}closeDocument(e){if(!e){const t=this.context.getActiveTab();if(!t)return;e=t.uid;}this.core.closeDocument(e,this.uid);}printDocument(){}activateTab(e){return this.context.activateTab(e)}getActiveTab(){return this.context.getActiveTab()}getAllTabs(){return this.context.getAllTabs()}getRealPixelSize(e){const t=this.context.getActiveDocTab();if(!t)return {width:0,height:0};W(e)&&(e=t.current);const i=t.getPageByIndex(e),s=this.core.pageService.getPage(i.uid);return {width:s.toPixelPPI(i.rWidth,!1),height:s.toPixelPPI(i.rHeight,!0)}}zoomIn(){const e=this.getActiveTab();if(!e||!e.isDocType)return;const{maxZoom:t}=this.getViewerConfig(),{zoom:i}=e.context;let s=$g(i,"in");(null===s||s>t)&&(s=t),this.updateViewerConfig({zoom:s});}zoomOut(){const e=this.getActiveTab();if(!e||!e.isDocType)return;const{minZoom:t}=this.getViewerConfig(),{zoom:i}=e.context;let s=$g(i,"out");(null===s||s<t)&&(s=t),this.updateViewerConfig({zoom:s});}filter(e,t){const i=this.context.getActiveDocTab();if(!i)return !1;const s=i.indicesToUids(e);return this.core.filterPages(i.uid,s,t),!1}getPerspectivePreviewImage(e,t,i,s){const o=this.context.getActiveDocTab();if(!o)return null;const r=o.getPageByIndex(e);if(!r)return null;const n=r.uid,{quadSelectionStyle:a}=this.getViewerConfig(),{borderColor:l}=Le(a.border),h=function(e){const t=e=>{const t=e.toString(16);return 1===t.length?`0${t}`:t};if(e.startsWith("rgb")){const i=e.match(/(\d+)/g);if(3===i.length){const e=parseInt(i[0],10),s=parseInt(i[1],10),o=parseInt(i[2],10);return `#${t(e)}${t(s)}${t(o)}`}}if(e.startsWith("#")&&(7===e.length||4===e.length))return e;return "#FE8E14"}(l);return this.context.core.getPerspectivePreviewData(n,{width:t||200,height:i||200},{strokeColor:h.substring(1),lineWidth:s})}}function $g(e,t){const i=[.01,.0625,.125,.25,.333,.5,.667,.75,1,1.25,1.5,2,3,4,6,8,12,16,24,32,64];if("in"===t){for(let t=0;t<i.length;t++)if(i[t]>e)return i[t]}else for(let t=i.length-1;t>=0;t--)if(i[t]<e)return i[t];return null}class Xg{constructor(e){t(this,"isDestroyed",!1),t(this,"viewers",new Map),t(this,"groups",new Map),t(this,"core",void 0),this.core=e;}unload(){for(const e of this.viewers.values())e.destroy();this.viewers.clear(),this.groups.clear();}destroy(){if(!this.isDestroyed){for(const e of this.viewers.values())e.destroy();this.viewers=null,this.groups=null,this.isDestroyed=!0;}}createViewer(e,t){var i;const{groupUid:s}=t,o=this.groups.get(s)||new fc(s);var r;W(null===(i=t.viewerConfig)||void 0===i?void 0:i.scrollToLatest)||o.isSetScrollToLatest||(o.updateConfig({scrollToLatest:null===(r=t.viewerConfig)||void 0===r?void 0:r.scrollToLatest}),o.isSetScrollToLatest=!0);t.groupConfig&&o.updateConfig(t.groupConfig);const n=new e(t);n.group=o,o.viewerUids.add(n.uid),this.groups.set(s,o),this.viewers.set(n.uid,n),this.listenGlobalEvents(n);const a=this.getViewersByGroupUid(s);return a.length>0&&n.context.syncViewer(a[0]),n}listenGlobalEvents(e){const{globalHooks:t}=this.core,i=e.context,s=e=>{let{docUid:t}=e;i.beforeLoadSource(t);},o=e=>{i.afterLoadSource(e.docUid),i.hooks.addPages.emit(e);},r=t=>{const{group:s}=e;let{scrollToLatest:o}=s.config;W(o)&&({scrollToLatest:o}=i.viewerConfig),i.addPages(t.docUid,t.pageUids,o,t.index);},n=e=>{i.updatePage(e.docUid,e.pageUid,e.data),i.hooks.updatePage.emit(e);},a=e=>{i.deletePages(e.docUid,e.pageUids);},l=e=>{i.deleteAllPages(e.docUid);},h=e=>{i.movePages(e.docUid,e.indices,e.insertBeforeIndex);},c=e=>{i.switchPage(e.docUid,e.one,e.another);},d=e=>{i.reorderPages(e.docUid,e.indices);},u=e=>{i.closeTabs(e.docUids);},g=e=>{i.renameDoc(e.docUid,e.newName);},f=e=>{i.groupUid===e.groupUid&&i.openDocument(e.doc);},p=e=>{i.groupUid===e.groupUid&&i.closeTabs([e.doc.uid]);},m=e=>{i.closeTabs([e.docUid]);},v=e=>{i.groupUid===e.groupUid&&i.setCurrentPage(e.docUid,e.index);},y=()=>{i.resize();},w=e=>{i.groupUid===e.groupUid&&i.selectPages(e.docUid,e.indices);},b=e=>{i.groupUid===e.groupUid&&i.uid!==e.viewerUid&&i.setCurrentPage(e.docUid,e.current);},x=e=>{const t=i.getActiveDocTab();(null==t?void 0:t.uid)===e.docUid&&i.hooks.operationsChanged.emit(e);},C=e=>{const t=i.getActiveDocTab();(null==t?void 0:t.uid)===e.docUid&&i.filter(e.docUid,e.pageUids,e.type);};t.beforeLoadSource.on(s),t.afterLoadSource.on(o),t.addPagesToDoc.on(r),t.updatePage.on(n),t.deletePagesFromDoc.on(a),t.deleteAllPagesFromDoc.on(l),t.movePages.on(h),t.switchPage.on(c),t.reorderPages.on(d),t.beforeDeleteDocs.on(u),t.renameDocument.on(g),t.gotoPage.on(v),t.openDocument.on(f),t.closeDocument.on(p),t.deleteDocument.on(m),t.resize.on(y),t.selectPages.on(w),t.currentChangedByScroll.on(b),t.operationsChanged.on(x),t.filterChanged.on(C),e.hooks.destroy.on((()=>{t.beforeLoadSource.off(s),t.afterLoadSource.off(o),t.addPagesToDoc.off(r),t.updatePage.off(n),t.deletePagesFromDoc.off(a),t.deleteAllPagesFromDoc.off(l),t.movePages.off(h),t.switchPage.off(c),t.reorderPages.off(d),t.beforeDeleteDocs.off(u),t.renameDocument.off(g),t.gotoPage.off(v),t.openDocument.off(f),t.closeDocument.off(p),t.deleteDocument.off(m),t.resize.off(y),t.selectPages.off(w),t.currentChangedByScroll.off(b),t.operationsChanged.off(x),t.filterChanged.off(C);}));}removeViewer(e){let t;if(t=$(e)?this.getViewer(e):e,!t)return !1;const{uid:i,groupUid:s}=t,o=this.groups.get(s);return o&&(o.viewerUids.delete(i),o.viewerUids.size||this.groups.delete(s)),this.viewers.delete(t.uid),t.destroy(),!0}hasViewer(e){return this.viewers.has(e)}getViewer(e){return this.viewers.get(e)}getAllViewers(){return Array.from(this.viewers.values())}getViewersByViewerUid(e){const t=this.viewers.get(e);return this.getViewersByGroupUid(t.groupUid)}getViewersByGroupUid(e){return this.groups.has(e)?this.groups.get(e).getViewerUids().map((e=>this.viewers.get(e))):[]}hasGroup(e){return this.groups.has(e)}}const Yg={apply(e){e.viewerService=new Xg(e);},install(e){e.setClass("Viewer",Gg);}},qg=/^<\/([^>]*)>/,Qg=/^<([^\s>]+)[^>]*>/,Zg=/^<slot>.*<\/slot>/,Jg=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function Kg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{template:i,data:s,components:o,injection:r}=e,n=ef(i,s,o,r,t),a=n.length;return a&&(n[0].cpInstance=e,n[a-1].cpInstance=e),n}function ef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=e.trim();const n=[];function a(e){r=r.substring(e);}function l(e){let[o,r]=e;if(r){const e=function(e){const t={},i=He(e,Jg);return i?(i.forEach((e=>{let[,i,s]=e;t[i]=s;})),t):t}(o),a=t[":for"];a&&(delete t[":for"],e[":for"]=a);const l={type:"start",name:r,data:t,attrs:e};if(n.push(l),(i[r]||s.components&&s.components[r])&&(l.cpOption={Component:i[r]||s.components[r],injection:s}),"input"===r||/\/>/.test(o)){const e={type:"end",name:r,data:t,attrs:{}};n.push(e);}}}function h(e){let[,t]=e;if(t){const e={type:"end",name:t,attrs:{}};n.push(e);}}function c(e){if(e=e.trim()){const i={type:"text",name:e,attrs:{},data:t};n.push(i);}}for(;r;){const e=r.indexOf("<");let t;if(0===e){const e=r.match(qg);if(e){a(e[0].length),h(e);continue}const i=r.match(Zg);if(i){a(i[0].length),n.push(...o);continue}const s=r.match(Qg);if(s&&s[0]!==s.input){a(s[0].length),l(s);continue}t=r;}else t=e>0?r.substring(0,e):r;t&&(a(t.length),c(t));}return n}function tf(e){const{cpInstance:t,children:i}=e;t&&!t.isInserted&&(t.isInserted=!0,t.hooks.inserted.emit()),i.forEach((e=>{tf(e);}));}function sf(e){const{cpInstance:t,children:i}=e;t&&t.hooks.destroyed.emit(e),i.forEach((e=>{sf(e);}));}function of(e,t){return t.key===e.key&&t.tagName===e.tagName}function rf(e,t,i){const s={};for(let o=t;o<=i;++o){const t=e[o];if(t&&t.data){const{key:e}=t.data;e&&(s[e]=o);}}return s}function nf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;t<=i;){af(e[t]),t+=1;}}function af(e){if(e){const{el:t,children:i}=e;if(function(e){const{cpInstance:t}=e;t&&(t.destroy(),t.hooks.beforeDestroyed.emit(e));}(e),t){const i=t.parentElement;i&&i.removeChild(t),t.vNode=null,e.el=null;}return sf(e),e.text=null,e.parent=null,i.length&&i.forEach((e=>{af(e);})),!0}return !1}function lf(e,t,i,s,o){const r=document.createDocumentFragment();for(let e=s;e<=o;e++){const t=i[e];r.appendChild(t.renderDom());}Oe(r,t,e);}function hf(e,t){var i,s;if(e===t)return;if((null===(i=e.cpInstance)||void 0===i||null===(i=i.constructor)||void 0===i?void 0:i.name)!==(null===(s=t.cpInstance)||void 0===s||null===(s=s.constructor)||void 0===s?void 0:s.name))return lf(e.parent.el,e.el,[t],0,0),void af(e);const{el:o,data:r,children:n,tagName:a,text:l}=e,{data:h,children:c,tagName:d,text:u}=t;t.el=o,o.vNode=t;const g=Object.keys(h),f=Object.keys(r);o.setAttribute&&g.forEach((e=>{o instanceof HTMLInputElement&&"value"===e?o.value=h[e]:o.setAttribute(e,h[e]);})),o.removeAttribute&&f.forEach((e=>{-1===g.indexOf(e)&&o.removeAttribute(e);})),a===d&&"TEXT"===d&&l!==u?o.textContent=Re(u):n.length&&c.length?function(e,t,i,s){let o,r=0,n=0,a=t.length-1,l=i.length-1,h=t[r],c=t[a],d=i[n],u=i[l];for(;r<=a&&n<=l;)if(null==h)r+=1,h=t[r];else if(null==c)a-=1,c=t[a];else if(null==d)n+=1,d=i[n];else if(null==u)l-=1,u=i[l];else if(of(h,d))hf(h,d),r+=1,n+=1,h=t[r],d=i[n];else if(of(c,u))hf(c,u),a-=1,l-=1,c=t[a],u=i[l];else if(of(h,u))hf(h,u),_e(h.el,c.el),r+=1,l-=1,h=t[r],u=i[l];else if(of(c,d))hf(c,d),Oe(c.el,h.el,e),a-=1,n+=1,c=t[a],d=i[n];else {void 0===o&&(o=rf(t,r,a));const s=o[d.key];if(void 0===s)lf(e,h.el,i,n,n),n+=1,d=i[n];else {const o=t[s];hf(o,d),Oe(o.el,h.el,e),t[s]=null,n+=1,d=i[n];}}r>a?lf(e,i[l+1]?i[l+1].el:null,i,n,l):n>l&&nf(t,r,a);}(o,n,c):c.length?lf(o,null,c,0,c.length-1):n.length&&nf(n,0,n.length),function(e,t){const{cpInstance:i}=e||{},{cpInstance:s}=t;i&&(s&&(i.data=s.data,i.injection={...i.injection,...s.injection}),t.cpInstance=i,i.vNode=t,s&&(s.hooks.beforeDestroyed.emit(e),s.hooks.destroyed.emit(e)),i.isInserted&&i.hooks.updated.emit(t));}(e,t);}class cf{constructor(e){t(this,"el",void 0),t(this,"tagName",void 0),t(this,"sel",""),t(this,"data",void 0),t(this,"children",void 0),t(this,"text",void 0),t(this,"key",void 0),t(this,"cpInstance",void 0),t(this,"cpOptions",void 0),t(this,"parent",void 0),this.createVNode(e);}renderDom(){if(this.el)return this.el;let e;if("FRAGMENT"===this.tagName)e=document.createDocumentFragment();else if("TEXT"===this.tagName){const t=Re(this.text);e=document.createTextNode(t);}else {e=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(const[t,i]of Object.entries(this.data))e.setAttribute(t,i);}return this.children.forEach((t=>{const i=t.renderDom();e.appendChild(i);})),e.vNode=this,this.el=e,function(e){const{cpInstance:t,el:i}=e;t&&(t.vNode=e,t.hooks.created.emit(i));}(this),e}patch(e){return function(e,t){if(of(e,t))hf(e,t);else {const i=e.el,s=i.parentNode;null!==s&&(t.el=t.renderDom(),Oe(t.el,i,s),nf([e]),e=null);}let i=-1;const s=e.parent;return null==s||s.children.forEach(((t,s)=>{t===e&&(i=s);})),i>-1&&(s.children[i]=t,t.parent=s,e.el=null),t}(this,e)}destroy(){return af(this)}createVNode(e){const{tagName:t,data:i={},children:s=[],el:o=null,key:r,text:n="",cpOptions:a,cpInstance:l}=e;let h=t;i.id&&(h+=`#${i.id}`),i.class&&(h+=`.${i.class}`),this.sel=h,this.data=i,this.tagName=t,this.children=s,this.el=o,this.key=r,this.text=n,this.cpInstance=l,this.cpOptions=a;}}function df(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[],s=[];let o=[];return e.forEach((e=>{if("start"===e.type)i.push(e),s.push(o),o=[];else if("text"===e.type)o.push({type:"text",value:e.name,data:e.data});else if(e instanceof cf)o.push(e);else {let t=i.pop();for(;t.name!==e.name;)t=i.pop();if(t){const{name:e,cpInstance:i,attrs:r,cpOption:n,data:a}=t,l={type:"token",tagName:e,cpInstance:i,cpOption:n,attrs:r,data:a,children:o};o.forEach((e=>{e.parent=l;})),o=s.pop(),o.push(l);}}})),t?o[0]:o}const uf=/'.+'|\\".+\\"|[\w$.]+/g,gf=/{{([^\s@}]+)}}/;function ff(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(L(e)){const t=[];return e.forEach((e=>{t.push(...mf(ff(e)));})),t}if(e instanceof cf)return e;if("token"===e.type){var i;const{tagName:s,attrs:o,cpInstance:r,children:n,data:a,cpOption:l}=e;if(o[":for"])return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{attrs:i,data:s}=e,o=JSON.parse(JSON.stringify(i)),r={":for":i[":for"]};delete i[":for"],pf(r,{...s,...t});const n=[];return r[":for"].forEach((t=>{const i=ff(e,t);n.push(...mf(i));})),e.attrs=o,n}(e,t);const h={...a,...t},c={...o};let d;if(pf(o,h),Object.prototype.hasOwnProperty.call(o,"if")&&!o.if)d=null;else if(delete o.if,l)d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{children:i,attrs:s,cpOption:o}=e,r=vf(i,t),{Component:n,injection:a}=o,l=new n({data:s,injection:a}),h=df(Kg(l,r));if(!h)return null;return mf(ff(h))[0]}(e,t);else {const{key:e}=o;void 0!==e&&delete o.key;const i=vf(n,t);d=new cf({tagName:s.toUpperCase(),data:o,cpInstance:r,key:e,children:i});}return e.attrs=c,null===(i=d)||void 0===i||i.children.forEach((e=>{e.parent=d;})),d}return function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{value:s}=e;const o=null===(t=e.parent)||void 0===t||null===(t=t.attrs)||void 0===t?void 0:t.html;if(s=function(e,t){const i=He(e,gf);i.length&&i.forEach((i=>{const s=i[1].split(".").reduce(((e,t)=>e[t]),t),o=i[0];e=e.replace(o,s);}));return e}(s.trim(),{...e.data,...i}),o){return ff(df(ef(s),!1))}return new cf({tagName:"TEXT",text:s})}(e,t)}function pf(e,t){for(const o of Object.keys(e)){const[,r,n]=o.match(/^(:|@)(.+)/)||[];if(!n)continue;let a=e[o];if(delete e[o],"for"===n){var i,s;let[o,r]=a.split(" in "),[n,l]=o.split(",");n=n.trim(),l=null===(i=l)||void 0===i?void 0:i.trim(),r=null===(s=r)||void 0===s?void 0:s.trim();const h=[],c=r.split(".").reduce(((e,t)=>e[t]),t);if(L(c))c.forEach(((e,t)=>{const i={};i[n]=e,l&&(i[l]=t),h.push(i);}));else if(B(c))for(const[e,t]of Object.entries(c)){const i={};i[n]=t,l&&(i[l]=e),h.push(i);}e[":for"]=h;}else {const i="this"===a?t:a.split(".").reduce(((e,t)=>null==e?void 0:e[t]),t);if(void 0!==i)"class"===n&&e[n]?e[n]=`${e[n]} ${i}`:e[n]=i;else {a=a.replace(uf,(e=>e.includes('"')||e.includes("'")||/^(true|false|\d+|undefined|null)$/.test(e)?e:e.split(".")));try{let i=yf(a,t);Fe(i)&&(i=new Function(`return ${a}`)()),"class"===n&&e[n]?e[n]=`${e[n]} ${i}`:e[n]=i;}catch(t){e[n]=void 0;}}"@"===r&&(e.events||(e.events={}),e.events[n]=e[n],delete e[`@${n}`]);}}}function mf(e){return e?(L(e)||(e=[e]),e):[]}function vf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];return e.forEach((e=>{const s=ff(e,t)||[];i.push(...mf(s));})),i}function yf(e,t){let i=null;try{const s=e.split(",");for(let e=0;e<s.length;e++){const i=s[e],o=/(\w+)(\[(\d+)\])?/,r=i.match(o);if(!r){t=null;break}{const e=r[1],i=r[3];if(!Object.prototype.hasOwnProperty.call(t,e)){t=null;break}t=t[e],void 0!==i&&Array.isArray(t)&&(t=t[i]);}}i=t;}catch(e){i=null;}return i}class wf{constructor(e){let{data:i={},template:s="",components:o={},injection:r={}}=e;t(this,"el",void 0),t(this,"vNode",null),t(this,"template",""),t(this,"data",{}),t(this,"injection",{}),t(this,"components",{}),t(this,"emitter",void 0),t(this,"uiEmitter",void 0),t(this,"isInserted",!1),t(this,"hooks",{created:ee.create(),inserted:ee.create(),updated:ee.create(),beforeDestroyed:ee.create(),destroyed:ee.create()}),t(this,"selfEvents",[]),t(this,"globalEvents",[]),t(this,"nativeEvents",[]),this.template=s,this.emitter=J.create(),this.setData(i),this.setComponents(o),this.setInjects(r),this.uiEmitter=this.injection.emitter,this.hooks.created.on((e=>{this.el=e;})),this.hooks.destroyed.on((()=>{this.destroy();})),this.initEvents();}setInjects(e){Object.assign(this.injection,e);}initEvents(){var e=this;const t=(t,i)=>{this.on(t,(function(){for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];$(i)?e.$emit(i,s):H(i)&&i(...s);}));};for(const[e,s]of Object.entries((null===(i=this.data)||void 0===i?void 0:i.events)||{})){var i;t(e,s);}for(const[e,i]of Object.entries((null===(s=this.data)||void 0===s||null===(s=s.options)||void 0===s?void 0:s.events)||{})){var s;t(e,i);}}setData(e){Object.assign(this.data,e);}setComponents(e){Object.assign(this.components,e);}on(e,t){this.emitter.on(e,t),this.selfEvents.push([e,t]);}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.emitter.emit(e,...i);}unbindSelfEvents(){this.selfEvents.forEach((e=>{let[t,i]=e;this.emitter.off(t,i);})),this.selfEvents=[];}$on(e,t){var i;this.uiEmitter&&(null===(i=this.uiEmitter)||void 0===i||i.on(e,t),this.globalEvents.push([e,t]));}$emit(e){for(var t,i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];null===(t=this.uiEmitter)||void 0===t||t.emit(e,...s);}unbindGlobalEvents(){this.globalEvents.forEach((e=>{let[t,i]=e;this.uiEmitter.off(t,i);})),this.globalEvents=[];}nativeOn(e,t,i){if(L(e))e.forEach((e=>{this.nativeOn(e,t,i);}));else {const s=((e,t,i,s)=>e?(e.addEventListener(t,i,s),()=>{e.removeEventListener(t,i);}):null)(e,t,i);s&&this.nativeEvents.push(s);}}unbindNativeEvents(){this.nativeEvents.forEach((e=>{e();})),this.nativeEvents=[];}query(e){var t;return null===(t=this.el)||void 0===t?void 0:t.querySelector(e)}queryAll(e){var t;return null===(t=this.el)||void 0===t?void 0:t.querySelectorAll(e)}parseHTML(){return ff(df(Kg(this,[])))}reRenderVNode(){const e=function(e){const t=Kg(e);return ff(df(t))}(this);this.vNode.patch(e);}bindEventsEmitter(){var e=this;const{options:t}=this.data;if(null!=t&&t.events)for(const[i,s]of Object.entries(t.events))this.nativeOn(this.el,i,(function(){for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];e.emit(i,...s);}));}destroy(){this.unbindSelfEvents(),this.unbindGlobalEvents(),this.unbindNativeEvents();}}const bf=(e,t,i,s)=>{const{id:o,tooltip:r,dataId:n,style:a,className:l}=e||{},h=(e=>{let t="";if(e)for(const[i,s]of Object.entries(e))t+=`${_(i)}:${s};`;return t})(a);return (W(o)?"":` id="${o}"`)+` class="${t}${null!=i?i:""} ${l||""}"`+(W(s)?"":` :class="${s}"`)+(h?` style="${h}"`:"")+(W(r)?"":` title="${r}"`)+(W(n)?"":` data-id="${n}"`)};function xf(e){if(0===Object.keys(e).length||!e)return '<MainView :options="this"></MainView>';const t=-1!==["Root","DDVRoot","Layout","DDVLayout"].indexOf(null==e?void 0:e.type);return $(e.type)&&!t?`<${e.type} :options="this"></${e.type}>`:'<Root :options="this"></Root>'}function Cf(){const e=U(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return null!=e&&e.children&&(e.children=e.children.map((e=>$(e)?{type:e}:B(e)?Cf(e):e))),e}class Sf{constructor(e){t(this,"options",void 0),t(this,"postfix",void 0),t(this,"uiEvents",[]),t(this,"parsedUiConfig",void 0),t(this,"injection",void 0),t(this,"rootComponent",void 0),t(this,"emitter",null),t(this,"rootDom",null),t(this,"rootVNode",void 0),t(this,"container",void 0),t(this,"uiConfig",{});const{container:i,injection:s,postfix:o,uiConfig:r,emitter:n}=e;this.options=e,this.injection=s,this.uiConfig=r,this.parsedUiConfig=Cf(r),this.emitter=n||J.create(),this.postfix=o||`-${q()}`,$(i)?this.container=document.getElementById(i):i instanceof HTMLElement&&(this.container=i),this.init();}static registerComponent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const[t,i]of Object.entries(e))Sf.isAlreadyRegistered(t)||(this.components[`DDV${t}`]=i,this.components[t]=i);}static isAlreadyRegistered(e){return !!this.components[e]}static getComponents(){return this.components}init(){const e=new wf({data:this.parsedUiConfig,template:xf(this.parsedUiConfig),components:Sf.getComponents(),injection:{...this.injection,components:Sf.getComponents(),postfix:this.postfix,emitter:this.emitter}}),t=e.parseHTML();if(!t)return;const i=t.renderDom();this.rootComponent=e,this.rootVNode=t,this.rootDom=i,this.container&&(this.container.appendChild(i),tf(this.rootVNode));}updateUiConfig(e){const t=Cf(e),i=new wf({data:t,template:xf(this.parsedUiConfig),components:Sf.getComponents(),injection:{...this.injection,components:Sf.getComponents(),postfix:this.postfix,emitter:this.emitter}}).parseHTML(),s=this.rootVNode.patch(i);return this.rootDom=s.el,this.rootVNode=s,this.uiConfig=e,tf(this.rootVNode),!0}bindContainer(e){let t;if(Z(e)&&(t=e),$(e)){const i=document.getElementById(e);Z(i)&&(t=i);}return !!t&&(this.container=t,t.appendChild(this.rootDom),tf(this.rootVNode),!0)}unbindContainer(){if(this.container&&0!==this.container.children.length){for(let e=0;e<this.container.children.length;e++)if(this.container.children[e]===this.rootDom)return void this.container.removeChild(this.rootDom);this.container=null;}}queryByDataId(e){var t;return null===(t=this.rootDom)||void 0===t?void 0:t.querySelector(`[data-id=${e}]`)}queryAllByDataId(e){var t;return null===(t=this.rootDom)||void 0===t?void 0:t.querySelectorAll(`[data-id=${e}]`)}getElementsByType(e,t){var i;const s=[];return (null===(i=e.cpInstance)||void 0===i||null===(i=i.constructor)||void 0===i?void 0:i.cpName)===t&&e.el&&s.push(e.el),e.children.length>0&&e.children.forEach((e=>{s.push(...this.getElementsByType(e,t));})),s}on(e,t){const i=this.emitter.on(e,t);this.uiEvents.push(i);}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];this.emitter.emit(e,...i);}off(e,t){this.emitter.off(e,t);}offAllEvents(){this.uiEvents.forEach((e=>{let{name:t,fn:i,context:s,once:o}=e;this.emitter.off(t,i,s,o);}));}destroy(){this.unbindContainer(),this.offAllEvents(),this.emitter=null,this.rootDom=null,this.uiConfig={},this.parsedUiConfig={},sf(this.rootVNode);}}t(Sf,"components",{});class Pf extends wf{constructor(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(e),t(this,"defaultClass","ddv-button"),this.initTemplate(i),this.bindBaseHooks();}bindBaseHooks(){this.hooks.inserted.on((e=>{this.bindEventsEmitter();}));}initTemplate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{options:t}=this.data,i=""===e?this.defaultClass:`${this.defaultClass} ${e}`,s=`<div ${bf(t,i)} >`+(W(null==t?void 0:t.label)?"":`<span>${t.label}</span>`)+"<slot></slot></div>";this.template=s;}}class Tf extends wf{constructor(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";super(e),t(this,"defaultClass","ddv-layout");const{options:s}=this.data;this.initTemplate((null==s?void 0:s.flexDirection)||i),this.bindHooks();}bindHooks(){this.hooks.inserted.on((()=>{kf(this);})),this.hooks.updated.on((()=>{kf(this);}));}initTemplate(e){const{options:t}=this.data,i=(null==t?void 0:t.children)||[],s="row"===e?"":"-col";let o=`<div ${bf(t,`${this.defaultClass}${s}`)}>`;i&&i.length&&i.forEach(((e,t)=>{if(B(e)){const{type:i}=e;i.trim(),i.length>0&&(o+=`<${i} :options="options.children[${t}]"></${i}>`);}})),o+="</div>",this.template=o;}}function kf(e){const{options:t}=e.data,i=e.el.children;((null==t?void 0:t.children)||[]).forEach(((t,s)=>{if(Z(t)){const o=t;0===s?(e.el.append(o),e.el.insertBefore(o,i[0])):_e(o,i[s-1]);}}));}class Df extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-root"),this.initTemplate(),this.bindHooks();}initTemplate(){const{options:e}=this.data,{children:t}=e,i="column"===e.flexDirection?`ddv-column ${this.defaultClass}`:this.defaultClass;let s=`<div ${bf(e,i,"")} >`;t&&t.length&&t.forEach(((e,t)=>{if(B(e)){const{type:i}=e;i.trim(),i.length>0&&(s+=`<${i} :options="options.children[${t}]"></${i}>`);}})),s+="</div>",this.template=s;}bindHooks(){this.hooks.inserted.on((()=>{kf(this);}));}}class Ef extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-split-row"),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.inserted.on((()=>{this.updateClassName();})),this.hooks.updated.on((()=>{this.isInserted&&this.updateClassName();}));}updateClassName(){const e=this.el.parentNode,t=window.getComputedStyle(e),{flexDirection:i}=t;"column"===i&&(this.el.classList.remove(this.defaultClass),this.el.classList.add("ddv-split-column"));}initTemplate(){const{options:e}=this.data,t=bf(e,this.defaultClass);this.template=`<div ${t}></div>`;}}var Af,If="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Mf={exports:{}};Af=Mf,function(){function e(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function t(e,t,i){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="blob",s.onload=function(){n(s.response,t,i);},s.onerror=function(){},s.send();}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send();}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"));}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t);}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof If&&If.global===If?If:void 0,r=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),n=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,r,n){var a=o.URL||o.webkitURL,l=document.createElement("a");r=r||e.name||"download",l.download=r,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?s(l):i(l.href)?t(e,r,n):s(l,l.target="_blank")):(l.href=a.createObjectURL(e),setTimeout((function(){a.revokeObjectURL(l.href);}),4e4),setTimeout((function(){s(l);}),0));}:"msSaveOrOpenBlob"in navigator?function(o,r,n){if(r=r||o.name||"download","string"!=typeof o)navigator.msSaveOrOpenBlob(e(o,n),r);else if(i(o))t(o,r,n);else {var a=document.createElement("a");a.href=o,a.target="_blank",setTimeout((function(){s(a);}));}}:function(e,i,s,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return t(e,i,s);var a="application/octet-stream"===e.type,l=/constructor/i.test(o.HTMLElement)||o.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent);if((h||a&&l||r)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=h?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null;},c.readAsDataURL(e);}else {var d=o.URL||o.webkitURL,u=d.createObjectURL(e);n?n.location=u:location.href=u,n=null,setTimeout((function(){d.revokeObjectURL(u);}),4e4);}});o.saveAs=n.saveAs=n,Af.exports=n;}();var Rf=Mf.exports;class Of extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-main-canvas"),this.initTemplate(),this.bindHooks();}bindHooks(){const{inserted:e}=this.hooks;e.on((()=>{var e;null===(e=this.injection.viewer)||void 0===e||e.context.viewService.bindContainer(this.el);}));}initTemplate(){const{options:e}=this.data;e.id=e.id||`ddvMainView${this.injection.viewer.postfix}`;const t=`<div ${bf(e,this.defaultClass,"")} ><slot></slot></div>`;this.template=t;}}t(Of,"cpName","MainView");const _f={CameraResolution:"ddvCameraResolution",Capture:"ddvCapture",Flashlight:"ddvFlashlight",CameraConvert:"ddvCameraConvert",AutoDetect:"ddvAutoDetect",AutoCapture:"ddvAutoCapture",Rotate:"ddvRotate",RotateLeft:"ddvRotateLeft",RotateRight:"ddvRotateRight",Load:"ddvLoad",Delete:"ddvDelete",DeleteCurrent:"ddvDeleteCurrent",DeleteAll:"ddvDeleteAll",Zoom:"ddvZoom",ZoomIn:"ddvZoomIn",ZoomOut:"ddvZoomOut",ZoomByPercentage:"ddvZoomByPercentage",Crop:"ddvCrop",CropAll:"ddvCropAll",CropCurrent:"ddvCropCurrent",CropMode:"ddvCropMode",PerspectiveAll:"ddvPerspectiveAll",FullQuad:"ddvFullQuad",Undo:"ddvUndo",Redo:"ddvRedo",Restore:"ddvRestore",Pan:"ddvPan",Filter:"ddvFilter",Print:"ddvPrint",ThumbnailSwitch:"ddvThumbnailSwitch",DisplayMode:"ddvDisplayMode",ContinuousPage:"ddvContinuousPage",SinglePage:"ddvSinglePage",FitMode:"ddvFitMode",FitWidth:"ddvFitWidth",FitHeight:"ddvFitHeight",FitWindow:"ddvFitWindow",ActualSize:"ddvActualSize",Back:"ddvBack",Close:"ddvClose",Done:"ddvDone",Download:"ddvDownload",ImagePreview:"ddvImagePreview",FirstPage:"ddvFirstPage",LastPage:"ddvLastPage",NextPage:"ddvNextPage",PrevPage:"ddvPrevPage",FitMode_FitWidth:"ddvFitModeFitWidth",FitMode_FitHeight:"ddvFitModeFitHeight",FitMode_FitWindow:"ddvFitModeFitWindow",FitMode_ActualSize:"ddvFitModeActualSize",DisplayMode_SinglePage:"ddvDisplayModeSinglePage",DisplayMode_ContinuousPage:"ddvDisplayModeContinuousPage",Crop_CropAll:"ddvCropCropAll",Crop_CropCurrent:"ddvCropCropCurrent",Crop_CropCancel:"ddvCropCropCancel",Crop_CropApply:"ddvCropCropApply",Filter_FilterAll:"ddvFilterFilterAll",Delete_DeleteCurrent:"ddvDeleteDeleteCurrent",Delete_DeleteAll:"ddvDeleteDeleteAll"};function Nf(e){e.$on("ui_hidePopup",(t=>{t!==e&&H(null==e?void 0:e.togglePopup)&&(null==e||e.togglePopup(!1));}));}function Lf(e){e.$on("ui_cropClick",(t=>{const{viewer:i}=e.injection,s=i.getPageCounts()||0;(t||s)&&Bf(e.el,t);}));}function Bf(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return;const{classList:i}=e,s=i.contains("ddv-button-disable");t?s||e.classList.add("ddv-button-disable"):s&&!t&&e.classList.remove("ddv-button-disable");}function Uf(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return;const{classList:i}=e,s=i.contains("ddv-button-activated");t?s||e.classList.add("ddv-button-activated"):e.classList.remove("ddv-button-activated");}function Wf(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{left:r,top:n,right:a,bottom:l}=function(e,t){const i=(t||e.parentElement).getBoundingClientRect(),s=e.getBoundingClientRect(),o=s.top-i.top,r=i.right-s.right;return {top:o,bottom:i.bottom-s.bottom,left:s.left-i.left,right:r}}(t,e),{x:h,y:c}=e.getBoundingClientRect(),{height:d,width:u}=i.getBoundingClientRect(),{x:g,y:f,width:p,height:m}=t.getBoundingClientRect();let v=Math.floor(g)-Math.floor(h);v<3&&(v=0);const y=v-(Math.floor(u)-Math.floor(p))/2,w=y<3?"0px":`${y}px`;let b=Math.floor(f)-Math.floor(c);i.style.left=o&&a>u/2&&r>u/2?w:a>u?`${v}px`:r>u?v-(Math.floor(u)-Math.floor(p))+"px":w,l>d?(s&&(b+=2),i.style.top=b+Math.floor(m)-1+"px"):(s&&(b-=4),i.style.top=b-Math.floor(d)+"px");}function Vf(e,t,i){const s=im.getTooltip(),o=im.getDisplayTextConfig(),r=_f;null!=i&&i.id||!(e in r)||(i.id=r[e]+t.postfix),null!=i&&i.tooltip||!(e in s)||(i.tooltip=s[e]),null!=i&&i.label||!(e in o)||(i.label=o[e]);}function Ff(e){return (null==e?void 0:e.constructor.cpName)||""}function zf(e){const{value:t}=e,{fontSize:i}=getComputedStyle(e),s=document.createElement("div");s.style.position="absolute",s.style.left="-9999px",s.style.top="-9999px",s.style.visibility="hidden",s.style.fontSize=i,s.style.fontFamily="Microsoft YaHei",document.body.appendChild(s),s.textContent=t;const o=s.clientWidth;return s.remove(),o}function Hf(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.uiState!==t&&e.el&&(Bf(e.el,"disabled"===t),function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return;const{classList:i}=e,s=i.contains("ddv-button-focused");t?s||e.classList.add("ddv-button-focused"):e.classList.remove("ddv-button-focused");}(e.el,"focused"===t),i&&Uf(e.el,"focused"===t),e.uiState=t);}class jf extends Pf{constructor(e,i){super(e,i.class),t(this,"callback",void 0),t(this,"uiState","normal"),t(this,"isFocused",!1),this.callback=i.callback,this.bindHooks(),"false"!==e.data.default&&this.bindDefaultUi();}bindEvent(){this.nativeOn(this.el,"click",this.callback),this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup");}));}setUiState(e){Hf(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]);}bindDefaultUi(){const{viewer:e}=this.injection,t=e=>{let t=this.isFocused?"focused":"normal";(W(null==e?void 0:e.pageCount)?this.injection.viewer.getPageCounts():e.pageCount)||(t="disabled"),this.setUiState(t);};e.hooks.pageExistenceChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageExistenceChanged.off(t);}));}bindHooks(){this.hooks.created.on((()=>{this.bindEvent();})),this.hooks.updated.on((()=>{this.uiState="normal";}));}initTemplate(e){const t=this.data;t.options||(t.options={});const{options:i,id:s}=this.data;s&&(i.id=s),Vf(Ff(this),this.injection.viewer,i),"false"===t.default&&(i.label=void 0),super.initTemplate(e);}}class Gf extends jf{constructor(e,i){super(e,{class:i.class,callback:()=>{this.injection.viewer.updateViewerConfig({displayMode:i.displayMode});}}),t(this,"displayMode",void 0),this.displayMode=i.displayMode,Lf(this);}bindDefaultUi(){const e=this.injection.viewer,t=t=>{var i;const s=e.getActiveTab(),o=(null==t?void 0:t.pageCount)||e.getPageCounts(),r=(null==s||null===(i=s.context)||void 0===i?void 0:i.displayMode)||e.getViewerConfig().displayMode;o?r===this.displayMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};e.hooks.pageExistenceChanged.on(t),e.hooks.displayModeChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageExistenceChanged.off(t),e.hooks.displayModeChanged.off(t);}));}}class $f extends Gf{constructor(e){super(e,{class:"ddv-continuous-mode",displayMode:"continuous"});}}t($f,"cpName","ContinuousPage");class Xf extends Gf{constructor(e){super(e,{class:"ddv-multiple-mode",displayMode:"multiple"});}}t(Xf,"cpName","MultiPage");class Yf extends Gf{constructor(e){super(e,{class:"ddv-single-mode",displayMode:"single"});}}t(Yf,"cpName","SinglePage");class qf extends jf{constructor(e,i){super(e,{class:i.class,callback:()=>{this.injection.viewer.updateViewerConfig({toolMode:i.toolMode,canvasStyle:{cursor:i.cursor}});}}),t(this,"toolMode",void 0),this.toolMode=i.toolMode,this.bindViewerHooks();}bindDefaultUi(){const e=this.injection.viewer,t=()=>{const{toolMode:t}=e.getViewerConfig();e.getPageCounts()>0?t===this.toolMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};e.hooks.pageExistenceChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageExistenceChanged.off(t);}));}bindViewerHooks(){const e=this.injection.viewer,t=t=>{const i=t.newToolMode===this.toolMode;e.getPageCounts()>0?i?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};e.hooks.toolModeChanged.on(t),this.hooks.destroyed.on((()=>{e.hooks.toolModeChanged.off(t);}));}}class Qf extends qf{constructor(e){super(e,{class:"ddv-pan-mode",toolMode:"pan",cursor:"default"});}}t(Qf,"cpName","Pan");t(class extends qf{constructor(e){super(e,{class:"ddv-zoom-mode",toolMode:"zoomIn",cursor:"zoom-in"});}},"cpName","ZoomMode");class Zf extends qf{constructor(e){super(e,{class:"ddv-crop-mode",toolMode:"crop",cursor:"crosshair"});}}t(Zf,"cpName","CropMode");class Jf extends jf{constructor(e,i){super(e,{class:i.class,callback:()=>{const{viewer:e}=this.injection;e.updateViewerConfig({fitMode:i.fitMode});}}),t(this,"fitMode",void 0),this.fitMode=i.fitMode,Lf(this);}bindDefaultUi(){const e=this.injection.viewer,t=()=>{const t=e.getPageCounts(),i=e.getActiveTab();let{fitMode:s}=e.getViewerConfig();i&&(s=i.context.fitMode);const o=t>0&&s===this.fitMode;t>0?o?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};e.hooks.pageExistenceChanged.on(t),e.hooks.fitModeChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageExistenceChanged.off(t),e.hooks.fitModeChanged.off(t);}));}}class Kf extends Jf{constructor(e){super(e,{class:"ddv-fit-height",fitMode:"height"});}}t(Kf,"cpName","FitHeight");class ep extends Jf{constructor(e){super(e,{class:"ddv-fit-width",fitMode:"width"});}}t(ep,"cpName","FitWidth");class tp extends Jf{constructor(e){super(e,{class:"ddv-fit-window",fitMode:"window"});}}t(tp,"cpName","FitWindow");class ip extends Jf{constructor(e){super(e,{class:"ddv-fit-actual",fitMode:"actualSize"});}}t(ip,"cpName","ActualSize");class sp extends jf{constructor(e){super(e,{class:"ddv-crop-current",callback:()=>{this.cropEvent();}});}bindDefaultUi(){op(this);}cropEvent(){const e=this.injection.viewer,t=e.getRectBox(),i=e.getCurrentPageIndex();t&&e.cropPages(t,[i]);}}function op(e){const t=e.injection.viewer,i=i=>{const s=W(null==i?void 0:i.pageCount)?t.getPageCounts():i.pageCount,o=t.getRectBox();s&&o?e.setUiState("normal"):e.setUiState("disabled");},s=t=>{e.setUiState("normal");},o=t=>{e.setUiState("disabled");};e.hooks.inserted.on(i),e.hooks.updated.on(i),t.hooks.pageExistenceChanged.on(i),t.hooks.cropRectDrawn.on(s),t.hooks.cropRectDeleted.on(o),e.hooks.destroyed.on((()=>{t.hooks.pageExistenceChanged.off(i),t.hooks.cropRectDrawn.off(s),t.hooks.cropRectDeleted.off(o);}));}t(sp,"cpName","CropCurrent");class rp extends jf{constructor(e){super(e,{class:"ddv-crop-all",callback:()=>{this.cropEvent();}});}bindDefaultUi(){op(this);}cropEvent(){const{viewer:e}=this.injection,t=e.getRectBox(),i=e.getCropIndices();t&&e.cropPages(t,i);}}t(rp,"cpName","CropAll");class np extends jf{constructor(e){super(e,{class:"ddv-perspective",callback:()=>{this.perspectiveEvent();}});}perspectiveEvent(){const{viewer:e}=this.injection;e.perspectiveAllPage();}}t(np,"cpName","PerspectiveAll");class ap extends jf{constructor(e){super(e,{class:"ddv-full-quad",callback:()=>{this.toggleFull();}}),this.bindViewerHooks();}toggleFull(){const{viewer:e}=this.injection;e.toggleFullPerspective();}bindViewerHooks(){const e=e=>{this.isFocused=e.isFull,this.setUiState(this.isFocused?"focused":"normal",!j());},{hooks:t}=this.injection.viewer;t.perspectiveQuadChanged.on(e),this.hooks.destroyed.on((()=>{t.perspectiveQuadChanged.off(e);}));}}t(ap,"cpName","FullQuad");class lp extends jf{constructor(e){super(e,{class:"ddv-redo-page",callback:()=>{this.injection.viewer.redo();}}),this.$on("ui_cropClick",(()=>{const e=this.injection.viewer.getOperationState().redo>0?"normal":"disabled";this.setUiState(e);}));}bindDefaultUi(){hp("redo",this);}}function hp(e,t){const{viewer:i}=t.injection,s=()=>{const s=i.getOperationState(),o=("redo"===e?s.redo:s.undo)>0?"normal":"disabled";t.setUiState(o);};t.hooks.inserted.on(s),t.hooks.updated.on(s);const o=i=>{let s="disabled";s="redo"===e?i.redo>0?"normal":"disabled":i.undo>0?"normal":"disabled",t.setUiState(s);};i.hooks.operationsChanged.on(o),t.hooks.destroyed.on((()=>{i.hooks.operationsChanged.off(o);}));}t(lp,"cpName","Redo");class cp extends jf{constructor(e){super(e,{class:"ddv-restore-page",callback:()=>{const{viewer:e}=this.injection,t=e.getCurrentPageIndex();e.reset(t);}}),Lf(this);}}t(cp,"cpName","Restore");class dp extends jf{constructor(e){super(e,{class:"ddv-rotate-left",callback:()=>{const{viewer:e}=this.injection,t=e.getCurrentPageIndex();e.rotatePages(-90,[t]);}}),Lf(this);}}t(dp,"cpName","RotateLeft");class up extends jf{constructor(e){super(e,{class:"ddv-rotate-right",callback:()=>{const{viewer:e}=this.injection,t=e.getCurrentPageIndex();e.rotatePages(90,[t]);}}),Lf(this);}}t(up,"cpName","RotateRight");class gp extends jf{constructor(e){super(e,{class:"ddv-undo-page",callback:()=>{this.injection.viewer.undo();}}),this.$on("ui_cropClick",(()=>{const e=this.injection.viewer.getOperationState().undo>0?"normal":"disabled";this.setUiState(e);}));}bindDefaultUi(){hp("undo",this);}}t(gp,"cpName","Undo");class fp extends jf{constructor(e,i){super(e,{class:i.class,callback:i.callback}),t(this,"type",void 0),this.type=i.type;}bindDefaultUi(){const e=this.injection.viewer,t=()=>{const t=e.getPageCounts(),i=e.getCurrentPageIndex();let s=!1;switch(this.type){case"previous":case"first":s=t>0&&0!==i;break;case"last":case"next":s=i<t-1;}0===t&&(s=!1),this.setUiState(s?"normal":"disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t),e.hooks.pageChanged.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageChanged.off(t);}));}}class pp extends fp{constructor(e){super(e,{class:"ddv-first-page",type:"first",callback:()=>{this.injection.viewer.gotoPage(0);}});}}t(pp,"cpName","FirstPage");class mp extends fp{constructor(e){super(e,{class:"ddv-last-page",type:"last",callback:()=>{const e=this.injection.viewer,t=e.getPageCounts();e.gotoPage(t-1);}});}}t(mp,"cpName","LastPage");class vp extends fp{constructor(e){super(e,{class:"ddv-next-page",type:"next",callback:()=>{const e=this.injection.viewer,t=e.getCurrentPageIndex();e.gotoPage(t+1);}});}}t(vp,"cpName","NextPage");class yp extends fp{constructor(e){super(e,{class:"ddv-prev-page",type:"previous",callback:()=>{const e=this.injection.viewer,t=e.getCurrentPageIndex();e.gotoPage(t-1);}});}}t(yp,"cpName","PrevPage");class wp extends jf{constructor(e){super(e,{class:"ddv-zoom-in",callback:()=>{this.injection.viewer.zoomIn();}}),this.bindViewerHooks(),Lf(this);}bindViewerHooks(){const e=this.injection.viewer,t=t=>{const{maxZoom:i}=e.getViewerConfig();!(e.getPageCounts()>0)||t.newZoomRatio>=i?this.setUiState("disabled"):this.setUiState("normal");};e.hooks.zoomChanged.on(t),this.hooks.destroyed.on((()=>{e.hooks.zoomChanged.off(t);}));}}t(wp,"cpName","ZoomIn");class bp extends jf{constructor(e){super(e,{class:"ddv-zoom-out",callback:()=>{this.injection.viewer.zoomOut();}}),this.bindViewerHooks(),Lf(this);}bindViewerHooks(){const e=this.injection.viewer,t=t=>{const{minZoom:i}=e.getViewerConfig();!(e.getPageCounts()>0)||t.newZoomRatio<=i?this.setUiState("disabled"):this.setUiState("normal");};e.hooks.zoomChanged.on(t),this.hooks.destroyed.on((()=>{e.hooks.zoomChanged.off(t);}));}}t(bp,"cpName","ZoomOut");class xp extends jf{constructor(e){super(e,{class:"ddv-auto-capture",callback:()=>{const{viewer:e}=this.injection,{viewerMode:t}=e.getViewerConfig(),{enableAutoCapture:i}=e.getCameraConfig();t===sl.CAPTURE&&e.updateCameraConfig({enableAutoCapture:!i});}}),this.bindViewerHooks();}bindDefaultUi(){const e=()=>{const e=this.injection.viewer;e.isVideoPlaying()?e.getCameraConfig().enableAutoCapture?this.setUiState("focused",!j()):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const{hooks:e}=this.injection.viewer,t=e=>{const t=e.enableAutoCapture?"focused":"normal";this.setUiState(t,!j());},i=()=>{const{enableAutoCapture:e}=this.injection.viewer.getCameraConfig();this.setUiState(e?"focused":"normal",!j());},s=()=>{this.setUiState("disabled");};e.autoCaptureChanged.on(t),e.cameraPlayed.on(i),e.cameraClosed.on(s),this.hooks.destroyed.on((()=>{e.autoCaptureChanged.off(t),e.cameraPlayed.off(i),e.cameraClosed.off(s);}));}}t(xp,"cpName","AutoCapture");class Cp extends jf{constructor(e){super(e,{class:"ddv-auto-detect",callback:()=>{const{viewer:e}=this.injection,{viewerMode:t}=e.getViewerConfig(),{enableAutoDetect:i}=e.getCameraConfig();t===sl.CAPTURE&&e.updateCameraConfig({enableAutoDetect:!i});}}),this.bindViewerHooks();}bindDefaultUi(){const e=()=>{const e=this.injection.viewer;e.isVideoPlaying()&&e.context.core.documentDetectService.enableDetect?e.getCameraConfig().enableAutoDetect?this.setUiState("focused",!j()):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const{hooks:e}=this.injection.viewer,t=e=>{const t=e.enableAutoDetect?"focused":"normal";this.setUiState(t,!j());},i=()=>{const{core:e}=this.injection.viewer.context;if(!e.documentDetectService.enableDetect)return;const{enableAutoDetect:t}=this.injection.viewer.getCameraConfig();this.setUiState(t?"focused":"normal",!j());},s=()=>{this.setUiState("disabled");};e.autoDetectChanged.on(t),e.cameraPlayed.on(i),e.cameraClosed.on(s),this.hooks.destroyed.on((()=>{e.autoDetectChanged.off(t),e.cameraPlayed.off(i),e.cameraClosed.off(s);}));}}t(Cp,"cpName","AutoDetect");class Sp extends jf{constructor(e){super(e,{class:"ddv-capture-image",callback:()=>{if(this.isCapturing)return;const e=this.injection.viewer;this.isCapturing=!0,this.setUiState("disabled"),e.capture().finally((()=>{this.isCapturing=!1,this.setUiState("normal");}));}}),t(this,"isCapturing",!1),this.bindViewerHooks();}bindDefaultUi(){const e=()=>{this.setUiState(this.injection.viewer.isVideoPlaying()?"normal":"disabled");};this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const{hooks:e}=this.injection.viewer,t=()=>{this.setUiState("normal");},i=()=>{this.setUiState("disabled");};e.cameraPlayed.on(t),e.cameraClosed.on(i),this.hooks.destroyed.on((()=>{e.cameraPlayed.off(t),e.cameraClosed.off(i);}));}}t(Sp,"cpName","Capture");class Pp extends jf{constructor(e){super(e,{class:"ddv-camera-flashlight",callback:()=>{const{viewer:e}=this.injection;e.cameraContext.turnOnTheTorch?e.turnOffTorch():e.turnOnTorch();}}),this.bindViewerHooks();}bindDefaultUi(){const e=()=>{const{viewer:e}=this.injection;e.isVideoPlaying()&&e.cameraContext.torchSupported?e.cameraContext.turnOnTheTorch?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const e=this.injection.viewer,t=e=>{switch(e.torchState){case"supported":case"off":this.setUiState("normal");break;case"on":this.setUiState("focused",!j());break;default:this.setUiState("disabled");}};e.hooks.torchChanged.on(t),this.hooks.destroyed.off((()=>{e.hooks.torchChanged.off(t);}));}}t(Pp,"cpName","Flashlight");class Tp extends jf{constructor(e){super(e,{class:"ddv-camera-convert",callback:()=>{const{viewer:e}=this.injection;e.cameraContext.convertCamera();}}),this.bindViewerHooks();}bindDefaultUi(){const e=()=>{const e=this.injection.viewer;e.isVideoPlaying()||this.setUiState("disabled"),this.setUiState(e.cameraContext.canFrontCamera?"normal":"disabled");};this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const{hooks:e}=this.injection.viewer,t=()=>{const e=this.injection.viewer.cameraContext.canFrontCamera;this.setUiState(e?"normal":"disabled");},i=()=>{this.setUiState("disabled");};e.cameraPlayed.on(t),e.cameraClosed.on(i),this.hooks.destroyed.on((()=>{e.cameraPlayed.off(t),e.cameraClosed.off(i);}));}}t(Tp,"cpName","CameraConvert");class kp extends jf{constructor(e){super(e,{class:"ddv-load-image",callback:()=>{this.fileLoader.value=null,delete this.fileLoader.files,this.fileLoader.click();}}),t(this,"fileLoader",void 0),this.$on("ui_cropClick",(e=>{const{viewer:t}=this.injection;0!==(t.getPageCounts()||0)&&this.setUiState(e?"disabled":"normal");}));}createFileInput(){const e=document.createElement("input");return e.accept="image/png,image/jpeg,image/bmp,image/tiff,application/pdf",e.type="file",e.multiple=!0,e.addEventListener("change",(t=>{const{files:i}=e,s=i.length,o=[];for(let e=0;e<s;e++){const t=new Blob([i[e]],{type:i[e].type});o.push({fileData:t});}this.injection.viewer.context.loadSource(o),e.value=null,e.files=null;}),!0),e}bindHooks(){super.bindHooks(),this.hooks.inserted.on((()=>{const e=this.createFileInput();e.style.display="none",this.el.appendChild(e),this.fileLoader=e,this.fileLoader.addEventListener("click",(e=>{e.stopPropagation();}));}));}bindDefaultUi(){const e=e=>{null!=e&&e.pageCount||this.setUiState("normal");};this.injection.viewer.hooks.pageExistenceChanged.on(e),this.hooks.destroyed.on((()=>{this.injection.viewer.hooks.pageExistenceChanged.off(e);}));}}t(kp,"cpName","Load");class Dp extends jf{constructor(e){super(e,{class:"ddv-delete-all",callback:()=>{this.injection.viewer.deleteAllPages();}}),Lf(this);}}t(Dp,"cpName","DeleteAll");class Ep extends jf{constructor(e){super(e,{class:"ddv-delete-current",callback:()=>{const e=this.injection.viewer,t=e.getCurrentPageIndex();e.deletePages([t]);}}),Lf(this);}}t(Ep,"cpName","DeleteCurrent");class Ap extends jf{constructor(e){super(e,{class:"ddv-button-download",callback:()=>{const e=this.injection.viewer,t=e.getActiveTab();e.context.core.fileSaveService.saveToPdf(t.doc.pages,{mimeType:"application/octet-stream"}).then((e=>{Rf.saveAs(e,`${t.docName}.pdf`);}));}}),Lf(this);}}t(Ap,"cpName","Download");class Ip extends jf{constructor(e){super(e,{class:"ddv-button-blank",callback:()=>{}});}bindDefaultUi(){}}class Mp extends jf{constructor(e){super(e,{class:"ddv-button-close",callback:()=>{}});}bindDefaultUi(){}}t(Mp,"cpName","Close");class Rp extends jf{constructor(e){super(e,{class:"ddv-print-page",callback:()=>{const e=this.injection.viewer,t=e.getCurrentPageIndex(),i=e.getActiveTab(),{displayMode:s}=i.context;"single"===s?e.context.core.printPages(i.uid,[t]):e.context.core.printPages(i.uid);}}),Lf(this);}}t(Rp,"cpName","Print");class Op extends jf{constructor(e){super(e,{class:"ddv-thumbnail-switch",callback:()=>{const{thumbnail:e}=this;if(!e)return;const{visibility:t}=e.getViewerConfig();e.updateViewerConfig({visibility:"visible"===t?"hidden":"visible"});}}),t(this,"thumbnail",void 0),this.injection.viewer.on("thumbnailBind",(e=>{if(this.thumbnail)return;const t=this.injection.viewer.context.core.getViewer(e);t&&(this.thumbnail=t,this.bindThumbnailHooks(t));const{visibility:i}=t.getViewerConfig();this.setUiState("visible"===i?"focused":"normal",!j());})),this.injection.viewer.hooks.destroy.on((()=>{this.thumbnail=null;}));}bindThumbnailHooks(e){const t=e=>{this.setUiState("visible"===e.newVisibility?"focused":"normal",!j());};e.hooks.visibleChanged.on(t),this.hooks.destroyed.on((()=>{e.hooks.visibleChanged.off(t);}));}bindDefaultUi(){const e=this.injection.viewer,t=()=>{if(!this.thumbnail)return;const{visibility:e}=this.thumbnail.getViewerConfig();this.setUiState("visible"===e?"focused":"normal",!j());};e.hooks.pageExistenceChanged.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageExistenceChanged.off(t);}));}}t(Op,"cpName","ThumbnailSwitch");class _p extends jf{constructor(e){super(e,{class:"ddv-button-back",callback:()=>{}});}bindDefaultUi(){}}t(_p,"cpName","Back");class Np extends jf{constructor(e){super(e,{class:"ddv-button-done",callback:()=>{}});}bindDefaultUi(){}}t(Np,"cpName","Done");class Lp extends wf{constructor(e,i,s){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(e),t(this,"defaultClass",void 0),t(this,"hasCheckIcon",void 0),t(this,"popupBoxClass",void 0),t(this,"lastSelectedIndex",0),t(this,"children",[]),t(this,"uiState","normal"),t(this,"box",void 0),t(this,"isFirstClick",!0),this.defaultClass=i,this.popupBoxClass=`${this.defaultClass}-box ddv-popup-common`,this.children=s,this.hasCheckIcon=o,this.init(),this.initTemplate(),this.bindPopupSwitchEvent(),this.bindDefaultUi(),this.bindViewerResized();}init(){this.hooks.created.on((e=>{this.box=this.query(`.${this.defaultClass}-box`),this.box.style.display="none",this.box.remove(),this.bindEvents();})),this.hooks.updated.on((()=>{this.uiState="normal",this.box.style.display="none",this.isFirstClick=!0;}));}getOptionsTemplate(){let e="";return this.children.forEach((t=>{e+=`<${t.type} default="false" id="${t.id+this.injection.viewer.postfix}" ><span>${t.label}</span>`+(this.hasCheckIcon?'<i class="ddv-button-ok" style="visibility: hidden"></i>':"")+`</${t.type}>`;})),e}bindViewerResized(){const{viewer:e}=this.injection,t=()=>{const{box:e}=this,t="none"===e.style.display,i=this.injection.viewer.rootDom;t?this.isFirstClick=!0:Wf(i,this.el,this.box);};e.on("resized",t),this.hooks.destroyed.on((()=>{e.off("resized",t);}));}bindEvents(){this.nativeOn(this.el,"click",(()=>{if(this.togglePopup(),this.isFirstClick){Wf(this.injection.viewer.rootDom,this.el,this.box),this.isFirstClick=!1;}}));}setUiState(e){Hf(this,e);}bindDefaultUi(){const e=this.injection.viewer,t=e=>{const t=(W(null==e?void 0:e.pageCount)?this.injection.viewer.getPageCounts():e.pageCount)?"normal":"disabled";this.setUiState(t);};e.hooks.pageExistenceChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageExistenceChanged.off(t);}));}bindPopupSwitchEvent(){Nf(this);}togglePopup(e){const{box:t}=this,{viewer:i}=this.injection;let s="none"===t.style.display;s=W(e)?!s:!e,s?t.remove():(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(t)),Uf(this.el,!s),t.style.display=s?"none":"";}selectChildren(e){if(!this.hasCheckIcon)return;if(-1!==e&&!this.box.childNodes[e])return;if(-1!==this.lastSelectedIndex){const e=this.box.children[this.lastSelectedIndex],t=e.getElementsByTagName("i")[0];e.classList.remove("ddv-popup-selected"),t.style.visibility="hidden";}if(-1===e)return void(this.lastSelectedIndex=-1);const t=this.box.children[e],i=t.getElementsByTagName("i")[0];t.classList.add("ddv-popup-selected"),i.style.visibility="visible",this.lastSelectedIndex=e;}initTemplate(){const e=this.data;e.options||(e.options={});const{options:t}=this.data,{popupBox:i}=t;Vf(Ff(this),this.injection.viewer,t);const s=`<div ${bf(t,`ddv-button ${this.defaultClass}`)}>`+(W(null==t?void 0:t.label)?"":`<span>${t.label}</span>`)+`<div ${bf(i,this.popupBoxClass)}>`+`${this.getOptionsTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=s;}}class Bp extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-pagination"),t(this,"cssPrefix",`${this.defaultClass}-`),t(this,"uiState","normal"),t(this,"input",void 0),t(this,"totalSpan",void 0),this.initTemplate(),this.bindHooks(),this.bindDefaultUi(),Sf.registerComponent({FirstPage:pp,LastPage:mp,NextPage:vp,PrevPage:yp});}bindHooks(){this.hooks.created.on((e=>{this.bindEvents(),this.input=this.query(`.${this.cssPrefix}goto`),this.totalSpan=this.query(`.${this.cssPrefix}total`);}));}bindEvents(){const e=this.injection.viewer,t=this.query(`.${this.cssPrefix}goto`);this.nativeOn(t,"input",(()=>{Up(t,this.totalSpan.clientWidth);})),this.nativeOn(t,"blur",(()=>{const i=e.getPageCounts(),s=e.getCurrentPageIndex();let o=parseInt(t.value,10);(!o||o<0||o>i)&&(o=s+1),t.value=`${o}`,Up(t),e.gotoPage(o-1);})),this.nativeOn(t,"keyup",(i=>{if("Enter"===i.key){const i=e.getPageCounts(),s=parseInt(t.value,10)||1,o=X(s,0,i);t.value=`${o}`,Up(t),e.gotoPage(o-1);}}));}setState(e){this.uiState!==e&&this.el&&("normal"===e?this.el.classList.remove(`${this.cssPrefix}disabled`):this.el.classList.add(`${this.cssPrefix}disabled`),this.uiState=e);}bindDefaultUi(){const e=this.injection.viewer,t=t=>{const i=W(null==t?void 0:t.total)?e.getPageCounts():null==t?void 0:t.total,s=W(null==t?void 0:t.current)?e.getCurrentPageIndex():null==t?void 0:t.current;this.setState(i>0?"normal":"disabled"),this.input.value=`${s+1}`,this.totalSpan.innerHTML=`${i}`,Up(this.input,this.totalSpan.clientWidth);};e.hooks.pageChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on((()=>{this.uiState="normal",t(null);})),this.hooks.destroyed.on((()=>{e.hooks.pageChanged.off(t);}));}initTemplate(){const{options:e}=this.data,{gotoPage:t,total:i,separator:s}=e,{cssPrefix:o,injection:r,defaultClass:n}=this,{viewer:a}=r,l=a.getCurrentPageIndex()+1,h=a.getPageCounts(),c=`<div ${bf(e,n,"")}><FirstPage :options="options.firstPage"></FirstPage><PrevPage :options="options.prevPage"></PrevPage><input ${bf(t,o,"goto")} value="${l}" type="number" ><div ${bf(s,o,"separator")}></div><span ${bf(i,o,"total")} >${h}</span><NextPage :options="options.nextPage"></NextPage><LastPage :options="options.lastPage"></LastPage></div>`;this.template=c;}}function Up(e,t){const{fontSize:i,width:s}=getComputedStyle(e);let o=function(e,t){const i=document.createElement("span");i.innerHTML=e,i.style.fontSize=t,i.style.position="absolute",i.style.top="0px",i.style.visibility="hidden",document.body.appendChild(i);const s=i.offsetWidth;return i.remove(),s}(e.value,i);W(t)||0===t||(o=Math.min(t+10,o));const r=`${o+3}px`;s!==r&&(e.style.width=r);}t(Bp,"cpName","Pagination");const Wp=[{label:" 720P",value:{width:1280,height:720}},{label:" 1080P",value:{width:1920,height:1080}},{label:" 1440P",value:{width:2560,height:1440}},{label:" 2160P",value:{width:3840,height:2160}}];class Vp extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-resolution"),t(this,"cssPrefix",`${this.defaultClass}-`),t(this,"checkedClassName",`${this.cssPrefix}checkbox-checked`),t(this,"resolutionOptions",[]),t(this,"isFirstClick",!0),t(this,"fakeResolution",!1),t(this,"lastCheckIndex",0),t(this,"box",void 0),this.bindHooks(),this.initTemplate(),Nf(this);}bindHooks(){this.hooks.created.on((e=>{this.box=this.query(`.${this.cssPrefix}box`),this.box.style.display="none",this.box.remove(),this.updateResolution(),this.bindEvents(),this.bindViewerHooks(),this.bindEventsEmitter(),Bf(this.el,!0);})),this.hooks.updated.on((()=>{this.box.style.display="none",this.isFirstClick=!0,this.injection.viewer.isVideoPlaying()||Bf(this.el,!0);}));}bindEvents(){const e=this.box.getElementsByTagName("ul")[0];this.nativeOn(this.el,"click",(()=>{const e=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(Wf(e,this.el,this.box),this.isFirstClick=!1);})),this.ulEvent(e);}ulEvent(e){e&&this.nativeOn(e,"click",(e=>{const t=this.injection.viewer,i=e.target,s=i.parentNode;if("LI"===i.tagName||"LI"===s.tagName){const e="LI"===i.tagName?i.value:s.value;if(e===this.lastCheckIndex)return;const{width:o,height:r}=this.resolutionOptions[e].value;this.fakeResolution=!0,t.setResolution(o,r),this.updateChecked(o,r);}this.togglePopup(!1);}));}bindViewerHooks(){const{viewer:e}=this.injection,{hooks:t}=e;t.cameraPlayed.on((e=>{if(Bf(this.el,!1),this.fakeResolution)return;const{width:t,height:i}=e.resolution;this.updateChecked(t,i),this.fakeResolution=!1;})),t.cameraClosed.on((()=>{Bf(this.el,!0);}));}updateChecked(e,t){const i=function(e,t){let i=-1;const s=t.width*t.height;for(let t=0;t<e.length;t++){const{value:o}=e[t],r=o.width*o.height;if(0===t&&s<=r)return 0;if(t===e.length&&s>=r)return e.length-1;s>r&&(i=t+1);}return i}(this.resolutionOptions,{width:e,height:t}),{box:s,checkedClassName:o}=this,r=s.getElementsByClassName(`${this.cssPrefix}checkbox`)[i],n=s.getElementsByClassName(o)[0];r!==n&&(this.lastCheckIndex=i,null==r||r.classList.add(o),null==n||n.classList.remove(o));}initTemplate(){const{options:e}=this.data,{popupBox:t}=e;Vf(Ff(this),this.injection.viewer,e);const i=`<div ${bf(e,`${this.defaultClass} ddv-button`)}>`+(W(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+'<i class="ddv-down-arrow"></i>'+`<div ${bf(t,this.cssPrefix,"box")}><ul></ul></div></div>`;this.template=i;}getOptionTemplate(){const{options:e}=this.data;let t=Wp;if(L(null==e?void 0:e.valueList))t=e.valueList;else {const{CameraResolution_720P:e,CameraResolution_1080P:i,CameraResolution_1440P:s,CameraResolution_2160P:o}=im.getDisplayTextConfig(),r=[e,i,s,o];t.forEach(((e,t)=>{r[t]&&(e.label=r[t]);}));}let i="";return t.forEach(((e,t)=>{const{width:s,height:o}=e.value;G(s)&&G(o)&&(i+=[`<li value="${t}">`,`<i class="${this.cssPrefix}checkbox"></i>`,`<span>${(null==e?void 0:e.label)||""}</span>`,"</li>"].join(""));})),this.resolutionOptions=t,i}updateResolution(){const e=this.getOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=e;}togglePopup(e){const{box:t}=this,{viewer:i}=this.injection;let s="none"!==t.style.display;s=W(e)?!s:e,s?(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(t)):t.remove(),Uf(this.el,s),t.style.display=s?"":"none";}}t(Vp,"cpName","CameraResolution");class Fp extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-image-preview"),t(this,"cssPrefix",`${this.defaultClass}-`),t(this,"uiState",void 0),t(this,"image",void 0),t(this,"counter",void 0),t(this,"imagePageUid",void 0),t(this,"hasTask",!1),t(this,"lastPageUid",void 0),t(this,"pageTaskUids",[]),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.created.on((e=>{this.setState("disabled"),this.bindViewerHooks(),this.bindEventsEmitter();})),this.hooks.inserted.on((e=>{this.image=this.el.getElementsByTagName("img")[0],this.counter=this.query(`.${this.cssPrefix}counter`);}));}bindViewerHooks(){const e=this.injection.viewer,t=j()?10:4;e.hooks.updatePage.on((async i=>{if(i.pageUid!==this.lastPageUid)return;if(this.hasTask)return;this.hasTask=!0;const s=e.getPageCounts(),o=await e.getPerspectivePreviewImage(s-1,400,400,t);o&&(this.image.src=Q(o.data).data),this.hasTask=!1,this.pageTaskUids.length>0&&this.createTask();})),e.hooks.pageChanged.on((async t=>{if(0===t.total)return this.image.src="",this.setState("disabled"),this.imagePageUid=void 0,void(this.lastPageUid=void 0);this.counter.innerHTML=`${t.total}`;const i=e.getActiveTab();if(!i)return;const s=i.pages[t.total-1].uid;this.pageTaskUids.push(s),this.hasTask||s!==this.lastPageUid&&this.createTask();}));}async createTask(){this.hasTask||(this.hasTask=!0,await this.updateImage(),setTimeout((()=>{this.hasTask=!1,0!==this.pageTaskUids.length&&this.createTask();}),300));}async updateImage(){const e=this.injection.viewer;if(e.isDestroy)return;const t=e.getActiveTab(),i=j()?10:4,s=t.pages.length;if(!t||!s)return;const o=this.pageTaskUids[this.pageTaskUids.length-1],r=t.pages[s-1].uid;if(this.pageTaskUids.length=0,this.lastPageUid=t.pages[s-1].uid,this.lastPageUid===o&&this.imagePageUid===o)return;let n;try{n=await e.getPerspectivePreviewImage(s-1,400,400,i);}catch(e){}n&&!e.isDestroy&&e.getActiveTab()&&(this.image.src=Q(n.data).data,this.imagePageUid=r,this.setState(s>0?"normal":"disabled"));}setState(e){this.uiState!==e&&this.el&&("normal"===e?(this.el.style.visibility="",this.el.style.pointerEvents=""):(this.el.style.visibility="hidden",this.el.style.pointerEvents="none"),this.uiState=e);}initTemplate(){const{options:e}=this.data,{imageCounter:t}=e,i=this.injection.viewer.getPageCounts();Vf(Ff(this),this.injection.viewer,e);const s=`<div ${bf(e,this.defaultClass)}> <img src=""></img><div ${bf(t,this.cssPrefix,"counter")}>${i}</div></div>`;this.template=s;}}t(Fp,"cpName","ImagePreview");const zp=[10,25,50,75,100,125,150,200,400,800,1600,2400,3200,6400];class Hp extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-zoom-percentage"),t(this,"cssPrefix",`${this.defaultClass}-`),t(this,"isFirstClick",!0),t(this,"box",void 0),t(this,"uiState","normal"),this.initTemplate(),this.bindHooks(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindViewerResized(),Lf(this),Nf(this);}bindHooks(){this.hooks.created.on((e=>{this.box=this.query(`.${this.cssPrefix}selectbox`),this.box.style.display="none",this.box.remove(),this.bindEvents();})),this.hooks.inserted.on((()=>{const e=this.injection.viewer,{zoom:t}=e.getViewerConfig();this.updateZoom(t),this.updateZoomOption();})),this.hooks.updated.on((()=>{this.uiState="normal",this.box.style.display="none",this.isFirstClick=!0;}));}bindDefaultUi(){const e=this.injection.viewer,t=()=>{Hf(this,0===e.getPageCounts()?"disabled":"normal"),this.updateZoom(e.getViewerConfig().zoom);};e.hooks.pageChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageChanged.off(t);}));}bindViewerHooks(){const{viewer:e}=this.injection,{hooks:t}=e,i=e=>{this.updateZoom(e.newZoomRatio);},s=t=>{if("hidden"===t.newVisibility)return;const{zoom:i}=e.getViewerConfig();this.updateZoom(i);};t.zoomChanged.on(i),t.visibleChanged.on(s),this.hooks.destroyed.on((()=>{t.zoomChanged.off(i),t.visibleChanged.off(s);}));}bindEvents(){const{el:e,box:t}=this,i=e.querySelector(`.${this.cssPrefix}selector`),s=e.getElementsByTagName("input")[0],o=t.getElementsByTagName("ul")[0];this.nativeOn(i,"click",(()=>{const e=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(Wf(e,this.el,this.box,!0,!0),this.isFirstClick=!1);})),this.inputEvent(s),this.ulEvent(o);}bindViewerResized(){const{viewer:e}=this.injection,t=()=>{const{box:e}=this,t="none"===e.style.display,i=this.injection.viewer.rootDom;t?this.isFirstClick=!0:Wf(i,this.el,this.box,!0,!0);};e.on("resized",t),this.hooks.destroyed.on((()=>{e.off("resized",t);}));}inputEvent(e){const t=this.injection.viewer,{maxZoom:i,minZoom:s}=t.getViewerConfig();e.value=`${i}`;const o=zf(e);function r(){const o=e.value/100,r=X(o,s,i);t.updateViewerConfig({zoom:r});}this.nativeOn(e,"input",(()=>{this.adaptInputWidth(o);})),this.nativeOn(e,"blur",r),this.nativeOn(e,"keydown",(e=>{"Enter"===e.key&&r();}));}ulEvent(e){this.nativeOn(e,"click",(e=>{e.stopPropagation();const{viewer:t}=this.injection,{maxZoom:i,minZoom:s}=t.getViewerConfig(),o=e.target;if("LI"===o.tagName){const e=X(o.value,100*s,100*i);t.updateViewerConfig({zoom:e/100});}this.togglePopup(!1);}));}getZoomOptionTemplate(){var e;const t=(null===(e=this.data.options)||void 0===e?void 0:e.valueList)||null,i=this.injection.viewer,{maxZoom:s,minZoom:o}=i.getViewerConfig(),r=L(t)?t:zp,n=o<1e-4?.01:parseFloat((100*o).toFixed(2)),a=Math.floor(100*s);r.push(n,a);const l=Array.from(new Set(r)).sort(((e,t)=>e-t));let h="";return l.forEach((e=>{G(e)&&e<=100*s&&e>=100*o&&(h+=`<li value="${e}">${e}%</li>`);})),h}updateZoomOption(){const e=this.getZoomOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=e;}updateZoom(e){const t=this.el.getElementsByTagName("input")[0],i=100*e;if(Number.isInteger(i))t.value=`${i}`;else {let e=i;e=e>=1e3?+e.toFixed(0).toString():e>=100?+e.toFixed(1).toString():e>=10?+e.toFixed(2).toString():+e.toFixed(3).toString(),t.value=`${e}`;}this.adaptInputWidth();}initTemplate(){const{options:e={}}=this.data,{input:t,selector:i,popupBox:s}=e,{cssPrefix:o}=this,{viewer:r}=this.injection;Vf(Ff(this),r,e);const n=`<div ${bf(e,this.defaultClass)}><div style="display: flex"><div ${bf(t,o,"input")}><input type="number"><span>%</span></div><div ${bf(i,o,"selector")}><i></i></div></div><div ${bf({id:`ddvZoomByPercentageSelectBox${r.postfix}`,...s},o,"selectbox")}><ul></ul></div></div>`;this.template=n;}adaptInputWidth(e){const t=this.el.getElementsByTagName("input")[0];let i=zf(t);e&&i>e&&(i=e),t.style.width=`${i}px`;}togglePopup(e){const{viewer:t}=this.injection,{box:i}=this;let s="none"!==i.style.display;s=W(e)?!s:e,s?(this.$emit("ui_hidePopup",this),t.rootDom.appendChild(i)):i.remove(),i.style.display=s?"":"none";}}t(Hp,"cpName","ZoomByPercentage");class jp extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-filter-item"),t(this,"cssPrefix",`${this.defaultClass}-`),t(this,"checkedClass",`${this.cssPrefix}checked`),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.created.on((e=>{this.bindEvents();})),this.hooks.inserted.on((()=>{this.bindFilterEvents();}));}bindEvents(){const{el:e}=this;this.nativeOn(e,"click",(()=>{if(""===this.el.getElementsByTagName("img")[0].getAttribute("src"))return;const{itemValue:e}=this.data;this.$emit("UI_filterClick",e.type);}));}bindFilterEvents(){this.$on("ui_filterReset",(e=>{this.resetSelect(e.currentFilter);const{filterList:t}=e,{itemValue:i}=this.data,s=this.el.getElementsByTagName("img")[0];t.forEach((e=>{if(e.type===i.type){let t="";e.imageData&&(t=Q(e.imageData).data),s.src=t;}}));})),this.$on("ui_filterLoading",(e=>{const t=this.el.getElementsByTagName("img")[0],i=this.el.getElementsByTagName("div")[0];t.style.display=e?"none":"",i.style.display=e?"":"none",this.el.style.pointerEvents=e?"none":"";})),this.injection.viewer.hooks.filterChanged.on((e=>{this.resetSelect(e.type);}));}resetSelect(e){const{itemValue:t}=this.data;e===t.type?this.el.classList.add(this.checkedClass):this.el.classList.remove(this.checkedClass);}initTemplate(){const{options:e,itemValue:t}=this.data,i=`<div ${bf(e,this.defaultClass)}><img src=""></img><div class="ddv-filter-loading" style="display:'none'"></div><span>${t.label}</span></div>`;this.template=i;}}const Gp=[{type:"none",label:"Original"}];class $p extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-filter"),t(this,"cssPrefix",`${this.defaultClass}-`),t(this,"isFirstClick",!0),t(this,"box",void 0),t(this,"applyAll",!1),t(this,"filterList",void 0),t(this,"filterUpdateStatus",!1),t(this,"enableFilter",!1),t(this,"uiState","normal"),this.bindHooks(),this.initTemplate(),this.bindDefaultUi(),Nf(this);const{processService:i}=this.injection.viewer.context.core;i.enableFilter&&(this.enableFilter=!0,Lf(this),this.bindViewerHooks(),this.bindFilterEvents(),this.bindViewerResized()),Sf.registerComponent({FilterItem:jp});}bindHooks(){this.hooks.created.on((e=>{this.box=this.query(`.${this.cssPrefix}list`),this.box.style.display="none",this.box.remove(),this.bindNativeEvents();})),this.hooks.updated.on((()=>{this.uiState="normal";}));}bindViewerResized(){const{viewer:e}=this.injection,t=()=>{const{box:e}=this,t="none"===e.style.display,i=this.injection.viewer.rootDom;t?this.isFirstClick=!0:Wf(i,this.el,this.box);};e.on("resized",t),this.hooks.destroyed.on((()=>{e.off("resized",t);}));}bindViewerHooks(){const e=this.injection.viewer,t=async t=>{if(0===t.total)return this.filterUpdateStatus=!0,void this.togglePopup(!1);const i=e.context.getActiveDocTab();if(!i||!this.box)return;const{currentUid:s,oldCurrentUid:o}=i;o!==s&&(this.filterUpdateStatus=!0,this.togglePopup(!1));},i=t=>{var i;const s=e.context.getActiveDocTab();s&&this.box&&(null===(i=s.getCurrentPage())||void 0===i?void 0:i.uid)===t.pageUid&&(this.filterUpdateStatus=!0,this.togglePopup(!1));};e.hooks.pageChanged.on(t),e.hooks.updatePage.on(i),this.hooks.destroyed.on((()=>{e.hooks.pageChanged.off(t),e.hooks.updatePage.off(i);}));}bindNativeEvents(){const{el:e,box:t}=this,i=t.querySelector(`.${this.cssPrefix}list-header`),s=i.getElementsByTagName("span")[0],o=i.getElementsByTagName("div")[0];this.nativeOn(e,"click",(async e=>{if(this.togglePopup(),this.isFirstClick){Wf(this.injection.viewer.rootDom,this.el,this.box),this.isFirstClick=!1;}})),this.nativeOn(t,"click",(e=>{e.stopPropagation();})),this.nativeOn([s,o],"click",(()=>{if(this.clickApplyToAll(),this.applyAll){const{viewer:e}=this.injection,t=e.getPageCounts(),i=e.getCurrentPageUid(),s=e.context.core.pageService.getPage(i);e.filter(Array.from(Array(t).keys()),s.filter);}}));}bindFilterEvents(){this.$on("UI_filterClick",(e=>{const{viewer:t}=this.injection,i=t.getPageCounts();if(i<1)return;let s=Array.from(Array(i).keys());if(!this.applyAll){const i=t.getCurrentPageUid();if(t.context.core.pageService.getPage(i).fileIndex===e)return;s=[t.getCurrentPageIndex()];}t.filter(s,e);}));}clickApplyToAll(e){const t=this.injection.viewer,i=_f.Filter_FilterAll+t.postfix,s=document.getElementById(i);if(W(e))return this.applyAll?s.classList.remove(`${this.cssPrefix}checked`):s.classList.add(`${this.cssPrefix}checked`),void(this.applyAll=!this.applyAll);e?s.classList.add(`${this.cssPrefix}checked`):s.classList.remove(`${this.cssPrefix}checked`),this.applyAll=e;}async updateFilterPreview(){const e=this.injection.viewer,t=e.getCurrentPageUid(),i=await e.context.core.imageDataService.getOriginal(t);if(!i)return;this.$emit("ui_filterLoading",!0);const s=[],o=e.context.core.pageService.getPage(t);let r;try{r=await e.context.core.processService.resize(i.data,3,i.width,i.height,200);}catch(e){}for(let t=0;t<this.filterList.length;t++){const o=this.filterList[t];if("none"===o.type)s.push({type:"none",imageData:i.data});else {let t;try{var n;r&&null!==(n=r)&&void 0!==n&&n.data&&(t=await e.context.core.processService.filter(r.data,3,o.type,{width:r.width,height:r.height}));}catch(e){t=null;}s.push({type:o.type,imageData:t});}}this.$emit("ui_filterLoading",!1),this.$emit("ui_filterReset",{currentFilter:o.filter||"none",filterList:s}),this.filterUpdateStatus=!1;}initTemplate(){var e;const t=this.data,{options:i}=t,{popupBox:s,filterHeader:o,filterContent:r,valueList:n}=i,{processService:a}=this.injection.viewer.context.core,l=_f.Filter_FilterAll+this.injection.viewer.postfix;Vf(Ff(this),this.injection.viewer,i);const h=(null===(e=im.getDisplayTextConfig())||void 0===e?void 0:e.Filter_FilterAll)||"Apply to All";t.valueList=n||Gp,a.enableFilter&&(t.valueList=a.getFilterTypeList()),this.filterList=t.valueList;const c=`<div ${bf(i,`ddv-button ${this.defaultClass}`)}>`+(W(null==i?void 0:i.label)?"":`<span>${i.label}</span>`)+'<i class="ddv-down-arrow"></i>'+`<div ${bf(s,this.cssPrefix,"list")}>`+`<div id="${l}" :class="false ? '${this.cssPrefix}checked' : ''" `+`${bf(o,this.cssPrefix,"list-header")}><div></div>`+`<span>${h}</span></div>`+`<div ${bf(r,this.cssPrefix,"list-content")}><FilterItem :for="item in valueList":options="options.filterItem" :itemValue="item"></FilterItem></div></div></div>`;this.template=c;}async togglePopup(e){const{box:t}=this,{viewer:i}=this.injection;let s="none"===t.style.display;s=W(e)?!s:!e,s?t.remove():(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(t),this.filterUpdateStatus&&this.updateFilterPreview()),Uf(this.el,!s),t.style.display=s?"none":"";}bindDefaultUi(){const e=this.injection.viewer,t=()=>{let t="normal";0!==e.getPageCounts()&&this.enableFilter||(t="disabled"),Hf(this,t);};e.hooks.pageChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageChanged.off(t);}));}}t($p,"cpName","Filter");class Xp extends wf{constructor(e,i){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ddv-popup-icon";super(e),t(this,"defaultClass","ddv-button"),t(this,"popupClassName","ddv-popup-box"),t(this,"isFirstClick",!0),t(this,"box",void 0),this.defaultClass+=` ${s}`,this.popupClassName=i?` ${i}`:this.popupClassName,this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.created.on((e=>{this.el=e,this.box=this.query(`.${this.popupClassName}`),this.box.style.display="none",this.box.remove(),this.bindEvents(),this.bindEventsEmitter();})),this.hooks.updated.on((()=>{this.box.style.display="none",this.isFirstClick=!0;}));}bindEvents(){this.nativeOn(this.el,"click",(()=>{const e=this.injection.viewer.rootDom;this.showPopupBox(),this.isFirstClick&&(Wf(e,this.el,this.box,!0,!0),this.isFirstClick=!1);}));}showPopupBox(e){const{box:t}=this,{viewer:i}=this.injection;let s="none"!==t.style.display;s=W(e)?!s:e,s?i.rootDom.appendChild(t):t.remove(),t.style.display=s?"":"none";}initTemplate(){const{options:e}=this.data,t=(null==e?void 0:e.children)||[];let i=`<div ${bf(e,this.defaultClass)}><div ${bf(null==e?void 0:e.popupBox,this.popupClassName)}>`;t.forEach(((e,t)=>{if(B(e)){const{type:s}=e;s.trim(),i+=`<${s} :options="options.children[${t}]"></${s}>`;}})),i+="</div></div>",this.template=i;}}const Yp=[{displayName:"continuous",className:"ddv-continuous-mode"},{displayName:"single",className:"ddv-single-mode"}];class qp extends Lp{constructor(e){const{DisplayMode_ContinuousPage:t,DisplayMode_SinglePage:i}=im.getDisplayTextConfig(),{DisplayMode_ContinuousPage:s,DisplayMode_SinglePage:o}=_f;super(e,"ddv-display-mode",[{type:"ContinuousPage",label:t,id:s},{type:"SinglePage",label:i,id:o}]),Sf.registerComponent({ContinuousPage:$f,MultiPage:Xf,SinglePage:Yf}),Lf(this);}updateUiState(e){const{el:t}=this;Yp.forEach(((i,s)=>{e===i.displayName?(t.classList.add(i.className),this.selectChildren(s)):t.classList.remove(i.className);}));}bindDefaultUi(){super.bindDefaultUi();const e=this.injection.viewer,t=()=>{const{displayMode:t}=e.getViewerConfig();this.updateUiState(t);},i=e=>{this.updateUiState(e.newDisplayMode);};e.hooks.displayModeChanged.on(i),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.displayModeChanged.off(i);}));}}t(qp,"cpName","DisplayMode");class Qp extends wf{constructor(e){super(e),t(this,"defaultClass","ddv-zoom-controller"),Sf.registerComponent({ZoomIn:wp,ZoomOut:bp}),this.initTemplate();}initTemplate(){const{options:e}=this.data;Vf(Ff(this),this.injection.viewer,e);const t=`<div ${bf(e,this.defaultClass)}><ZoomOut :options:"options.ZoomOut"></ZoomOut><ZoomByPercentage :options:"options.ZoomByPercentage"></ZoomByPercentage><ZoomIn :options:"options.ZoomIn"></ZoomIn></div>`;this.template=t;}}t(Qp,"cpName","Zoom");class Zp extends Lp{constructor(e){const{Delete_DeleteCurrent:t,Delete_DeleteAll:i}=im.getDisplayTextConfig(),{Delete_DeleteCurrent:s,Delete_DeleteAll:o}=_f;super(e,"ddv-delete-btn",[{type:"DeleteCurrent",label:t,id:s},{type:"DeleteAll",label:i,id:o}],!1),Sf.registerComponent({DeleteAll:Dp,DeleteCurrent:Ep}),Lf(this);}}t(Zp,"cpName","Delete");const Jp=[{displayName:"window",className:"ddv-fit-window"},{displayName:"width",className:"ddv-fit-width"},{displayName:"height",className:"ddv-fit-height"},{displayName:"actualSize",className:"ddv-fit-actual"}];class Kp extends Lp{constructor(e){const{FitMode_FitWindow:t,FitMode_FitWidth:i,FitMode_FitHeight:s,FitMode_ActualSize:o}=im.getDisplayTextConfig(),{FitMode_FitWindow:r,FitMode_FitWidth:n,FitMode_FitHeight:a,FitMode_ActualSize:l}=_f;super(e,"ddv-fit-type",[{type:"FitWindow",label:t,id:r},{type:"FitWidth",label:i,id:n},{type:"FitHeight",label:s,id:a},{type:"ActualSize",label:o,id:l}]),Sf.registerComponent({FitWindow:tp,FitWidth:ep,FitHeight:Kf,ActualSize:ip}),Lf(this);}updateUiState(e){const{el:t}=this;"none"!==e?Jp.forEach(((i,s)=>{e===i.displayName?(t.classList.add(i.className),this.selectChildren(s)):t.classList.remove(i.className);})):this.selectChildren(-1);}bindDefaultUi(){super.bindDefaultUi();const e=this.injection.viewer,t=()=>{const{fitMode:t}=e.getViewerConfig();this.updateUiState(t);},i=e=>{this.updateUiState(e.newFitMode);};e.hooks.fitModeChanged.on(i),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.fitModeChanged.off(i);}));}}t(Kp,"cpName","FitMode");const em="ddv-crop";class tm extends Lp{constructor(e){super(e,em,[],!1),this.initHooks();}initHooks(){const e=e=>{const t="crop"===e.newToolMode,i=this.injection.viewer.getPageCounts();!t&&i>0&&(this.setUiState(t?"focused":"normal"),this.togglePopup(t)),this.$emit("ui_cropClick",t);},t=()=>{Bf(this.box.querySelector(`.${em}-buttonGroup`).children[1],!1);},i=()=>{Bf(this.box.querySelector(`.${em}-buttonGroup`).children[1],!this.injection.viewer.getRenderedRectBoxCount());},s=this.injection.viewer;s.hooks.toolModeChanged.on(e),s.hooks.cropRectDrawn.on(t),s.hooks.pageChanged.on(i),this.hooks.destroyed.on((()=>{s.hooks.toolModeChanged.off(e),s.hooks.cropRectDrawn.off(t),s.hooks.pageChanged.off(i);}));}bindEvents(){const{viewer:e}=this.injection,t=this.box.querySelector(`.${em}-buttonGroup`),i=this.box.getElementsByTagName("input")[1],s=this.box.getElementsByTagName("input")[0],o=t.children[0],r=t.children[1],n=()=>{this.togglePopup(!1),e.updateViewerConfig({toolMode:"pan",canvasStyle:{cursor:"default"}});};this.nativeOn(r,"click",(()=>{const t=e.getRectBox(),i=e.getCropIndices();t&&(e.cropPages(t,i),n());})),this.nativeOn(o,"click",n),this.nativeOn(this.el,"click",(()=>{const t=e.rootDom,i=this.box.querySelector(`.${em}-buttonGroup`).children[1];e.updateViewerConfig({toolMode:"crop"}),this.togglePopup(!0),this.setUiState("focused"),this.$emit("ui_cropClick",!0);Bf(i,!e.getRectBox()),this.isFirstClick&&(Wf(t,this.el,this.box),this.isFirstClick=!1);})),this.nativeOn(i,"change",(()=>{e.cropMode="all";})),this.nativeOn(s,"change",(()=>{e.cropMode="current";}));}bindPopupSwitchEvent(){}bindDefaultUi(){const e=this.injection.viewer,t=()=>{let t="disabled";e.getPageCounts()>0?t=""===this.box.style.display?"focused":"normal":(e.updateViewerConfig({toolMode:"pan"}),this.togglePopup(!1)),this.setUiState(t);};e.hooks.pageExistenceChanged.on(t),this.hooks.inserted.on(t),this.hooks.updated.on(t),this.hooks.destroyed.on((()=>{e.hooks.pageExistenceChanged.off(t);}));}initTemplate(){const{options:e}=this.data,{popupBox:t}=e,{postfix:i,cropMode:s}=this.injection.viewer,{Crop_CropCurrent:o,Crop_CropAll:r,Crop_CropApply:n,Crop_CropCancel:a}=im.getDisplayTextConfig(),{Crop_CropCurrent:l,Crop_CropAll:h,Crop_CropApply:c,Crop_CropCancel:d}=_f,u="current"===s?'checked="checked"':"",g="all"===s?'checked="checked"':"";Vf(Ff(this),this.injection.viewer,e);const f=`<div ${bf(e,`ddv-button ${em}`)}>`+(W(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${bf(t,`${em}-box`)}><div>`+`<input ${u} type="radio" id="${l+i}" name="cropType" value="cropCurrent" />`+`<label for="${l+i}">${o}</label>`+`<input ${g} type="radio" id="${h+i}" name="cropType" value="cropAll" />`+`<label for="${h+i}">${r}</label></div>`+`<div class= "${em}-buttonGroup">`+`<div id="${d+i}"><span>${a}</span></div>`+`<div id="${c+i}"><span>${n}</span></div></div></div></div>`;this.template=f;}}t(tm,"cpName","Crop");class im{static getTooltip(){return this.tooltip}static setTooltip(e){this.tooltip={...this.tooltip,...e};}static getDisplayTextConfig(){return this.displayTextConfig}static setDisplayTextConfig(e){this.displayTextConfig={...this.displayTextConfig,...e};}static registerAll(){Sf.registerComponent({Capture:Sp,Flashlight:Pp,CameraConvert:Tp,CameraResolution:Vp,AutoDetect:Cp,AutoCapture:xp,ImagePreview:Fp,RotateLeft:dp,RotateRight:up,Delete:Zp,DeleteAll:Dp,DeleteCurrent:Ep,Zoom:Qp,ZoomIn:wp,ZoomOut:bp,ZoomByPercentage:Hp,PerspectiveAll:np,FullQuad:ap,Restore:cp,Undo:gp,Redo:lp,FitMode:Kp,FitWidth:ep,FitHeight:Kf,FitWindow:tp,ActualSize:ip,DisplayMode:qp,SinglePage:Yf,MultiPage:Xf,ContinuousPage:$f,Pan:Qf,Print:Rp,Filter:$p,ThumbnailSwitch:Op,Pagination:Bp,Back:_p,Done:Np,Root:Df,Layout:Tf,Button:Pf,MainView:Of,Load:kp,Download:Ap,Close:Mp,Blank:Ip,SeparatorLine:Ef,PopupButton:Xp,CropCurrent:sp,CropAll:rp,CropMode:Zf,Crop:tm});}}t(im,"tooltip",{}),t(im,"displayTextConfig",{FitMode_FitWidth:"Fit Width",FitMode_FitHeight:"Fit Height",FitMode_FitWindow:"Fit Window",FitMode_ActualSize:"Actual Size",DisplayMode_SinglePage:"Single Page",DisplayMode_ContinuousPage:"Continuous Page",Crop_CropAll:"Crop All",Crop_CropCurrent:"Crop Current",Crop_CropCancel:"Cancel",Crop_CropApply:"Apply",Filter_FilterAll:"Apply to All",Delete_DeleteCurrent:"Delete current",Delete_DeleteAll:"Delete all",CameraResolution_720P:"720P",CameraResolution_1080P:"1080P",CameraResolution_1440P:"1440P",CameraResolution_2160P:"2160P"});const sm={install(e){const o=function(e){var o,r,n,a;return o=new WeakMap,r=new WeakMap,n=new WeakMap,a=new WeakSet,class extends e{constructor(e){super(e),p(this,a),t(this,"ui",void 0),t(this,"rootDom",void 0),f(this,o,{writable:!0,value:!1}),f(this,r,{writable:!0,value:0}),f(this,n,{writable:!0,value:0}),im.registerAll(),this.ui=new Sf({container:e.container,emitter:this.emitter,postfix:this.uid,uiConfig:e.uiConfig,injection:{viewer:this}}),e.container&&(e.uiConfig?(this.bindContainer(e.container),this.rootDom=this.ui.rootDom):this.rootDom=this.context.viewService.rootDom),this.listenNativeEventsForUi();}listenNativeEventsForUi(){this.on("click",(()=>{this.emit("ui_hidePopup",null);}));}getUiConfig(){return U(this.ui.uiConfig)}updateUiConfig(e){const t=this.ui.updateUiConfig(e);return this.rootDom=this.ui.rootDom,this.context.viewService.rootDom=this.rootDom,t}getElementsByType(e){return $(e)?this.ui.getElementsByType(this.ui.rootVNode,e):""}bindContainer(e){let t=e;return $(e)&&(t=document.querySelector(`#${e}`)),t instanceof HTMLElement&&(u(this,a,l).call(this,this.ui.rootDom),this.ui.bindContainer(t),this.context.viewService.container=t,this.context.viewService.rootDom=this.ui.rootDom,this.rootDom=this.ui.rootDom,"hidden"===this.context.viewerConfig.visibility&&(this.context.viewService.rootDom.style.display="none"),this.context.viewService.isBindContainer=!0,!0)}unbindContainer(){this.rootDom&&this.ui.container&&(this.ui.unbindContainer(),this.context.viewService.container=null,this.context.viewService.isBindContainer=!1);}destroy(){var e;super.destroy(),null===(e=this.ui)||void 0===e||e.destroy();}};function l(e){if(i(this,o))return;const{resizeService:t}=this.context.core,a=t=>{if(t.target===e){var o;let a=0,l=0;if((null===(o=t.borderBoxSize)||void 0===o?void 0:o.length)>0){const e=t.borderBoxSize[0];a=e.inlineSize,l=e.blockSize;}else a=e.offsetWidth,l=e.offsetHeight;const h={oldWidth:i(this,r),oldHeight:i(this,n),newWidth:a,newHeight:l};s(this,r,a),s(this,n,l),this.hooks.resize.emit(h),this.emit("resized",h);}};t.observe(e),t.hooks.resizeObserver.on(a),this.hooks.destroy.on((()=>{t.unobserve(e),t.hooks.resizeObserver.off(a);})),s(this,o,!0);}}(e.getClass("Viewer"));e.setClass("Viewer",o);}};function om(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)}function rm(e,t,i,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===s?o.call(e,i):o?o.value=i:t.set(e,i),i}"function"==typeof SuppressedError&&SuppressedError;const nm="undefined"==typeof self;let am,lm,hm,cm,dm;function um(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)}function gm(e,t,i,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===s?o.call(e,i):o?o.value=i:t.set(e,i),i}"undefined"!=typeof navigator&&(am=navigator,lm=am.userAgent,hm=am.platform,cm=am.mediaDevices),function(){if(!nm){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:am.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:hm,search:"Win"},Mac:{str:hm},Linux:{str:hm}};let i="unknownBrowser",s=0,o="unknownOS";for(let t in e){const o=e[t]||{};let r=o.str||lm,n=o.search||t,a=o.verStr||lm,l=o.verSearch||t;if(l instanceof Array||(l=[l]),-1!=r.indexOf(n)){i=t;for(let e of l){let t=a.indexOf(e);if(-1!=t){s=parseFloat(a.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let s=i.str||lm,r=i.search||e;if(-1!=s.indexOf(r)){o=e;break}}"Linux"==o&&-1!=lm.indexOf("Windows NT")&&(o="HarmonyOS"),dm={browser:i,version:s,OS:o};}nm&&(dm={browser:"ssr",version:0,OS:"ssr"});}(),cm&&cm.getUserMedia,"Chrome"===dm.browser&&dm.version>66||"Safari"===dm.browser&&dm.version>13||"OPR"===dm.browser&&dm.version>43||"Edge"===dm.browser&&dm.version,"function"==typeof SuppressedError&&SuppressedError;class fm{static multiply(e,t){const i=[];for(let s=0;s<3;s++){const o=t.slice(3*s,3*s+3);for(let t=0;t<3;t++){const s=[e[t],e[t+3],e[t+6]].reduce(((e,t,i)=>e+t*o[i]),0);i.push(s);}}return i}static identity(){return [1,0,0,0,1,0,0,0,1]}static translate(e,t,i){return fm.multiply(e,[1,0,0,0,1,0,t,i,1])}static rotate(e,t){var i=Math.cos(t),s=Math.sin(t);return fm.multiply(e,[i,-s,0,s,i,0,0,0,1])}static scale(e,t,i){return fm.multiply(e,[t,0,0,0,i,0,0,0,1])}}var pm,mm,vm,ym,wm,bm,xm,Cm,Sm;!function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra";}(pm||(pm={}));class Pm{static get version(){return "1.1.1-0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(gm(Pm,mm,!1,"f",vm),!1):(gm(Pm,mm,!0,"f",vm),!0)}get disposed(){return um(this,Sm,"f")}constructor(){ym.set(this,pm.RGBA),wm.set(this,null),bm.set(this,null),xm.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Cm.set(this,null),Sm.set(this,!1);}drawImage(e,t,i,s,o,r){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!s)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==um(Pm,mm,"f",vm)&&Pm.checkWebGLSupport(),(null==r?void 0:r.bUseWebGL)&&!um(Pm,mm,"f",vm))throw new Error("Your browser or machine may not support WebGL.");if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let n;Pm._onLog&&(n=Date.now(),Pm._onLog("drawImage(), START: "+n));let a=0,l=0,h=i,c=s,d=0,u=0,g=i,f=s;o&&(o.sx&&(a=Math.round(o.sx)),o.sy&&(l=Math.round(o.sy)),o.sWidth&&(h=Math.round(o.sWidth)),o.sHeight&&(c=Math.round(o.sHeight)),o.dx&&(d=Math.round(o.dx)),o.dy&&(u=Math.round(o.dy)),o.dWidth&&(g=Math.round(o.dWidth)),o.dHeight&&(f=Math.round(o.dHeight)));let p,m=pm.RGBA;if((null==r?void 0:r.pixelFormat)&&(m=r.pixelFormat),(null==r?void 0:r.bufferContainer)&&(p=r.bufferContainer,p.length<4*g*f))throw new Error("Unexpected size of the 'bufferContainer'.");const v=e;if(!um(Pm,mm,"f",vm)||!(this.useWebGLByDefault&&null==(null==r?void 0:r.bUseWebGL)||(null==r?void 0:r.bUseWebGL))){Pm._onLog&&Pm._onLog("drawImage() in context2d."),v.ctx2d||(v.ctx2d=v.getContext("2d",{willReadFrequently:!0}));const e=v.ctx2d;if(!e)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return (v.width<d+g||v.height<u+f)&&(v.width=d+g,v.height=u+f),e.drawImage(t,a,l,h,c,d,u,g,f),Pm._onLog&&Pm._onLog("drawImage() in context2d end. Costs: "+(Date.now()-n)),{context:e,pixelFormat:pm.RGBA,bUseWebGL:!1}}Pm._onLog&&Pm._onLog("drawImage() in WebGL.");try{(v.width<d+g||v.height<u+f)&&(v.width=d+g,v.height=u+f,v.ctxWebGL&&v.ctxWebGL.viewport(0,0,d+g,u+f));const e=v.ctxWebGL||v.getContext("webgl",{antialias:!1})||v.getContext("experimental-webgl",{antialias:!1});if(!e){Pm._onLog&&Pm._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const e=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw e.name="WebGLError",e}if(!v.ctxWebGL||m!==um(this,ym,"f")){v.ctxWebGL=e;const t=e=>{const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW);const i=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW),{positions:t,texCoords:i}},i=e=>{const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},s=(e,t)=>{const i=e.createProgram();if(t.forEach((t=>e.attachShader(i,t))),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){const t=new Error(`An error occured linking the program: ${e.getProgramInfoLog(i)}.`);throw t.name="WebGLError",t}return e.useProgram(i),i},o=(e,t,i)=>{const s=e.createShader(t);if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS)){const t=new Error(`An error occured compiling the shader: ${e.getShaderInfoLog(s)}.`);throw t.name="WebGLError",t}return s},r="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let n="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(m)&&(n=m.slice(0,3));const a=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${n} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,l=s(e,[o(e,e.VERTEX_SHADER,r),o(e,e.FRAGMENT_SHADER,a)]);gm(this,bm,{program:l,attribLocations:{vertexPosition:e.getAttribLocation(l,"a_position"),texPosition:e.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:e.getUniformLocation(l,"u_image"),uColorFactor:e.getUniformLocation(l,"uColorFactor"),uMatrix:e.getUniformLocation(l,"u_matrix"),uTextureMatrix:e.getUniformLocation(l,"u_textureMatrix")}},"f"),gm(this,xm,t(e),"f"),gm(this,wm,i(e),"f"),gm(this,ym,m,"f");}const o=(e,t,i)=>{e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);},r=(e,t,i)=>{const s=e.RGBA,o=e.RGBA,r=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,s,o,r,i);},y=(e,t,r,n)=>{e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),o(e,r.positions,t.attribLocations.vertexPosition),o(e,r.texCoords,t.attribLocations.texPosition),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n),e.uniform1i(t.uniformLocations.uSampler,0),e.uniform1f(t.uniformLocations.uColorFactor,[pm.GREY,pm.GREY32].includes(m)?1:0);let p,v,y=fm.translate(fm.identity(),-1,-1);y=fm.scale(y,2,2),y=fm.scale(y,1/e.canvas.width,1/e.canvas.height),p=fm.translate(y,d,u),p=fm.scale(p,g,f),e.uniformMatrix3fv(t.uniformLocations.uMatrix,!1,p),v=fm.translate(fm.identity(),a/i,l/s),v=fm.scale(v,h/i,c/s),e.uniformMatrix3fv(t.uniformLocations.uTextureMatrix,!1,v),e.drawArrays(e.TRIANGLES,0,6);};r(e,um(this,wm,"f"),t),y(e,um(this,bm,"f"),um(this,xm,"f"),um(this,wm,"f"));const w=p||new Uint8Array(4*g*f);if(e.readPixels(d,u,g,f,e.RGBA,e.UNSIGNED_BYTE,w),255!==w[3]){Pm._onLog&&Pm._onLog("Incorrect WebGL drawing .");const e=new Error("WebGL error: incorrect drawing.");throw e.name="WebGLError",e}return Pm._onLog&&Pm._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-n)),{context:e,pixelFormat:m===pm.GREY?pm.GREY32:m,bUseWebGL:!0}}catch(n){if(this.forceLoseContext(),null==(null==r?void 0:r.bUseWebGL))return Pm._onLog&&Pm._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,t,i,s,o,Object.assign({},r,{bUseWebGL:!1}));throw n.name="WebGLError",n}}readCvsData(e,t,i){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let s,o=0,r=0,n=e.canvas.width,a=e.canvas.height;if(t&&(t.x&&(o=t.x),t.y&&(r=t.y),t.width&&(n=t.width),t.height&&(a=t.height)),(null==i?void 0:i.length)<4*n*a)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){const t=e;i?(t.readPixels(o,r,n,a,t.RGBA,t.UNSIGNED_BYTE,i),s=new Uint8Array(i.buffer,0,4*n*a)):(s=new Uint8Array(4*n*a),t.readPixels(o,r,n,a,t.RGBA,t.UNSIGNED_BYTE,s));}else if(e instanceof CanvasRenderingContext2D){let t;t=e.getImageData(o,r,n,a),s=new Uint8Array(t.data.buffer),null==i||i.set(s);}return s}transformPixelFormat(e,t,i,s){let o,r;if(Pm._onLog&&(o=Date.now(),Pm._onLog("transformPixelFormat(), START: "+o)),t===i)return Pm._onLog&&Pm._onLog("transformPixelFormat() end. Costs: "+(Date.now()-o)),s?new Uint8Array(e):e;const n=[pm.RGBA,pm.RBGA,pm.GRBA,pm.GBRA,pm.BRGA,pm.BGRA];if(n.includes(t))if(i===pm.GREY){r=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4){const i=.21*e[t]+.71*e[t+1]+.07*e[t+2];r[t/4]=i;}}else if(i===pm.GREY32){r=s?new Uint8Array(e):e;for(let t=0;t<e.length;t+=4){const i=.21*e[t]+.71*e[t+1]+.07*e[t+2];r[t]=i,r[t+1]=i,r[t+2]=i;}}else {if(!n.includes(i))throw new Error("Unable to transform.");if(s){r=new Uint8Array(e);const s=t.indexOf("r"),o=t.indexOf("g"),n=t.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),h=i.indexOf("b");for(let t=0;t<e.length;t+=4)r[t+a]=e[t+s],r[t+l]=e[t+o],r[t+h]=e[t+n];}else {r=e;const s=t.indexOf("r"),o=t.indexOf("g"),n=t.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),h=i.indexOf("b");for(let t=0;t<e.length;t+=4){let i=[e[t],e[t+1],e[t+2]];r[t+a]=i[s],r[t+l]=i[o],r[t+h]=i[n];}}}else if(t===pm.GREY){if(i!==pm.GREY32)throw new Error("Unable to transform.");r=new Uint8Array(4*e.length);for(let t=0;t<e.length;t++)r[4*t]=e[t],r[4*t+1]=e[t],r[4*t+2]=e[t],r[4*t+3]=255;}else {if(t!==pm.GREY32)throw new Error("Unable to transform.");if(i!==pm.GREY)throw new Error("Unable to transform.");r=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4)r[t/4]=e[t];}return Pm._onLog&&Pm._onLog("transformPixelFormat() end. Costs: "+(Date.now()-o)),r}getImageData(e,t,i,s,o){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!t||!i)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==um(Pm,mm,"f",vm)&&Pm.checkWebGLSupport(),(null==o?void 0:o.bUseWebGL)&&!um(Pm,mm,"f",vm))throw new Error("Your browser or machine may not support WebGL.");if(s.sx>t||s.sy>i||s.sx+s.sWidth>t||s.sy+s.sHeight>i)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let r;Pm._onLog&&(r=Date.now(),Pm._onLog("getImageData(), START: "+r));const n=Math.round(s.sx),a=Math.round(s.sy),l=Math.round(s.sWidth),h=Math.round(s.sHeight),c=Math.round(s.dWidth),d=Math.round(s.dHeight);let u=pm.RGBA;(null==o?void 0:o.pixelFormat)&&(u=o.pixelFormat);let g,f,p,m=null;if((null==o?void 0:o.bufferContainer)&&(m=o.bufferContainer),um(Pm,mm,"f",vm)&&(this.useWebGLByDefault&&null==(null==o?void 0:o.bUseWebGL)||(null==o?void 0:o.bUseWebGL))){Pm._onLog&&Pm._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),g=this._reusedWebGLCvs;try{if(m)if(u===pm.GREY){if(p=new Uint8Array(4*c*d),f=this.drawImage(g,e,t,i,{sx:n,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},{pixelFormat:u,bUseWebGL:!0,bufferContainer:p}),p=this.transformPixelFormat(p,f.pixelFormat,u),m){if(m.length<p.length)throw new Error("Unexpected size of the 'bufferContainer'.");m.set(p);}}else f=this.drawImage(g,e,t,i,{sx:n,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},{pixelFormat:u,bUseWebGL:!0,bufferContainer:m}),p=new Uint8Array(m.buffer,0,4*c*d),p=this.transformPixelFormat(p,f.pixelFormat,u);else u===pm.GREY?((!um(this,Cm,"f")||um(this,Cm,"f").length<4*c*d)&&gm(this,Cm,new Uint8Array(4*c*d),"f"),p=new Uint8Array(um(this,Cm,"f").buffer,0,4*c*d)):p=new Uint8Array(4*c*d),f=this.drawImage(g,e,t,i,{sx:n,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},{pixelFormat:u,bUseWebGL:!0,bufferContainer:p}),p=this.transformPixelFormat(p,f.pixelFormat,u);}catch(s){if("WebGLError"===s.name&&(this.forceLoseContext(),null==(null==o?void 0:o.bUseWebGL)))return Pm._onLog&&Pm._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(e,t,i,{sx:n,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},Object.assign({},o,{bUseWebGL:!1}));throw s}}else if(Pm._onLog&&Pm._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),g=this._reusedCvs,f=this.drawImage(g,e,t,i,{sx:n,sy:a,sWidth:l,sHeight:h,dWidth:c,dHeight:d},{pixelFormat:pm.RGBA,bUseWebGL:!1}),p=this.readCvsData(f.context,{width:c,height:d},null),p=this.transformPixelFormat(p,f.pixelFormat,u),m){if(m.length<p.length)throw new Error("Unexpected size of the 'bufferContainer'.");m.set(p);}return Pm._onLog&&Pm._onLog("getImageData() end. Costs: "+(Date.now()-r)),{data:p,pixelFormat:u,width:c,height:d,bUseWebGL:f.bUseWebGL}}convertDataToCvs(e,t,i,s){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof t||t<=0)throw new Error("Invalid 'width'.");if("number"!=typeof i||i<=0)throw new Error("Invalid 'height'.");const o=document.createElement("canvas");let r;if(o.width=t,o.height=i,s===pm.GREY){r=new Uint8ClampedArray(4*t*i);for(let t=0;t<r.length;t+=4)r[t]=e[t/4],r[t+1]=e[t/4],r[t+2]=e[t/4],r[t+3]=255;}else r=new Uint8ClampedArray(e.buffer);const n=new ImageData(r,t,i);return o.getContext("2d").putImageData(n,0,0),o}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),gm(this,wm,null,"f"),gm(this,bm,null,"f"),gm(this,xm,null,"f"),this._reusedWebGLCvs=null;}dispose(){this.forceLoseContext(),gm(this,Sm,!0,"f");}}mm=Pm,ym=new WeakMap,wm=new WeakMap,bm=new WeakMap,xm=new WeakMap,Cm=new WeakMap,Sm=new WeakMap,vm={value:void 0};var Tm,km,Dm,Em,Am,Im,Mm,Rm,Om,_m,Nm,Lm,Bm,Um,Wm,Vm,Fm,zm,Hm,jm,Gm,$m,Xm,Ym,qm,Qm,Zm,Jm,Km,ev,tv,iv,sv,ov,rv,nv,av,lv,hv,cv,dv,uv,gv;class fv{constructor(){Tm.set(this,new Map),km.set(this,!1);}get disposed(){return om(this,km,"f")}on(e,t){e=e.toLowerCase();const i=om(this,Tm,"f").get(e);if(i){if(i.includes(t))return;i.push(t);}else om(this,Tm,"f").set(e,[t]);}off(e,t){e=e.toLowerCase();const i=om(this,Tm,"f").get(e);if(!i)return;const s=i.indexOf(t);-1!==s&&i.splice(s,1);}offAll(e){e=e.toLowerCase();const t=om(this,Tm,"f").get(e);t&&(t.length=0);}async fire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{async:!1,copy:!0};t||(t=[]),e=e.toLowerCase();const s=om(this,Tm,"f").get(e);if(s&&s.length){i=Object.assign({async:!1,copy:!0},i);for(let e of s){if(!e)continue;let s=[];if(i.copy)for(let e of t){try{e=JSON.parse(JSON.stringify(e));}catch(e){}s.push(e);}else s=t;let o=!1;if(i.async)setTimeout((()=>{this.disposed||e.apply(i.target,s);}),0);else try{o=await e.apply(i.target,s);}catch(e){}if(!0===o)break}}}dispose(){rm(this,km,!0,"f");}}Tm=new WeakMap,km=new WeakMap;const pv=(e,t,i,s)=>{if(!i)return e;let o=t+Math.round((e-t)/i)*i;return s&&(o=Math.min(o,s)),o};class mv{static get version(){return "2.0.0-16"}static isStorageAvailable(e){let t;try{t=window[e];const i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}static findBestRearCameraInIOS(e,t){if(!e||!e.length)return null;let i=!1;if((null==t?void 0:t.getMainCamera)&&(i=!0),i){const t=["후면 카메라","背面カメラ","後置鏡頭","后置相机","กล้องด้านหลัง","बैक कैमरा","الكاميرا الخلفية","מצלמה אחורית","камера на задней панели","задня камера","задна камера","артқы камера","πίσω κάμερα","zadní fotoaparát","zadná kamera","tylny aparat","takakamera","stražnja kamera","rückkamera","kamera på baksidan","kamera belakang","kamera bak","hátsó kamera","fotocamera (posteriore)","câmera traseira","câmara traseira","cámara trasera","càmera posterior","caméra arrière","cameră spate","camera mặt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],i=e.find((e=>t.includes(e.label.toLowerCase())));return null==i?void 0:i.deviceId}{const t=["후면","背面","後置","后置","านหลัง","बैक","خلفية","אחורית","задняя","задней","задна","πίσω","zadní","zadná","tylny","trasera","traseira","taka","stražnja","spate","sau","rück","posteriore","posterior","hátsó","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"],i=["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],s=["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],o=e.filter((e=>{const i=e.label.toLowerCase();return t.some((e=>i.includes(e)))}));if(!o.length)return null;const r=o.find((e=>{const t=e.label.toLowerCase();return i.some((e=>t.includes(e)))}));if(r)return r.deviceId;const n=o.find((e=>{const t=e.label.toLowerCase();return s.some((e=>t.includes(e)))}));return n?n.deviceId:o[0].deviceId}}static findBestRearCamera(e,t){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(dm.OS))return mv.findBestRearCameraInIOS(e,{getMainCamera:null==t?void 0:t.getMainCameraInIOS});const i=["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"];for(let t of e){const e=t.label.toLowerCase();if(e&&i.some((t=>e.includes(t)))&&/\b0(\b)?/.test(e))return t.deviceId}return ["Android","HarmonyOS"].includes(dm.OS)?e[e.length-1].deviceId:null}static findBestCamera(e,t,i){return e&&e.length?"environment"===t?this.findBestRearCamera(e,i):"user"===t?null:t?void 0:null:null}static async playVideo(e,t,i){if(!e)throw new Error("Invalid 'videoEl'.");if(!t)throw new Error("Invalid 'source'.");return "string"==typeof t||t instanceof String?e.src=t:e.srcObject=t,new Promise(((t,s)=>{let o;const r=()=>{e.removeEventListener("loadstart",l),e.removeEventListener("abort",h),e.removeEventListener("play",c),e.removeEventListener("error",d);},n=()=>{o&&clearTimeout(o),r(),t(e);},a=e=>{o&&clearTimeout(o),r(),s(e);},l=()=>{e.addEventListener("abort",h,{once:!0});},h=()=>{const e=new Error("Video playing was interrupted.");e.name="AbortError",a(e);},c=()=>{n();},d=()=>{a(new Error(`Video error ${e.error.code}: ${e.error.message}.`));};e.addEventListener("loadstart",l,{once:!0}),e.autoplay&&["iPhone","iPad","Mac"].includes(dm.OS)&&dm.version>=17?(e.addEventListener("play",c,{once:!0}),e.addEventListener("error",d,{once:!0})):(e.load(),e.play().then((()=>{n();})).catch((e=>{a(e);}))),i&&(o=setTimeout((()=>{r(),s(new Error("Failed to play video. Timeout."));}),i));}))}static async testCameraAccess(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))return {ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let s;try{s=e?await navigator.mediaDevices.getUserMedia(e):await navigator.mediaDevices.getUserMedia({video:!0});}catch(e){return {ok:!1,errorName:e.name,errorMessage:e.message}}finally{null==s||s.getTracks().forEach((e=>{e.stop();}));}return {ok:!0}}get state(){if(!om(this,Vm,"f"))return "closed";if("pending"===om(this,Vm,"f"))return "opening";if("fulfilled"===om(this,Vm,"f"))return "opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e&&mv.isStorageAvailable("localStorage")?rm(this,Lm,!0,"f"):rm(this,Lm,!1,"f");}get ifSaveLastUsedCamera(){return om(this,Lm,"f")}get isVideoPlaying(){return !(!om(this,Am,"f")||om(this,Am,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(e){var t,i,s;if(!(e instanceof HTMLElement)&&null!=e)throw new TypeError("Invalid 'element'.");null===(t=om(this,$m,"f"))||void 0===t||t.removeEventListener("click",om(this,Gm,"f")),null===(i=om(this,$m,"f"))||void 0===i||i.removeEventListener("touchend",om(this,Gm,"f")),null===(s=om(this,$m,"f"))||void 0===s||s.removeEventListener("touchmove",om(this,jm,"f")),rm(this,$m,e,"f"),e&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(dm.OS)?(e.addEventListener("touchend",om(this,Gm,"f")),e.addEventListener("touchmove",om(this,jm,"f"))):e.addEventListener("click",om(this,Gm,"f")));}get tapFocusEventBoundEl(){return om(this,$m,"f")}get disposed(){return om(this,tv,"f")}constructor(e){var t,i;Em.add(this),Am.set(this,null),Im.set(this,void 0),Mm.set(this,(()=>{"opened"===this.state&&om(this,Qm,"f").fire("resumed",null,{target:this,async:!0});})),Rm.set(this,(()=>{om(this,Qm,"f").fire("paused",null,{target:this,async:!1});})),Om.set(this,void 0),_m.set(this,void 0),this.cameraOpenTimeout=4e3,this._arrCameras=[],Nm.set(this,void 0),Lm.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Bm.set(this,void 0),Um.set(this,!0),Wm.set(this,void 0),Vm.set(this,void 0),Fm.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},zm.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(e,t)=>{let i,s;const o=window.getComputedStyle(om(this,Am,"f")).objectFit,r=this.getResolution(),n=om(this,Am,"f").getBoundingClientRect(),a=n.left,l=n.top,{width:h,height:c}=om(this,Am,"f").getBoundingClientRect();if(h<=0||c<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const d=h/c,u=r.width/r.height;let g=1;if("contain"===o)u>d?(g=h/r.width,i=(e-a)/g,s=(t-l-(c-h/u)/2)/g):(g=c/r.height,s=(t-l)/g,i=(e-a-(h-c*u)/2)/g);else {if("cover"!==o)throw new Error("Unsupported object-fit.");u>d?(g=c/r.height,s=(t-l)/g,i=(e-a+(c*u-h)/2)/g):(g=h/r.width,i=(e-a)/g,s=(t-l+(h/u-c)/2)/g);}return {x:i,y:s}},Hm.set(this,!1),jm.set(this,(()=>{rm(this,Hm,!0,"f");})),Gm.set(this,(async e=>{var t;if(om(this,Hm,"f"))return void rm(this,Hm,!1,"f");if(!om(this,zm,"f"))return;if(!this.isVideoPlaying)return;if(!om(this,Im,"f"))return;if(!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(t=this.getCameraCapabilities())||void 0===t?void 0:t.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),1==this._focusParameters.isDoingFocus)return;let i,s;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)i=e.clientX,s=e.clientY;else {if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;i=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY;}const o=this.getResolution(),r=2*Math.round(Math.min(o.width,o.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let n;try{n=this.calculateCoordInVideo(i,s);}catch(e){}if(n.x<0||n.x>o.width||n.y<0||n.y>o.height)return;const a={x:n.x+"px",y:n.y+"px"},l=r+"px",h=l;let c;mv._onLog&&(c=Date.now());try{await om(this,Em,"m",dv).call(this,a,l,h,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance);}catch(e){if(mv._onLog)throw mv._onLog(e),e}mv._onLog&&mv._onLog(`Tap focus costs: ${Date.now()-c} ms`),this._focusParameters.taskBackToContinous=setTimeout((()=>{var e;mv._onLog&&mv._onLog("Back to continuous focus."),null===(e=om(this,Im,"f"))||void 0===e||e.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch((()=>{}));}),this._focusParameters.focusBackToContinousTime),om(this,Qm,"f").fire("tapfocus",null,{target:this,async:!0});})),$m.set(this,null),Xm.set(this,1),Ym.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!om(this,Am,"f"))return;const e=om(this,Xm,"f");if(e<1)throw new RangeError("Invalid scale value.");if(1===e)om(this,Am,"f").style.transform="";else {const t=window.getComputedStyle(om(this,Am,"f")).objectFit,i=om(this,Am,"f").videoWidth,s=om(this,Am,"f").videoHeight,{width:o,height:r}=om(this,Am,"f").getBoundingClientRect();if(o<=0||r<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const n=o/r,a=i/s;let l=1;"contain"===t?l=n<a?o/(i/e):r/(s/e):"cover"===t&&(l=a>n?r/(i/e):o/(s/e));const h=l*(1-1/e)*(i/2-om(this,Ym,"f").x),c=l*(1-1/e)*(s/2-om(this,Ym,"f").y);om(this,Am,"f").style.transform=`translate(${h}px, ${c}px) scale(${e})`;}},qm.set(this,(function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,this.pixelFormat===pm.GREY){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255;}else t=new Uint8ClampedArray(this.data.buffer);const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e})),Qm.set(this,void 0),Zm.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Jm.set(this,new Map),Km.set(this,!1),ev.set(this,(async()=>{var e,t;if("visible"===document.visibilityState){if(mv._onLog&&mv._onLog("document visible. video paused: "+(null===(e=om(this,Am,"f"))||void 0===e?void 0:e.paused)),om(this,Km,"f")&&om(this,Am,"f")&&this.videoSrc&&"opened"===this.state)return void this.resume().catch((()=>{}));if(!this._mediaStream)return;if(this._mediaStream.active&&om(this,Im,"f"))if(om(this,Im,"f").muted&&["iPhone","iPad","Mac"].includes(dm.OS)){if(dm.version>=17)return;await om(this,Em,"m",nv).call(this);}else om(this,Km,"f")&&this.resume().catch((()=>{}));else await om(this,Em,"m",nv).call(this);}else if("hidden"===document.visibilityState&&(mv._onLog&&mv._onLog("document hidden. video paused: "+(null===(t=om(this,Am,"f"))||void 0===t?void 0:t.paused)),["iPhone","iPad","Mac"].includes(dm.OS)?rm(this,Km,!0,"f"):rm(this,Km,this.isVideoPlaying,"f"),this.isVideoLoaded()&&"opened"==this.state)){if(["iPhone","iPad","Mac"].includes(dm.OS)&&dm.version>=17)return;this.pause();}})),tv.set(this,!1),(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia)||setTimeout((()=>{mv.onWarning&&mv.onWarning("The browser is too old or the page is loaded from an insecure origin.");}),0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),rm(this,Qm,new fv,"f"),this.imageDataGetter=new Pm,document.addEventListener("visibilitychange",om(this,ev,"f"));}setVideoEl(e){if(!(e&&e instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");e.addEventListener("play",om(this,Mm,"f")),e.addEventListener("pause",om(this,Rm,"f")),rm(this,Am,e,"f");}getVideoEl(){return om(this,Am,"f")}releaseVideoEl(){var e,t;null===(e=om(this,Am,"f"))||void 0===e||e.removeEventListener("play",om(this,Mm,"f")),null===(t=om(this,Am,"f"))||void 0===t||t.removeEventListener("pause",om(this,Rm,"f")),rm(this,Am,null,"f");}isVideoLoaded(){return !!om(this,Am,"f")&&4==om(this,Am,"f").readyState}async open(){if(om(this,Wm,"f")&&!om(this,Um,"f")){if("pending"===om(this,Vm,"f"))return om(this,Wm,"f");if("fulfilled"===om(this,Vm,"f"))return}om(this,Qm,"f").fire("before:open",null,{target:this}),await om(this,Em,"m",nv).call(this),om(this,Qm,"f").fire("opened",null,{target:this,async:!0}),om(this,Qm,"f").fire("played",null,{target:this,async:!0});}async close(){if("closed"===this.state)return;om(this,Qm,"f").fire("before:close",null,{target:this});const e=om(this,Wm,"f");if(om(this,Em,"m",lv).call(this),e&&"pending"===om(this,Vm,"f")){try{await e;}catch(e){}if(!1===om(this,Um,"f")){const e=new Error("'close()' was interrupted.");throw e.name="AbortError",e}}rm(this,Wm,null,"f"),rm(this,Vm,null,"f"),om(this,Qm,"f").fire("closed",null,{target:this,async:!0});}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");om(this,Am,"f").pause();}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");await om(this,Am,"f").play();}async setCamera(e){if("string"!=typeof e)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof om(this,Om,"f").video&&(om(this,Om,"f").video={}),delete om(this,Om,"f").video.facingMode,om(this,Om,"f").video.deviceId={exact:e},!("closed"===this.state||this.videoSrc||"opening"===this.state&&om(this,Um,"f"))){om(this,Qm,"f").fire("before:camera:change",[],{target:this,async:!1}),await om(this,Em,"m",av).call(this);try{this.resetSoftwareScale();}catch(e){}return om(this,_m,"f")}}async switchToFrontCamera(e){if("object"!=typeof om(this,Om,"f").video&&(om(this,Om,"f").video={}),(null==e?void 0:e.resolution)&&(om(this,Om,"f").video.width={ideal:e.resolution.width},om(this,Om,"f").video.height={ideal:e.resolution.height}),delete om(this,Om,"f").video.deviceId,om(this,Om,"f").video.facingMode={exact:"user"},rm(this,Nm,null,"f"),!("closed"===this.state||this.videoSrc||"opening"===this.state&&om(this,Um,"f"))){om(this,Qm,"f").fire("before:camera:change",[],{target:this,async:!1}),om(this,Em,"m",av).call(this);try{this.resetSoftwareScale();}catch(e){}return om(this,_m,"f")}}getCamera(){var e;if(om(this,_m,"f"))return om(this,_m,"f");{let t=(null===(e=om(this,Om,"f").video)||void 0===e?void 0:e.deviceId)||"";if(t){t=t.exact||t.ideal||t;for(let e of this._arrCameras)if(e.deviceId===t)return JSON.parse(JSON.stringify(e))}return {deviceId:"",label:"",_checked:!1}}}async _getCameras(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let s;if(e){let e=await navigator.mediaDevices.getUserMedia({video:!0});s=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)),e.getTracks().forEach((e=>{e.stop();}));}else s=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));const o=[],r=[];if(this._arrCameras)for(let e of this._arrCameras)e._checked&&r.push(e);for(let e=0;e<s.length;e++){let t,i=s[e];for(let e of r)if(i.deviceId==e.deviceId){t=e;break}t||(t={deviceId:i.deviceId,label:i.label?i.label:"camera "+e,_checked:!1}),t.deviceId&&o.push(t);}return this._arrCameras=o,mv._onLog&&mv._onLog(JSON.stringify(this._arrCameras)),o}async getCameras(){var e,t;if(!(null===(t=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===t?void 0:t.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const i=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(e,t,i){if("number"!=typeof e||e<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof t||t<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof om(this,Om,"f").video&&(om(this,Om,"f").video={}),i?(om(this,Om,"f").video.width={exact:e},om(this,Om,"f").video.height={exact:t}):(om(this,Om,"f").video.width={ideal:e},om(this,Om,"f").video.height={ideal:t}),"closed"===this.state||this.videoSrc||"opening"===this.state&&om(this,Um,"f"))return null;om(this,Qm,"f").fire("before:resolution:change",[],{target:this,async:!1}),await om(this,Em,"m",av).call(this);try{this.resetSoftwareScale();}catch(e){}const s=this.getResolution();return {width:s.width,height:s.height}}getResolution(){if("opened"===this.state&&this.videoSrc&&om(this,Am,"f"))return {width:om(this,Am,"f").videoWidth,height:om(this,Am,"f").videoHeight};if(om(this,Im,"f")){const e=om(this,Im,"f").getSettings();return {width:e.width,height:e.height}}if(this.isVideoLoaded())return {width:om(this,Am,"f").videoWidth,height:om(this,Am,"f").videoHeight};{const e={width:0,height:0};let t=om(this,Om,"f").video.width||0,i=om(this,Om,"f").video.height||0;return t&&(e.width=t.exact||t.ideal||t),i&&(e.height=i.exact||i.ideal||i),e}}async getResolutions(e){var t,i,s,o,r,n,a,l,h,c,d;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let u="";const g=(e,t)=>{const i=om(this,Jm,"f").get(e);if(!i||!i.length)return !1;for(let e of i)if(e.width===t.width&&e.height===t.height)return !0;return !1};if(this._mediaStream){u=null===(d=om(this,_m,"f"))||void 0===d?void 0:d.deviceId;let t=om(this,Jm,"f").get(u);if(t&&!e)return JSON.parse(JSON.stringify(t));t=[],om(this,Jm,"f").set(u,t),rm(this,Fm,!0,"f");try{for(let e of this.detectedResolutions){await om(this,Im,"f").applyConstraints({width:{ideal:e.width},height:{ideal:e.height}}),om(this,Em,"m",sv).call(this);const i=om(this,Im,"f").getSettings(),s={width:i.width,height:i.height};g(u,s)||t.push({width:s.width,height:s.height});}}catch(e){throw om(this,Em,"m",lv).call(this),rm(this,Fm,!1,"f"),e}try{await om(this,Em,"m",nv).call(this);}catch(e){if("AbortError"===e.name)return t;throw e}finally{rm(this,Fm,!1,"f");}return t}{const t=async(e,t,i)=>{const s={video:{deviceId:{exact:e},width:{ideal:t},height:{ideal:i}}};let o=null;try{o=await navigator.mediaDevices.getUserMedia(s);}catch(e){return null}if(!o)return null;const r=o.getVideoTracks();let n=null;try{const e=r[0].getSettings();n={width:e.width,height:e.height};}catch(e){const t=document.createElement("video");t.srcObject=o,n={width:t.videoWidth,height:t.videoHeight},t.srcObject=null;}return r.forEach((e=>{e.stop();})),n};let i=(null===(r=null===(o=null===(s=om(this,Om,"f"))||void 0===s?void 0:s.video)||void 0===o?void 0:o.deviceId)||void 0===r?void 0:r.exact)||(null===(l=null===(a=null===(n=om(this,Om,"f"))||void 0===n?void 0:n.video)||void 0===a?void 0:a.deviceId)||void 0===l?void 0:l.ideal)||(null===(c=null===(h=om(this,Om,"f"))||void 0===h?void 0:h.video)||void 0===c?void 0:c.deviceId);if(!i)return [];let d=om(this,Jm,"f").get(i);if(d&&!e)return JSON.parse(JSON.stringify(d));d=[],om(this,Jm,"f").set(i,d);for(let e of this.detectedResolutions){const s=await t(i,e.width,e.height);s&&!g(i,s)&&d.push({width:s.width,height:s.height});}return d}}async setMediaStreamConstraints(e,t){if(!(e=>{return null!==e&&"[object Object]"===(t=e,Object.prototype.toString.call(t));var t;})(e))throw new TypeError("Invalid 'mediaStreamConstraints'.");rm(this,Om,JSON.parse(JSON.stringify(e)),"f"),rm(this,Nm,null,"f"),t&&om(this,Em,"m",av).call(this);}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(om(this,Om,"f")))}resetMediaStreamConstraints(){rm(this,Om,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f");}getCameraCapabilities(){if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return om(this,Im,"f").getCapabilities?om(this,Im,"f").getCapabilities():{}}getCameraSettings(){if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return om(this,Im,"f").getSettings()}async turnOnTorch(){if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(null==e?void 0:e.torch))throw Error("Not supported.");await om(this,Im,"f").applyConstraints({advanced:[{torch:!0}]});}async turnOffTorch(){if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(null==e?void 0:e.torch))throw Error("Not supported.");await om(this,Im,"f").applyConstraints({advanced:[{torch:!1}]});}async setColorTemperature(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const s=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.colorTemperature;if(!s)throw Error("Not supported.");return t&&(e<s.min?e=s.min:e>s.max&&(e=s.max),e=pv(e,s.min,s.step,s.max)),await om(this,Im,"f").applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]}),e}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const s=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.exposureCompensation;if(!s)throw Error("Not supported.");return t&&(e<s.min?e=s.min:e>s.max&&(e=s.max),e=pv(e,s.min,s.step,s.max)),await om(this,Im,"f").applyConstraints({advanced:[{exposureCompensation:e}]}),e}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");let s=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.frameRate;if(!s)throw Error("Not supported.");t&&(e<s.min?e=s.min:e>s.max&&(e=s.max));const o=this.getResolution();return await om(this,Im,"f").applyConstraints({width:{ideal:Math.max(o.width,o.height)},frameRate:e}),e}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(e,t){if("object"!=typeof e||Array.isArray(e)||null==e)throw new TypeError("Invalid 'settings'.");if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const i=this.getCameraCapabilities(),s=null==i?void 0:i.focusMode,o=null==i?void 0:i.focusDistance;if(!s)throw Error("Not supported.");if("string"!=typeof e.mode)throw TypeError("Invalid 'mode'.");const r=e.mode.toLowerCase();if(!s.includes(r))throw Error("Unsupported focus mode.");if("manual"===r){if(!o)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let i=e.distance;t&&(i<o.min?i=o.min:i>o.max&&(i=o.max),i=pv(i,o.min,o.step,o.max)),this._focusParameters.focusArea=null,await om(this,Im,"f").applyConstraints({advanced:[{focusMode:r,focusDistance:i}]});}else {if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const t=e.area.centerPoint;let i=e.area.width,s=e.area.height;if(!i||!s){const e=this.getResolution();i||(i=2*Math.round(Math.min(e.width,e.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),s||(s=2*Math.round(Math.min(e.width,e.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px");}this._focusParameters.focusArea={centerPoint:{x:t.x,y:t.y},width:i,height:s},await om(this,Em,"m",dv).call(this,t,i,s);}}}else this._focusParameters.focusArea=null,await om(this,Im,"f").applyConstraints({advanced:[{focusMode:r}]});}getFocus(){const e=this.getCameraSettings(),t=e.focusMode;return t?"manual"===t?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:t}:null}async enableTapToFocus(){rm(this,zm,!0,"f");}disableTapToFocus(){rm(this,zm,!1,"f");}isTapToFocusEnabled(){return om(this,zm,"f")}async setZoom(e){if("object"!=typeof e||Array.isArray(e)||null==e)throw new TypeError("Invalid 'settings'.");if("number"!=typeof e.factor)throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==this.state)throw new Error("Video is not playing.");e.centerPoint?om(this,Em,"m",uv).call(this,e.centerPoint):this.resetScaleCenter();try{if(om(this,Em,"m",gv).call(this,om(this,Ym,"f"))){const t=await this.setHardwareScale(e.factor,!0);let i=this.getHardwareScale();1==i&&1!=t&&(i=t),e.factor>i?this.setSoftwareScale(e.factor/i):this.setSoftwareScale(1);}else await this.setHardwareScale(1),this.setSoftwareScale(e.factor);}catch(t){const i=t.message||t;if("Not supported."!==i&&"Camera is not open."!==i)throw t;this.setSoftwareScale(e.factor);}}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let e=1;try{e=this.getHardwareScale();}catch(e){if("Camera is not open."!==(e.message||e))throw e}return {factor:e*om(this,Xm,"f")}}async resetZoom(){await this.setZoom({factor:1});}async setHardwareScale(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(!om(this,Im,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const s=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.zoom;if(!s)throw Error("Not supported.");return t&&(e<s.min?e=s.min:e>s.max&&(e=s.max),e=pv(e,s.min,s.step,s.max)),await om(this,Im,"f").applyConstraints({advanced:[{zoom:e}]}),e}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(e,t){if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");t&&om(this,Em,"m",uv).call(this,t),rm(this,Xm,e,"f"),this.updateVideoElWhenSoftwareScaled();}getSoftwareScale(){return om(this,Xm,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const e=this.getResolution();rm(this,Ym,{x:e.width/2,y:e.height/2},"f");}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter();}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded())return null;if(om(this,Fm,"f"))return null;const t=Date.now();mv._onLog&&mv._onLog("getFrameData() START: "+t);const i=om(this,Am,"f").videoWidth,s=om(this,Am,"f").videoHeight;let o={sx:0,sy:0,sWidth:i,sHeight:s,dWidth:i,dHeight:s};(null==e?void 0:e.position)&&(o=JSON.parse(JSON.stringify(e.position)));let r=pm.RGBA;(null==e?void 0:e.pixelFormat)&&(r=e.pixelFormat);let n=om(this,Xm,"f");(null==e?void 0:e.scale)&&(n=e.scale);let a=om(this,Ym,"f");if(null==e?void 0:e.scaleCenter){if("string"!=typeof e.scaleCenter.x||"string"!=typeof e.scaleCenter.y)throw new Error("Invalid scale center.");let t=0,o=0;if(e.scaleCenter.x.endsWith("px"))t=parseFloat(e.scaleCenter.x);else {if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");t=parseFloat(e.scaleCenter.x)/100*i;}if(e.scaleCenter.y.endsWith("px"))o=parseFloat(e.scaleCenter.y);else {if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");o=parseFloat(e.scaleCenter.y)/100*s;}if(isNaN(t)||isNaN(o))throw new Error("Invalid scale center.");a.x=Math.round(t),a.y=Math.round(o);}let l=null;if((null==e?void 0:e.bufferContainer)&&(l=e.bufferContainer),0==i||0==s)return null;1!==n&&(o.sWidth=Math.round(o.sWidth/n),o.sHeight=Math.round(o.sHeight/n),o.sx=Math.round((1-1/n)*a.x+o.sx/n),o.sy=Math.round((1-1/n)*a.y+o.sy/n));const h=this.imageDataGetter.getImageData(om(this,Am,"f"),i,s,o,{pixelFormat:r,bufferContainer:l});if(!h)return null;const c=Date.now();return mv._onLog&&mv._onLog("getFrameData() END: "+c),{data:h.data,width:h.width,height:h.height,pixelFormat:h.pixelFormat,timeSpent:c-t,timeStamp:c,toCanvas:om(this,qm,"f")}}on(e,t){if(!om(this,Zm,"f").includes(e.toLowerCase()))throw new Error(`Event '${e}' does not exist.`);om(this,Qm,"f").on(e,t);}off(e,t){om(this,Qm,"f").off(e,t);}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),om(this,Qm,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",om(this,ev,"f")),rm(this,tv,!0,"f");}}function vv(e,t){G(t)&&(e.config.maxFrameNumber=t);}function yv(e,t){G(t)&&(e.config.autoCaptureDelay=t);}function wv(e,t){if(!z(t))return;const{context:i}=e.viewer;i.core.documentDetectService.enableDetect&&(e.config.enableAutoDetect=t,e.isVideoPlaying&&(e.viewer.hooks.autoDetectChanged.emit({enableAutoDetect:t}),t?e.loop.startLoop():e.config.enableAutoCapture?e.loop.cancelAnimation():e.loop.closeLoop()));}function bv(e,t){z(t)&&(e.config.enableAutoCapture=t,e.isVideoPlaying&&(e.viewer.hooks.autoCaptureChanged.emit({enableAutoCapture:t}),t?e.loop.startLoop():e.config.enableAutoDetect||e.loop.closeLoop()));}function xv(e,t){G(t)&&(e.config.acceptedPolygonConfidence=t);}function Cv(e,t){return !!e.videoEl&&(e.config.fullscreen=t,e.videoEl.style.objectFit=t?"cover":"contain",e.loop.updateVideoLayout(),!0)}Am=new WeakMap,Im=new WeakMap,Mm=new WeakMap,Rm=new WeakMap,Om=new WeakMap,_m=new WeakMap,Nm=new WeakMap,Lm=new WeakMap,Bm=new WeakMap,Um=new WeakMap,Wm=new WeakMap,Vm=new WeakMap,Fm=new WeakMap,zm=new WeakMap,Hm=new WeakMap,jm=new WeakMap,Gm=new WeakMap,$m=new WeakMap,Xm=new WeakMap,Ym=new WeakMap,qm=new WeakMap,Qm=new WeakMap,Zm=new WeakMap,Jm=new WeakMap,Km=new WeakMap,ev=new WeakMap,tv=new WeakMap,Em=new WeakSet,iv=async function(){const e=this.getMediaStreamConstraints();if("boolean"==typeof e.video&&(e.video={}),e.video.deviceId);else if(om(this,Nm,"f"))delete e.video.facingMode,e.video.deviceId={exact:om(this,Nm,"f")};else if(this.ifSaveLastUsedCamera&&mv.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete e.video.facingMode,e.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const t=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),i=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));t&&i&&(e.video.width=t,e.video.height=i);}else if(this.ifSkipCameraInspection);else {const t=async e=>{let t=null;return "environment"===e&&["Android","HarmonyOS","iPhone","iPad"].includes(dm.OS)?(await this._getCameras(!1),om(this,Em,"m",sv).call(this),t=mv.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):e||["Android","HarmonyOS","iPhone","iPad"].includes(dm.OS)||(await this._getCameras(!1),om(this,Em,"m",sv).call(this),t=mv.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),t};let i=e.video.facingMode;i instanceof Array&&i.length&&(i=i[0]),"object"==typeof i&&(i=i.exact||i.ideal);const s=await t(i);s&&(delete e.video.facingMode,e.video.deviceId={exact:s});}return e},sv=function(){if(om(this,Um,"f")){const e=new Error("The operation was interrupted.");throw e.name="AbortError",e}},ov=async function(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let s;try{mv._onLog&&mv._onLog("======try getUserMedia========");let t=[0,500],i=null;const o=async e=>{for(let o of t){o&&(await new Promise((e=>setTimeout(e,o))),om(this,Em,"m",sv).call(this));try{mv._onLog&&mv._onLog("ask "+JSON.stringify(e)),s=await navigator.mediaDevices.getUserMedia(e),om(this,Em,"m",sv).call(this);break}catch(e){if("NotFoundError"===e.name||"NotAllowedError"===e.name||"AbortError"===e.name||"OverconstrainedError"===e.name)throw e;i=e,mv._onLog&&mv._onLog(e.message||e);}}};if(await o(e),s||(mv._onLog&&mv._onLog("======try getUserMedia again========"),mv._onLog&&mv._onLog(e),await o(e)),s||(t=[1e3,2e3],await o(e)),s||await o(e),!s)throw i;return s}catch(e){throw null==s||s.getTracks().forEach((e=>{e.stop();})),"NotFoundError"===e.name&&(DOMException?e=new DOMException("No camera available, please use a device with an accessible camera.",e.name):(e=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),e}},rv=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach((e=>{e.stop();})),this._mediaStream=null),rm(this,Im,null,"f");},nv=async function(){rm(this,Um,!1,"f");const e=rm(this,Bm,Symbol(),"f");if(om(this,Wm,"f")&&"pending"===om(this,Vm,"f")){try{await om(this,Wm,"f");}catch(e){}om(this,Em,"m",sv).call(this);}if(e!==om(this,Bm,"f"))return;const t=rm(this,Wm,(async()=>{rm(this,Vm,"pending","f");try{if(this.videoSrc){if(!om(this,Am,"f"))throw new Error("'videoEl' should be set.");await mv.playVideo(om(this,Am,"f"),this.videoSrc,this.cameraOpenTimeout),om(this,Em,"m",sv).call(this);}else {let e=await om(this,Em,"m",iv).call(this);om(this,Em,"m",rv).call(this);let t=await om(this,Em,"m",ov).call(this,e);await this._getCameras(!1),om(this,Em,"m",sv).call(this);const i=()=>{const e=t.getVideoTracks();let i,s;if(e.length&&(i=e[0]),i){const e=i.getSettings();if(e)for(let t of this._arrCameras)if(e.deviceId===t.deviceId){t._checked=!0,t.label=i.label,s=t;break}}return s},s=om(this,Om,"f");if("object"==typeof s.video){let o=s.video.facingMode;if(o instanceof Array&&o.length&&(o=o[0]),"object"==typeof o&&(o=o.exact||o.ideal),!(om(this,Nm,"f")||this.ifSaveLastUsedCamera&&mv.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||s.video.deviceId)){const s=i(),r=mv.findBestCamera(this._arrCameras,o,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});r&&r!=(null==s?void 0:s.deviceId)&&(t.getTracks().forEach((e=>{e.stop();})),e.video.deviceId={exact:r},t=await om(this,Em,"m",ov).call(this,e),om(this,Em,"m",sv).call(this));}}const o=i();(null==o?void 0:o.deviceId)&&(rm(this,Nm,o&&o.deviceId,"f"),this.ifSaveLastUsedCamera&&mv.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",om(this,Nm,"f")),"object"==typeof e.video&&e.video.width&&e.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(e.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(e.video.height))))),om(this,Am,"f")&&(await mv.playVideo(om(this,Am,"f"),t,this.cameraOpenTimeout),om(this,Em,"m",sv).call(this)),this._mediaStream=t;const r=t.getVideoTracks();(null==r?void 0:r.length)&&rm(this,Im,r[0],"f"),rm(this,_m,o,"f");}}catch(e){throw om(this,Em,"m",lv).call(this),rm(this,Vm,null,"f"),e}rm(this,Vm,"fulfilled","f");})(),"f");return t},av=async function(){var e;if("closed"===this.state||this.videoSrc)return;const t=null===(e=om(this,_m,"f"))||void 0===e?void 0:e.deviceId,i=this.getResolution();await om(this,Em,"m",nv).call(this);const s=this.getResolution();t&&t!==om(this,_m,"f").deviceId&&om(this,Qm,"f").fire("camera:changed",[om(this,_m,"f").deviceId,t],{target:this,async:!0}),i.width==s.width&&i.height==s.height||om(this,Qm,"f").fire("resolution:changed",[{width:s.width,height:s.height},{width:i.width,height:i.height}],{target:this,async:!0}),om(this,Qm,"f").fire("played",null,{target:this,async:!0});},lv=function(){om(this,Em,"m",rv).call(this),rm(this,_m,null,"f"),om(this,Am,"f")&&(om(this,Am,"f").srcObject=null,this.videoSrc&&(om(this,Am,"f").pause(),om(this,Am,"f").currentTime=0)),rm(this,Um,!0,"f");try{this.resetSoftwareScale();}catch(e){}},hv=async function e(t,i){const s=e=>{if(!om(this,Im,"f")||!this.isVideoPlaying||e.focusTaskId!=this._focusParameters.curFocusTaskId){om(this,Im,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const t=new Error(`Focus task ${e.focusTaskId} canceled.`);throw t.name="DeprecatedTaskError",t}1===this._focusParameters.isDoingFocus&&Date.now()-e.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1);};let o;i=pv(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await om(this,Im,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),s(t),o=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise((e=>{setTimeout(e,o);})),s(t);let r=t.focusL-t.focusW/2,n=t.focusT-t.focusH/2,a=t.focusW,l=t.focusH;const h=this.getResolution();if(r>=h.width||n>=h.height)throw new Error("Invalid area.");r+a>h.width&&(a=h.width-r),n+l>h.height&&(l=h.height-n),r=Math.round(r),n=Math.round(n),a=Math.round(a),l=Math.round(l);const c=4*h.width*h.height*this._focusParameters.defaultTempBufferContainerLenRatio,d=4*a*l;let u=this._focusParameters.tempBufferContainer;if(u){const e=u.length;c>e&&c>=d?u=new Uint8Array(c):d>e&&d>=c&&(u=new Uint8Array(d));}else u=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(c,d));if(!this.imageDataGetter.getImageData(om(this,Am,"f"),h.width,h.height,{sx:r,sy:n,sWidth:a,sHeight:l,dWidth:a,dHeight:l},{pixelFormat:pm.RGBA,bufferContainer:u}))return om(this,Em,"m",e).call(this,t,i);const g=u;let f=0;for(let e=0,t=d-8;e<t;++e){let t=g[e]-g[e+8];++e;let i=g[e]-g[e+8];++e;let s=g[e]-g[e+8];++e,f+=t*t+i*i+s*s;}return -f},cv=async function e(t,i,s,o,r,n,a){let l;if(i=pv(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=pv(o,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),n?n=pv(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(n=pv(Math.sqrt((i||this._focusParameters.fds.step)*(o||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await om(this,Em,"m",hv).call(this,t,n)),a<=s&&a<=r?l=3:s<r&&s<a?l=1:r<s&&r<a&&(l=2),(o-i)/2<=this._focusParameters.fds.step)return 3===l||(1===l?await om(this,Im,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):2===l&&await om(this,Im,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:o}]})),!0;if(1===l)return await om(this,Em,"m",e).call(this,t,i,s,n,a);if(2===l)return await om(this,Em,"m",e).call(this,t,n,a,o,r);if(3!==l)return s=await om(this,Em,"m",hv).call(this,t,i),r=await om(this,Em,"m",hv).call(this,t,o),await om(this,Em,"m",e).call(this,t,i,s,o,r);let h=pv(Math.sqrt((i||this._focusParameters.fds.step)*(n||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),c=pv(Math.sqrt((o||this._focusParameters.fds.step)*(n||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/h)<=Math.abs(1/this._focusParameters.oldDistance-1/c)){let l=await om(this,Em,"m",hv).call(this,t,h);if(l<a)return await om(this,Em,"m",e).call(this,t,i,s,n,a,h,l);if(l==a)return await om(this,Em,"m",e).call(this,t,h,l,n,a);let d=await om(this,Em,"m",hv).call(this,t,c);if(l>a&&a<d)return await om(this,Em,"m",e).call(this,t,h,l,c,d,n,a);if(a==d)return await om(this,Em,"m",e).call(this,t,n,a,c,d);if(a>d)return await om(this,Em,"m",e).call(this,t,n,a,o,r,c,d)}else {let l=await om(this,Em,"m",hv).call(this,t,c);if(a>l)return await om(this,Em,"m",e).call(this,t,n,a,o,r,c,l);if(a==l)return await om(this,Em,"m",e).call(this,t,n,a,c,l);let d=await om(this,Em,"m",hv).call(this,t,h);if(d>a&&a<l)return await om(this,Em,"m",e).call(this,t,h,d,c,l,n,a);if(d==a)return await om(this,Em,"m",e).call(this,t,h,d,n,a);if(d<a)return await om(this,Em,"m",e).call(this,t,i,s,n,a,h,d)}return !1},dv=async function(e,t,i,s,o){var r;if(1==this._focusParameters.isDoingFocus)return !1;if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid 'centerPoint'.");if(!t||"string"!=typeof t)throw new Error("Invalid 'width'.");if(!i||"string"!=typeof i)throw new Error("Invalid 'height'.");const n=this.getResolution();let a=0,l=0;if(e.x.endsWith("px"))a=parseFloat(e.x);else {if(!e.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");a=parseFloat(e.x)/100*n.width;}if(e.y.endsWith("px"))l=parseFloat(e.y);else {if(!e.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");l=parseFloat(e.y)/100*n.height;}if(isNaN(a)||isNaN(l)||a<0||a>n.width||l<0||l>n.height)throw new Error("Invalid 'centerPoint'.");let h=0;if(t.endsWith("px"))h=parseFloat(t);else {if(!t.endsWith("%"))throw new Error("Invalid 'width'.");h=parseFloat(t)/100*n.width;}if(isNaN(h)||h<0)throw new Error("Invalid 'width'.");let c=0;if(i.endsWith("px"))c=parseFloat(i);else {if(!i.endsWith("%"))throw new Error("Invalid 'height'.");c=parseFloat(i)/100*n.height;}if(isNaN(c)||c<0)throw new Error("Invalid 'height'.");if(1!==om(this,Xm,"f")){const e=om(this,Xm,"f"),t=om(this,Ym,"f");h/=e,c/=e,a=(1-1/e)*t.x+a/e,l=(1-1/e)*t.y+l/e;}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(r=this.getCameraCapabilities())||void 0===r?void 0:r.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const d={focusL:a,focusT:l,focusW:h,focusH:c,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},u=async(e,t,i)=>{try{(null==t||t<this._focusParameters.fds.min)&&(t=this._focusParameters.fds.min),(null==i||i>this._focusParameters.fds.max)&&(i=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let s=pv(Math.sqrt(i*(t||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=pv(Math.sqrt((t||this._focusParameters.fds.step)*s),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=pv(Math.sqrt(s*i),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),n=await om(this,Em,"m",hv).call(this,e,r),a=await om(this,Em,"m",hv).call(this,e,o),l=await om(this,Em,"m",hv).call(this,e,s);if(a>l&&l<n){const t=await om(this,Em,"m",cv).call(this,e,o,a,r,n,s,l);return this._focusParameters.isDoingFocus=0,t}if(a<l&&a<n){let i=await om(this,Em,"m",hv).call(this,e,t);const r=await om(this,Em,"m",cv).call(this,e,t,i,s,l,o,a);return this._focusParameters.isDoingFocus=0,r}if(l>n&&a>n){let t=await om(this,Em,"m",hv).call(this,e,i);const o=await om(this,Em,"m",cv).call(this,e,s,l,i,t,r,n);return this._focusParameters.isDoingFocus=0,o}if(a==l&&l<n){const t=await om(this,Em,"m",cv).call(this,e,o,a,s,l);return this._focusParameters.isDoingFocus=0,t}if(l==n&&a>l){const t=await om(this,Em,"m",cv).call(this,e,s,l,r,n);return this._focusParameters.isDoingFocus=0,t}return u(e,t,i)}catch(e){if("DeprecatedTaskError"!==e.name)throw e}};return u(d,s,o)},uv=function(e){if("opened"!==this.state)throw new Error("Video is not playing.");if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid 'center'.");const t=this.getResolution();let i=0,s=0;if(e.x.endsWith("px"))i=parseFloat(e.x);else {if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(e.x)/100*t.width;}if(e.y.endsWith("px"))s=parseFloat(e.y);else {if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");s=parseFloat(e.y)/100*t.height;}if(isNaN(i)||isNaN(s))throw new Error("Invalid scale center.");rm(this,Ym,{x:i,y:s},"f");},gv=function(e){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();return e&&e.x==t.width/2&&e.y==t.height/2},mv.browserInfo=dm,mv.onWarning=null===(Dm=null===window||void 0===window?void 0:window.console)||void 0===Dm?void 0:Dm.warn;class Sv{constructor(e){t(this,"isLooping",!1),t(this,"lastDetectTime",(new Date).getTime()),t(this,"loopTimer",void 0),t(this,"autoCaptureStartTime",0),t(this,"lastRenderedQuad",void 0),t(this,"animation",void 0),t(this,"cameraContext",void 0),t(this,"videoLayout",void 0),this.cameraContext=e;}getLoopState(){const{enableAutoCapture:e,enableAutoDetect:t}=this.cameraContext.config;return e||t}clearLoopTimer(){clearTimeout(this.loopTimer),this.loopTimer=null,this.isLooping=!1,this.autoCaptureStartTime=0,this.lastDetectTime=(new Date).getTime();}loopTimeout(){if(!this.cameraContext.isVideoPlaying&&!this.getLoopState())return;const e=this.getDetectRemainTime();this.loopTimer=setTimeout((async()=>{if(!this.getLoopState()||this.isLooping)return;this.isLooping=!0;const e=await this.loopTaskDetail();this.isLooping=!1,e&&this.getLoopState()&&setTimeout((()=>{this.getLoopState()&&this.loopTimeout();}),10);}),e);}async loopTaskDetail(){if(!(this.cameraContext&&this.cameraContext.isVideoPlaying&&this.cameraContext.videoEl&&this.cameraContext.canvasEl))return !1;if(!this.getLoopState())return !1;const{viewer:e}=this.cameraContext;if(this.lastDetectTime=(new Date).getTime(),!e.context.viewService.isBindContainer)return !0;if("hidden"===e.getViewerConfig().visibility)return !1;const{config:t}=this.cameraContext,{enableDetect:i}=e.context.core.documentDetectService,s=this.cameraContext.getFrameData();if(!s)return !1;const o={type:1,data:s.data.buffer,height:s.height,width:s.width};let r={success:!1};var n;i&&(r=await this.getDetectResult(o),0===s.data.length&&(s.data=new Uint8Array(o.data)),t.enableAutoDetect&&(this.cameraContext.isVideoPlaying&&r.success&&null!==(n=r)&&void 0!==n&&n.location?(this.lastRenderedQuad?this.createDetectAnimation(this.lastRenderedQuad,r.location):this.drawQuadrilateral(r.location),this.lastRenderedQuad=r.location):(this.clearCanvas(),this.lastRenderedQuad=null)));let a=!1;var l;if(t.enableAutoCapture){if((null===(l=r)||void 0===l?void 0:l.status)===exports.EnumDocumentDetectionStatus.AUTO_CAPTURE&&(a=!0),!i)if(this.autoCaptureStartTime<=0)this.autoCaptureStartTime=(new Date).getTime();else {(new Date).getTime()-this.autoCaptureStartTime>t.autoCaptureDelay&&(this.autoCaptureStartTime=0,a=!0);}}else this.autoCaptureStartTime=0;if(a){var h;const e=await this.cameraContext.viewer.context.core.processService.resize(s.data.buffer,1,s.width,s.height,-1);this.cameraContext.isCapturedPages=!0,await this.cameraContext.viewer.context.loadSource({extraPageData:[{index:0,perspectiveQuad:null===(h=r)||void 0===h?void 0:h.location}],fileData:e.data}),this.startCaptureAnimation(),await Pv(),this.closeCaptureAnimation();}return !0}getDetectRemainTime(){const e=(new Date).getTime(),{maxFrameNumber:t}=this.cameraContext.config,i=e-this.lastDetectTime;return Math.max(0,1e3/t-i)}startLoop(){this.loopTimer||(this.getLoopState()?this.loopTimeout():(this.clearLoopTimer(),this.clearCanvas()));}closeLoop(){if(!this.loopTimer)return;const{context:e}=this.cameraContext.viewer,{documentDetectService:t}=e.core;t.resetDetector(),this.clearLoopTimer(),this.clearCanvas(),cancelAnimationFrame(this.animation);}updateVideoLayout(){const{videoEl:e,config:t}=this.cameraContext,{fullscreen:i}=t,{videoWidth:s,videoHeight:o}=e,{width:r,height:n}=e.getBoundingClientRect(),a={zoom:1,left:0,top:0};if(i){const e=Math.max(r/s,n/o);a.zoom=e;}else {const e=Math.min(r/s,n/o),t=(r-s*e)/2,i=(n-o*e)/2;a.zoom=e,a.left=t,a.top=i;}this.videoLayout=a;}async getDetectResult(e){const{cameraContext:t}=this,{context:i}=t.viewer,{documentDetectService:s}=i.core;if(!i.core.documentDetectService.enableDetect)return Promise.resolve({success:!1});let o=e;if(!e){const e=t.getFrameData();o={type:1,data:e.data.buffer,height:e.height,width:e.width};}const{acceptedPolygonConfidence:r,enableAutoCapture:n,autoCaptureDelay:a}=t.config,l={acceptedPolygonConfidence:r,enableAutoCapture:n,autoCaptureDelay:a},h=await s.detect(o,l);return h||Promise.resolve({success:!1})}drawQuadrilateral(e){if(!this.loopTimer)return;const{canvasEl:t,viewer:i}=this.cameraContext,{zoom:s,left:o,top:r}=this.videoLayout,n=t.getContext("2d");n.save(),n.clearRect(0,0,t.width,t.height),n.translate(o,r),n.scale(s,s),n.beginPath(),n.moveTo(e[0][0],e[0][1]);for(let t=1;t<e.length;t++)n.lineTo(e[t][0],e[t][1]);n.closePath();const{quadSelectionStyle:a}=i.getViewerConfig(),{border:l,background:h}=a,{borderWidth:c,borderColor:d,borderStyle:u}=Le(l);let g=Or(c).value/s;0===g&&(g=1);const f="solid"===u?[0,0]:[5*g,2*g];n.strokeStyle=d,n.fillStyle=h,n.lineCap="round",n.lineWidth=g,n.setLineDash(f),n.fill(),n.stroke(),n.restore();}clearCanvas(){const{canvasEl:e}=this.cameraContext;if(!e)return;e.getContext("2d").clearRect(0,0,e.width,e.height);}cancelAnimation(){this.clearCanvas(),cancelAnimationFrame(this.animation);}createDetectAnimation(e,t){let i=0;const s=()=>{this.clearCanvas();const o=e.map(((e,s)=>{const o=t[s];return [e[0]+(o[0]-e[0])*i,e[1]+(o[1]-e[1])*i]}));this.drawQuadrilateral(o),i<1&&(i+=.2,this.animation=requestAnimationFrame(s));};s();}startCaptureAnimation(){this.cameraContext.videoEl.style.filter="brightness(0%)",this.cameraContext.canvasEl.style.visibility="hidden";}closeCaptureAnimation(){this.cameraContext.videoEl.style.filter="brightness(100%)",this.cameraContext.canvasEl.style.visibility="";}}function Pv(){return new Promise((e=>{setTimeout((()=>{e("");}),50);}))}const Tv={tag:"div",id:"ddv-camera-container",className:"ddv-camera-container",children:[{tag:"video",id:"ddv-camera-video",class:"ddv-camera-camera"},{tag:"canvas",id:"ddv-camera-canvas",class:"ddv-camera-canvas"}]},kv={enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:65,fullscreen:!1,autoCaptureDelay:1e3};class Dv{constructor(e){var i;if(t(this,"camera",void 0),t(this,"configHandler",{}),t(this,"isHttps",!0),t(this,"lastDeviceId",void 0),t(this,"userDeviceId",void 0),t(this,"isFirstPlayed",!0),t(this,"isTurningTorch",!1),t(this,"initializing",!1),t(this,"cameraContainer",void 0),t(this,"viewer",void 0),t(this,"loop",void 0),t(this,"videoEl",void 0),t(this,"canvasEl",void 0),t(this,"config",kv),t(this,"bUser",!1),t(this,"canFrontCamera",!1),t(this,"isCapturedPages",!1),t(this,"lastEnvironmentCameraId",void 0),t(this,"cameraList",[]),t(this,"turnOnTheTorch",!1),t(this,"torchSupported",!1),this.viewer=e,this.camera=new mv,this.loop=new Sv(this),this.initConfigHandler(),null!==(i=navigator)&&void 0!==i&&null!==(i=i.mediaDevices)&&void 0!==i&&i.getUserMedia||(this.isHttps=!1),this.isCaptureViewer&&this.isHttps){this.initializing=!0;const e=this.getCameras().then((e=>{this.cameraList=e;})),t=this.getFrontCamera().then((e=>{this.canFrontCamera=e,this.viewer.hooks.cameraInit.emit({enableConvert:e});})).catch((e=>{}));Promise.all([e,t]).finally((()=>{this.initializing=!1;}));}this.camera.setResolution(1280,720),this.bindCameraEvents(),this.initHooks(),this.handleViewerModeChanged(),this.bindNativeEvents();}initHooks(){this.bindViewerHooks(),this.bindGlobalHooks();}handleViewerModeChanged(){const{defaultDom:e,mainAndThbContainer:t}=this.viewer.context.viewService;if(this.isCaptureViewer){if(!this.cameraContainer){const t=Uu(Tv,this.viewer.postfix);this.cameraContainer=t,Object.assign(t.style,this.viewer.context.viewerConfig.canvasStyle),e.appendChild(t);const i=t.getElementsByTagName("video")[0],s=t.getElementsByTagName("canvas")[0];i.setAttribute("playsinline","true"),i.setAttribute("muted","true"),i.setAttribute("disablePictureInPicture","true"),i.setAttribute("autoplay","autoplay"),i.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),i.style.transition="opacity 300ms, filter 100ms ease",this.bindCameraVideo(i),this.bindCameraCanvas(s),this.updateCameraConfig(kv);}Vu(this.cameraContainer,"flex"),Wu(t);}else Wu(this.cameraContainer),Vu(t,"flex");}initConfigHandler(){const e={maxFrameNumber:vv,enableAutoCapture:bv,enableAutoDetect:wv,acceptedPolygonConfidence:xv,fullscreen:Cv,autoCaptureDelay:yv};this.configHandler=e;}bindViewerHooks(){this.viewer.hooks.viewerModeChanged.on((e=>{this.isCaptureViewer&&this.getFrontCamera().then((e=>{this.canFrontCamera=e,this.viewer.hooks.cameraInit.emit({enableConvert:e});})),this.handleViewerModeChanged();})),this.viewer.hooks.visibleChanged.on((e=>{this.loop.closeLoop(),"visible"===e.newVisibility&&this.loop.startLoop();}));}bindGlobalHooks(){const{globalHooks:e}=this.viewer.context.core,t=e=>{this.isCapturedPages&&(this.viewer.emit("captured",{pageUid:e.pageUids[0]}),this.isCapturedPages=!1);};e.addPagesToDoc.on(t),this.viewer.hooks.destroy.on((()=>{e.addPagesToDoc.off(t);}));}bindCameraEvents(){const{camera:e}=this;e.on("paused",(()=>{this.loop.closeLoop();})),e.on("resumed",(()=>{this.loop.closeLoop(),this.loop.startLoop();})),e.on("before:open",(()=>{this.videoEl&&(this.videoEl.style.opacity="0");})),e.on("before:resolution:change",(()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop();})),e.on("before:camera:change",(()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop(),this.lastDeviceId=this.camera.getCamera().deviceId;})),e.on("camera:changed",(()=>{this.viewer.emit("cameraChanged",{oldDeviceId:this.lastDeviceId,newDeviceId:this.camera.getCamera().deviceId});})),e.on("played",(()=>{if(!this.videoEl||!this.isVideoPlaying)return;this.videoEl.style.opacity="1";const{enableTorch:e}=this.config,t=this.camera.getResolution();let i="unsupported";try{const e=this.camera.getCameraCapabilities();i=null!=e&&e.torch?"supported":"unsupported";}catch(e){}this.torchSupported="supported"===i,this.viewer.hooks.torchChanged.emit({torchState:i}),"supported"===i&&e&&this.turnOnTorch().catch((()=>{this.config.enableTorch=!0;})),this.viewer.hooks.cameraPlayed.emit({resolution:t}),this.loop.updateVideoLayout(),this.loop.closeLoop(),this.loop.startLoop();})),e.on("closed",(()=>{this.isVideoPlaying||(this.loop.closeLoop(),this.viewer.hooks.cameraClosed.emit(),this.viewer.hooks.torchChanged.emit({torchState:"unsupported"}));}));}getVPointerEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=0,o=0,r=0,n=0;if(t){const{left:e,top:i}=t.getBoundingClientRect();r=e,n=i;}return e instanceof PointerEvent||e instanceof MouseEvent?(s=e.offsetX,o=e.offsetY):i?(s=e.changedTouches[0].clientX-r,o=e.changedTouches[0].clientY-n):(s=e.touches[0].clientX-r,o=e.touches[0].clientY-n),{index:-1,pageUid:"",imageX:-1,imageY:-1,canvasX:Math.floor(s),canvasY:Math.floor(o),nativeEvent:e}}triggerPlayed(e){this.viewer.emit("played",{resolution:e,deviceId:this.camera.getCamera().deviceId});}bindNativeEvents(){const e=this.canvasEl;if(!e)return;const t=e=>{const t=this.getVPointerEvent(e);this.viewer.emit("click",t);},i=e=>{this.viewer.emit("dblclick",this.getVPointerEvent(e));},s=e=>{e.preventDefault();const t=this.getVPointerEvent(e);this.viewer.emit("rightclick",t);},o=()=>{setTimeout((()=>{this.resize();}),500);},r=()=>{this.isVideoPlaying&&(this.loop.closeLoop(),"visible"===document.visibilityState&&this.loop.startLoop());};e.addEventListener("click",t),e.addEventListener("dblclick",i),e.addEventListener("contextmenu",s),document.addEventListener("visibilitychange",r),window.addEventListener("orientationchange",o),this.viewer.hooks.destroy.on((()=>{e.removeEventListener("click",t),e.removeEventListener("dblclick",i),e.removeEventListener("contextmenu",s),document.removeEventListener("visibilitychange",r),window.removeEventListener("orientationchange",o);}));}get isCaptureViewer(){return this.viewer.context.viewerConfig.viewerMode===sl.CAPTURE}get isVideoPlaying(){return !!this.camera&&this.camera.isVideoPlaying}async getFrontCamera(){if(!this.isHttps)return Zl.reject(Zl.CAMERA_NEEDHTTPS);const e=await mv.testCameraAccess({video:{facingMode:{exact:"user"}}});return Promise.resolve(e.ok)}convertCamera(){if(!this.canFrontCamera)return Promise.reject();if("opening"===this.camera.state)return Promise.resolve();if(!this.bUser){const e=this.getCamera().deviceId;return this.camera.switchToFrontCamera().then((()=>(this.bUser=!0,this.lastEnvironmentCameraId=e,this.torchSupported&&this.viewer.hooks.torchChanged.emit({torchState:"unsupported"}),Promise.resolve())))}return this.setCamera(this.lastEnvironmentCameraId).then((()=>(this.bUser=!1,this.torchSupported&&this.viewer.hooks.torchChanged.emit({torchState:"supported"}),Promise.resolve())))}getFrameData(){if(!this.config.fullscreen)return this.camera.getFrameData();const{width:e,height:t}=this.videoEl.getBoundingClientRect(),i=this.videoEl.videoWidth,s=this.videoEl.videoHeight,o=Math.max(e/i,t/s),r=e/(i*o),n=t/(s*o),a=Math.floor((1-r)/2*i),l=Math.floor((1-n)/2*s),h=Math.floor(i*r),c=Math.floor(s*n);return this.camera.getFrameData({position:{sx:a,sy:l,sWidth:h,sHeight:c,dWidth:h,dHeight:c}})}updateCameraConfig(e){for(const[t,i]of Object.entries(e)){const e=this.configHandler[t];e&&!W(i)&&e(this,i);}}bindCameraVideo(e){e instanceof HTMLVideoElement&&(this.camera.setVideoEl(e),this.videoEl=e);}bindCameraCanvas(e){e instanceof HTMLCanvasElement&&(this.canvasEl=e);}async capture(){this.loop.startCaptureAnimation(),await Pv(),this.loop.closeCaptureAnimation(),this.viewer.context.core.errorNotify.Verbose(`[${Date.now()}][cv] start capture`);const e=this.getFrameData();if(this.viewer.context.core.errorNotify.Verbose(`[${Date.now()}][cv] get frame done`),!e)return null;const t={type:1,data:e.data.buffer,width:e.width,height:e.height},i=await this.loop.getDetectResult(t);this.viewer.context.core.errorNotify.Verbose(`[${Date.now()}][cv] get detect result done`),0===e.data.length&&(e.data=new Uint8Array(t.data));const s=await this.viewer.context.core.processService.resize(e.data.buffer,1,e.width,e.height,-1);return this.viewer.context.core.errorNotify.Verbose(`[${Date.now()}][cv] create image done`),this.isCapturedPages=!0,await this.viewer.context.loadSource({fileData:s.data,extraPageData:[{index:0,perspectiveQuad:i.success?i.location:void 0}]}),this.viewer.context.core.errorNotify.Verbose(`[${Date.now()}][cv] capture done`),s.data}async play(e){if(!this.isHttps)return Promise.reject(Zl.CAMERA_NEEDHTTPS);if(!e&&this.isVideoPlaying)return Promise.resolve();const{fill:t,resolution:i}=e||{},s=this.camera.getResolution();if(z(t)&&this.updateCameraConfig({fullscreen:t}),this.isVideoPlaying&&Ev(i)&&i[0]===s.width&&i[1]===s.height)return Promise.resolve();let o=[s.width,s.height];if(Ev(i)){if(this.isVideoPlaying)return this.camera.setResolution(i[0],i[1]).then((e=>(this.resize(),this.triggerPlayed(i),Promise.resolve()))).catch();this.camera.setResolution(i[0],i[1]),o=i;}return !this.isFirstPlayed||this.isVideoPlaying||i||"opening"===this.camera.state||(this.camera.setResolution(1280,720),o=[1280,720]),this.initializing&&await new Promise((e=>{const t=setInterval((()=>{this.initializing||(clearInterval(t),e(""));}),100);})),this.isFirstPlayed&&(this.isFirstPlayed=!1),this.camera.open().then((async()=>(this.resize(),this.triggerPlayed(o),Promise.resolve()))).catch((e=>{let t=Zl.CAMERA_OCCUPIED;return "Permission denied"===e.message&&(t=Zl.CAMERA_DENIED),8===e.code&&(t=Zl.CAMERA_NOCAMERA),Promise.reject(t)}))}stop(){var e;this.loop.closeLoop(),this.viewer.emit("stopped",{deviceId:this.getCamera().deviceId}),null===(e=this.camera)||void 0===e||e.close();}async setCamera(e){let t="";B(e)?t=e.deviceId||"":$(e)&&(t=e);let i=!1;for(let e=0;e<this.cameraList.length;e++)this.cameraList[e].deviceId===t&&(i=!0);if(!i)return Promise.reject(Zl.CAMERA_NOTEXIST);await this.camera.setCamera(t).catch((e=>{let t=Zl.CAMERA_OCCUPIED;"Permission denied"===e.message&&(t=Zl.CAMERA_DENIED),8===e.code&&(t=Zl.CAMERA_NOCAMERA),Promise.reject(t);}));const s=this.camera.getResolution(),o={deviceId:t,width:s.width,height:s.height};return this.isVideoPlaying&&this.triggerPlayed([s.width,s.height]),Promise.resolve(o)}getCamera(){const e=this.camera.getCamera();return {deviceId:e.deviceId,label:e.label}}async getCameras(){const e=(await this.camera.getAllCameras()).map((e=>({deviceId:e.deviceId,label:e.label})));return Promise.resolve(e)}async setResolution(e,t){const i=this.camera.getCamera();if(!i||""===i.deviceId)return Promise.reject(Zl.CAMERA_NOTEXIST);let s;if(G(e))s=e;else if(L(e)){const[i,o]=e;s=i,t=o;}let o=this.camera.getResolution();return G(s)&&G(t)&&(this.loop.closeLoop(),o=await this.camera.setResolution(s,t).catch((()=>{}))),this.camera&&this.isVideoPlaying&&this.triggerPlayed([o.width,o.height]),Promise.resolve({deviceId:i.deviceId,...o})}getResolution(){const e=this.camera.getCamera();if(!e||""===e.deviceId)return [0,0];const t=this.camera.getResolution();return [t.width,t.height]}async getResolutions(){const e=(await this.camera.getResolutions()).map((e=>[e.width,e.height]));return Promise.resolve(e)}turnOnTorch(){const e=this.camera.getCamera();return e&&""!==e.deviceId?this.isTurningTorch?Promise.resolve():(this.isTurningTorch=!0,this.camera.turnOnTorch().then((()=>(this.isTurningTorch=!1,this.turnOnTheTorch=!0,this.config.enableTorch=!0,this.viewer.hooks.torchChanged.emit({torchState:"on"}),Promise.resolve()))).catch((e=>(this.isTurningTorch=!1,this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.viewer.hooks.torchChanged.emit({torchState:"off"}),Zl.reject(Zl.CAMERA_NOTSUPPORTTORCH))))):Promise.reject(Zl.CAMERA_NOVIDEO)}turnOffTorch(){const e=this.camera.getCamera();return e&&""!==e.deviceId?this.camera.turnOffTorch().then((()=>(this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.viewer.hooks.torchChanged.emit({torchState:"off"}),Promise.resolve()))).catch((e=>Zl.reject(Zl.CAMERA_NOTSUPPORTTORCH))):Promise.reject(Zl.CAMERA_NOVIDEO)}resize(){const{canvasEl:e}=this,{width:t,height:i}=e.getBoundingClientRect();e.width=Math.floor(t),e.height=Math.floor(i),this.loop.updateVideoLayout();}destroy(){var e,t;this.stop(),null===(e=this.loop)||void 0===e||e.closeLoop(),null===(t=this.camera)||void 0===t||t.dispose(),this.camera=null,this.loop=null,this.videoEl=null,this.canvasEl=null;}}function Ev(e){return !!(L(e)&&G(e[0])&&G(e[1]))}const Av={install(e){const i=e.getClass("Viewer"),s=(o=i,class extends o{constructor(e){if(super(e),t(this,"cameraContext",void 0),this.context.viewerConfig.viewerMode===sl.CAPTURE){this.cameraContext=new Dv(this);const t=kv;B(e.viewerConfig)&&["enableTorch","enableAutoCapture","enableAutoDetect","acceptedPolygonConfidence","maxFrameNumber","autoCaptureDelay"].forEach((i=>{i in e.viewerConfig&&(t[i]=e.viewerConfig[i]);})),this.cameraContext.config={...t,defaultCameraConfig:kv},this.on("resized",(()=>{this.cameraContext.resize();}));}}isVideoPlaying(){return this.cameraContext.isVideoPlaying}convertCamera(){return this.cameraContext.convertCamera()}getCameraConfig(){return U(this.cameraContext.config)}updateCameraConfig(e){B(e)&&this.cameraContext.updateCameraConfig(e);}capture(){return this.cameraContext.capture()}play(e){return this.cameraContext.play(e)}stop(){this.isVideoPlaying()?this.cameraContext.stop():Zl.OutputWarning(Zl.CAMERA_NOVIDEO);}getCurrentCamera(){return this.cameraContext.getCamera()}getAllCameras(){return this.cameraContext.getCameras()}selectCamera(e){return this.cameraContext.setCamera(e)}getCurrentResolution(){return this.cameraContext.getResolution()}getResolutions(){return this.cameraContext.getResolutions()}setResolution(e,t){return this.cameraContext.setResolution(e,t)}turnOnTorch(){return this.cameraContext.turnOnTorch()}turnOffTorch(){return this.cameraContext.turnOffTorch()}destroy(){var e;this.cameraContext&&(null===(e=this.cameraContext)||void 0===e||e.destroy()),this.cameraContext=null,super.destroy();}});var o;e.setClass("Viewer",s);}};class Iv{constructor(e){t(this,"uid",void 0),t(this,"areaUid",void 0),t(this,"isRect",!0),t(this,"vertexes",[]),t(this,"midpoints",[]),t(this,"points",[]),t(this,"keepAspectRatio",!1),t(this,"isConvex",!0),t(this,"renderer",void 0),t(this,"area",void 0),t(this,"slopeRatio",[]),t(this,"selectedPart",-1),t(this,"startX",null),t(this,"startY",null),t(this,"lastX",null),t(this,"lastY",null),t(this,"lastAspectRatio",1),t(this,"b1",void 0),t(this,"b2",void 0),t(this,"k1",void 0),t(this,"k2",void 0),this.uid=q(),Object.assign(this,e),this.initBox(e.vertexes);}initBox(e){this.vertexes=e,this.midpoints=Rv(this.vertexes),this.points=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=Ov(this.vertexes);}getRect(){if(!this.isRect)return null;const{minX:e,maxX:t,minY:i,maxY:s}=this.getBounds();return {left:e,top:i,width:t-e||1,height:s-i||1}}getQuad(){if(this.isRect)return null;const{points:e}=this,t=[];for(let i=0;i<4;i++)t.push([e[2*i],e[2*i+1]]);return t}getActivePartNum(e,t){const i=this.getSelectedCtrlPointNum(e,t);if(i>-1)return i;return this.isPointOnBox(e,t)?8:-1}getSelectedCtrlPointNum(e,t){const{points:i}=this,{width:s,height:o,zoom:r}=this.area,{ctrlWidth:n,ctrlHeight:a,ctrlRadiusMultipleMobile:l}=this.renderer.config.boxStyle;let h=a/2/r,c=n/2/r;j()&&(c*=l,h*=l);const d=X(c,0,3*c),u=X(h,0,3*h);for(let r=0;r<8;r++){const n=i[2*r],a=i[2*r+1];if(e<=n+d&&e>=n-d&&t<=a+u&&t>=a-u&&e>=0-d&&e<=s+d&&t>=0-u&&t<=o+u)return r}return -1}checkOrientation(e){if(e<0||e>7)return null;const{minX:t,maxX:i,minY:s,maxY:o}=this.getBounds(),{points:r}=this,n=r[2*e],a=r[2*e+1];let l="",h="";return n===i?l="e":n===t&&(l="w"),a===o?h="s":a===s&&(h="n"),e<4?h+l:h||l}onStartHandler(e,t,i){var s;if(null!==(s=i)&&void 0!==s||(i=this.getActivePartNum(e,t)),!(i<0)&&(this.startX=e,this.startY=t,this.lastX=e,this.lastY=t,this.selectedPart=i,!this.isRect&&i>3&&i<8)){const{points:e,slopeRatio:t}=this,s=i-4;this.k1=t[(s+1)%4],this.b1=e[(2*s+3)%8]-this.k1*e[(2*s+2)%8],this.k2=t[(s+3)%4],this.b2=e[(2*s+1)%8]-this.k2*e[(2*s+0)%8];}}onMoveHandler(e,t,i){const{selectedPart:s}=this;if(s<0)return;const o=e-this.lastX,r=t-this.lastY;if(0===o&&0===r)return;const{points:n}=this;let a=n.slice();var l;s<8?(null!==(l=i)&&void 0!==l||(i=s),this.isRect?a=this.moveRectPoint(a,i,e,t):(a=this.moveQuadPoint(a,i,e,t),this.slopeRatio=Ov(n).slice(0,4),this.isConvex=Mv(a))):8===s&&(a=this.moveBox(a,o,r));const h=Rv(a);this.points=a.slice(0,8).concat(h),this.midpoints=h,this.lastX=e,this.lastY=t;}onEndHandler(){const{startX:e,startY:t,vertexes:i,midpoints:s,lastX:o,lastY:r,selectedPart:n}=this;if(n<0)return;this.startX=0,this.startY=0,this.selectedPart=-1;let a=this.points.slice();const l=Mv(a);(e===o&&t===r||!l)&&(a=i.slice().concat(s)),this.isConvex=!0,this.vertexes=a.slice(0,8),this.midpoints=Rv(a),this.points=a.slice(0,8).concat(this.midpoints),this.slopeRatio=Ov(a).slice(0,4);}getBounds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.points;return {minX:Math.min(e[0],e[2],e[4],e[6]),maxX:Math.max(e[0],e[2],e[4],e[6]),minY:Math.min(e[1],e[3],e[5],e[7]),maxY:Math.max(e[1],e[3],e[5],e[7])}}moveRectPoint(e,t,i,s){let o=0,r=0;if(this.keepAspectRatio){const{minX:n,maxX:a,minY:l,maxY:h}=this.getBounds(),c=this.checkOrientation(t);let d=(a-n)/(h-l);0===d||d===1/0||d===-1/0||Number.isNaN(d)?d=this.lastAspectRatio:this.lastAspectRatio=d,o=0,r=0;let u="w";if(t<4){if(o=i-e[2*t],r=s-e[2*t+1],0===o||0===r)return e;u="w";}else {const n=t-4,a={e:[(n+1)%4,"w"],s:[n,"h"],w:[n,"w"],n:[(n+1)%4,"h"]};if(["e","s","w","n"].includes(c)&&([t,u]=a[c]),o=i-e[2*n],r=s-e[2*n+1],0===o||0===r)return e}const g=["ne","sw","n","w"];"h"===u?(o=r*d,g.includes(c)&&(o=-o)):(r=o/d,g.includes(c)&&(r=-r));const f=e[2*t]+o,p=e[2*t+1]+r,{width:m,height:v}=this.area;f<0?(o=0-e[2*t],r=0):f>m?(o=m-e[2*t],r=0):p<0?(r=0-e[2*t+1],o=0):p>v&&(r=v-e[2*t+1],o=0),e[2*t]+=o,e[2*t+1]+=r;const y=(t+1)%4,w=(t+3)%4;t%2?(e[2*y]+=o,e[2*w+1]+=r):(e[2*y+1]+=r,e[2*w]+=o);}else if(t<4){if(o=i-e[2*t],r=s-e[2*t+1],0===o&&0===r)return e;e[2*t]=i,e[2*t+1]=s;const n=(t+1)%4,a=(t+3)%4;t%2?(e[2*n]=i,e[2*a+1]=s):(e[2*n+1]=s,e[2*a]=i);}else {const o=t-4,r=this.slopeRatio[o%4];0===r?(e[(2*o+3)%8]=s,e[(2*o+1)%8]=s):r!==1/0&&r!==-1/0||(e[(2*o+2)%8]=i,e[(2*o+0)%8]=i);}return e}moveQuadPoint(e,t,i,s){const o=e.slice();if(t<4){const o=i-e[2*t],r=s-e[2*t+1];if(0===o&&0===r)return e;e[2*t]=i,e[2*t+1]=s;}else {const r=t-4,n=this.slopeRatio[r%4],a=s-n*i,l=-a/n,h=a,c=e[(2*r+9)%8]-n*e[(2*r+8)%8],d=-c/n,{k1:u,b1:g,k2:f,b2:p}=this;0===n?(e[(2*r+3)%8]=s,u!==1/0&&u!==-1/0&&(e[(2*r+2)%8]=(s-g)/u),e[(2*r+1)%8]=s,f!==1/0&&f!==-1/0&&(e[(2*r+0)%8]=(s-p)/f)):n===1/0||n===-1/0?(e[(2*r+2)%8]=i,e[(2*r+3)%8]=u*i+g,e[(2*r+0)%8]=i,e[(2*r+1)%8]=f*i+p):(0===u?e[(2*r+2)%8]+=l-d:u===1/0||u===-1/0?e[(2*r+3)%8]+=h-c:(e[(2*r+2)%8]=(g-a)/(n-u),e[(2*r+3)%8]=(n*g-u*a)/(n-u)),0===f?e[(2*r+0)%8]+=l-d:f===1/0||f===-1/0?e[(2*r+1)%8]+=h-c:(e[(2*r+0)%8]=(p-a)/(n-f),e[(2*r+1)%8]=(n*p-f*a)/(n-f)));for(let t=0;t<4;t++){const i=e[2*t],s=e[2*t+1];if(i<0||i>this.area.width||s<0||s>this.area.height)return o}}return e}moveBox(e,t,i){const{minX:s,maxX:o,minY:r,maxY:n}=this.getBounds(e);t=X(t,-s,this.area.width-o),i=X(i,-r,this.area.height-n);for(let s=0;s<4;s++)e[2*s]+=t,e[2*s+1]+=i;return e}isPointOnBox(e,t){if(this.isRect){const{minX:i,maxX:s,minY:o,maxY:r}=this.getBounds();return e>=i&&e<=s&&t>=o&&t<=r}const i=[...this.vertexes],s=[...this.midpoints],o=[];for(let e=0;e<4;e++)o.push([i[2*e],i[2*e+1]]),o.push([s[2*e],s[2*e+1]]);return function(e,t){let i,s,o,r,n=0;const a=t.length;for([o]=t,i=1;i<=a;i++)r=t[i%a],e[0]>Math.min(o[0],r[0])&&e[0]<=Math.max(o[0],r[0])&&e[1]<=Math.max(o[1],r[1])&&o[0]!==r[0]&&(s=(e[0]-o[0])*(r[1]-o[1])/(r[0]-o[0])+o[1],(o[1]===r[1]||e[1]<=s)&&(n+=1)),o=r;if(n%2==0)return !1;return !0}([e,t],o)}}function Mv(e){const[t,i,s,o,r,n,a,l]=e,h=(a-t)*(o-i)-(l-i)*(s-t),c=(t-s)*(n-o)-(i-o)*(r-s),d=(s-r)*(l-n)-(o-n)*(a-r),u=(r-a)*(i-l)-(n-l)*(t-a);if(h*c*d*u<0)return !1;const g=e.slice().concat(e.slice(0,2)),f=Ov(e);if(f.length)for(let e=0;e<2;e++)if(f[e]!==f[e+2]){if(_v(g.slice(2*e,2*(e+1)),g.slice(2*(e+1),2*(e+2)),g.slice(2*(e+2),2*(e+3)),g.slice(2*(e+3),2*(e+4))))return !1}return h*c*d*u>0}function Rv(e){const t=e.slice(0,8).concat(e[0],e[1]),i=[];for(let e=0;e<4;e++){const s=(t[2*e]+t[2*(e+1)])/2,o=(t[2*e+1]+t[2*(e+1)+1])/2;i.push(s,o);}return i}function Ov(e){const t=[];let i=null;const s=e.slice(0,8).concat(e[0],e[1]);for(let e=0;e<4;e++){const o=s[2*(e+1)+1]-s[2*e+1],r=s[2*(e+1)]-s[2*e];i=0===o&&0===r?0:o/r,t.push(i);}return t}function _v(e,t,i,s){if(function(e,t,i,s){const o=Math.min(e[0],t[0])<=Math.max(i[0],s[0])&&Math.min(i[0],s[0])<=Math.max(e[0],t[0])&&Math.min(e[1],t[1])<=Math.max(i[1],s[1])&&Math.min(i[1],s[1])<=Math.max(e[1],t[1]);return o}(e,t,i,s)&&function(e,t,i,s){let o=e[0]*(i[1]-t[1])+t[0]*(e[1]-i[1])+i[0]*(t[1]-e[1]),r=e[0]*(s[1]-t[1])+t[0]*(e[1]-s[1])+s[0]*(t[1]-e[1]);return !((o^r)>=0&&0!==o&&0!==r||(o=i[0]*(e[1]-s[1])+s[0]*(i[1]-e[1])+e[0]*(s[1]-i[1]),r=i[0]*(t[1]-s[1])+s[0]*(i[1]-t[1])+t[0]*(s[1]-i[1]),(o^r)>=0&&0!==o&&0!==r))}(e,t,i,s)){let o=(s[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-s[1]),r=(e[1]-i[1])*(t[0]-e[0])*(s[0]-i[0])+i[0]*(s[1]-i[1])*(t[0]-e[0])-e[0]*(t[1]-e[1])*(s[0]-i[0]);if(0===o||0===r){const o=Nv(e,t),r=Nv(i,s),n=o[0],a=o[1],l=r[0],h=r[1];if(a[0]===l[0]&&a[1]===l[1])return a;if(n[0]===h[0]&&n[1]===h[1])return n;if(Lv(a,r)&&Lv(l,o))return [l,a];if(Lv(n,r)&&Lv(h,o))return [n,h];if(Lv(n,r)&&Lv(a,r))return [n,a];if(Lv(l,r)&&Lv(h,r))return [l,h]}const n=r/o;o=(e[0]-t[0])*(s[1]-i[1])-(t[1]-e[1])*(i[0]-s[0]),r=t[1]*(e[0]-t[0])*(s[1]-i[1])+(s[0]-t[0])*(s[1]-i[1])*(e[1]-t[1])-s[1]*(i[0]-s[0])*(t[1]-e[1]);return [n,r/o]}return !1}function Nv(e,t){return e[0]===t[0]?e[1]<t[1]?[e,t]:[t,e]:e[0]<t[0]?[e,t]:[t,e]}function Lv(e,t){return t[0][0]===t[1][0]?e[1]>=t[0][1]&&e[1]<=t[1][1]:e[0]>=t[0][0]&&e[0]<=t[1][0]}class Bv{constructor(e,i,s){t(this,"areaUid",void 0),t(this,"left",void 0),t(this,"top",void 0),t(this,"width",void 0),t(this,"height",void 0),t(this,"boxes",void 0),t(this,"isVisible",!0),t(this,"zoom",1),t(this,"oldRect",void 0),t(this,"oldQuad",void 0),t(this,"isModified",!1),t(this,"isDrawNewBox",!1),t(this,"activeBoxUid",void 0),t(this,"activePartNum",-1),t(this,"startX",void 0),t(this,"startY",void 0),t(this,"isMouseDown",!1),t(this,"isDrawing",!1),t(this,"renderer",void 0),this.renderer=e,this.areaUid=i,this.boxes=[],this.updateAreaRect(s);}hasActiveBox(){return !!this.activeBoxUid}getFullVertexes(){return [0,0,this.width,0,this.width,this.height,0,this.height]}isContainRect(e){return e.left>=0&&e.left<=this.width&&e.left+e.width<=this.width&&e.top>=0&&e.top<=this.height&&e.top+e.height<=this.height}isContainBox(e){const t=e.getRect();return this.isContainRect(t)}isFullBox(e){const{vertexes:t}=e;return 0===t[0]&&0===t[1]&&t[2].toFixed(2)===this.width.toFixed(2)&&0===t[3]&&t[4].toFixed(2)===this.width.toFixed(2)&&t[5].toFixed(2)===this.height.toFixed(2)&&0===t[6]&&t[7].toFixed(2)===this.height.toFixed(2)}addRectBox(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e=this.handleBoundary(e),this.addBox(e,!0,t)}updateRectBox(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=e.getRect(),o=e.getQuad();if(t=this.handleBoundary(t),e.initBox(t),i){const t={box:e};e.isRect?(t.oldRect=s,t.newRect=e.getRect()):(t.oldQuad=o,t.newQuad=e.getQuad()),this.renderer.hooks.boxModified.emit(t);}}handleBoundary(e){e=[...e];for(let t=0;t<4;t++){const i=[e[2*t],e[2*t+1]];i[0]=X(i[0],0,this.width),i[1]=X(i[1],0,this.height),[e[2*t],e[2*t+1]]=i;}return e}addQuadBox(e){return this.addBox(e,!1)}addBox(e){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=new Iv({isRect:!(arguments.length>1&&void 0!==arguments[1])||arguments[1],area:this,renderer:this.renderer,vertexes:[...e],keepAspectRatio:this.renderer.config.keepAspectRatio});return this.boxes.push(i),t&&this.renderer.hooks.boxCreated.emit(i),i}getBoxRects(){return this.boxes.map(((e,t)=>({index:t,...e.getRect()})))}getBoxByUid(e){return this.boxes.find((t=>t.uid===e))}deleteBoxByUid(e){const t=this.boxes.findIndex((t=>t.uid===e));t>-1&&this.boxes.splice(t,1);}clearBoxes(){this.boxes.length=0;}updateAreaRect(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height;}setKeepAspectRatio(e){this.isDrawing||this.boxes.forEach((t=>{t.keepAspectRatio=e;}));}isTouchedPoint(e,t){return e=X(e,0,this.width),t=X(t,0,this.height),this.boxes.some((i=>{const s=i.getActivePartNum(e,t);return s>-1&&s<8}))}onStartHandler(e,t){this.isMouseDown=!0,e=X(e,0,this.width),t=X(t,0,this.height),this.startX=e,this.startY=t;const i=this.boxes.find((i=>{const s=i.getActivePartNum(e,t);return s>-1&&(this.activePartNum=s),s>-1}));i&&(this.oldRect=i.getRect(),this.oldQuad=i.getQuad(),this.activeBoxUid=i.uid,i.keepAspectRatio=this.renderer.config.keepAspectRatio,i.onStartHandler(e,t));}onMoveHandler(e,t,i){if(!this.isMouseDown)return;let s;if(e=X(e,0,this.width),t=X(t,0,this.height),this.activeBoxUid){s=this.getBoxByUid(this.activeBoxUid);const{keepAspectRatioWithShift:o,keepAspectRatio:r,enableMoveQuad:n}=this.renderer.config;if(s.isRect)s.keepAspectRatio=!(!i||!o)||r;else if(!n&&8===this.activePartNum)return;return s.onMoveHandler(e,t),void(this.isModified=!0)}const{enableCreateBoxByPointer:o,enableMultiple:r}=this.renderer.config;if((r||!this.boxes.length)&&o){const{startX:i,startY:o}=this;let r=t-o;const n=e-i;let a=-1;const l=2/this.zoom;if(n<-l&&r<-l?a=0:n>l&&r<-l?a=1:n>l&&r>l?a=2:n<-l&&r>l&&(a=3),a>-1){const{aspectRatio:l}=this.renderer.config;l>0&&(r=n/l,a%2&&(r=-n/l));const h=[],c=a%2?[i,o,i,o+r,e,o+r,e,o]:[e,o+r,i,o+r,i,o,e,o];for(let e=0;e<4;e++)h.push(c[2*(a+e)%8]),h.push(c[(2*(a+e)+1)%8]);s=this.addRectBox(h,!1),this.isDrawNewBox=!0,s.keepAspectRatio=l>0,this.isDrawing=!0,this.activeBoxUid=s.uid,s.onStartHandler(this.startX,this.startY,a),s.onMoveHandler(e,t,a);}}}onEndHandler(){if(!this.isMouseDown||!this.activeBoxUid)return;this.isMouseDown=!1;const e=this.getBoxByUid(this.activeBoxUid);if(e.keepAspectRatio=this.renderer.config.keepAspectRatio,e.onEndHandler(),this.isDrawNewBox)this.isDrawNewBox=!1,this.renderer.hooks.boxCreated.emit(e);else if(this.isModified){const t={box:e};e.isRect?(t.oldRect=this.oldRect,t.newRect=e.getRect()):(t.oldQuad=this.oldQuad,t.newQuad=e.getQuad()),this.renderer.hooks.boxModified.emit(t);}this.oldRect=null,this.oldQuad=null,this.isModified=!1,this.isDrawing=!1,this.activeBoxUid=null,this.activePartNum=-1;}isPointHover(e){let[t,i]=e;return t>=0&&t<=this.width&&i>=0&&i<=this.height}getCursorInfo(e,t){for(let i=this.boxes.length-1;i>=0;i--){const s=this.boxes[i],o=s.getActivePartNum(e,t);if(o>-1){let e="move";return o<8&&(e=s.checkOrientation(o)),{part:o,position:e,isRect:s.isRect}}}return null}}const Uv={aspectRatio:0,keepAspectRatio:!1,keepAspectRatioWithShift:!0,enableMultiple:!1,enableCreateBoxByPointer:!0,enableCursor:!0,enableMask:!0,enableMagnifier:!0,moveThreshold:2,enableMoveQuad:!1,magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2},boxStyle:{borderColor:"orange",borderWidth:2,borderStyle:[5,2],background:"rgba(255,255,255,0)",ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlWidth:16,ctrlHeight:16,ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",ctrlRadiusMultipleMobile:2},defaultCursor:"default"};class Wv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,"areas",void 0),t(this,"scrollTop",0),t(this,"scrollLeft",0),t(this,"zoom",1),t(this,"config",void 0),t(this,"canvasDom",void 0),t(this,"isMousedown",!1),t(this,"hoveredArea",void 0),t(this,"hooks",{boxCreated:te(),boxModified:te(),boxDeleted:te()}),this.areas=new Map,this.zoom=1,this.config=U(Uv),je(e,this.config),this.setCanvasDom(e.canvas);}setCanvasDom(e){e&&(this.canvasDom=e);}updateConfig(e){je(e,this.config);}addArea(e,t){if(this.areas.has(e))return this.areas.get(e);const i=new Bv(this,e,t);return this.areas.set(e,i),i}deleteArea(e){if(this.areas.has(e)){this.areas.get(e).boxes.forEach((e=>{this.hooks.boxDeleted.emit(e);})),this.areas.delete(e);}}clearArea(){this.areas.forEach((e=>{e.boxes.forEach((e=>{this.hooks.boxDeleted.emit(e);}));})),this.areas.clear();}clearAreaBoxes(e){if(this.areas.has(e)){const t=this.areas.get(e);t.boxes.forEach((e=>{this.hooks.boxDeleted.emit(e);})),t.clearBoxes();}}addRectBox(e,t){return this.areas.get(t).addRectBox(e)}addQuadBox(e,t){return this.areas.get(t).addQuadBox(e)}updateOptions(e){Object.assign(this,e),G(e.zoom)&&this.areas.forEach((t=>{t.zoom=e.zoom;}));}getAreaByUid(e){return this.areas.get(e)}deleteAreaByUid(e){this.areas.delete(e);}getHoveredArea(e){const t=this.nativeToCanvas(e);for(const e of this.areas.values()){const i=this.canvasToArea(t,e);if(e.isPointHover(i)&&e.isVisible)return e}return null}getHoveredAreaForCursor(e){const t=this.nativeToCanvas(e);for(const e of this.areas.values()){const i=this.canvasToArea(t,e),[s,o]=i,r=e.isVisible&&e.boxes.find((e=>e.getActivePartNum(s,o)>-1));if(e.isPointHover(i)||r)return e}return null}isControlPointTouched(e){const t=this.getHoveredArea(e);if(!t||!t.isVisible)return !1;const i=this.nativeToCanvas(e),[s,o]=this.canvasToArea(i,t);return t.isTouchedPoint(s,o)}onStartHandler(e){const t=this.getHoveredArea(e);if(!t||!t.isVisible)return;this.hoveredArea=t,this.isMousedown=!0;const i=this.nativeToCanvas(e),[s,o]=this.canvasToArea(i,t);t.onStartHandler(s,o);}onMoveHandler(e){if(!this.canvasDom)return;const t=this.getHoveredArea(e);if(t){if(!t.isVisible)return}else this.canvasDom.style.cursor=this.config.defaultCursor;const i=this.nativeToCanvas(e);if(this.isMousedown){const[t,s]=this.canvasToArea(i,this.hoveredArea);this.hoveredArea.onMoveHandler(t,s,e.shiftKey);}else if(this.config.enableCursor&&t){const{canvasDom:e}=this;if(!this.hasBox())return void("crosshair"!==e.style.cursor&&(e.style.cursor="crosshair"));const[s,o]=this.canvasToArea(i,t),r=t.getCursorInfo(s,o);let n;n=null===r?this.config.enableMultiple?"crosshair":this.config.defaultCursor:r.isRect?"move"===r.position?"move":`${r.position}-resize`:r.part>-1&&r.part<8?"crosshair":this.config.defaultCursor,e.style.cursor=n;}}hasBox(){for(const e of this.areas.values())if(e.isVisible&&e.boxes.length)return !0;return !1}onEndHandler(e){this.isMousedown&&(this.isMousedown=!1,this.hoveredArea.onEndHandler(),this.hoveredArea=null);}render(){if(!this.canvasDom||!this.areas.size)return;const e=this.canvasDom.getContext("2d");e.setTransform(1,0,0,1,0,0),this.areas.forEach((t=>{t.isVisible&&t.boxes.length&&this.renderArea(e,t);}));}renderArea(e,t){const{borderStyle:i,borderColor:s,borderWidth:o,ctrlBorderColor:r,ctrlBackground:n,ctrlBorderWidth:a,ctrlBorderStyle:l,background:h,maskColor:c,invalidBorderColor:d,invalidCtrlBorderColor:u,ctrlBorderRadius:g,ctrlWidth:f,ctrlHeight:p}=this.config.boxStyle,m=devicePixelRatio,v=f*m,y=p*m,w=Math.min(g*m,v/2,y/2),b=[i[0]*m,i[1]*m],x=o*m,C=a*m,S=[l[0]*m,l[1]*m];e.save(),e.beginPath(),e.rect(t.left*m,t.top*m,t.width*t.zoom*m,t.height*t.zoom*m),e.closePath(),e.clip(),this.config.enableMask&&c&&(e.save(),e.beginPath(),e.rect(t.left*m,t.top*m,t.width*t.zoom*m,t.height*t.zoom*m),t.boxes.forEach((i=>{let s=this.areaPointsToCanvas(i.points.slice(0,8),t),o=this.areaPointsToCanvas(i.midpoints.slice(0,8),t);1!==m&&(s=s.map((e=>e*m)),o=o.map((e=>e*m))),e.moveTo(s[0],s[1]);for(let t=1;t<4;t++)e.lineTo(s[2*t],s[2*t+1]);})),e.closePath(),e.clip("evenodd"),e.fillStyle=c,e.fill(),e.restore()),t.boxes.forEach((i=>{let o=this.areaPointsToCanvas(i.points.slice(0,8),t),a=this.areaPointsToCanvas(i.midpoints.slice(0,8),t);1!==m&&(o=o.map((e=>e*m)),a=a.map((e=>e*m))),e.save(),e.setLineDash(b),e.strokeStyle=i.isConvex?s:d,e.fillStyle=""===h?"transparent":h,e.lineWidth=x,e.beginPath(),e.moveTo(o[0],o[1]);for(let t=1;t<4;t++)e.lineTo(o[2*t],o[2*t+1]);e.closePath(),e.fill(),e.stroke(),e.setLineDash(S),e.strokeStyle=i.isConvex?r:u,e.fillStyle=""===n?"transparent":n,e.lineWidth=C,this.drawCtrlPoints(e,o,v,y,w),this.drawCtrlPoints(e,a,v,y,w),e.restore();})),e.restore();}drawCtrlPoints(e,t,i,s,o){const r=i/2,n=s/2;for(let a=0;a<4;a++){e.beginPath();const l=t[2*a],h=t[2*a+1];if(0===o)e.rect(l-r,h-n,i,s);else {const{PI:t}=Math;e.arc(l-r+o,h-n+o,o,t,3*t/2),e.arc(l+r-o,h-n+o,o,3*t/2,2*t),e.arc(l+r-o,h+n-o,o,0,t/2),e.arc(l-r+o,h+n-o,o,t/2,t);}e.closePath(),e.fill(),e.stroke();}}areaPointsToCanvas(e,t){const i=[];for(let s=0;s<4;s++){const[o,r]=this.areaToCanvas([e[2*s],e[2*s+1]],t);i.push(o,r);}return i}canvasToArea(e,t){let[i,s]=e;const{scrollLeft:o,scrollTop:r,zoom:n}=this;return i=(i-t.left+o)/n,s=(s-t.top+r)/n,[i,s]}areaToCanvas(e,t){let[i,s]=e;const{scrollLeft:o,scrollTop:r,zoom:n}=this;return i=i*n+t.left-o,s=s*n+t.top-r,[i,s]}nativeToCanvas(e){const t=function(e){return ["touchstart","touchend","touchmove"].includes(e.type)}(e)?e.targetTouches[0]:e,i=this.canvasDom.getBoundingClientRect(),{scrollX:s,scrollY:o}=window;return [t.pageX-s-i.left,t.pageY-o-i.top]}}class Vv{constructor(e,i){t(this,"context",void 0),t(this,"core",void 0),t(this,"boxRenderer",void 0),t(this,"viewer",void 0),t(this,"isMousedown",!1),this.viewer=e,this.context=e.context,this.core=e.context.core,this.boxRenderer=i;}mousedown(e){const{context:t}=this,i=this.context.getActiveDocTab();if(null==i||!i.total)return;if("crop"!==this.context.viewerConfig.toolMode)return;const[s]=this.context.formatTouches(e),{page:o}=this.context.getPointerOverPageInfo(s.pageX,s.pageY).pageInfo;if(i&&o&&o.uid!==i.currentUid){const e=i.getPageIndex(o);i.gotoPage(e),this.context.emitPageChangedEvent(i),this.context.core.globalHooks.currentChangedByScroll.emit({viewerUid:t.uid,docUid:i.uid,groupUid:t.groupUid,current:e}),this.context.emitPageChangedAfterRenderEvent(i);}this.isMousedown=!0,this.boxRenderer.onStartHandler(e);let r=!1;const{hoveredArea:n}=this.boxRenderer;(!n||n.boxes.length&&!n.hasActiveBox())&&(r=!0),this.context.canMoveInCropMode=r;}mousemove(e){const t=this.context.getActiveDocTab();null!=t&&t.total&&"crop"===this.context.viewerConfig.toolMode&&(window.TouchEvent&&e instanceof TouchEvent&&e.cancelable&&e.preventDefault(),this.boxRenderer.onMoveHandler(e),this.isMousedown&&this.context.render());}mouseup(e){this.isMousedown&&(this.boxRenderer.onEndHandler(e),this.context.canMoveInCropMode=!1,this.isMousedown=!1,this.context.render());}afterPerspective(e){let{pageUid:t,docUid:i,width:s,height:o}=e;const{context:r}=this,n=r.getTab(i);if(!n)return;const a=n.getPageByUid(t);if(a&&(a.rWidth=s,a.rHeight=o),n.isActive){if("crop"===r.viewerConfig.toolMode){this.boxRenderer.areas.forEach((e=>{e.clearBoxes();}));const e=this.boxRenderer.getAreaByUid(t),i=n.getPageByUid(t).getRect();null==e||e.updateAreaRect(i);}a&&(a.isLoaded=!1),r.scrollReason="currentChanged",r.showTab(n);}}afterRotatePages(e){const{context:t}=this;if("crop"!==t.viewerConfig.toolMode)return;const i=this.context.getActiveDocTab();null!=i&&i.total&&i.uid===e.docUid&&(this.boxRenderer.areas.forEach((e=>{e.clearBoxes();})),e.pageUids.forEach((e=>{const t=this.boxRenderer.getAreaByUid(e),s=i.getPageByUid(e).getRect();null==t||t.updateAreaRect(s);})),this.context.render());}afterRender(e){const{context:t}=this;"crop"===t.viewerConfig.toolMode&&(e.pages.forEach((t=>{const i=this.boxRenderer.getAreaByUid(t.uid);if(i){if(t.isVisible){const e=t.getRect();i.updateAreaRect(e);}"current"===this.viewer.cropMode?i.isVisible=t.uid===e.currentUid:i.isVisible=t.isVisible;}})),this.boxRenderer.updateOptions({zoom:e.context.zoom}),this.boxRenderer.render());}toolModeChanged(e){if("crop"!==e.oldToolMode&&"crop"===e.newToolMode){const e=this.context.getActiveDocTab();if(!e)return;e.pages.forEach((t=>{const i=t.getRect(),s=this.boxRenderer.addArea(t.uid,i);"current"===this.viewer.cropMode?s.isVisible=t.uid===e.currentUid:s.isVisible=t.isVisible;})),this.boxRenderer.updateOptions({zoom:e.context.zoom});}else "crop"!==e.newToolMode&&"crop"===e.oldToolMode&&(this.boxRenderer.clearArea(),this.context.render());}pageChanged(e){if("crop"!==this.context.viewerConfig.toolMode)return;return this.context.getActiveDocTab()?0===e.total?(this.clearRedundantBoxes(),this.boxRenderer.clearArea(),void this.context.render()):void("current"===this.viewer.cropMode&&this.resetPageCropArea()):void 0}deletePages(e){"crop"===this.context.viewerConfig.toolMode&&e.pageUids.forEach((e=>{this.boxRenderer.deleteArea(e);}));}updatePage(e){const{context:t}=this;if("crop"!==t.viewerConfig.toolMode)return;const i=t.getActiveDocTab();if(i&&i.uid===e.docUid&&("current"===this.viewer.cropMode&&e.pageUid===i.currentUid&&this.resetPageCropArea(),"all"===this.viewer.cropMode)){const s=this.boxRenderer.getAreaByUid(e.pageUid),o=i.getPageByUid(e.pageUid).getRect();s.updateAreaRect(o),this.boxRenderer.areas.forEach((e=>{e.clearBoxes();})),t.render();}}addPages(e){const t=this.context.getActiveDocTab();null!=t&&t.total&&t.uid===e.docUid&&(e.pageUids.forEach((e=>{const i=t.getPageByUid(e),s=i.getRect();this.boxRenderer.addArea(i.uid,s),this.boxRenderer.updateOptions({zoom:t.context.zoom});})),this.boxRenderer.areas.forEach((e=>{e.clearBoxes();})));}resetPageCropArea(){const e=this.context.getActiveDocTab();this.clearRedundantBoxes();const t=e.getCurrentPage(),i=t.getRect();this.boxRenderer.addArea(t.uid,i),this.boxRenderer.updateOptions({zoom:e.context.zoom}),this.context.render();}clearRedundantBoxes(){const e=this.context.getActiveDocTab();e&&"current"===this.viewer.cropMode&&this.boxRenderer.areas.forEach((t=>{t.areaUid!==e.currentUid&&this.boxRenderer.clearAreaBoxes(t.areaUid);}));}}class Fv{constructor(e,i){t(this,"context",void 0),t(this,"core",void 0),t(this,"boxRenderer",void 0),t(this,"viewer",void 0),t(this,"isMousedown",!1),t(this,"canSlide",!1),t(this,"isStart",!1),t(this,"startX",void 0),t(this,"isSliding",void 0),t(this,"slideDistance",void 0),t(this,"slideDirection",void 0),t(this,"slideTimer",void 0),t(this,"tabX",void 0),t(this,"tabY",void 0),this.viewer=e,this.context=e.context,this.core=e.context.core,this.boxRenderer=i;}mousedown(e){const t=this.context.getActiveDocTab();if(null==t||!t.total)return;this.isMousedown=!0;!this.boxRenderer.isControlPointTouched(e)&&this.context.viewerConfig.enableSlide?(this.canSlide=!0,this.slideStart(e)):this.boxRenderer.onStartHandler(e);}mousemove(e){const t=this.context.getActiveDocTab();null!=t&&t.total&&(window.TouchEvent&&e instanceof TouchEvent&&e.cancelable&&e.preventDefault(),this.canSlide?this.slideMove(e):(this.boxRenderer.onMoveHandler(e),this.isMousedown&&this.context.render()));}mouseup(e){this.isMousedown&&(this.canSlide?this.slideEnd(e):this.boxRenderer.onEndHandler(e),this.canSlide=!1,this.isMousedown=!1,this.context.render());}reRender(){const{context:e}=this,t=e.getActiveDocTab();null!=t&&t.total&&"visible"===e.viewerConfig.visibility&&(this.updatePageQuad(t),e.render());}updatePage(e){const{context:t}=this,i=t.getActiveDocTab();null!=i&&i.total&&"visible"===t.viewerConfig.visibility&&i.currentUid===e.pageUid&&(this.updatePageQuad(i),t.render());}afterRender(e){if(null==e||!e.total)return;const{boxRenderer:t}=this;e.pages.forEach((e=>{const i=t.getAreaByUid(e.uid);if(i&&e.isVisible){const t=e.getRect();i.updateAreaRect(t);}})),t.updateOptions({zoom:e.context.zoom}),t.render();}pageChanged(e){if(-1===e.current&&0===e.total)return void this.boxRenderer.clearArea();const t=this.context.getActiveDocTab();t&&this.updatePageQuad(t);}updatePageQuad(e){const{context:t}=this,i=e.getCurrentPage();if(!i)return !1;let s=null;const o=this.boxRenderer.getAreaByUid(i.uid);o&&o.boxes[0]&&(s=o.boxes[0].getQuad());const r=t.core.pageService.getPage(e.currentUid);this.boxRenderer.clearArea();const n=i.getRect(),a=this.boxRenderer.addArea(i.uid,n);this.boxRenderer.updateOptions({zoom:e.context.zoom});const l=r.getQuadVertices(),h=a.addQuadBox(l);let c=h.getQuad();t.hooks.perspectiveQuadChanged.emit({quad:h.getQuad(),isFull:r.isFull}),s&&(s=r.quadToPixelPPI(s)),c&&(c=r.quadToPixelPPI(c)),Hc(s),Hc(c);let d=!1;return s&&c&&(d=s.every(((e,t)=>{let[i,s]=e;const[o,r]=c[t];return i===o&&s===r}))),d||t.viewer.emit("quadModified",{oldQuad:s,newQuad:c}),h}afterRotatePages(e){const t=this.context.getActiveDocTab();null!=t&&t.total&&e.pageUids.includes(t.currentUid)&&(this.updatePageQuad(t),this.context.render());}afterPerspective(e){let{pageUid:t,docUid:i}=e;const{context:s}=this,o=this.context.getActiveDocTab();if(null==o||!o.total)return;if(o.uid!==i||o.currentUid!==t)return;const r=o.getCurrentPage();r&&(r.isLoaded=!1),this.updatePageQuad(o),s.scrollReason="currentChanged",s.showTab(o);}slideStart(e){if(!this.context.viewerConfig.enableSlide)return;if(this.isSliding)return;const t=this.context.getActiveDocTab();if(null==t||!t.total)return;const{scrollLeft:i,scrollTop:s}=this.context.viewService.getMaxScrollValue();if(i||s)return;const o=this.context.formatTouches(e);if(o.length>1)return;const r=t.getPosition();this.tabX=r.x,this.tabY=r.y,this.startX=o[0].pageX,this.isStart=!0;}slideMove(e){if(!this.isStart)return;const{context:t}=this,{viewerConfig:i}=t,s=t.getActiveDocTab(),o=t.formatTouches(e)[0].pageX-this.startX;if(o>0?this.slideDirection="right":o<0&&(this.slideDirection="left"),this.slideDistance=Math.min(s.context.viewportWidth,Math.abs(o)),this.isSliding)"right"===this.slideDirection?s.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&s.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),t.render();else if("single"===s.context.displayMode&&"pan"===i.toolMode&&i.enableSlide){const{scrollLeft:e,scrollTop:s}=this.context.viewService.getMaxScrollValue();Math.abs(o)>i.StartSlideThresholdForPerspective&&!e&&!s&&(this.isSliding=!0,t.configService.updateConfig({displayMode:"slide"}));}}slideEnd(e){if(!this.isStart)return;const{context:t}=this;this.context.formatTouches(e,!0);const i=t.getActiveDocTab(),{displayMode:s}=i.context;"slide"===s&&this.slide(i),this.isStart=!1;}slide(e){let t,i=0,s=0,o=0,r=!1;const{viewerConfig:n}=this.context,a=e.context.viewportWidth*n.slideThresholdForPerspective;this.slideDistance>=Math.max(a,n.StartSlideThresholdForPerspective)?(s=e.context.viewportWidth,t=s-this.slideDistance,"left"===this.slideDirection?e.current!==e.total-1?(o=-this.slideDistance,i=-t/8):(s=0,t=this.slideDistance,r=!0,o=-this.slideDistance,i=t/8):0!==e.current?(o=this.slideDistance,i=t/8):(s=0,t=this.slideDistance,r=!0,o=this.slideDistance,i=-t/8)):(r=!0,s=0,t=this.slideDistance,"left"===this.slideDirection?(o=-this.slideDistance,i=t/8):(o=this.slideDistance,i=-t/8)),this.slideTimer=Ee.createTimer((()=>{o+=i;const t=o>=0;if(Math.abs(o)>=s&&(o=s,t||(o*=-1)),e.setPosition({x:o+this.tabX,y:this.tabY,z:0}),Math.abs(o)===s)return r||("right"===this.slideDirection?this.context.viewer.gotoPage(e.current-1):this.context.viewer.gotoPage(e.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void Ee.clearTimer(this.slideTimer);this.context.render();}),25);}}const zv={install(e){const i=e.getClass("Viewer"),s=(o=i,class extends o{constructor(e){super(e),t(this,"boxRenderer",void 0),t(this,"iCropMode","current"),t(this,"cropRectService",void 0),t(this,"perspectiveQuadService",void 0);const{isDefaultViewer:i,isPerspectiveViewer:s}=this.context;(i||s)&&this.initBoxRenderer(),this.cropRectService=new Vv(this,this.boxRenderer),this.perspectiveQuadService=new Fv(this,this.boxRenderer),this.listenDefaultNativeEventsForBox(),this.listenDefaultViewerEventsForBox(),this.listenDefaultGlobalEventsForBox(),this.listenPerspectiveNativeEventsForBox(),this.listenPerspectiveViewerEventsForBox(),this.listenPerspectiveGlobalEventsForBox();}initBoxRenderer(){if(!this.context.isDefaultViewer&&!this.context.isPerspectiveViewer)return;this.boxRenderer=new Wv({defaultCursor:this.context.viewerConfig.canvasStyle.cursor}),this.boxRenderer.setCanvasDom(this.context.rendererService.getCanvasDom()),this.updateQuadStyle(),this.context.hooks.quadSelectionStyleChanged.on((()=>{this.updateQuadStyle();})),this.hooks.resize.on((()=>{this.context.render();}));const{hooks:e}=this.boxRenderer;e.boxCreated.on((e=>{const t=this.context.getActiveDocTab();if(null!=t&&t.total&&(this.context.isDefaultViewer&&e.isRect&&"all"===this.cropMode&&this.boxRenderer.areas.forEach((t=>{t.boxes.length?t.boxes.forEach((i=>{t.isContainBox(e)?t.updateRectBox(i,[...e.vertexes]):t.clearBoxes();})):t.isContainBox(e)&&t.addRectBox([...e.vertexes]);})),e.isRect)){let t=e.getRect();t=this.context.core.pageService.getPage(e.area.areaUid).rectToPixelPPI(t),Hu(t);const i={rect:t};this.hooks.cropRectDrawn.emit(i),this.emit("cropRectDrawn",i);}})),e.boxDeleted.on((e=>{const t=this.context.getActiveDocTab();if(null!=t&&t.total&&e.isRect){let t=e.getRect();t=this.context.core.pageService.getPage(e.area.areaUid).rectToPixelPPI(t),Hu(t);const i={rect:t};this.hooks.cropRectDeleted.emit(i),this.emit("cropRectDeleted",i);}})),e.boxModified.on((e=>{const t=this.context.getActiveDocTab();if(null==t||!t.total)return;const{box:i}=e;if(this.context.isDefaultViewer&&i.isRect){let{oldRect:t,newRect:s}=e,o=0;"all"===this.cropMode&&this.boxRenderer.areas.forEach((e=>{e.boxes.length?e.boxes.forEach((t=>{e.isContainBox(i)?(o+=1,e.updateRectBox(t,[...i.vertexes])):e.clearBoxes();})):e.isContainBox(i)&&e.addRectBox([...i.vertexes]);}));const r=this.context.core.pageService.getPage(i.area.areaUid);if(t&&(t=r.rectToPixelPPI(t)),s&&(s=r.rectToPixelPPI(s)),Hu(t),Hu(s),!t||!s||t.left!==s.left||t.top!==s.top||t.width!==s.width||t.height!==s.height){o=Math.max(1,o);for(let e=0;e<o;e++)this.emit("cropRectModified",{oldRect:t,newRect:s});}}if(this.context.isPerspectiveViewer&&!i.isRect){const t=this.context.core.pageService.getPage(i.area.areaUid),s=this.boxRenderer.getAreaByUid(i.area.areaUid).isFullBox(i);t.isFull=s,t.setActiveQuad(i.getQuad());let{oldQuad:o,newQuad:r}=e;o&&(o=t.quadToPixelPPI(o)),r&&(r=t.quadToPixelPPI(r)),Hc(o),Hc(r),this.hooks.perspectiveQuadChanged.emit({quad:r,isFull:t.isFull});let n=!1;o&&r&&(n=o.every(((e,t)=>{let[i,s]=e;const[o,n]=r[t];return i===o&&s===n}))),n||this.emit("quadModified",{oldQuad:o,newQuad:r});}}));}updateQuadStyle(){const e=this.context.styleService.getParsedQuadSelectionStyle();this.boxRenderer.updateConfig({boxStyle:e});}get cropMode(){return this.iCropMode}set cropMode(e){if(this.iCropMode===e)return;const t=this.iCropMode;this.iCropMode=e;const i=this.context.getActiveDocTab();if(null!=i&&i.total){if("current"===t&&"all"===e){const e=this.boxRenderer.getAreaByUid(i.currentUid).boxes[0];e&&this.boxRenderer.areas.forEach((t=>{t.isContainBox(e)?t.boxes.length?t.updateRectBox(t.boxes[0],[...e.vertexes]):t.addRectBox([...e.vertexes]):t.clearBoxes();}));}this.cropRectService.clearRedundantBoxes(),this.context.render();}}toggleFullPerspective(){const{context:e}=this;if(!e.isPerspectiveViewer)return;const t=e.getActiveDocTab();null!=t&&t.total&&e.core.pageService.getPage(t.currentUid).toggleFull()&&(this.perspectiveQuadService.updatePageQuad(t),e.render());}listenDefaultGlobalEventsForBox(){if(this.context.isPerspectiveViewer)return;const e=e=>{this.cropRectService.afterPerspective(e);},t=e=>{this.cropRectService.afterRotatePages(e);},{globalHooks:i}=this.context.core;i.afterPerspective.on(e),i.afterRotatePages.on(t),this.hooks.destroy.on((()=>{i.afterPerspective.off(e),i.afterRotatePages.off(t);}));}listenPerspectiveGlobalEventsForBox(){if(!this.context.isPerspectiveViewer)return;const{perspectiveQuadService:e}=this,t=t=>{e.afterRotatePages(t);},i=t=>{e.afterPerspective(t);},{globalHooks:s}=this.context.core;s.afterRotatePages.on(t),s.afterPerspective.on(i),this.hooks.destroy.on((()=>{s.afterRotatePages.off(t),s.afterPerspective.off(i);}));}listenPerspectiveViewerEventsForBox(){if(!this.context.isPerspectiveViewer)return;const{perspectiveQuadService:e}=this;this.hooks.resize.on((()=>{e.reRender();})),this.hooks.visibleChanged.on((()=>{e.reRender();})),this.hooks.updatePage.on((t=>{e.updatePage(t);})),this.hooks.afterRender.on((t=>{e.afterRender(t);})),this.hooks.pageChanged.on((t=>{e.pageChanged(t);}));}listenDefaultViewerEventsForBox(){if(!this.context.isDefaultViewer)return;const{cropRectService:e}=this;this.hooks.updatePage.on((t=>{e.updatePage(t);})),this.hooks.addPages.on((t=>{e.addPages(t);})),this.hooks.afterRender.on((t=>{e.afterRender(t);})),this.hooks.toolModeChanged.on((t=>{e.toolModeChanged(t);})),this.hooks.pageChanged.on((t=>{e.pageChanged(t);})),this.hooks.deletePages.on((t=>{e.deletePages(t);})),this.hooks.beforeCropPages.on((()=>{this.clearRectBox();}));}listenPerspectiveNativeEventsForBox(){if(!this.context.isPerspectiveViewer)return;this.boxRenderer.updateConfig({enableCreateBoxByPointer:!1});const e=this.context.rendererService.getCanvasDom(),t=j(),i=t?"touchstart":"mousedown",s=t?"touchmove":"mousemove",o=t?"touchend":"mouseup",{perspectiveQuadService:r}=this;e.addEventListener(i,(e=>{r.mousedown(e);})),e.addEventListener(s,(e=>{r.mousemove(e);}),{passive:!1});const n=e=>{r.mouseup(e);};document.addEventListener(o,n),this.hooks.destroy.on((()=>{document.removeEventListener(o,n);}));}listenDefaultNativeEventsForBox(){if(!this.context.isDefaultViewer)return;const e=this.context.rendererService.getCanvasDom(),t=j(),i=t?"touchstart":"mousedown",s=t?"touchmove":"mousemove",o=t?"touchend":"mouseup",{cropRectService:r}=this;e.addEventListener(i,(e=>{r.mousedown(e);})),e.addEventListener(s,(e=>{r.mousemove(e);}),{passive:!1});const n=e=>{r.mouseup(e);};document.addEventListener(o,n),this.hooks.destroy.on((()=>{document.removeEventListener(o,n);}));}setRectBox(e,t){const i=this.context.getActiveDocTab();return !(!i||!i.total||(W(t)&&(t=[i.current]),i.indicesToUids(t).forEach((t=>{let i=e;const s=this.context.core.pageService.getPage(t);s.enableResolution&&(i=s.rectToDisplayPPI(e));const o=(e=>{const{left:t,top:i,width:s,height:o}=e;return [t,i,t+s,i,t+s,i+o,t,i+o]})(i),r=this.boxRenderer.areas.get(t);r.boxes.length?r.updateRectBox(r.boxes[0],o,!0):r.addRectBox(o);})),this.context.render(),0))}getRectBox(){const e=this.context.getActiveDocTab();if(e&&e.total){let t=null;if(e.pages.find((e=>{const i=this.boxRenderer.getAreaByUid(e.uid);return !(null==i||!i.boxes.length||(t=i,0))})),t){const e=t.boxes[0];if(null!=e&&e.isRect){let i=e.getRect();const s=this.context.core.pageService.getPage(t.areaUid);return s.enableResolution&&(i=s.rectToPixelPPI(i)),Hu(i),i.width=i.width||1,i.height=i.height||1,i}}}return null}getRenderedRectBoxCount(){const e=this.context.getActiveDocTab();let t=0;return e&&e.total&&this.boxRenderer.areas.forEach((e=>{t+=e.boxes.length;})),t}getCropIndices(){const e=this.context.getActiveDocTab();let t=[];if(e&&e.total)if("all"===this.iCropMode){const i=[];this.boxRenderer.areas.forEach((e=>{e.boxes.length&&i.push(e.areaUid);})),t=e.uidsToIndices(i);}else t=[e.current];return t}clearRectBox(){return this.boxRenderer.areas.forEach((e=>{e.clearBoxes();})),!0}setQuadBox(e){const t=this.context.getActiveDocTab();if(!t||!t.total)return !1;const i=this.context.core.pageService.getPage(t.currentUid);let s=e;i.enableResolution&&(s=i.quadToDisplayPPI(e));const o=this.boxRenderer.getAreaByUid(t.currentUid),{width:r,height:n}=o,a=Uc(s,r,n);return i.isFull=a,i.setActiveQuad(s),this.perspectiveQuadService.updatePageQuad(t),this.hooks.perspectiveQuadChanged.emit({quad:s,isFull:i.isFull}),this.context.render(),!0}getQuadBox(){const e=this.context.getActiveDocTab();if(e&&e.total){const t=this.boxRenderer.getAreaByUid(e.currentUid).boxes[0];if(!t.isRect){let i=t.getQuad();const s=this.context.core.pageService.getPage(e.currentUid);return s.enableResolution&&(i=s.quadToPixelPPI(i)),Hc(i),i}}return null}resetQuadBox(e){const t=this.context.getActiveDocTab();if(null==t||!t.total)return !1;let i=[];return i=W(e)?[t.currentUid]:t.indicesToUids(e),i.forEach((e=>{const i=this.context.core.pageService.getPage(e),{quad:s}=i;s?(i.isFull&&(i.isFull=!1),i.setActiveQuad(s),this.perspectiveQuadService.updatePageQuad(t)):i.isFull||(i.isFull=!0,this.perspectiveQuadService.updatePageQuad(t)),i.uid===t.currentUid&&this.hooks.perspectiveQuadChanged.emit({quad:s,isFull:i.isFull});})),this.context.render(),!0}clearQuadBox(){return this.boxRenderer.areas.forEach((e=>{e.clearBoxes();})),!0}isConvexQuad(e){return Mv(e.flat())}});var o;e.setClass("Viewer",s);}};class Hv{constructor(e,i){t(this,"uid",void 0),t(this,"action",void 0),t(this,"core",void 0),t(this,"type",void 0),this.action=e,this.type="rotate",this.core=i;}execute(){const{core:e,action:t}=this;return e.actionService.addAction(t),t.pageUids.forEach((i=>{e.pageService.getPage(i).addAction(t);})),e.globalHooks.rotatePages.emit(t),e.globalHooks.afterRotatePages.emit(t),!0}undo(){const{core:e,action:t}=this;e.actionService.deleteAction(t.actionUid),t.pageUids.forEach((i=>{e.pageService.getPage(i).deleteAction(t.actionUid);})),e.globalHooks.rotatePages.emit(t),e.globalHooks.afterRotatePages.emit(t);}}class jv{constructor(e,i){t(this,"uid",void 0),t(this,"action",void 0),t(this,"core",void 0),t(this,"type",void 0),this.action=e,this.type="crop",this.core=i;}execute(){const{core:e,action:t}=this;return e.actionService.addAction(this.action),t.pageUids.forEach((t=>{e.pageService.getPage(t).addAction(this.action);})),e.globalHooks.cropPages.emit(t),!0}undo(){const{core:e,action:t}=this;e.actionService.deleteAction(t.actionUid),t.pageUids.forEach((i=>{e.pageService.getPage(i).deleteAction(t.actionUid);})),e.globalHooks.cropPages.emit(t);}}class Gv{constructor(){t(this,"outer",void 0),t(this,"inner",void 0),t(this,"original",void 0),t(this,"matrices",void 0),this.reset();}reset(){this.outer=new Vn,this.inner=new Vn,this.outer.appendChild(this.inner),this.original=this.inner,this.matrices=[];}prepare(e,t){this.reset(),this.inner.updateStyle({x:0,y:0,width:e,height:t}),this.outer.updateStyle({width:e,height:t});}editPageForSave(e,t,i){if(!e.length)return {width:t,height:i,matrices:[]};this.prepare(t,i),e.forEach((e=>{"rotate"===e.type?[t,i]=this.rotate(e.angle,t,i):"crop"===e.type&&([t,i]=this.crop(e.rect));}));const s={width:t,height:i,matrices:this.matrices};return this.reset(),s}editPageForPerspective(e,t,i){if(e%360==0)return {width:t,height:i,matrices:[]};this.prepare(t,i),[t,i]=this.rotate(e,t,i);const s={width:t,height:i,matrices:this.matrices};return this.reset(),s}editPage(e,t,i){if(!e.length)return {width:t,height:i,matrices:[]};this.prepare(t,i),e.forEach((e=>{"rotate"===e.type?[t,i]=this.rotate(e.angle,t,i):"crop"===e.type&&([t,i]=this.crop(e.rect));}));const s={width:t,height:i,matrices:this.matrices};return this.reset(),s}rotate(e,t,i){const s=ie(e),{width:o,height:r}=function(e,t,i,s,o){const r=e+i/2,n=t+s/2,a=De(e,t,r,n,o),l=De(e+i,t,r,n,o),h=De(e+i,t+s,r,n,o),c=De(e,t+s,r,n,o),d=[l.x,a.x,c.x,h.x].sort(((e,t)=>e-t)),u=[l.y,a.y,c.y,h.y].sort(((e,t)=>e-t));return {x:d[0],y:u[0],width:d[3]-d[0],height:u[3]-u[0]}}(0,0,t,i,s),n=(o-t)/2,a=(r-i)/2;t=o,i=r;const l=new Vn;l.updateStyle({x:0,y:0,width:o,height:r}),l.appendChild(this.outer),this.outer.rotateLocal(e),this.inner=this.outer,this.outer=l;const{x:h,y:c}=this.inner.getPosition();this.inner.setPosition({x:h+n,y:c+a,z:0});const d=this.inner.getLocalTransform();return this.matrices.push(d),[o,r]}crop(e){const t=new Vn;t.updateStyle({x:0,y:0,width:e.width,height:e.height}),t.appendChild(this.outer),this.inner=this.outer,this.outer=t;const{x:i,y:s}=this.inner.getPosition();this.inner.setPosition({x:i-e.left,y:s-e.top,z:0});const o=this.inner.getLocalTransform();return this.matrices.push(o),[e.width,e.height]}}class $v{constructor(e,i){t(this,"hooks",void 0),t(this,"core",void 0),t(this,"editor",void 0),this.core=e,this.hooks=i,this.editor=new Gv;}rotatePages(e,t,i,s){const o={actionUid:q(),type:"rotate",docUid:e,pageUids:[...t],options:{angle:i,type:s}},{core:r}=this,n=new Hv(o,r);return r.commandService.execute(n,e),!0}cropPages(e,t,i){i=this.core.pageService.getPage(t[0]).rectToDisplayPPI(i);const s={actionUid:q(),type:"crop",docUid:e,pageUids:[...t],options:{...i}},{core:o}=this,r=new jv(s,o);return o.commandService.execute(r,e),!0}editPage(e){const t=this.core.pageService.getPage(e),{width:i,height:s}=t.original.getPageSize(),o=t.getActions(),r=Xv(U(o),i,s);return this.editor.editPage(r,i,s)}editPageForSave(e){const t=this.core.pageService.getPage(e);let{width:i,height:s}=t.original.getPageSize(),o=t.getActions();o=U(o),i=t.toPixelPPI(i,!1),s=t.toPixelPPI(s,!0),o.forEach((e=>{"crop"===e.type&&(e.options=t.rectToPixelPPI(e.options));}));const r=Xv(U(o),i,s);return this.editor.editPageForSave(r,i,s)}editPageForPerspective(e){const t=this.core.pageService.getPage(e),{width:i,height:s}=t.raw.getPageSize(),o=t.getPerspectiveActions().reduce(((e,t)=>("rotate"===t.type&&(e+=t.options.angle),e)),0);return this.editor.editPageForPerspective(o,i,s)}}function Xv(e,t,i){let s={type:"",actions:[]};const o=[];e.forEach((e=>{e.type!==s.type&&(s={type:e.type,actions:[]},o.push(s)),s.actions.push(e);}));const r=[];o.forEach((e=>{if(e.actions.length)if("rotate"===e.type){let t=0;e.actions.forEach((e=>{t+=e.options.angle;})),r.push({type:"rotate",angle:t});}else if("crop"===e.type){const t={...e.actions[0].options};let i=new Zn(t.left,t.left+t.width,t.top,t.top+t.height);for(let t=1;t<e.actions.length;t++){const{left:s,top:o,width:r,height:n}=e.actions[t].options,{left:a,top:l}=i.getRect(),h=new Zn(s+a,s+a+r,o+l,o+l+n),c=i.intersection(h);c&&(i=c);}const s=i.getRect();r.push({type:"crop",rect:s});}}));let n,a={left:0,top:0,width:t,height:i},l=0,h=!1;r.forEach((e=>{if("rotate"===e.type)l+=e.angle,a=Fu(a,l,t,i);else if("crop"===e.type){h=!0;const s=e.rect;a={left:a.left+s.left,top:a.top+s.top,width:s.width,height:s.height},a=function(e,t,i,s){t=(t%360+360)%360;const o={...e},{left:r,top:n,width:a,height:l}=e,h=Math.floor(t/90);return 1===h?(o.left=n,o.top=s-a-r):2===h?(o.left=i-a-r,o.top=s-l-n):3===h&&(o.left=i-l-n,o.top=r),h%2>0&&(o.width=l,o.height=a),o}(a,l,t,i);}n=e.type;})),"crop"===n&&(a=Fu(a,l,t,i));const c=[];return 0!==l&&c.push({type:"rotate",angle:l}),h&&c.push({type:"crop",rect:a}),c}const Yv={apply(e){e.editService=new $v(e,e.globalHooks);},install(e){const t=e.getClass("Viewer"),i=(s=t,class extends s{constructor(e){super(e),this.listenGlobalEventsForEdit(),this.listenViewerEventsForEdit();}listenGlobalEventsForEdit(){const{globalHooks:e}=this.context.core,t=e=>{let{docUid:t}=e;const i=this.context.getTab(t);null!=i&&i.isActive&&(this.context.scrollReason="currentChanged",this.context.showTab(i));};e.rotatePages.on(t),e.cropPages.on(t),this.hooks.destroy.on((()=>{e.rotatePages.off(t),e.cropPages.off(t);}));}listenViewerEventsForEdit(){const{hooks:e}=this;e.beforeLayout.on((e=>{this.context.isDefaultViewer||this.context.isThumbnailViewer?e.pages.forEach((e=>{const{width:t,height:i,matrices:s}=this.context.core.editService.editPage(e.uid);e.image.externalMatrices=s,e.rWidth=t,e.rHeight=i;})):this.context.isPerspectiveViewer&&e.pages.forEach((e=>{const{width:t,height:i,matrices:s}=this.context.core.editService.editPageForPerspective(e.uid);e.image.externalMatrices=s,e.rWidth=t,e.rHeight=i;}));}));}rotatePages(e,t){var i;if(e%360==0)return !0;const s=this.context.getActiveDocTab();if(!s)return !1;null!==(i=t)&&void 0!==i||(t=[s.current]);const o=s.indicesToUids(t);return this.context.core.editService.rotatePages(s.uid,o,e,"contain")}cropPages(e,t){var i;const s=this.context.getActiveDocTab();if(!s)return !1;null!==(i=t)&&void 0!==i||(t=[s.current]);const o=s.indicesToUids(t);return this.hooks.beforeCropPages.emit(),this.context.core.editService.cropPages(s.uid,o,e)}async perspectivePage(e,t){const i=this.context.getActiveDocTab();if(!i)return null;let s=i.currentUid;return W(t)||(s=i.indexToUid(t)),(await this.context.core.perspectivePage(i.uid,s,e)).data}perspectiveAllPage(){const e=this.context.getActiveDocTab();if(!e)return !1;const t=this.getPageCounts();for(let i=0;i<t;i++){const t=this.indexToUid(i),s=this.context.core.pageService.getPage(t);if(s.isFull){let{width:i,height:o}=s.raw.getImageDetail();const r=Math.abs((s.rotation%360+360)%360);if(90===r||270===r){const e=i;i=o,o=e;}const n=[[0,0],[i,0],[i,o],[0,o]];this.context.core.perspectivePage(e.uid,t,n);}else if(s.activeQuad&&s.activeQuad!==s.quad){const{width:i,height:o}=s.raw.getPageSize(),r=_c(s.activeQuad.flat(),s.rotation,i,o);let n=Bc(r);s.enableResolution&&(n=s.quadToPixelPPI(n)),this.context.core.perspectivePage(e.uid,t,n);}}return !0}destroy(){super.destroy();}});var s;e.setClass("Viewer",i);}};Bu.registerPlugin(Yg),Bu.registerPlugin(Av),Bu.registerPlugin(zv),Bu.registerPlugin(sm),Bu.registerPlugin(Yv);const qv=new Bu;j()?qv.autoReleaseImg=!0:qv.autoReleaseImg=!1;const Qv="Layout",Zv="Button",Jv="Capture",Kv="Flashlight",ey="CameraConvert",ty="CameraResolution",iy="AutoDetect",sy="AutoCapture",oy="ImagePreview",ry="Rotate",ny="RotateLeft",ay="RotateRight",ly="Delete",hy="DeleteCurrent",cy="DeleteAll",dy="Zoom",uy="ZoomIn",gy="ZoomOut",fy="ZoomByPercentage",py="Crop",my="CropMode",vy="CropCurrent",yy="CropAll",wy="FullQuad",by="PerspectiveAll",xy="Undo",Cy="Redo",Sy="FitMode",Py="FitWindow",Ty="FitHeight",ky="FitWidth",Dy="ActualSize",Ey="DisplayMode",Ay="SinglePage",Iy="ContinuousPage",My="Pan",Ry="Load",Oy="Download",_y="Print",Ny="Filter",Ly="Restore",By="ThumbnailSwitch",Uy="Pagination",Wy="Done",Vy="Back",Fy="Blank",zy="Close",Hy="MainView",jy="SeparatorLine";class Gy{static getTooltip(){return im.getTooltip()}static setTooltip(e){const t="Elements.setTooltip",i="tooltip";return !Vw(e,!0,t,i)&&(B(e)?(im.setTooltip(e),!0):(Zl.OutputWarning(Zl.PARAM_INVALID,t,i),!1))}static getDisplayTextConfig(){return im.getDisplayTextConfig()}static setDisplayTextConfig(e){const t="Elements.displayTextConfig",i="displayTextConfig";return !Vw(e,!0,t,i)&&(B(e)?(im.setDisplayTextConfig(e),!0):(Zl.OutputWarning(Zl.PARAM_INVALID,t,i),!1))}static get Layout(){return Qv}static get Button(){return Zv}static get Capture(){return Jv}static get Flashlight(){return Kv}static get CameraConvert(){return ey}static get CameraResolution(){return ty}static get AutoDetect(){return iy}static get AutoCapture(){return sy}static get ImagePreview(){return oy}static get Rotate(){return ry}static get RotateLeft(){return ny}static get RotateRight(){return ay}static get Delete(){return ly}static get DeleteCurrent(){return hy}static get DeleteAll(){return cy}static get Zoom(){return dy}static get ZoomIn(){return uy}static get ZoomOut(){return gy}static get ZoomByPercentage(){return fy}static get Crop(){return py}static get CropCurrent(){return vy}static get CropAll(){return yy}static get FullQuad(){return wy}static get PerspectiveAll(){return by}static get Undo(){return xy}static get Redo(){return Cy}static get Pan(){return My}static get CropMode(){return my}static get Load(){return Ry}static get Download(){return Oy}static get Print(){return _y}static get Filter(){return Ny}static get Restore(){return Ly}static get ThumbnailSwitch(){return By}static get Pagination(){return Uy}static get FitMode(){return Sy}static get FitWindow(){return Py}static get FitHeight(){return Ty}static get FitWidth(){return ky}static get ActualSize(){return Dy}static get DisplayMode(){return Ey}static get SinglePage(){return Ay}static get ContinuousPage(){return Iy}static get MainView(){return Hy}static get SeparatorLine(){return jy}static get Done(){return Wy}static get Back(){return Vy}static get Blank(){return Fy}static get Close(){return zy}}const $y={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-capture-viewer-header-mobile",children:[{type:"CameraResolution",className:"ddv-capture-viewer-resolution"},Gy.Flashlight]},Gy.MainView,{type:"Layout",className:"ddv-capture-viewer-footer-mobile",children:[Gy.AutoDetect,Gy.AutoCapture,{type:"Capture",className:"ddv-capture-viewer-captureButton"},Gy.ImagePreview,Gy.CameraConvert]}]},Xy={type:"Layout",flexDirection:"column",className:"ddv-edit-viewer-mobile",children:[{type:"Layout",className:"ddv-edit-viewer-header-mobile",children:[Gy.Blank,Gy.Pagination,Gy.Download]},Gy.MainView,{type:"Layout",className:"ddv-edit-viewer-footer-mobile",children:[Gy.DisplayMode,Gy.RotateLeft,Gy.Crop,Gy.Filter,Gy.Undo,Gy.Delete,Gy.Load]}]},Yy={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-mobile",children:[Gy.Blank,Gy.Pagination,Gy.PerspectiveAll]},Gy.MainView,{type:"Layout",className:"ddv-perspective-viewer-footer-mobile",children:[Gy.FullQuad,Gy.RotateLeft,Gy.RotateRight,Gy.DeleteCurrent,Gy.DeleteAll]}]},qy={type:"Layout",flexDirection:"column",className:"ddv-capture-viewer-desktop",children:[{type:"Layout",className:"ddv-capture-viewer-header-desktop",children:[{type:Gy.CameraResolution,className:"ddv-capture-viewer-resolution-desktop"},Gy.AutoDetect,{type:Gy.Capture,className:"ddv-capture-viewer-capture-desktop"},Gy.AutoCapture]},Gy.MainView,{type:Gy.ImagePreview,className:"ddv-capture-viewer-image-preview-desktop"}]},Qy={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-desktop",children:[Gy.FullQuad,Gy.RotateLeft,Gy.RotateRight,Gy.DeleteCurrent,Gy.DeleteAll,{type:Gy.Pagination,className:"ddv-perspective-viewer-pagination-desktop"},{type:Gy.PerspectiveAll,className:"ddv-perspective-viewer-perspective-desktop"}]},Gy.MainView]},Zy={type:Gy.Layout,flexDirection:"column",className:"ddv-edit-viewer-desktop",children:[{type:Gy.Layout,className:"ddv-edit-viewer-header-desktop",children:[{type:Gy.Layout,children:[Gy.ThumbnailSwitch,Gy.Zoom,Gy.FitMode,Gy.DisplayMode,Gy.RotateLeft,Gy.RotateRight,Gy.Crop,Gy.Filter,Gy.Undo,Gy.Redo,Gy.DeleteCurrent,Gy.DeleteAll,Gy.Pan]},{type:Gy.Layout,children:[{type:Gy.Pagination,className:"ddv-edit-viewer-pagination-desktop"},Gy.Load,Gy.Download,Gy.Print]}]},Gy.MainView]},Jy={type:Gy.Layout,children:[Gy.MainView]},Ky={background:"#e2e1de"},ew={border:"1px solid #707070",background:"#fff"},tw={border:"2px solid #fe8e14",background:"rgba(255,255,255,0)",maskColor:"rgba(128,128,128,0.6)",ctrlBorderRadius:"50%",ctrlBackground:"#fe8e14",ctrlBorder:"2px solid #fe8e14",ctrlWidth:"15px",ctrlHeight:"15px",invalidCtrlBorderColor:"red",invalidBorderColor:"red"},iw={canvasStyle:{...Ky},currentPageStyle:{border:"4px solid #fe8e14"},pageStyle:{border:"6px solid rgba(0,0,0,0)",background:"rgba(255,255,255,0)"},selectedPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},hoveredPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},placeholderStyle:{border:"6px solid rgba(136,136,136,0.2)",background:"rgba(136,136,136,0.2)"},pageNumberStyle:{onPage:!1,visibility:"visible",width:"32px",height:"24px",background:"rgba(255,255,255,0)",border:"0px solid #000",borderRadius:"0px",opacity:1,color:"#323234",fontSize:"14px",fontFamily:"Open Sans",left:"50%",top:"",right:"",bottom:"3px",translateX:"-50%",translateY:"0px"},checkboxStyle:{visibility:"visible",width:"16px",height:"16px",background:"#fff",border:"2px solid #999999",borderRadius:"0px",opacity:1,left:"2px",top:"2px",checkMarkColor:"#FE8E14",checkMarkLineWidth:"2px",translateX:"0px",translateY:"0px"},rows:2,columns:2,multiselectMode:!1,scrollToLatest:!1,enableDragPage:!0,scrollDirection:"vertical"},sw={...iw,visibility:"hidden",size:"180px",position:"left",rows:4,columns:1,canvasStyle:{background:"#DDDDDD"}},ow={canvasStyle:{...Ky},pageStyle:{...ew},quadSelectionStyle:{...tw},currentPageStyle:{border:"",background:""},minZoom:.01,maxZoom:64,scrollDirection:"vertical",enableSlide:!0,scrollToLatest:!1},rw=["canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle"];var nw=new WeakSet;class aw{constructor(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BaseBrowseViewer";p(this,nw),t(this,"v",void 0),t(this,"uid",void 0),t(this,"groupUid",void 0),t(this,"postfix",void 0),t(this,"errorPrefix","BaseBrowseViewer"),this.errorPrefix=i;const s=`new ${this.errorPrefix}`;nc.makeSureCoreLicenseExist(),Rw(s,"option","browseViewer",e);const o=je((null==e?void 0:e.viewerConfig)||{},U({...iw,viewerMode:sl.THUMBNAIL,tabMode:"single",displayMode:"multiple",toolMode:"pan"}));this.v=qv.createViewer({uiConfig:U(Jy),...e,viewerConfig:o}),this.uid=this.v.uid,this.groupUid=this.v.groupUid,this.postfix=this.v.postfix,u(this,nw,lw).call(this);}get isVisible(){return "visible"===this.v.getViewerConfig().visibility}get isBoundContainer(){return this.v.context.viewService.isBindContainer}set multiselectMode(e){const t="multiselectMode",i=`${this.errorPrefix}.${t}`;z(e)?this.v.updateViewerConfig({multiselectMode:e}):Mw(i,t);}get multiselectMode(){return this.v.getViewerConfig().multiselectMode}getStyle(e){const t=`${this.errorPrefix}.getStyle`,i="styleName";if(Vw(e,!0,t,i))return null;if(!Pw(e,rw,t,i))return null;const s=this.v.getViewerConfig();if(e in s){return ww(e,s[e])}return null}updateStyle(e,t){const i=`${this.errorPrefix}.updateStyle`;return !(Vw(e,!0,i,"name")||Vw(t,!0,i,"style")||!_w(e,t,rw,i))&&(this.v.updateViewerConfig({[e]:t}),!0)}getUiConfig(){return this.v.getUiConfig()}updateUiConfig(e){return !!Ow(e,"browseViewer",`${this.errorPrefix}.updateUiConfig`,"uiConfig")&&this.v.updateUiConfig(e)}show(){this.v.show();}hide(){this.v.hide();}getSelectedPageIndices(){return Uw(this.v)?this.v.getSelectedPageIndices():[]}selectAllPages(){return Uw(this.v,!0)?this.v.selectAllPages():[]}selectPages(e){const t=`${this.errorPrefix}.selectPages`,i="indices";if(Vw(e,!0,t,i))return [];if(!Uw(this.v))return [];const s=this.v.getPageCounts(),o=cl.numberArrayIsValid(e,0,s-1);return o.length>0?(Mw(t,i,o),[]):this.v.selectPagesByIndices(e)}setRowAndColumn(e,t){const i=`${this.errorPrefix}.setRowAndColumn`,s="row",o="column";if(Vw(e,!0,i,s)||Vw(t,!0,i,o))return !1;if(!$s(e))return Mw(i,s),!1;if(!$s(t))return Mw(i,o),!1;const{maxColumns:r,maxRows:n}=this.v.getViewerConfig();return e<1||e>n?(Zl.OutputWarning(Zl.PARAM_OUTOFRANGE,i,s),!1):t<1||t>r?(Zl.OutputWarning(Zl.PARAM_OUTOFRANGE,i,o),!1):this.v.setRowAndColumn(e,t)}on(e,t){Ww(e,t,`${this.errorPrefix}.on`)&&this.v.on(e,t);}off(e,t){Ww(e,t,`${this.errorPrefix}.off`,!0,!0)&&this.v.off(e,t);}destroy(){this.v&&this.v.destroy();}}function lw(){this.v.hooks.destroy.on((()=>{this.v=null,Object.setPrototypeOf(this,null);}));}const hw=["canvasStyle","pageStyle","quadSelectionStyle","currentPageStyle"];var cw=new WeakMap,dw=new WeakSet,uw=new WeakSet,gw=new WeakSet;class fw{constructor(e){p(this,gw),p(this,uw),p(this,dw),f(this,cw,{writable:!0,value:void 0}),t(this,"uid",void 0),t(this,"groupUid",void 0),t(this,"postfix",void 0),t(this,"thumbnail",void 0);nc.makeSureCoreLicenseExist(),Rw("new EditViewer","option","editViewer",e);const o=je((null==e?void 0:e.viewerConfig)||{},U({...ow,viewerMode:sl.DEFAULT,displayMode:"continuous"}));if(o.minZoom>o.maxZoom){Zl.OutputWarning(Zl.MINZOOM_INVALID);const e=o.maxZoom;o.maxZoom=o.minZoom,o.minZoom=e;}const{maxZoom:r,minZoom:n}=o;(r>64||r<.01)&&(o.maxZoom=64),(n>64||n<.01)&&(o.minZoom=.01);const a=j()?Xy:Zy;s(this,cw,qv.createViewer({uiConfig:U(a),...e,viewerConfig:o})),this.uid=i(this,cw).uid,this.groupUid=i(this,cw).groupUid,this.postfix=i(this,cw).postfix,xw(i(this,cw).getUiConfig()).includes(Gy.Filter)&&!i(this,cw).context.core.processService.enableFilter&&Zl.OutputWarning(Zl.IMGFILTER_MISS);const l=(null==e?void 0:e.thumbnailConfig)||{},h=U(sw);j()&&(h.size="100%",h.rows=3,h.columns=2,h.canvasStyle.background="#4B4B4B",h.pageNumberStyle.color="white"),je(l,h),e&&!1===e.createThumbnail||u(this,uw,mw).call(this,h),i(this,cw).rootDom&&yw(this,i(this,cw).rootDom),qv.preloadModule("core"),u(this,gw,vw).call(this),u(this,dw,pw).call(this);}get isVisible(){return "visible"===i(this,cw).getViewerConfig().visibility}get isBoundContainer(){return i(this,cw).context.viewService.isBindContainer}get currentDocument(){var e;const t=null===(e=i(this,cw).getActiveTab())||void 0===e?void 0:e.uid;return t?eb.getDocument(t):null}get zoom(){return parseFloat(i(this,cw).getViewerConfig().zoom.toFixed(4))}set zoom(e){if(!G(e))return void Mw("EditViewer.zoom","zoom");const{maxZoom:t,minZoom:s}=i(this,cw).getViewerConfig();e>t?Zl.OutputWarning(Zl.ZOOM_TOOLARGE):e<s&&Zl.OutputWarning(Zl.ZOOM_TOOSMALL),i(this,cw).updateViewerConfig({zoom:e});}get zoomOrigin(){return i(this,cw).getViewerConfig().zoomOrigin}set zoomOrigin(e){(function(e,t){if(!B(e))return Zl.OutputWarning(Zl.PARAM_INVALID,t,"zoomOrigin"),!1;const i=[];if(["x","y"].forEach((t=>{W(e[t])?i.push(`ZoomOrigin.${t} is missing.`):-1===["start","center","end"].indexOf(e[t])&&i.push(`ZoomOrigin.${t} is valid.`);})),i.length>0){const e={...Zl.PARAM_INVALID,detail:i};return Zl.OutputWarning(e,t,"zoomOrigin"),!1}return !0})(e,"EditViewer.zoomOrigin")&&i(this,cw).updateViewerConfig({zoomOrigin:{x:e.x,y:e.y}});}get displayMode(){const{displayMode:e}=i(this,cw).getViewerConfig(),t=i(this,cw).getActiveTab();return t?t.context.displayMode:e}set displayMode(e){const t="EditViewer.displayMode",s="displayMode";if(!$(e))return void Mw(t,s);const o={single:"single",continuous:"continuous"}[e];o?i(this,cw).updateViewerConfig({displayMode:o}):Zl.OutputWarning(Zl.PARAM_NOTSUPPORT,t,s);}get toolMode(){const{toolMode:e}=i(this,cw).getViewerConfig();return e}set toolMode(e){const t="EditViewer.toolMode",s="toolMode";$(e)?["crop","pan"].includes(e)?i(this,cw).updateViewerConfig({toolMode:e}):Zl.OutputWarning(Zl.PARAM_NOTSUPPORT,t,s):Mw(t,s);}get fitMode(){const{fitMode:e}=i(this,cw).getViewerConfig(),t=i(this,cw).getActiveTab();return t?t.context.fitMode:e}set fitMode(e){const t="EditViewer.fitMode",s="fitMode";if(!$(e))return void Mw(t,s);const o={width:"width",height:"height",window:"window",actualSize:"actualSize"}[e];o?i(this,cw).updateViewerConfig({fitMode:o}):Zl.OutputWarning(Zl.PARAM_NOTSUPPORT,t,s);}setParallelScrollCount(e){const t="EditViewer.setParallelScrollCount",s="count";if(Vw(e,!0,t,s))return !1;if(!$s(e))return Mw(t,s),!1;if("continuous"!==this.displayMode)return Zl.OutputWarning(Zl.ROWCOLUMN_CANNOTCHANGE,t),!1;const{maxColumns:o,maxRows:r}=i(this,cw).getViewerConfig();return e<1||e>o||e>r?(Zl.OutputWarning(Zl.PARAM_OUTOFRANGE,t,s),!1):i(this,cw).setRowAndColumn(e,e)}bindContainer(e){cl.makeSureContainerValid(e,"EditViewer.bindContainer","container"),i(this,cw).bindContainer(e);}unbindContainer(){i(this,cw).unbindContainer();}show(){i(this,cw).show(),yw(this,i(this,cw).rootDom);}hide(){i(this,cw).hide();}getUiConfig(){return i(this,cw).getUiConfig()}updateUiConfig(e){return !!Ow(e,"editViewer","EditViewer.updateUiConfig","uiConfig")&&(i(this,cw).updateUiConfig(e),i(this,cw).emit("thumbnailBind",this.thumbnail.uid),!0)}openDocument(e){const t="EditViewer.openDocument",i="docUid";cl.makeSureMissing(e,t,i),cl.makeSureStringValid(e,t,i);qv.documentService.getDocument(e)||Zl.throw(Zl.DOC_NOTEXIST,t,i);try{qv.openDocument(e,this.uid);}catch(e){Zl.throw(e,t,i);}}closeDocument(){if(!Uw(i(this,cw)))return !1;try{i(this,cw).closeDocument();}catch(e){Zl.OutputWarning(e);}return !0}getStyle(e){const t="EditViewer.getStyle",s="styleName";if(Vw(e,!0,t,s))return null;if(!Pw(e,hw,t,s))return null;const o=i(this,cw).getViewerConfig();if(e in o){return ww(e,o[e])}return null}updateStyle(e,t){const s="EditViewer.updateStyle";return !(Vw(e,!0,s,"name")||Vw(t,!0,s,"style")||!_w(e,t,hw,s))&&(i(this,cw).updateViewerConfig({[e]:t}),!0)}setCropRect(e){const t="EditViewer.setCropRect",s="rect";if(Vw(e,!0,t,s))return !1;const o=cl.rectIsValid(e);if(o.length>0)return Mw(t,s,o),!1;if(!Uw(i(this,cw),!0))return !1;if("crop"!==this.toolMode)return Zl.OutputWarning(Zl.RECT_NOTAVL,t),!1;const{width:r,height:n}=i(this,cw).getRealPixelSize();return Hw(e,r,n)?i(this,cw).setRectBox(e):(Zl.OutputWarning(Zl.RECT_EXCEEDPAGEBOUND),!1)}getCropRect(){return Uw(i(this,cw))?i(this,cw).getRectBox():null}crop(e,t){const s="EditViewer.crop",o=i(this,cw).getPageCounts(),r="rect";if(Vw(e,!0,s,r))return !1;const n=cl.rectIsValid(e);if(n.length>0)return Mw(s,r,n),!1;if(!Uw(i(this,cw),!0,!0))return !1;if(t){const r=cl.numberArrayIsValid(t,0,o-1,void 0,0);if(r.length>0)return Mw(s,"indices",r),!1;const n=[];for(let s=0;s<t.length;s++){const{width:o,height:r}=i(this,cw).getRealPixelSize(t[s]);Hw(e,o,r)||n.push(`indices[${t[s]}]: ${Zl.RECT_EXCEEDPAGEBOUND.message}`);}if(n.length>0)return Zl.OutputWarning({...Zl.RECT_EXCEEDPAGEBOUND,details:n}),!1}else {const{width:t,height:s}=i(this,cw).getRealPixelSize();if(!Hw(e,t,s))return Zl.OutputWarning(Zl.RECT_EXCEEDPAGEBOUND),!1}const a=i(this,cw).getCurrentPageIndex();return i(this,cw).cropPages(e,t||[a])}rotate(e,t){return !!Fw(e,t,i(this,cw),"EditViewer.rotate")&&i(this,cw).rotatePages(e,t)}undo(){if(!Uw(i(this,cw)))return !1;const e=i(this,cw).undo();return e||Zl.OutputWarning(Zl.UNDO_NOOP),e}redo(){if(!Uw(i(this,cw)))return !1;const e=i(this,cw).redo();return e||Zl.OutputWarning(Zl.REDO_NOOP),e}saveOperations(){return !!Uw(i(this,cw))&&i(this,cw).saveOperations()}indexToUid(e){return Nw(e,i(this,cw),"indexToUid","EditViewer.indexToUid")?i(this,cw).indexToUid(e):""}uidToIndex(e){const t="EditViewer.uidToIndex";if(!Lw(e,i(this,cw),t))return -1;return this.currentDocument.pages.includes(e)?i(this,cw).uidToIndex(e):(Zl.OutputWarning(Zl.PAGE_NOTEXIST,t,"uid"),-1)}getCurrentPageUid(){return Uw(i(this,cw),!0)?i(this,cw).getCurrentPageUid():""}getCurrentPageIndex(){return Uw(i(this,cw),!0)?i(this,cw).getCurrentPageIndex():-1}getPageCount(){return Uw(i(this,cw))?i(this,cw).getPageCounts():-1}goToPage(e){return Nw(e,i(this,cw),"goToPage","EditViewer.goToPage")?i(this,cw).gotoPage(e):-1}on(e,t){Ww(e,t,"EditViewer.on")&&i(this,cw).on(e,t);}off(e,t){Ww(e,t,"EditViewer.off",!0,!0)&&i(this,cw).off(e,t);}destroy(){i(this,cw)&&i(this,cw).destroy();}}function pw(){i(this,cw).hooks.destroy.on((()=>{var e;null===(e=this.thumbnail)||void 0===e||e.destroy(),this.thumbnail=null,s(this,cw,null),Object.setPrototypeOf(this,null);}));}function mw(e){const{mainAndThbContainer:t,mainContainer:s,thumbnailContainer:o}=i(this,cw).context.viewService,{size:r,position:n,visibility:a}=e,l=U(Jy);let h="row",c=r,d="100%",u="left"===n?"-1":"1";"top"!==n&&"bottom"!==n||(h="column",c="100%",d=r,u="top"===n?"-1":"1");const g=`ddv-edit-viewer-thumb-${n}`;l.className=g,Object.assign(o.style,{width:c,height:d,order:u,display:"visible"===a?"block":"none"}),t.style.flexDirection=h,t.insertBefore(o,s),i(this,cw).context.resize();const f=new aw({container:o,viewerConfig:e,groupUid:this.groupUid,uiConfig:l},"EditViewer.thumbnail");this.thumbnail=f,i(this,cw).emit("thumbnailBind",f.uid),f.on("click",(()=>{i(this,cw).emit("ui_hidePopup",null);}));}function vw(){this.on("resized",(e=>{e.newWidth<1200&&e.newWidth>800&&yw(this,i(this,cw).rootDom);}));}function yw(e,t){if(j())return;if(!e.isVisible)return;const i=t,s=i.clientWidth;if(e instanceof fw){let e=20;s<1280&&(e=Math.max(13.5,s/1280*20)),i.style.fontSize=`${e}px`;}}function ww(e,t){const i=["border","background"],s=["left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY","opacity","visibility"],o={pageStyle:i,selectedPageStyle:i,hoveredPageStyle:i,canvasStyle:[...i,"cursor"],checkboxStyle:[...s,"checkMarkColor","checkMarkLineWidth"],pageNumberStyle:[...s,"color","fontSize","fontFamily","onPage"],quadSelectionStyle:["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"]};if(e in o){const i=o[e];return Object.fromEntries(Object.entries(t).filter((e=>{let[t,s]=e;return i.includes(t)})))}return U(t)}function bw(e,t){const i=["Load","Download","Print"],s=["Layout","Button","Blank","SeparatorLine","Close","Done","Back"],o=[...s,"MainView"],r=["Pagination","RotateLeft","RotateRight","Delete","DeleteCurrent","DeleteAll"],n=[...o,...r,...i,"PerspectiveAll","FullQuad"],a=[...o,...r,...i],l=[...o,"Capture","Flashlight","CameraConvert","CameraResolution","AutoDetect","AutoCapture","ImagePreview"],h=[...o,...r,...i,"Zoom","ZoomIn","ZoomOut","ZoomByPercentage","ThumbnailSwitch","FitMode","DisplayMode","Crop","Filter","Undo","Redo","Pan","FitWidth","FitHeight","FitWindow","ActualSize","SinglePage","ContinuousPage"];let c;switch(t){case"captureViewer":c=l;break;case"editViewer":c=h;break;case"perspectiveViewer":c=n;break;case"customViewer":c=s;break;case"browseViewer":c=a;}const d=[];return null!=e&&e.type&&!c.includes(null==e?void 0:e.type)&&d.push(e.type),null!=e&&e.children&&e.children.forEach((e=>{$(e)&&!c.includes(e)&&d.push(e),B(e)&&d.push(...bw(e,t));})),d}function xw(e){const t=[];return null!=e&&e.type&&t.push(e.type),null!=e&&e.children&&e.children.forEach((e=>{$(e)&&t.push(e),B(e)&&t.push(...xw(e));})),[...new Set(t)]}function Cw(e,t){const i=bw(e,t);if(i.length>0){let e="";return i.forEach(((t,s)=>{s===i.length-1?e+=`${t}`:e+=`${t} `;})),e}return !1}function Sw(e){if(""===e)return !0;const t=document.createElement("div");t.style.border=e;const i=e=>""===e||"initial"===e,{borderWidth:s,borderColor:o,borderStyle:r}=t.style;return !(i(s)||i(o)||i(r))}function Pw(e,t,i,s){return $(e)&&""!==e?-1!==t.indexOf(e)||(function(e,t){Zl.OutputWarning(Zl.PARAM_NOTSUPPORT,e,t);}(i,s),!1):(Mw(i,s),!1)}function Tw(e,t){let i;switch(e){case"canvasStyle":i=Dw;break;case"pageNumberStyle":i=Ew;break;case"checkBoxStyle":i=Aw;break;case"quadSelectionStyle":i=Iw;break;default:i=kw;}return i(e,t)}function kw(e,t){const i=[];return Object.keys(t).forEach((s=>{-1!==["background","border"].indexOf(s)&&($(t[s])||i.push(`${e}.${s} is invalid.`),"border"===s&&t[s]&&$(t[s])&&!Sw(t[s])&&i.push(`${e}.border is invalid.`));})),i}function Dw(e,t){const i=[];return i.push(...kw(e,{border:(null==t?void 0:t.border)||"",background:(null==t?void 0:t.background)||""})),W(null==t?void 0:t.cursor)||$(t.cursor)||i.push(`${e}.cursor is invalid`),i}function Ew(e,t){const i=[],s=["color","fontSize","fontFamily","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(t).forEach((o=>{-1!==s.indexOf(o)&&($(t[o])||i.push(`${e}.${o} is invalid.`)),"border"===o&&$(t[o])&&!Sw(t[o])&&i.push(`${e}.border is invalid.`),("onPage"===o&&!z(t[o])||"opacity"===o&&!G(t[o])||"visibility"===o&&-1===["visible","hidden"].indexOf(t[o]))&&i.push(`${e}.${o} is invalid.`);})),i}function Aw(e,t){const i=[],s=["checkMarkColor","checkMarkLineWidth","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(t).forEach((o=>{-1!==s.indexOf(o)&&($(t[o])||i.push(`${e}.${o} is invalid.`)),"border"===o&&$(t[o])&&!Sw(t[o])&&i.push(`${e}.border is invalid.`),("opacity"===o&&!G(t[o])||"visibility"===o&&-1===["visible","hidden"].indexOf(t[o]))&&i.push(`${e}.${o} is invalid.`);})),i}function Iw(e,t){const i=[],s=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"];return Object.keys(t).forEach((o=>{-1!==s.indexOf(o)&&($(t[o])||i.push(`${e}.${o} is invalid`)),"border"!==o&&"ctrlBorder"!==o||!$(t[o])||Sw(t[o])||i.push(`${e}.${o} is invalid`);})),i}function Mw(e,t,i){Zl.OutputWarning({...Zl.PARAM_INVALID,details:i},e,t);}function Rw(e,t,i,s){const o=[],r=t;if(W(s))return;B(s)||Zl.throw(Zl.PARAM_INVALID,e,r);const n=["pageStyle","hoveredPageStyle","selectedPageStyle","currentPageStyle","placeholderStyle","canvasStyle","pageNumberStyle","checkboxStyle","quadSelectionStyle"];Object.keys(s).forEach((e=>{const t=s[e];if("container"===e)o.push(...cl.containerIsValid(t,r));else if("uiConfig"===e){const e=cl.uiConfigIsValid(t,"option.uiConfig");if(e.length>0)o.push(...e);else {const e=Cw(t,i);if(e){const t=Zl.buildError(Zl.ELEMENT_UNSUPPORTED,i.charAt(0).toUpperCase()+i.slice(1),e);o.push(`option.uiConfig: ${t.message}`);}}}else "viewerConfig"!==e&&"thumbnailConfig"!==e||Object.keys(t).forEach((i=>{const s=t[i];if(n.includes(i)){const t=Tw(i,s);o.push(...t.map((t=>`${e}.${t}`)));}}));})),o.length>0&&Zl.throw({...Zl.PARAM_INVALID,details:o},e,r);}function Ow(e,t,i,s){if(Vw(e,!0,i,s))return !1;const o=cl.uiConfigIsValid(e,s);if(o.length>0)return Zl.OutputWarning({...Zl.PARAM_INVALID,details:o},i,s),!1;const r=Cw(e,t);return !r||(Zl.OutputWarning(Zl.ELEMENT_UNSUPPORTED,t.charAt(0).toUpperCase()+t.slice(1),r),!1)}function _w(e,t,i,s){const o="styleName";if(!$(e))return Zl.OutputWarning(Zl.PARAM_INVALID,s,o),!1;if(!B(t))return Zl.OutputWarning(Zl.PARAM_INVALID,s,"style"),!1;if(!Pw(e,i,s,o))return !1;const r=Tw(e,t);if(r.length>0){const e=Zl.PARAM_INVALID;return e.details=r,Zl.OutputWarning(e,s,"style"),!1}return !0}function Nw(e,t,i,s){if(Vw(e,!0,s,"index"))return !1;if(!$s(e))return Zl.OutputWarning(Zl.PARAM_INVALID,s,"index"),!1;if(!Uw(t,!0))return !1;const o=t.getPageCounts();return !(e<0||e>=o)||(Zl.OutputWarning(Zl.PARAM_OUTOFRANGE,s,"index"),!1)}function Lw(e,t,i){return !Vw(e,!0,i,"uid")&&(!$(e)||$(e)&&0===e.trim().length?(Zl.OutputWarning(Zl.PARAM_INVALID,i,"uid"),!1):!!Uw(t,!0,!0))}function Bw(e,t,i,s){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return !!t.includes(e)||(o?Zl.OutputWarning(Zl.PAGE_NOTEXIST,i,s):Zl.throw(Zl.PAGE_NOTEXIST,i,s),!1)}function Uw(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=e.getActiveTab();if(!s)return i?Zl.OutputWarning(Zl.DOC_NOTOPEN):Zl.throw(Zl.DOC_NOTOPEN),!1;if(t){if(0===s.doc.pages.length)return i?Zl.OutputWarning(Zl.DOC_NOIMAGE):Zl.throw(Zl.DOC_NOIMAGE),!1}return !0}function Ww(e,t,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r="eventName",n="listener";return !(Vw(e,s,i,r)||!o&&Vw(t,s,i,n))&&($(e)&&""!==e?!(t&&!H(t))||(s?Zl.OutputWarning(Zl.PARAM_INVALID,i,n):Zl.throw(Zl.PARAM_INVALID,i,n),!1):(s?Zl.OutputWarning(Zl.PARAM_INVALID,i,r):Zl.throw(Zl.PARAM_INVALID,i,r),!1))}function Vw(e,t,i,s){return !!W(e)&&(t?Zl.OutputWarning(Zl.PARAM_MISS,i,s):cl.makeSureMissing(e,i,s),!0)}function Fw(e,t,i,s){const o="angle",r=i.getPageCounts();if(Vw(e,!0,s,o))return !1;if(!$s(e))return Mw(s,o),!1;if(e%90!=0)return Zl.OutputWarning(Zl.PARAM_NOTSUPPORT,s,o),!1;if(!Uw(i,!0,!0))return !1;if(!W(t)){const e=cl.numberArrayIsValid(t,0,r-1,void 0,0);if(e.length>0)return Mw(s,"indices",e),!1}return !0}function zw(e,t,i,s){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const r=[];return t.forEach(((t,i)=>{e.get(t)||r.push(`${s}[${i}]:The specified document(s) do not exist.`);})),!(r.length>0)||(o?Zl.OutputWarning({...Zl.DOC_NOTEXIST,details:r},i,s):Zl.throw({...Zl.DOC_NOTEXIST,details:r},i,s),!1)}function Hw(e,t,i){const{left:s,top:o,width:r,height:n}=e;return !(s>t||s+r>t||o>i||o+n>i)}function jw(e,t,i){for(let s=0;s<e.length;s++)if(e[s][0]>t||e[s][1]>i)return !1;return !0}var Gw=new WeakMap,$w=new WeakMap,Xw=new WeakMap;class Yw{constructor(e,t){f(this,Xw,{get:qw,set:void 0}),f(this,Gw,{writable:!0,value:void 0}),f(this,$w,{writable:!0,value:void 0}),s(this,Gw,e),s(this,$w,t);}get name(){return i(this,$w).name}get uid(){return i(this,$w).uid}get pages(){return i(this,$w).pages.slice()}get creationDate(){return i(this,$w).creationDate}get author(){return i(this,$w).author}async loadSource(e,t){const s="IDocument.loadSource",o="sources";let r=e;nc.makeSureLoadLicenseExist(),cl.makeSureMissing(e,s,o);const n=[];i(this,Gw).processService.getFilterTypeList().forEach((e=>{n.push(e.type);})),L(e)?F(e[0])?cl.makeSureValid(cl.blobArrayIsValid(e,o),s,o):cl.makeSureValid(cl.sourcesIsValid(e,void 0,n),s,o):(F(e)||cl.makeSureValid(cl.sourceIsValid(e,void 0,n),s,o),e=[e]),F(e[0])&&(r=e.map((e=>({fileData:e}))));const a=t;return B(a)?cl.makeSureValid(cl.loadSourceOptionsIsValid(a,void 0),s,"loadSourceOptions"):W(a)||cl.makeSureNumberValid(a,0,i(this,Xw)-1,s,"index"),i(this,Gw).loadSource(r,this.uid,a).catch((e=>Zl.reject(e,s)))}async getPageData(e){const t="IDocument.getPageData",s="pageUid";cl.makeSureMissing(e,t,s),cl.makeSureStringValid(e,t,s),this.pages.includes(e)||Zl.throw(Zl.PAGE_NOTEXIST,t,s);const o=await i(this,Gw).getPageData(e);if(o.raw){const e={data:o.raw.data,width:o.raw.width,height:o.raw.height};o.raw=e;}if(o.display){const e={data:o.display.data,width:o.display.width,height:o.display.height};o.display=e;}if(o.thumbnail){const e={data:o.thumbnail.data,width:o.thumbnail.width,height:o.thumbnail.height};o.thumbnail=e;}return o.rotation&&(o.rotation%=360),o}async updatePage(e,t,s){const o="IDocument.updatePage",r="pageUid",n="data";return cl.makeSureMissing(e,o,r),cl.makeSureMissing(t,o,n),cl.makeSureStringValid(e,o,r),this.pages.includes(e)||Zl.throw(Zl.PAGE_NOTEXIST,o,r),F(t)||Zl.throw(Zl.PARAM_INVALID,o,n),s&&cl.makeSureValid(cl.updatePageDataIsValid(s),o,"updatePageOptions"),i(this,Gw).updatePage(e,t,s).catch((e=>Zl.reject(e)))}deletePages(e){const t="IDocument.deletePages",s="indices";if(Vw(e,!0,t,s))return !1;const o=cl.numberArrayIsValid(e,0,i(this,Xw)-1,void 0,0);if(o.length>0)return Mw(t,s,o),!1;const r=e.map((e=>i(this,$w).pages[e]));return i(this,Gw).deletePages(this.uid,r)}deleteAllPages(){return i(this,$w).pages.slice(),i(this,Gw).deleteAllPages(this.uid)}movePages(e,t){const s="IDocument.movePages",o="indices";cl.makeSureMissing(e,s,o),cl.makeSureValid(cl.numberArrayIsValid(e,0,i(this,Xw)-1,void 0,0),s,o),W(t)||cl.makeSureNumberValid(t,0,i(this,Xw)-1,s,"insertBeforeIndex"),i(this,Gw).movePages(this.uid,e,t);}switchPage(e,t){const s="IDocument.switchPage",o="oneIndex",r="anotherIndex";cl.makeSureMissing(e,s,o),cl.makeSureMissing(t,s,r),cl.makeSureNumberValid(e,0,i(this,Xw)-1,s,o),cl.makeSureNumberValid(t,0,i(this,Xw)-1,s,r),i(this,Gw).documentService.switchPage(this.uid,e,t);}rename(e){const t="IDocument.rename",s="name";return !Vw(e,!0,t,s)&&($(e)?i(this,Gw).documentService.renameDocument(this.uid,e):(Mw(t,s),!1))}setPageCustomData(e,t){const s="IDocument.setPageCustomData",o="pageUid";return cl.makeSureMissing(e,s,o),cl.makeSureMissing(t,s,"data"),cl.makeSureStringValid(e,s,o),Bw(e,this.pages,s,o,!1),i(this,Gw).setCustomData(e,t)}getPageCustomData(e){const t="IDocument.getPageCustomData",s="pageUid";return cl.makeSureMissing(e,t,s),cl.makeSureStringValid(e,t,s),Bw(e,this.pages,t,s,!1),i(this,Gw).getCustomData(e)}async saveToJpeg(e,t){const s="IDocument.saveToJpeg",o="index";cl.makeSureMissing(e,s,o),cl.makeSureNumberValid(e,0,i(this,Xw)-1,s,o),W(t)||cl.makeSureValid(cl.saveJpegSettingsIsValid(t),s,"saveJpegSettings");const r=this.pages[e];return i(this,Gw).fileSaveService.saveToJpeg(r,t).catch((e=>Zl.reject(e,s)))}saveToPng(e){const t="IDocument.saveToPng",s="index";cl.makeSureMissing(e,t,s),cl.makeSureNumberValid(e,0,i(this,Xw)-1,t,s);const o=this.pages[e];return i(this,Gw).fileSaveService.saveToPng(o).catch((e=>Zl.reject(e,t)))}saveToPdf(e,t){const s="IDocument.saveToPdf";0===this.pages.length&&Zl.throw(Zl.DOC_NOIMAGE),L(e)?cl.makeSureValid(cl.numberArrayIsValid(e,0,i(this,Xw)-1,void 0,0),s,"indices"):(t=e,e=Array.from(Array(this.pages.length).keys())),W(t)||cl.makeSureValid(cl.savePdfSettingsIsValid(t),s,"savePDFSettings");const o=[];return e.forEach((e=>{o.push(this.pages[e]);})),i(this,Gw).fileSaveService.saveToPdf(o,t).catch((e=>Zl.reject(e,s)))}saveToTiff(e,t){const s="IDocument.saveToTiff";0===this.pages.length&&Zl.throw(Zl.DOC_NOIMAGE),L(e)?cl.makeSureValid(cl.numberArrayIsValid(e,0,i(this,Xw)-1,void 0,0),s,"indices"):(t=e,e=Array.from(Array(this.pages.length).keys())),W(t)||cl.makeSureValid(cl.saveTiffSettingsIsValid(t),s,"saveTIFFSettings");const o=[];return e.forEach((e=>{o.push(this.pages[e]);})),i(this,Gw).fileSaveService.saveToTiff(o,t).catch((e=>Zl.throw(e,s)))}print(e){const t=W(e)?Array.from(Array(this.pages.length).keys()):e;0===this.pages.length&&Zl.throw(Zl.DOC_NOIMAGE),cl.makeSureValid(cl.numberArrayIsValid(t,0,i(this,Xw)-1,void 0,0),"IDocument.print","indices"),i(this,Gw).printPages(this.uid,t);}}function qw(){return i(this,$w).pages.length}const Qw=["documentCreated","documentDeleted","pagesAdded","pagesDeleted"];var Zw=new WeakMap,Jw=new WeakMap,Kw=new WeakMap;const eb=new class{constructor(){f(this,Zw,{writable:!0,value:void 0}),f(this,Jw,{writable:!0,value:void 0}),f(this,Kw,{writable:!0,value:void 0}),s(this,Kw,new J),s(this,Zw,qv),s(this,Jw,new Map);const{globalHooks:e}=qv;e.unload.on((()=>{i(this,Jw).clear(),i(this,Kw).removeAllEventListeners();})),e.createDocument.on((e=>{const t=i(this,Zw).getDocument(e.docUid),s=new Yw(i(this,Zw),t);i(this,Jw).set(s.uid,s),i(this,Kw).emit("documentCreated",e);})),e.deleteDocument.on((e=>{i(this,Jw).has(e.docUid)&&i(this,Jw).delete(e.docUid),i(this,Kw).emit("documentDeleted",e);}));}createDocument(e){W(e)||cl.makeSureDocOptionsValid(e,"DocumentManager.createDocument","createDocumentOptions");const t=i(this,Zw).createDocument(e);return i(this,Jw).get(t.uid)}getDocument(e){const t="DocumentManager.getDocument",s="docUid";cl.makeSureMissing(e,t,s),cl.makeSureStringValid(e,t,s);const o=i(this,Jw).get(e);return o||Zl.throw(Zl.DOC_NOTEXIST,t,s),o}getAllDocuments(){return Array.from(i(this,Jw).values())}deleteDocuments(e){const t="DocumentManager.deleteDocuments",s="docUids";if(Vw(e,!0,t,s))return !1;const o=cl.stringArrayIsValid(e,s);return o.length>0?(Mw(t,s,o),!1):!!zw(i(this,Jw),e,t,s)&&i(this,Zw).deleteDocuments([...new Set(e)])}deleteAllDocuments(){const e=i(this,Zw).documentService.getAllDocuments();return i(this,Zw).deleteDocuments(e.map((e=>e.uid)))}copyPagesToDocument(e,t,s){const o="DocumentManager.copyPagesToDocument",r="sourceDocUid",n="targetDocUid";cl.makeSureMissing(e,o,r),cl.makeSureMissing(t,o,n),cl.makeSureStringValid(e,o,r),cl.makeSureStringValid(t,o,n);const a=i(this,Jw).get(e),l=i(this,Jw).get(t);return a&&l||Zl.throw(Zl.DOC_NOTEXIST,o),W(s)||cl.makeSureTransferOptions(s,0,a.pages.length-1,o,"transferOptions"),i(this,Zw).transferDocument(e,t,{...s,copy:!0})}movePagesToDocument(e,t,s){const o="DocumentManager.movePagesToDocument",r="sourceDocUid",n="targetDocUid";cl.makeSureMissing(e,o,r),cl.makeSureMissing(t,o,n),cl.makeSureStringValid(e,o,r),cl.makeSureStringValid(t,o,n);const a=i(this,Jw).get(e),l=i(this,Jw).get(t);return a&&l||Zl.throw(Zl.DOC_NOTEXIST,o),W(s)||cl.makeSureTransferOptions(s,0,a.pages.length-1,o,"transferOptions"),i(this,Zw).transferDocument(e,t,s)}mergeDocuments(e,t){const s="DocumentManager.mergeDocuments",o="docUids";cl.makeSureMissing(e,s,o),cl.makeSureValid(cl.stringArrayIsValid(e,o),s,o),function(e){return new Set(e).size!==e.length}(e)&&Zl.throw(Zl.DOCUID_DUPLICATE),zw(i(this,Jw),e,s,o,!1),W(t)||cl.makeSureDocOptionsValid(t,s,"mergeDocumentOptions");const r=i(this,Zw).mergeDocuments(e,t);return i(this,Jw).get(r.uid)}on(e,t){const s="DocumentManager.on";Ww(e,t,s,!0)&&(Qw.includes(e)?i(this,Kw).on(e,t):Zl.OutputWarning(Zl.PARAM_NOTSUPPORT,s,"eventName"));}off(e,t){const s="DocumentManager.off";Ww(e,t,s,!0,!0)&&(Qw.includes(e)?i(this,Kw).off(e,t):Zl.OutputWarning(Zl.PARAM_NOTSUPPORT,s,"eventName"));}},tb={canvasStyle:{...Ky},quadSelectionStyle:{...tw},enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:80},ib=["canvasStyle","quadSelectionStyle"];var sb=new WeakMap,ob=new WeakSet;class rb{constructor(e){var o;p(this,ob),f(this,sb,{writable:!0,value:void 0}),t(this,"uid",void 0),t(this,"groupUid",void 0),t(this,"postfix",void 0);nc.makeSureCoreLicenseExist(),nc.makeSureCameraLicenseExist(),Rw("new CaptureViewer","option","captureViewer",e);const r=je((null==e?void 0:e.viewerConfig)||{},U({...tb,viewerMode:sl.CAPTURE})),n=j()?$y:qy;s(this,sb,qv.createViewer({uiConfig:U(n),...e,viewerConfig:r})),null!=e&&null!==(o=e.viewerConfig)&&void 0!==o&&o.enableAutoDetect&&!i(this,sb).context.core.documentDetectService.enableDetect&&Zl.OutputWarning(Zl.DOCDETECT_MISS),this.uid=i(this,sb).uid,this.groupUid=i(this,sb).groupUid,this.postfix=i(this,sb).postfix,qv.preloadModule("core"),u(this,ob,nb).call(this);}get isVisible(){return "visible"===i(this,sb).getViewerConfig().visibility}get isBoundContainer(){return i(this,sb).context.viewService.isBindContainer}get currentDocument(){var e;const t=null===(e=i(this,sb).getActiveTab())||void 0===e?void 0:e.uid;return t?eb.getDocument(t):null}get acceptedPolygonConfidence(){return i(this,sb).getCameraConfig().acceptedPolygonConfidence}set acceptedPolygonConfidence(e){const t="CaptureViewer.acceptedPolygonConfidence";G(e)?e<0||e>100?Zl.OutputWarning(Zl.PARAM_OUTOFRANGE,t,"acceptedPolygonConfidence"):i(this,sb).updateCameraConfig({acceptedPolygonConfidence:e}):Mw(t,"acceptedPolygonConfidence");}get maxFrameNumber(){return i(this,sb).getCameraConfig().maxFrameNumber}set maxFrameNumber(e){const t="CaptureViewer.maxFrameNumber",s="maxFrameNumber";G(e)?e<=0||e>60?Zl.OutputWarning(Zl.PARAM_OUTOFRANGE,t,s):i(this,sb).updateCameraConfig({maxFrameNumber:e}):Mw(t,s);}get enableAutoDetect(){return i(this,sb).getCameraConfig().enableAutoDetect}set enableAutoDetect(e){z(e)?(e&&!i(this,sb).context.core.documentDetectService.enableDetect&&Zl.OutputWarning(Zl.DOCDETECT_MISS),i(this,sb).updateCameraConfig({enableAutoDetect:e})):Mw("CaptureViewer.enableAutoDetect","enableAutoDetect");}get enableAutoCapture(){return i(this,sb).getCameraConfig().enableAutoCapture}set enableAutoCapture(e){z(e)?i(this,sb).updateCameraConfig({enableAutoCapture:e}):Mw("CaptureViewer.enableAutoCapture","enableAutoCapture");}bindContainer(e){cl.makeSureContainerValid(e,"CaptureViewer.bindContainer","container"),i(this,sb).bindContainer(e);}unbindContainer(){i(this,sb).unbindContainer();}show(){i(this,sb).show();}hide(){i(this,sb).hide();}openDocument(e){const t="CaptureViewer.openDocument",i="docUid";cl.makeSureMissing(e,t,i),cl.makeSureStringValid(e,t,i);qv.documentService.getDocument(e)||Zl.throw(Zl.DOC_NOTEXIST,t,i);try{qv.openDocument(e,this.uid);}catch(e){Zl.throw(e,t,i);}}closeDocument(){if(!Uw(i(this,sb)))return !1;try{i(this,sb).closeDocument();}catch(e){Zl.OutputWarning(e);}return !0}getStyle(e){const t="CaptureViewer.getStyle",s="styleName";if(Vw(e,!0,t,s))return null;if(!Pw(e,ib,t,s))return null;const o=i(this,sb).getViewerConfig();if(e in o){const t=ww(e,o[e]);return "quadSelectionStyle"===e?{border:t.border,background:t.background}:t}return null}updateStyle(e,t){const s="CaptureViewer.updateStyle";return !(Vw(e,!0,s,"name")||Vw(t,!0,s,"style")||!_w(e,t,ib,s))&&(i(this,sb).updateViewerConfig({[e]:t}),!0)}capture(){return i(this,sb).isVideoPlaying()?i(this,sb).context.viewService.isBindContainer?i(this,sb).capture():Zl.reject(Zl.CONTAINER_NOBOUND):Zl.reject(Zl.CAMERA_NOVIDEO)}play(e){const t="CaptureViewer.play";if(e){const i=[];if(null!=e&&e.fill&&!z(null==e?void 0:e.fill)&&i.push("fill is invalid."),null!=e&&e.resolution){const t=cl.numberArrayIsValid(null==e?void 0:e.resolution,0,void 0,"resolution");i.push(...t);}if(i.length>0){const e={...Zl.PARAM_INVALID,details:i};return Zl.reject(e,t,"config")}}return i(this,sb).play(e).catch((e=>Zl.reject(e,t)))}stop(){i(this,sb).stop();}getCurrentCamera(){return i(this,sb).getCurrentCamera()}getAllCameras(){return i(this,sb).getAllCameras()}selectCamera(e){const t="CaptureViewer.selectCamera",s="cameraObjectOrDeviceID";try{cl.makeSureCameraObject(e,t,s);}catch(e){return Promise.reject(e)}return i(this,sb).selectCamera(e).catch((e=>Zl.reject(e,t,s)))}getCurrentResolution(){return i(this,sb).getCurrentResolution()}turnOnTorch(){return i(this,sb).turnOnTorch().catch((e=>Zl.reject(e)))}turnOffTorch(){return i(this,sb).turnOffTorch().catch((e=>Zl.reject(e)))}getUiConfig(){return i(this,sb).getUiConfig()}updateUiConfig(e){return !!Ow(e,"captureViewer","CaptureViewer.updateUiConfig","uiConfig")&&i(this,sb).updateUiConfig(e)}on(e,t){Ww(e,t,"CaptureViewer.on")&&i(this,sb).on(e,t);}off(e,t){Ww(e,t,"CaptureViewer.off",!0,!0)&&i(this,sb).off(e,t);}destroy(){i(this,sb)&&i(this,sb).destroy();}}function nb(){i(this,sb).hooks.destroy.on((()=>{s(this,sb,null),Object.setPrototypeOf(this,null);}));}const ab={canvasStyle:{...Ky},pageStyle:{...ew},quadSelectionStyle:{...tw},enableSlide:!0},lb=["canvasStyle","pageStyle","quadSelectionStyle"];var hb=new WeakMap,cb=new WeakSet;class db{constructor(e){p(this,cb),f(this,hb,{writable:!0,value:void 0}),t(this,"uid",void 0),t(this,"groupUid",void 0),t(this,"postfix",void 0);nc.makeSureCoreLicenseExist(),Rw("new PerspectiveViewer","option","perspectiveViewer",e);const o=je((null==e?void 0:e.viewerConfig)||{},U({...ab,viewerMode:sl.PERSPECTIVE})),r=j()?Yy:Qy;s(this,hb,qv.createViewer({uiConfig:U(r),...e,viewerConfig:o})),this.uid=i(this,hb).uid,this.groupUid=i(this,hb).groupUid,this.postfix=i(this,hb).postfix,u(this,cb,ub).call(this);}get isVisible(){return "visible"===i(this,hb).getViewerConfig().visibility}get isBoundContainer(){return i(this,hb).context.viewService.isBindContainer}get currentDocument(){var e;const t=null===(e=i(this,hb).getActiveTab())||void 0===e?void 0:e.uid;return t?eb.getDocument(t):null}getUiConfig(){return i(this,hb).getUiConfig()}updateUiConfig(e){return !!Ow(e,"perspectiveViewer","PerspectiveViewer.updateUiConfig","uiConfig")&&i(this,hb).updateUiConfig(e)}bindContainer(e){cl.makeSureContainerValid(e,"PerspectiveViewer.bindContainer","container"),i(this,hb).bindContainer(e);}unbindContainer(){i(this,hb).unbindContainer();}show(){i(this,hb).show();}hide(){i(this,hb).hide();}openDocument(e){const t="PerspectiveViewer.openDocument",i="docUid";cl.makeSureMissing(e,t,i),cl.makeSureStringValid(e,t,i);qv.documentService.getDocument(e)||Zl.throw(Zl.DOC_NOTEXIST,t,i);try{qv.openDocument(e,this.uid);}catch(e){Zl.throw(e,t,i);}}closeDocument(){if(!Uw(i(this,hb)))return !1;try{i(this,hb).closeDocument();}catch(e){Zl.OutputWarning(e);}return !0}getStyle(e){const t="PerspectiveViewer.getStyle",s="styleName";if(Vw(e,!0,t,s))return null;if(!Pw(e,lb,t,s))return null;const o=i(this,hb).getViewerConfig();if(e in o){return ww(e,o[e])}return null}updateStyle(e,t){const s="PerspectiveViewer.updateStyle";return !(Vw(e,!0,s,"name")||Vw(t,!0,s,"style")||!_w(e,t,lb,s))&&(i(this,hb).updateViewerConfig({[e]:t}),!0)}setQuadSelection(e){const t="PerspectiveViewer.setQuadSelection",s="quad";if(Vw(e,!0,t,s))return !1;if(!Uw(i(this,hb),!0,!0))return !1;const o=cl.quadIsValid(e);if(o.length>0)return Mw(t,s,o),!1;if(!i(this,hb).isConvexQuad(e))return Zl.OutputWarning(Zl.PARAM_INVALID,t,s),!1;const{width:r,height:n}=i(this,hb).getRealPixelSize();return jw(e,r,n)?i(this,hb).setQuadBox(e):(Zl.OutputWarning(Zl.QUAD_EXCEEDPAGEBOUND),!1)}getQuadSelection(){return Uw(i(this,hb),!0)?i(this,hb).getQuadBox():null}resetQuadSelection(e){if(!Uw(i(this,hb),!0))return !1;if(!W(e)){const t=i(this,hb).getPageCounts(),s=cl.numberArrayIsValid(e,0,t-1,void 0,0);if(s.length>0)return Mw("PerspectiveViewer.resetQuadSelection","indices",s),!1}return i(this,hb).resetQuadBox(e)}rotate(e,t){return !!Fw(e,t,i(this,hb),"PerspectiveViewer.rotate")&&i(this,hb).rotatePages(e,t)}applyPerspective(e){const t="PerspectiveViewer.applyPerspective",s="quad";cl.makeSureMissing(e,t,s),cl.makeSureValid(cl.quadIsValid(e),t,s),i(this,hb).isConvexQuad(e)||Zl.throw(Zl.PARAM_INVALID,t,s),Uw(i(this,hb),!0,!1);const{width:o,height:r}=i(this,hb).getRealPixelSize();return jw(e,o,r)||Zl.throw(Zl.QUAD_EXCEEDPAGEBOUND),i(this,hb).perspectivePage(e)}saveOperations(){return !!Uw(i(this,hb))&&i(this,hb).saveOperations()}getCurrentPageIndex(){return Uw(i(this,hb),!0)?i(this,hb).getCurrentPageIndex():-1}getPageCount(){return Uw(i(this,hb))?i(this,hb).getPageCounts():-1}goToPage(e){return Nw(e,i(this,hb),0,"PerspectiveViewer.goToPage")?i(this,hb).gotoPage(e):-1}uidToIndex(e){const t="PerspectiveViewer.uidToIndex";if(!Lw(e,i(this,hb),t))return -1;return this.currentDocument.pages.includes(e)?i(this,hb).uidToIndex(e):(Zl.OutputWarning(Zl.PAGE_NOTEXIST,t,"uid"),-1)}indexToUid(e){return Nw(e,i(this,hb),0,"PerspectiveViewer.indexToUid")?i(this,hb).indexToUid(e):""}getCurrentPageUid(){return Uw(i(this,hb),!0)?i(this,hb).getCurrentPageUid():""}on(e,t){Ww(e,t,"PerspectiveViewer.on")&&i(this,hb).on(e,t);}off(e,t){Ww(e,t,"PerspectiveViewer.on",!0,!0)&&i(this,hb).off(e,t);}destroy(){i(this,hb)&&i(this,hb).destroy();}}function ub(){i(this,hb).hooks.destroy.on((()=>{s(this,hb,null),Object.setPrototypeOf(this,null);}));}class gb extends aw{constructor(e){super(e,"BrowseViewer");}get currentDocument(){var e;const t=null===(e=this.v.getActiveTab())||void 0===e?void 0:e.uid;return t?eb.getDocument(t):null}bindContainer(e){const t=`${this.errorPrefix}.bindContainer`;cl.makeSureContainerValid(e,t,"container"),this.v.bindContainer(e);}unbindContainer(){this.v.unbindContainer();}openDocument(e){const t=`${this.errorPrefix}.openDocument`,i="docUid";cl.makeSureMissing(e,t,i),cl.makeSureStringValid(e,t,i);qv.documentService.getDocument(e)||Zl.throw(Zl.DOC_NOTEXIST,t,i);try{qv.openDocument(e,this.uid);}catch(e){Zl.throw(e,t,i);}}closeDocument(){if(!Uw(this.v))return !1;try{this.v.closeDocument();}catch(e){Zl.OutputWarning(e);}return !0}rotate(e,t){const i=`${this.errorPrefix}.rotate`;return !!Fw(e,t,this.v,i)&&this.v.rotatePages(e,t)}indexToUid(e){const t=`${this.errorPrefix}.indexToUid`;return Nw(e,this.v,0,t)?this.v.indexToUid(e):""}uidToIndex(e){const t=`${this.errorPrefix}.uidToIndex`;if(!Lw(e,this.v,t))return -1;return this.currentDocument.pages.includes(e)?this.v.uidToIndex(e):(Zl.OutputWarning(Zl.PAGE_NOTEXIST,t,"uid"),-1)}getCurrentPageUid(){return Uw(this.v,!0)?this.v.getCurrentPageUid():""}getCurrentPageIndex(){return Uw(this.v,!0)?this.v.getCurrentPageIndex():-1}getPageCount(){return Uw(this.v)?this.v.getPageCounts():-1}goToPage(e){const t=`${this.errorPrefix}.goToPage`;return Nw(e,this.v,0,t)?this.v.gotoPage(e):-1}saveOperations(){return !!Uw(this.v)&&this.v.saveOperations()}}exports.EnumImageFilterType = void 0;var pb=new WeakMap,mb=new WeakMap,vb=new WeakMap,yb=new WeakSet;class wb{constructor(e){p(this,yb),f(this,pb,{writable:!0,value:void 0}),f(this,mb,{writable:!0,value:void 0}),f(this,vb,{writable:!0,value:!1}),t(this,"uid",void 0),t(this,"isDestroyed",!1),t(this,"postfix",void 0);this.uid=q(),this.postfix=`-${this.uid}`,s(this,mb,new J),Rw("new CustomViewer","option","customViewer",e);let o=null==e?void 0:e.uiConfig;(!o||B(o)&&0===Object.keys(o).length)&&(o={type:"Layout"}),u(this,yb,bb).call(this),s(this,pb,new Sf({container:null==e?void 0:e.container,emitter:i(this,mb),postfix:this.uid,uiConfig:o,injection:{viewer:{postfix:this.postfix}}})),null!=e&&e.container&&o&&i(this,pb).bindContainer(e.container);}get isBoundContainer(){return i(this,vb)}get isVisible(){return "none"!==i(this,pb).rootDom.style.display}hide(){i(this,pb).rootDom.style.display="none";}show(){i(this,pb).rootDom.style.display="flex";}getUiConfig(){return i(this,pb).uiConfig}updateUiConfig(e){return !!Ow(e,"customViewer","CustomViewer.updateUiConfig","uiConfig")&&i(this,pb).updateUiConfig(e)}bindContainer(e){cl.makeSureContainerValid(e,"CustomViewer.bindContainer","container");i(this,pb).bindContainer(e)&&s(this,vb,!0);}unbindContainer(){i(this,pb).unbindContainer(),s(this,vb,!1);}on(e,t){Ww(e,t,"CustomViewer.on")&&i(this,mb).on(e,t);}off(e,t){Ww(e,t,"CustomViewer.off",!0,!0)&&i(this,mb).off(e,t);}destroy(){this.isDestroyed||(i(this,pb).destroy(),i(this,mb).destroy(),s(this,pb,null),s(this,mb,null)),this.isDestroyed=!0,Object.setPrototypeOf(this,null);}}function bb(){Sf.registerComponent({Root:Df,Layout:Tf,Button:Pf,Blank:Ip,SeparatorLine:Ef,Close:Mp,Done:Np,Back:_p});}!function(e){e.NONE="none",e.BLACK_AND_WHITE="blackAndWhite",e.GRAY="gray",e.REMOVE_SHADOW="removeShadow",e.SAVE_INK="saveInk",e.ENHANCE="enhance",e.INVERT="invert";}(exports.EnumImageFilterType||(exports.EnumImageFilterType={}));const xb={documentManager:eb,Elements:Gy,DocumentDetect:fh,ImageFilter:Nh,BrowseViewer:gb,CaptureViewer:rb,CustomViewer:wb,EditViewer:fw,PerspectiveViewer:db,get versionInfo(){return {viewer:Bh,engine:Rl.version}},get lastError(){return qv.errorService.lastError},Experiments:{get(e,t){switch(e){case"WasmEnv":return Rl;case"ImageProcess":return new Ya;case"FileParser.Options":return qv.getFileParserDefaultOptions(t);default:return}},set(e,t){switch(e){case"FileParser.Options":return qv.setFileParserDefaultOptions(t.type,t.options);case"ClearExternalHandler":return qv.clearExternalHandler(t.type);default:return}}},setConfig(e){const t="DDV.setConfig",i="config";return cl.makeSureMissing(e,t,i),cl.makeSureValid(cl.configIsValid(e),t,i),qv.setConfig(e)},getDefaultUiConfig(e){const t="DDV.getDefaultUiConfig",i="viewerType";if(Vw(e,!0,t,i))return null;if(!$(e))return Zl.OutputWarning(Zl.PARAM_INVALID,t,i),null;if(-1===["editViewer","perspectiveViewer","browseViewer","captureViewer"].indexOf(e))return Zl.OutputWarning(Zl.PARAM_NOTSUPPORT,t,i),null;let s=null;if(j())switch(e){case"editViewer":s=Xy;break;case"perspectiveViewer":s=Yy;break;case"captureViewer":s=$y;break;case"browseViewer":s=Jy;}else switch(e){case"editViewer":s=Zy;break;case"perspectiveViewer":s=Qy;break;case"captureViewer":s=qy;break;case"browseViewer":s=Jy;}return U(s)},setProcessingHandler(e,t){const i="DDV.setProcessingHandler",s="type",o="handler";cl.makeSureMissing(e,i,s),cl.makeSureMissing(t,i,o),cl.makeSureExternalHandlerTypeValid(e,i,s);const r=e;switch(r){case"documentBoundariesDetect":cl.makeSureDocDetectHandlerValid(t,i,o);break;case"imageFilter":cl.makeSureImageFilterHandlerValid(t,i,o);}try{switch(r){case"documentBoundariesDetect":qv.setDetectHandler(e,t);break;case"imageFilter":qv.setImageFilterHandler(t);}}catch(e){Zl.throw(e,i);}},unload(){qv.unload(),qv.globalHooks.unload.emit();},clearLastError:()=>qv.errorService.clearLastError(),on(e,t){const i="DDV.on";if(!Ww(e,t,i,!1))return;let s;switch(e){case"error":s="error";break;case"warning":s="warning";break;case"verbose":s="verbose";}s?qv.errorService.on(s,t):Zl.throw(Zl.PARAM_NOTSUPPORT,i,"eventName");},off(e,t){const i="DDV.off";if(!Ww(e,t,i,!1,!0))return;let s;switch(e){case"error":s="error";break;case"warning":s="warning";break;case"verbose":s="verbose";}s?qv.errorService.off(s,t):Zl.throw(Zl.PARAM_NOTSUPPORT,i,"eventName");},EnumImageDataType:exports.EnumImageDataType,EnumConvertMode:exports.EnumConvertMode,EnumDocumentDetectionStatus:exports.EnumDocumentDetectionStatus,EnumImageFilterType:exports.EnumImageFilterType,EnumImageProcessMethodType:exports.EnumImageProcessMethodType,EnumPDFCompressionType:exports.EnumPDFCompressionType,EnumPDFPageType:exports.EnumPDFPageType,EnumTIFFCompressionType:exports.EnumTIFFCompressionType};window.Dynamsoft||(window.Dynamsoft={}),window.Dynamsoft.DDV=xb;

	exports.BrowseViewer = gb;
	exports.CaptureViewer = rb;
	exports.CustomViewer = wb;
	exports.DDV = xb;
	exports.EditViewer = fw;
	exports.PerspectiveViewer = db;

	return exports;

})({});
